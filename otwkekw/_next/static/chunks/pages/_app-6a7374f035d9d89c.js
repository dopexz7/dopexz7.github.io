(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{3454:function(e,t,n){"use strict";e.exports=n.g.process||n(7663)},1780:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return n(8510)}])},5819:function(e,t,n){"use strict";n.d(t,{Z:function(){return Ob},a:function(){return Db}});var r={};n.r(r),n.d(r,{FirebaseError:function(){return _},SDK_VERSION:function(){return oe},_DEFAULT_ENTRY_NAME:function(){return G},_addComponent:function(){return X},_addOrOverwriteComponent:function(){return Z},_apps:function(){return J},_clearComponents:function(){return re},_components:function(){return Y},_getProvider:function(){return te},_registerComponent:function(){return ee},_removeServiceInstance:function(){return ne},deleteApp:function(){return he},getApp:function(){return ce},getApps:function(){return ue},initializeApp:function(){return ae},onLog:function(){return de},registerVersion:function(){return le},setLogLevel:function(){return fe}});var i=n(5893),s=n(7294);const o=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,c=a?e[i+2]:0,u=t>>2,h=(3&t)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(o(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==a)throw Error();const c=t<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},c=function(e){return function(e){const t=o(e);return a.encodeByteArray(t,!0)}(e).replace(/\./g,"")},u=function(e){try{return a.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function h(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=h(e[n],t[n]));return e}class l{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function d(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[c(JSON.stringify({alg:"none",type:"JWT"})),c(JSON.stringify(s)),""].join(".")}function f(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function p(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(f())}function m(){try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function g(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function y(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function v(){const e=f();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function w(){return"object"===typeof indexedDB}class _ extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,_.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,b.prototype.create)}}class b{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(I,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new _(r,o,n)}}const I=/\{\$([^}]+)}/g;function T(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function E(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(k(n)&&k(s)){if(!E(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function k(e){return null!==e&&"object"===typeof e}function S(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function A(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function C(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function R(e,t){const n=new N(e,t);return n.subscribe.bind(n)}class N{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=D),void 0===r.error&&(r.error=D),void 0===r.complete&&(r.complete=D);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function D(){}function O(e){return e&&e._delegate?e._delegate:e}class P{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const x="[DEFAULT]";class L{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new l;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:x})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&s.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(Oy){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===x?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(Oy){}var r;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:x:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class M{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new L(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const U=[];var F;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(F||(F={}));const V={debug:F.DEBUG,verbose:F.VERBOSE,info:F.INFO,warn:F.WARN,error:F.ERROR,silent:F.SILENT},q=F.INFO,j={[F.DEBUG]:"log",[F.VERBOSE]:"log",[F.INFO]:"info",[F.WARN]:"warn",[F.ERROR]:"error"},B=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=j[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class z{constructor(e){this.name=e,this._logLevel=q,this._logHandler=B,this._userLogHandler=null,U.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in F))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?V[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,F.DEBUG,...e),this._logHandler(this,F.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,F.VERBOSE,...e),this._logHandler(this,F.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,F.INFO,...e),this._logHandler(this,F.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,F.WARN,...e),this._logHandler(this,F.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,F.ERROR,...e),this._logHandler(this,F.ERROR,...e)}}class ${constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const K="@firebase/app",H="0.7.14",W=new z("@firebase/app"),G="[DEFAULT]",Q={[K]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},J=new Map,Y=new Map;function X(e,t){try{e.container.addComponent(t)}catch(n){W.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Z(e,t){e.container.addOrOverwriteComponent(t)}function ee(e){const t=e.name;if(Y.has(t))return W.debug(`There were multiple attempts to register component ${t}.`),!1;Y.set(t,e);for(const n of J.values())X(n,e);return!0}function te(e,t){return e.container.getProvider(t)}function ne(e,t,n=G){te(e,t).clearInstance(n)}function re(){Y.clear()}const ie=new b("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class se{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new P("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ie.create("app-deleted",{appName:this._name})}}const oe="9.6.4";function ae(e,t={}){if("object"!==typeof t){t={name:t}}const n=Object.assign({name:G,automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!==typeof r||!r)throw ie.create("bad-app-name",{appName:String(r)});const i=J.get(r);if(i){if(E(e,i.options)&&E(n,i.config))return i;throw ie.create("duplicate-app",{appName:r})}const s=new M(r);for(const a of Y.values())s.addComponent(a);const o=new se(e,n,s);return J.set(r,o),o}function ce(e=G){const t=J.get(e);if(!t)throw ie.create("no-app",{appName:e});return t}function ue(){return Array.from(J.values())}async function he(e){const t=e.name;J.has(t)&&(J.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function le(e,t,n){var r;let i=null!==(r=Q[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void W.warn(e.join(" "))}ee(new P(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}function de(e,t){if(null!==e&&"function"!==typeof e)throw ie.create("invalid-log-argument");!function(e,t){for(const n of U){let r=null;t&&t.level&&(r=V[t.level]),n.userLogHandler=null===e?null:(t,n,...i)=>{const s=i.map((e=>{if(null==e)return null;if("string"===typeof e)return e;if("number"===typeof e||"boolean"===typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}})).filter((e=>e)).join(" ");n>=(null!==r&&void 0!==r?r:t.logLevel)&&e({level:F[n].toLowerCase(),message:s,args:i,type:t.name})}}}(e,t)}function fe(e){var t;t=e,U.forEach((e=>{e.setLogLevel(t)}))}var pe;pe="",ee(new P("platform-logger",(e=>new $(e)),"PRIVATE")),le(K,H,pe),le(K,H,"esm2017"),le("fire-js","");class me{constructor(e,t){this._delegate=e,this.firebase=t,X(e,new P("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),he(this._delegate))))}_getService(e,t=G){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=G){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){X(this._delegate,e)}_addOrOverwriteComponent(e){Z(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const ge=new b("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."});const ye=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(r,i={}){const s=ae(r,i);if(T(t,s.name))return t[s.name];const o=new e(s,n);return t[s.name]=o,o},app:i,registerVersion:le,setLogLevel:fe,onLog:de,apps:null,SDK_VERSION:oe,INTERNAL:{registerComponent:function(t){const r=t.name,s=r.replace("-compat","");if(ee(t)&&"PUBLIC"===t.type){const o=(e=i())=>{if("function"!==typeof e[s])throw ge.create("invalid-app-argument",{appName:r});return e[s]()};void 0!==t.serviceProps&&h(o,t.serviceProps),n[s]=o,e.prototype[s]=function(...e){return this._getService.bind(this,r).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[s]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:r}};function i(e){if(!T(t,e=e||G))throw ge.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),i.App=e,n}(me);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){h(t,e)},createSubscribe:R,ErrorFactory:b,deepExtend:h}),t}(),ve=new z("@firebase/app-compat");if("object"===typeof self&&self.self===self&&void 0!==self.firebase){ve.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&ve.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const we=ye;!function(e){le("@firebase/app-compat","0.1.15",e)}();we.registerVersion("firebase","9.6.4","app-compat");function _e(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;const be="facebook.com",Ie="github.com",Te="google.com",Ee="password",ke="twitter.com",Se="EMAIL_SIGNIN",Ae="PASSWORD_RESET",Ce="RECOVER_EMAIL",Re="REVERT_SECOND_FACTOR_ADDITION",Ne="VERIFY_AND_CHANGE_EMAIL",De="VERIFY_EMAIL";function Oe(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Pe=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},xe=Oe,Le=new b("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Me=new z("@firebase/auth");function Ue(e,...t){Me.logLevel<=F.ERROR&&Me.error(`Auth (${oe}): ${e}`,...t)}function Fe(e,...t){throw Be(e,...t)}function Ve(e,...t){return Be(e,...t)}function qe(e,t,n){const r=Object.assign(Object.assign({},xe()),{[t]:n});return new b("auth","Firebase",r).create(t,{appName:e.name})}function je(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&Fe(e,"argument-error"),qe(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Be(e,...t){if("string"!==typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return Le.create(e,...t)}function ze(e,t,...n){if(!e)throw Be(t,...n)}function $e(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Ue(t),new Error(t)}function Ke(e,t){e||$e(t)}const He=new Map;function We(e){Ke(e instanceof Function,"Expected a class definition");let t=He.get(e);return t?(Ke(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,He.set(e,t),t)}function Ge(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Qe(){return"http:"===Je()||"https:"===Je()}function Je(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class Ye{constructor(e,t){this.shortDelay=e,this.longDelay=t,Ke(t>e,"Short delay should be less than long delay!"),this.isMobile=p()||y()}get(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(Qe()||g()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Xe(e,t){Ke(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Ze{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:void $e("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:void $e("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:void $e("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const et={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},tt=new Ye(3e4,6e4);function nt(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function rt(e,t,n,r,i={}){return it(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=S(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),Ze.fetch()(ot(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function it(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},et),t);try{const t=new at(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw ct(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw ct(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw ct(e,"email-already-in-use",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw qe(e,a,o);Fe(e,a)}}catch(i){if(i instanceof _)throw i;Fe(e,"network-request-failed")}}async function st(e,t,n,r,i={}){const s=await rt(e,t,n,r,i);return"mfaPendingCredential"in s&&Fe(e,"multi-factor-auth-required",{_serverResponse:s}),s}function ot(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?Xe(e.config,i):`${e.config.apiScheme}://${i}`}class at{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Ve(this.auth,"network-request-failed"))),tt.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function ct(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=Ve(e,t,r);return i.customData._tokenResponse=n,i}function ut(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function ht(e){return 1e3*Number(e)}function lt(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Ue("JWT malformed, contained fewer than 3 sections"),null;try{const e=u(n);return e?JSON.parse(e):(Ue("Failed to decode base64 JWT payload"),null)}catch(i){return Ue("Caught error parsing JWT payload as JSON",i),null}}async function dt(e,t,n=!1){if(n)return t;try{return await t}catch(r){throw r instanceof _&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(r)&&e.auth.currentUser===e&&await e.auth.signOut(),r}}class ft{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class pt{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ut(this.lastLoginAt),this.creationTime=ut(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function mt(e){var t;const n=e.auth,r=await e.getIdToken(),i=await dt(e,async function(e,t){return rt(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));ze(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=_e(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[];const a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const h=e.isAnonymous,l=!(e.email&&s.passwordHash)&&!(null===a||void 0===a?void 0:a.length),d=!!h&&l,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new pt(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class gt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ze(e.idToken,"internal-error"),ze("undefined"!==typeof e.idToken,"internal-error"),ze("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):function(e){const t=lt(e);return ze(t,"internal-error"),ze("undefined"!==typeof t.exp,"internal-error"),ze("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return ze(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await it(e,{},(async()=>{const n=S({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=ot(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Ze.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new gt;return n&&(ze("string"===typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(ze("string"===typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(ze("number"===typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new gt,this.toJSON())}_performRefresh(){return $e("not implemented")}}function yt(e,t){ze("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class vt{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=_e(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new ft(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.metadata=new pt(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await dt(this,this.stsTokenManager.getToken(this.auth,e));return ze(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=O(e),r=await n.getIdToken(t),i=lt(r);ze(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"===typeof i.firebase?i.firebase:void 0,o=null===s||void 0===s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:ut(ht(i.auth_time)),issuedAtTime:ut(ht(i.iat)),expirationTime:ut(ht(i.exp)),signInProvider:o||null,signInSecondFactor:(null===s||void 0===s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=O(e);await mt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(ze(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new vt(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){ze(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await mt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await dt(this,async function(e,t){return rt(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,l=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:b,stsTokenManager:I}=t;ze(v&&I,e,"internal-error");const T=gt.fromJSON(this.name,I);ze("string"===typeof v,e,"internal-error"),yt(h,e.name),yt(l,e.name),ze("boolean"===typeof w,e,"internal-error"),ze("boolean"===typeof _,e,"internal-error"),yt(d,e.name),yt(f,e.name),yt(p,e.name),yt(m,e.name),yt(g,e.name),yt(y,e.name);const E=new vt({uid:v,auth:e,email:l,emailVerified:w,displayName:h,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return b&&Array.isArray(b)&&(E.providerData=b.map((e=>Object.assign({},e)))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,n=!1){const r=new gt;r.updateFromServerResponse(t);const i=new vt({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await mt(i),i}}class wt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}wt.type="NONE";const _t=wt;function bt(e,t,n){return`firebase:${e}:${t}:${n}`}class It{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=bt(this.userKey,r.apiKey,i),this.fullPersistenceKey=bt("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?vt._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new It(We(_t),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||We(_t);const s=bt(n,e.config.apiKey,e.name);let o=null;for(const c of t)try{const t=await c._get(s);if(t){const n=vt._fromJSON(e,t);c!==i&&(o=n),i=c;break}}catch(Oy){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(Oy){}}))),new It(i,e,n)):new It(i,e,n)}}function Tt(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(At(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Et(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Rt(t))return"Blackberry";if(Nt(t))return"Webos";if(kt(t))return"Safari";if((t.includes("chrome/")||St(t))&&!t.includes("edge/"))return"Chrome";if(Ct(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function Et(e=f()){return/firefox\//i.test(e)}function kt(e=f()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function St(e=f()){return/crios\//i.test(e)}function At(e=f()){return/iemobile/i.test(e)}function Ct(e=f()){return/android/i.test(e)}function Rt(e=f()){return/blackberry/i.test(e)}function Nt(e=f()){return/webos/i.test(e)}function Dt(e=f()){return/iphone|ipad|ipod/i.test(e)}function Ot(e=f()){return Dt(e)||Ct(e)||Nt(e)||Rt(e)||/windows phone/i.test(e)||At(e)}function Pt(e,t=[]){let n;switch(e){case"Browser":n=Tt(f());break;case"Worker":n=`${Tt(f())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${oe}/${r}`}class xt{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Mt(this),this.idTokenSubscription=new Mt(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Le,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=We(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await It.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(i){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e)):void 0}async initializeCurrentUser(e){var t;let n=await this.assertedPersistence.getCurrentUser();if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null===n||void 0===n?void 0:n._redirectEventId,s=await this.tryRedirectSignIn(e);r&&r!==i||!(null===s||void 0===s?void 0:s.user)||(n=s.user)}return n?n._redirectEventId?(ze(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)):this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await mt(e)}catch(t){if("auth/network-request-failed"!==t.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?O(e):null;return t&&ze(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&ze(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(We(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new b("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&We(e)||this._popupRedirectResolver;ze(t,this,"argument-error"),this.redirectPersistenceManager=await It.create(this,[We(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return ze(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"===typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ze(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Pt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};return this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId),e}}function Lt(e){return O(e)}class Mt{constructor(e){this.auth=e,this.observer=null,this.addObserver=R((e=>this.observer=e))}get next(){return ze(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Ut(e,t,n){const r=Lt(e);ze(r._canInitEmulator,r,"emulator-config-failed"),ze(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null===n||void 0===n?void 0:n.disableWarnings),s=Ft(t),{host:o,port:a}=function(e){const t=Ft(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Vt(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Vt(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Ft(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Vt(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class qt{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return $e("not implemented")}_getIdTokenResponse(e){return $e("not implemented")}_linkToIdToken(e,t){return $e("not implemented")}_getReauthenticationResolver(e){return $e("not implemented")}}async function jt(e,t){return rt(e,"POST","/v1/accounts:resetPassword",nt(e,t))}async function Bt(e,t){return rt(e,"POST","/v1/accounts:update",t)}async function zt(e,t){return rt(e,"POST","/v1/accounts:sendOobCode",nt(e,t))}class $t extends qt{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new $t(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new $t(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return st(e,"POST","/v1/accounts:signInWithPassword",nt(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return st(e,"POST","/v1/accounts:signInWithEmailLink",nt(e,t))}(e,{email:this._email,oobCode:this._password});default:Fe(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Bt(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return st(e,"POST","/v1/accounts:signInWithEmailLink",nt(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Fe(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Kt(e,t){return st(e,"POST","/v1/accounts:signInWithIdp",nt(e,t))}class Ht extends qt{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ht(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Fe("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=_e(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Ht(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return Kt(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Kt(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Kt(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=S(t)}return e}}const Wt={USER_NOT_FOUND:"user-not-found"};class Gt extends qt{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Gt({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Gt({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return st(e,"POST","/v1/accounts:signInWithPhoneNumber",nt(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await st(e,"POST","/v1/accounts:signInWithPhoneNumber",nt(e,t));if(n.temporaryProof)throw ct(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return st(e,"POST","/v1/accounts:signInWithPhoneNumber",nt(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Wt)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Gt({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Qt{constructor(e){var t,n,r,i,s,o;const a=A(C(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);ze(c&&u&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=A(C(e)).link,n=t?A(C(t)).deep_link_id:null,r=A(C(e)).deep_link_id;return(r?A(C(r)).link:null)||r||n||t||e}(e);try{return new Qt(t)}catch(Oy){return null}}}class Jt{constructor(){this.providerId=Jt.PROVIDER_ID}static credential(e,t){return $t._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Qt.parseLink(t);return ze(n,"argument-error"),$t._fromEmailAndCode(e,n.code,n.tenantId)}}Jt.PROVIDER_ID="password",Jt.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Jt.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Yt{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Xt extends Yt{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Zt extends Xt{static credentialFromJSON(e){const t="string"===typeof e?JSON.parse(e):e;return ze("providerId"in t&&"signInMethod"in t,"argument-error"),Ht._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return ze(e.idToken||e.accessToken,"argument-error"),Ht._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Zt.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Zt.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!n&&!r&&!t&&!i)return null;if(!o)return null;try{return new Zt(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(a){return null}}}class en extends Xt{constructor(){super("facebook.com")}static credential(e){return Ht._fromParams({providerId:en.PROVIDER_ID,signInMethod:en.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return en.credentialFromTaggedObject(e)}static credentialFromError(e){return en.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return en.credential(e.oauthAccessToken)}catch(Oy){return null}}}en.FACEBOOK_SIGN_IN_METHOD="facebook.com",en.PROVIDER_ID="facebook.com";class tn extends Xt{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ht._fromParams({providerId:tn.PROVIDER_ID,signInMethod:tn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return tn.credentialFromTaggedObject(e)}static credentialFromError(e){return tn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return tn.credential(t,n)}catch(Oy){return null}}}tn.GOOGLE_SIGN_IN_METHOD="google.com",tn.PROVIDER_ID="google.com";class nn extends Xt{constructor(){super("github.com")}static credential(e){return Ht._fromParams({providerId:nn.PROVIDER_ID,signInMethod:nn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nn.credentialFromTaggedObject(e)}static credentialFromError(e){return nn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return nn.credential(e.oauthAccessToken)}catch(Oy){return null}}}nn.GITHUB_SIGN_IN_METHOD="github.com",nn.PROVIDER_ID="github.com";class rn extends qt{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Kt(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Kt(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Kt(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new rn(n,i):null}static _create(e,t){return new rn(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class sn extends Yt{constructor(e){ze(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return sn.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return sn.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=rn.fromJSON(e);return ze(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return rn._create(n,t)}catch(r){return null}}}class on extends Xt{constructor(){super("twitter.com")}static credential(e,t){return Ht._fromParams({providerId:on.PROVIDER_ID,signInMethod:on.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return on.credentialFromTaggedObject(e)}static credentialFromError(e){return on.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return on.credential(t,n)}catch(Oy){return null}}}async function an(e,t){return st(e,"POST","/v1/accounts:signUp",nt(e,t))}on.TWITTER_SIGN_IN_METHOD="twitter.com",on.PROVIDER_ID="twitter.com";class cn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await vt._fromIdTokenResponse(e,n,r),s=un(n);return new cn({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=un(n);return new cn({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function un(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class hn extends _{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,hn.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new hn(e,t,n,r)}}function ln(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw hn._fromErrorAndOperation(e,n,t,r);throw n}))}function dn(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function fn(e,t){const n=O(e);await mn(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return rt(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),i=dn(r||[]);return n.providerData=n.providerData.filter((e=>i.has(e.providerId))),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function pn(e,t,n=!1){const r=await dt(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return cn._forOperation(e,"link",r)}async function mn(e,t,n){await mt(t);const r=!1===e?"provider-already-linked":"no-such-provider";ze(dn(t.providerData).has(n)===e,t.auth,r)}async function gn(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await dt(e,ln(r,i,t,e),n);ze(s.idToken,r,"internal-error");const o=lt(s.idToken);ze(o,r,"internal-error");const{sub:a}=o;return ze(e.uid===a,r,"user-mismatch"),cn._forOperation(e,i,s)}catch(s){throw"auth/user-not-found"===(null===s||void 0===s?void 0:s.code)&&Fe(r,"user-mismatch"),s}}async function yn(e,t,n=!1){const r="signIn",i=await ln(e,r,t),s=await cn._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function vn(e,t){return yn(Lt(e),t)}async function wn(e,t){const n=O(e);return await mn(!1,n,t.providerId),pn(n,t)}async function _n(e,t){return gn(O(e),t)}async function bn(e,t){const n=Lt(e),r=await async function(e,t){return st(e,"POST","/v1/accounts:signInWithCustomToken",nt(e,t))}(n,{token:t,returnSecureToken:!0}),i=await cn._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}class In{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Tn._fromServerResponse(e,t):Fe(e,"internal-error")}}class Tn extends In{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Tn(t)}}function En(e,t,n){var r;ze((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),ze("undefined"===typeof n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(ze(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(ze(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function kn(e,t,n){const r=O(e),i={requestType:"PASSWORD_RESET",email:t};n&&En(r,i,n),await async function(e,t){return zt(e,t)}(r,i)}async function Sn(e,t){await async function(e,t){return rt(e,"POST","/v1/accounts:update",nt(e,t))}(O(e),{oobCode:t})}async function An(e,t){const n=O(e),r=await jt(n,{oobCode:t}),i=r.requestType;switch(ze(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":ze(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":ze(r.mfaInfo,n,"internal-error");default:ze(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=In._fromServerResponse(Lt(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function Cn(e,t,n){const r=O(e),i={requestType:"EMAIL_SIGNIN",email:t};ze(n.handleCodeInApp,r,"argument-error"),n&&En(r,i,n),await async function(e,t){return zt(e,t)}(r,i)}async function Rn(e,t){const n={identifier:t,continueUri:Qe()?Ge():"http://localhost"},{signinMethods:r}=await async function(e,t){return rt(e,"POST","/v1/accounts:createAuthUri",nt(e,t))}(O(e),n);return r||[]}async function Nn(e,t){const n=O(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&En(n.auth,r,t);const{email:i}=await async function(e,t){return zt(e,t)}(n.auth,r);i!==e.email&&await e.reload()}async function Dn(e,t,n){const r=O(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&En(r.auth,i,n);const{email:s}=await async function(e,t){return zt(e,t)}(r.auth,i);s!==e.email&&await e.reload()}async function On(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=O(e),i={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=await dt(r,async function(e,t){return rt(e,"POST","/v1/accounts:update",t)}(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find((({providerId:e})=>"password"===e));o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(s)}async function Pn(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await dt(e,Bt(r,i));await e._updateTokensIfNecessary(s,!0)}class xn{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Ln extends xn{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Mn extends xn{constructor(e,t){super(e,"facebook.com",t)}}class Un extends Ln{constructor(e,t){super(e,"github.com",t,"string"===typeof(null===t||void 0===t?void 0:t.login)?null===t||void 0===t?void 0:t.login:null)}}class Fn extends xn{constructor(e,t){super(e,"google.com",t)}}class Vn extends Ln{constructor(e,t,n){super(e,"twitter.com",t,n)}}function qn(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null===e||void 0===e?void 0:e.idToken)){const r=null===(n=null===(t=lt(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new xn(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new Mn(s,i);case"github.com":return new Un(s,i);case"google.com":return new Fn(s,i);case"twitter.com":return new Vn(s,i,e.screenName||null);case"custom":case"anonymous":return new xn(s,null);default:return new xn(s,r,i)}}(n)}class jn{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new jn("enroll",e)}static _fromMfaPendingCredential(e){return new jn("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null===e||void 0===e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return jn._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return jn._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Bn{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=Lt(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map((e=>In._fromServerResponse(n,e)));ze(r.mfaPendingCredential,n,"internal-error");const s=jn._fromMfaPendingCredential(r.mfaPendingCredential);return new Bn(s,i,(async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await cn._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return ze(t.user,n,"internal-error"),cn._forOperation(t.user,t.operationType,o);default:Fe(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}class zn{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>In._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new zn(e)}async getSession(){return jn._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e,r=await this.getSession(),i=await dt(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"===typeof e?e:e.uid,n=await this.user.getIdToken(),r=await dt(this.user,function(e,t){return rt(e,"POST","/v2/accounts/mfaEnrollment:withdraw",nt(e,t))}(this.user.auth,{idToken:n,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(i){if("auth/user-token-expired"!==i.code)throw i}}}const $n=new WeakMap;const Kn="__sak";class Hn{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Kn,"1"),this.storage.removeItem(Kn),Promise.resolve(!0)):Promise.resolve(!1)}catch(Oy){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Wn extends Hn{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=f();return kt(e)||Dt(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Ot(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);v()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Wn.type="LOCAL";const Gn=Wn;class Qn extends Hn{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Qn.type="SESSION";const Jn=Qn;class Yn{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Yn(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null===s||void 0===s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Xn(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}Yn.receivers=[];class Zn{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=Xn("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function er(){return window}function tr(){return"undefined"!==typeof er().WorkerGlobalScope&&"function"===typeof er().importScripts}const nr="firebaseLocalStorageDb",rr="firebaseLocalStorage",ir="fbase_key";class sr{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function or(e,t){return e.transaction([rr],t?"readwrite":"readonly").objectStore(rr)}function ar(){const e=indexedDB.open(nr,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(rr,{keyPath:ir})}catch(r){n(r)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(rr)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(nr);return new sr(e).toPromise()}(),t(await ar()))}))}))}async function cr(e,t,n){const r=or(e,!0).put({[ir]:t,value:n});return new sr(r).toPromise()}function ur(e,t){const n=or(e,!0).delete(t);return new sr(n).toPromise()}class hr{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await ar()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return tr()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Yn._getInstance(tr()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Zn(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(Oy){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await ar();return await cr(e,Kn,"1"),await ur(e,Kn),!0}catch(Oy){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>cr(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=or(e,!1).get(t),r=await new sr(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>ur(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=or(e,!1).getAll();return new sr(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}hr.type="LOCAL";const lr=hr;function dr(e){return new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=Ve("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}))}function fr(e){return`__${e}${Math.floor(1e6*Math.random())}`}const pr=1e12;class mr{constructor(e){this.auth=e,this.counter=pr,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new gr(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||pr;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||pr;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||pr;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class gr{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"===typeof e?document.getElementById(e):e;ze(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(n){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(n){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const yr=fr("rcb"),vr=new Ye(3e4,6e4);class wr{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!er().grecaptcha}load(e,t=""){return ze(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(er().grecaptcha):new Promise(((n,r)=>{const i=er().setTimeout((()=>{r(Ve(e,"network-request-failed"))}),vr.get());er()[yr]=()=>{er().clearTimeout(i),delete er()[yr];const s=er().grecaptcha;if(!s)return void r(Ve(e,"internal-error"));const o=s.render;s.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(s)};dr(`https://www.google.com/recaptcha/api.js??${S({onload:yr,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(i),r(Ve(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!er().grecaptcha&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class _r{async load(e){return new mr(e)}clearedOneInstance(){}}const br="recaptcha",Ir={theme:"light",type:"image"};class Tr{constructor(e,t=Object.assign({},Ir),n){this.parameters=t,this.type=br,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Lt(n),this.isInvisible="invisible"===this.parameters.size,ze("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"===typeof e?document.getElementById(e):e;ze(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new _r:new wr,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){ze(!this.parameters.sitekey,this.auth,"argument-error"),ze(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),ze("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"===typeof e)e(t);else if("string"===typeof e){const n=er()[e];"function"===typeof n&&n(t)}}}assertNotDestroyed(){ze(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){ze(Qe()&&!tr(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await rt(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);ze(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return ze(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Er{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Gt._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function kr(e,t,n){var r;const i=await n.verify();try{let s;if(ze("string"===typeof i,e,"argument-error"),ze(n.type===br,e,"argument-error"),s="string"===typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){ze("enroll"===t.type,e,"internal-error");return(await function(e,t){return rt(e,"POST","/v2/accounts/mfaEnrollment:start",nt(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}})).phoneSessionInfo.sessionInfo}{ze("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;ze(n,e,"missing-multi-factor-info");return(await function(e,t){return rt(e,"POST","/v2/accounts/mfaSignIn:start",nt(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return rt(e,"POST","/v1/accounts:sendVerificationCode",nt(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class Sr{constructor(e){this.providerId=Sr.PROVIDER_ID,this.auth=Lt(e)}verifyPhoneNumber(e,t){return kr(this.auth,e,O(t))}static credential(e,t){return Gt._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Sr.credentialFromTaggedObject(t)}static credentialFromError(e){return Sr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Gt._fromTokenResponse(t,n):null}}function Ar(e,t){return t?We(t):(ze(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Sr.PROVIDER_ID="phone",Sr.PHONE_SIGN_IN_METHOD="phone";class Cr extends qt{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Kt(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Kt(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Kt(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Rr(e){return yn(e.auth,new Cr(e),e.bypassAuthState)}function Nr(e){const{auth:t,user:n}=e;return ze(n,t,"internal-error"),gn(n,new Cr(e),e.bypassAuthState)}async function Dr(e){const{auth:t,user:n}=e;return ze(n,t,"internal-error"),pn(n,new Cr(e),e.bypassAuthState)}class Or{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Rr;case"linkViaPopup":case"linkViaRedirect":return Dr;case"reauthViaPopup":case"reauthViaRedirect":return Nr;default:Fe(this.auth,"internal-error")}}resolve(e){Ke(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ke(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Pr=new Ye(2e3,1e4);class xr extends Or{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,xr.currentPopupAction&&xr.currentPopupAction.cancel(),xr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ze(e,this.auth,"internal-error"),e}async onExecution(){Ke(1===this.filter.length,"Popup operations only handle one event");const e=Xn();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Ve(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Ve(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,xr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Ve(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,Pr.get())};e()}}xr.currentPopupAction=null;const Lr=new Map;class Mr extends Or{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Lr.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Vr(t),r=Fr(e);if(!(await r._isAvailable()))return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Lr.set(this.auth._key(),e)}return this.bypassAuthState||Lr.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Ur(e,t){return Fr(e)._set(Vr(t),"true")}function Fr(e){return We(e._redirectPersistence)}function Vr(e){return bt("pendingRedirect",e.config.apiKey,e.name)}function qr(e,t,n){return async function(e,t,n){const r=Lt(e);je(e,t,Yt);const i=Ar(r,n);return await Ur(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function jr(e,t,n){return async function(e,t,n){const r=O(e);je(r.auth,t,Yt);const i=Ar(r.auth,n);await Ur(i,r.auth);const s=await $r(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}function Br(e,t,n){return async function(e,t,n){const r=O(e);je(r.auth,t,Yt);const i=Ar(r.auth,n);await mn(!1,r,t.providerId),await Ur(i,r.auth);const s=await $r(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}async function zr(e,t,n=!1){const r=Lt(e),i=Ar(r,t),s=new Mr(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function $r(e){const t=Xn(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Kr{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Wr(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Wr(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Ve(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Hr(e))}saveEventToCache(e){this.cachedEventUids.add(Hr(e)),this.lastProcessedEventTime=Date.now()}}function Hr(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Wr({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null===t||void 0===t?void 0:t.code)}async function Gr(e,t={}){return rt(e,"GET","/v1/projects",t)}const Qr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Jr=/^https?/;function Yr(e){const t=Ge(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Jr.test(n))return!1;if(Qr.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Xr=new Ye(3e4,6e4);function Zr(){const e=er().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let ei=null;function ti(e){return ei=ei||function(e){return new Promise(((t,n)=>{var r,i,s;function o(){Zr(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Zr(),n(Ve(e,"network-request-failed"))},timeout:Xr.get()})}if(null===(i=null===(r=er().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=er().gapi)||void 0===s?void 0:s.load)){const t=fr("iframefcb");return er()[t]=()=>{gapi.load?o():n(Ve(e,"network-request-failed"))},dr(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw ei=null,e}))}(e),ei}const ni=new Ye(5e3,15e3),ri={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ii=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function si(e){const t=e.config;ze(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Xe(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:oe},i=ii.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${S(r).slice(1)}`}const oi={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ai{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function ci(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},oi),{width:r.toString(),height:i.toString(),top:s,left:o}),u=f().toLowerCase();n&&(a=St(u)?"_blank":n),Et(u)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=f()){var t;return Dt(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new ai(null);const l=window.open(t||"",a,h);ze(l,e,"popup-blocked");try{l.focus()}catch(d){}return new ai(l)}const ui="__/auth/handler",hi="emulator/auth/handler";function li(e,t,n,r,i,s){ze(e.config.authDomain,e,"auth-domain-config-required"),ze(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:oe,eventId:i};if(t instanceof Yt){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof Xt){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const c of Object.keys(a))void 0===a[c]&&delete a[c];return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${ui}`;return Xe(e,hi)}(e)}?${S(a).slice(1)}`}const di="webStorageSupport";const fi=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Jn,this._completeRedirectFn=zr}async _openPopup(e,t,n,r){var i;Ke(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return ci(e,li(e,t,n,Ge(),r),Xn())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=li(e,t,n,Ge(),r),er().location.href=i,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Ke(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await ti(e),n=er().gapi;return ze(n,e,"internal-error"),t.open({where:document.body,url:si(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ri,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=Ve(e,"network-request-failed"),s=er().setTimeout((()=>{r(i)}),ni.get());function o(){er().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new Kr(e);return t.register("authEvent",(t=>{ze(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(di,{type:di},(n=>{var r;const i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r.webStorageSupport;void 0!==i&&t(!!i),Fe(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await Gr(e);for(const n of t)try{if(Yr(n))return}catch(Oy){}Fe(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ot()||kt()||Dt()}};class pi extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return $e("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new pi(e)}_finalizeEnroll(e,t,n){return function(e,t){return rt(e,"POST","/v2/accounts/mfaEnrollment:finalize",nt(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return rt(e,"POST","/v2/accounts/mfaSignIn:finalize",nt(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class mi{constructor(){}static assertion(e){return pi._fromCredential(e)}}mi.FACTOR_ID="phone";var gi,yi="@firebase/auth",vi="0.19.6";class wi{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ze(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function _i(){return window}gi="Browser",ee(new P("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),{apiKey:r,authDomain:i}=n.options;return(e=>{ze(r&&!r.includes(":"),"invalid-api-key",{appName:e.name}),ze(!(null===i||void 0===i?void 0:i.includes(":")),"argument-error",{appName:e.name});const n={apiKey:r,authDomain:i,clientPlatform:gi,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Pt(gi)},s=new xt(e,n);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(We);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(s,t),s})(n)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),ee(new P("auth-internal",(e=>(e=>new wi(e))(Lt(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),le(yi,vi,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(gi)),le(yi,vi,"esm2017");async function bi(e,t,n){var r;const{BuildInfo:i}=_i();Ke(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(Ke(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!==typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),o={};return Dt()?o.ibi=i.packageName:Ct()?o.apn=i.packageName:Fe(e,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,li(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}function Ii(e){const{cordova:t}=_i();return new Promise((n=>{t.plugins.browsertab.isAvailable((r=>{let i=null;r?t.plugins.browsertab.openUrl(e):i=t.InAppBrowser.open(e,function(e=f()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(i)}))}))}class Ti extends Kr{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function Ei(e){const t=await Ai()._get(Ci(e));return t&&await Ai()._remove(Ci(e)),t}function ki(e,t){var n,r;const i=function(e){const t=Ri(e),n=t.link?decodeURIComponent(t.link):void 0,r=Ri(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return Ri(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){const t=Ri(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(t){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(r=null===(n=null===s||void 0===s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],a=o?Ve(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}function Si(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<20;n++){const n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}function Ai(){return We(Gn)}function Ci(e){return bt("authEvent",e.config.apiKey,e.name)}function Ri(e){if(!(null===e||void 0===e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return A(n.join("?"))}const Ni=class{constructor(){this._redirectPersistence=Jn,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=zr}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new Ti(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){Fe(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,o,a,c,u,h;const l=_i();ze("function"===typeof(null===(t=null===l||void 0===l?void 0:l.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),ze("undefined"!==typeof(null===(n=null===l||void 0===l?void 0:l.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),ze("function"===typeof(null===(s=null===(i=null===(r=null===l||void 0===l?void 0:l.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),ze("function"===typeof(null===(c=null===(a=null===(o=null===l||void 0===l?void 0:l.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),ze("function"===typeof(null===(h=null===(u=null===l||void 0===l?void 0:l.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===h?void 0:h.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const i=await this._initialize(e);await i.initialized(),i.resetRedirect(),Lr.clear(),await this._originValidation(e);const s=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:Si(),postBody:null,tenantId:e.tenantId,error:Ve(e,"no-auth-event")}}(e,n,r);await function(e,t){return Ai()._set(Ci(e),t)}(e,s);const o=await bi(e,s,t);return async function(e,t,n){const{cordova:r}=_i();let i=()=>{};try{await new Promise(((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"===typeof t&&t(),"function"===typeof(null===n||void 0===n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout((()=>{o(Ve(e,"redirect-cancelled-by-user"))}),2e3))}function h(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),Ct()&&document.addEventListener("visibilitychange",h,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",h,!1),a&&window.clearTimeout(a)}}))}finally{i()}}(e,i,await Ii(o))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=_i(),n={};Dt()?n.iosBundleId=t.packageName:Ct()?n.androidPackageName=t.packageName:Fe(e,"operation-not-supported-in-this-environment"),await Gr(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=_i(),s=setTimeout((async()=>{await Ei(e),t.onEvent(Di())}),500),o=async n=>{clearTimeout(s);const r=await Ei(e);let i=null;r&&(null===n||void 0===n?void 0:n.url)&&(i=ki(r,n.url)),t.onEvent(i||Di())};"undefined"!==typeof n&&"function"===typeof n.subscribe&&n.subscribe(null,o);const a=r,c=`${i.packageName.toLowerCase()}://`;_i().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"===typeof a)try{a(e)}catch(t){console.error(t)}}}};function Di(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Ve("no-auth-event")}}function Oi(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Pi(e=f()){return!("file:"!==Oi()&&"ionic:"!==Oi()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function xi(e=f()){return v()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=f()){return/Edge\/\d+/.test(e)}(e)}function Li(){try{const e=self.localStorage,t=Xn();if(e)return e.setItem(t,"1"),e.removeItem(t),!xi()||w()}catch(e){return Mi()&&w()}return!1}function Mi(){return"undefined"!==typeof n.g&&"WorkerGlobalScope"in n.g&&"importScripts"in n.g}function Ui(){return("http:"===Oi()||"https:"===Oi()||g()||Pi())&&!(y()||m())&&Li()&&!Mi()}function Fi(){return Pi()&&"undefined"!==typeof document}const Vi={LOCAL:"local",NONE:"none",SESSION:"session"},qi=ze,ji="persistence";async function Bi(e){await e._initializationPromise;const t=zi(),n=bt(ji,e.config.apiKey,e.name);(null===t||void 0===t?void 0:t.sessionStorage)&&t.sessionStorage.setItem(n,e._getPersistence())}function zi(){return"undefined"!==typeof window?window:null}const $i=ze;class Ki{constructor(){this.browserResolver=We(fi),this.cordovaResolver=We(Ni),this.underlyingResolver=null,this._redirectPersistence=Jn,this._completeRedirectFn=zr}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Fi()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return $i(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!Fi()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function Hi(e){return e.unwrap()}function Wi(e,t){var n;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===t.code){t.resolver=new Yi(e,function(e,t){var n;const r=O(e),i=t;return ze(t.customData.operationType,r,"argument-error"),ze(null===(n=i.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),Bn._fromError(r,i)}(e,t))}else if(r){const e=Gi(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}function Gi(e){const{_tokenResponse:t}=e instanceof _?e.customData:e;if(!t)return null;if(!(e instanceof _)&&"temporaryProof"in t&&"phoneNumber"in t)return Sr.credentialFromResult(e);const n=t.providerId;if(!n||n===Ee)return null;let r;switch(n){case Te:r=tn;break;case be:r=en;break;case Ie:r=nn;break;case ke:r=on;break;default:const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return i||s||e||o?o?n.startsWith("saml.")?rn._create(n,o):Ht._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:i}):new Zt(n).credential({idToken:e,accessToken:i,rawNonce:a}):null}return e instanceof _?r.credentialFromError(e):r.credentialFromResult(e)}function Qi(e,t){return t.catch((t=>{throw t instanceof _&&Wi(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(r=e,Gi(r)),additionalUserInfo:qn(e),user:Xi.getOrCreate(n)};var r}))}async function Ji(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>Qi(e,n.confirm(t))}}class Yi{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Qi(Hi(this.auth),this.resolver.resolveSignIn(e))}}class Xi{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=O(e);return $n.has(t)||$n.set(t,zn._fromUser(t)),$n.get(t)}(e)}static getOrCreate(e){return Xi.USER_MAP.has(e)||Xi.USER_MAP.set(e,new Xi(e)),Xi.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Qi(this.auth,wn(this._delegate,e))}async linkWithPhoneNumber(e,t){return Ji(this.auth,async function(e,t,n){const r=O(e);await mn(!1,r,"phone");const i=await kr(r.auth,t,O(n));return new Er(i,(e=>wn(r,e)))}(this._delegate,e,t))}async linkWithPopup(e){return Qi(this.auth,async function(e,t,n){const r=O(e);je(r.auth,t,Yt);const i=Ar(r.auth,n);return new xr(r.auth,"linkViaPopup",t,i,r).executeNotNull()}(this._delegate,e,Ki))}async linkWithRedirect(e){return await Bi(Lt(this.auth)),Br(this._delegate,e,Ki)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Qi(this.auth,_n(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Ji(this.auth,async function(e,t,n){const r=O(e),i=await kr(r.auth,t,O(n));return new Er(i,(e=>_n(r,e)))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Qi(this.auth,async function(e,t,n){const r=O(e);je(r.auth,t,Yt);const i=Ar(r.auth,n);return new xr(r.auth,"reauthViaPopup",t,i,r).executeNotNull()}(this._delegate,e,Ki))}async reauthenticateWithRedirect(e){return await Bi(Lt(this.auth)),jr(this._delegate,e,Ki)}sendEmailVerification(e){return Nn(this._delegate,e)}async unlink(e){return await fn(this._delegate,e),this}updateEmail(e){return function(e,t){return Pn(O(e),t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return Pn(O(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){await pn(O(e),t)}(this._delegate,e)}updateProfile(e){return On(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return Dn(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Xi.USER_MAP=new WeakMap;const Zi=ze;class es{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;Zi(n,"invalid-api-key",{appName:e.name}),Zi(n,"invalid-api-key",{appName:e.name});const r="undefined"!==typeof window?Ki:void 0;this._delegate=t.initialize({options:{persistence:ns(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(Pe),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Xi.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){Ut(this._delegate,e,t)}applyActionCode(e){return Sn(this._delegate,e)}checkActionCode(e){return An(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await jt(O(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Qi(this._delegate,async function(e,t,n){const r=Lt(e),i=await an(r,{returnSecureToken:!0,email:t,password:n}),s=await cn._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(s.user),s}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return Rn(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=Qt.parseLink(t);return"EMAIL_SIGNIN"===(null===n||void 0===n?void 0:n.operation)}(this._delegate,e)}async getRedirectResult(){Zi(Ui(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await Lt(e)._initializationPromise,zr(e,t,!1)}(this._delegate,Ki);return e?Qi(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){Lt(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=ts(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=ts(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return Cn(this._delegate,e,t)}sendPasswordResetEmail(e,t){return kn(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){qi(Object.values(Vi).includes(t),e,"invalid-persistence-type"),y()?qi(t!==Vi.SESSION,e,"unsupported-persistence-type"):m()?qi(t===Vi.NONE,e,"unsupported-persistence-type"):Mi()?qi(t===Vi.NONE||t===Vi.LOCAL&&w(),e,"unsupported-persistence-type"):qi(t===Vi.NONE||Li(),e,"unsupported-persistence-type")}(this._delegate,e),e){case Vi.SESSION:t=Jn;break;case Vi.LOCAL:t=await We(lr)._isAvailable()?lr:Gn;break;case Vi.NONE:t=_t;break;default:return Fe("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Qi(this._delegate,async function(e){var t;const n=Lt(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new cn({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await an(n,{returnSecureToken:!0}),i=await cn._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}(this._delegate))}signInWithCredential(e){return Qi(this._delegate,vn(this._delegate,e))}signInWithCustomToken(e){return Qi(this._delegate,bn(this._delegate,e))}signInWithEmailAndPassword(e,t){return Qi(this._delegate,function(e,t,n){return vn(O(e),Jt.credential(t,n))}(this._delegate,e,t))}signInWithEmailLink(e,t){return Qi(this._delegate,async function(e,t,n){const r=O(e),i=Jt.credentialWithLink(t,n||Ge());return ze(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),vn(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Ji(this._delegate,async function(e,t,n){const r=Lt(e),i=await kr(r,t,O(n));return new Er(i,(e=>vn(r,e)))}(this._delegate,e,t))}async signInWithPopup(e){return Zi(Ui(),this._delegate,"operation-not-supported-in-this-environment"),Qi(this._delegate,async function(e,t,n){const r=Lt(e);je(e,t,Yt);const i=Ar(r,n);return new xr(r,"signInViaPopup",t,i).executeNotNull()}(this._delegate,e,Ki))}async signInWithRedirect(e){return Zi(Ui(),this._delegate,"operation-not-supported-in-this-environment"),await Bi(this._delegate),qr(this._delegate,e,Ki)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await An(O(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function ts(e,t,n){let r=e;"function"!==typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&Xi.getOrCreate(e)),error:t,complete:n}}function ns(e,t){const n=function(e,t){const n=zi();if(!(null===n||void 0===n?void 0:n.sessionStorage))return[];const r=bt(ji,e,t);switch(n.sessionStorage.getItem(r)){case Vi.NONE:return[_t];case Vi.LOCAL:return[lr,Jn];case Vi.SESSION:return[Jn];default:return[]}}(e,t);if("undefined"===typeof self||n.includes(lr)||n.push(lr),"undefined"!==typeof window)for(const r of[Gn,Jn])n.includes(r)||n.push(r);return n.includes(_t)||n.push(_t),n}es.Persistence=Vi;class rs{constructor(){this.providerId="phone",this._delegate=new Sr(Hi(we.auth()))}static credential(e,t){return Sr.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}rs.PHONE_SIGN_IN_METHOD=Sr.PHONE_SIGN_IN_METHOD,rs.PROVIDER_ID=Sr.PROVIDER_ID;const is=ze;class ss{constructor(e,t,n=we.app()){var r;is(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new Tr(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}var os;(os=we).INTERNAL.registerComponent(new P("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new es(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Se,PASSWORD_RESET:Ae,RECOVER_EMAIL:Ce,REVERT_SECOND_FACTOR_ADDITION:Re,VERIFY_AND_CHANGE_EMAIL:Ne,VERIFY_EMAIL:De}},EmailAuthProvider:Jt,FacebookAuthProvider:en,GithubAuthProvider:nn,GoogleAuthProvider:tn,OAuthProvider:Zt,SAMLAuthProvider:sn,PhoneAuthProvider:rs,PhoneMultiFactorGenerator:mi,RecaptchaVerifier:ss,TwitterAuthProvider:on,Auth:es,AuthCredential:qt,Error:_}).setInstantiationMode("LAZY").setMultipleInstances(!1)),os.registerVersion("@firebase/auth-compat","0.2.6");var as,cs="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},us={},hs=hs||{},ls=cs||self;function ds(){}function fs(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function ps(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var ms="closure_uid_"+(1e9*Math.random()>>>0),gs=0;function ys(e,t,n){return e.call.apply(e.bind,arguments)}function vs(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function ws(e,t,n){return(ws=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ys:vs).apply(null,arguments)}function _s(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function bs(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function Is(){this.s=this.s,this.o=this.o}var Ts={};Is.prototype.s=!1,Is.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,ms)&&e[ms]||(e[ms]=++gs)}(this);delete Ts[e]}},Is.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Es=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},ks=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const r=e.length,i="string"===typeof e?e.split(""):e;for(let s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function Ss(e){return Array.prototype.concat.apply([],arguments)}function As(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function Cs(e){return/^[\s\xa0]*$/.test(e)}var Rs,Ns=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Ds(e,t){return-1!=e.indexOf(t)}function Os(e,t){return e<t?-1:e>t?1:0}e:{var Ps=ls.navigator;if(Ps){var xs=Ps.userAgent;if(xs){Rs=xs;break e}}Rs=""}function Ls(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function Ms(e){const t={};for(const n in e)t[n]=e[n];return t}var Us="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Fs(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<Us.length;t++)n=Us[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Vs(e){return Vs[" "](e),e}Vs[" "]=ds;var qs,js=Ds(Rs,"Opera"),Bs=Ds(Rs,"Trident")||Ds(Rs,"MSIE"),zs=Ds(Rs,"Edge"),$s=zs||Bs,Ks=Ds(Rs,"Gecko")&&!(Ds(Rs.toLowerCase(),"webkit")&&!Ds(Rs,"Edge"))&&!(Ds(Rs,"Trident")||Ds(Rs,"MSIE"))&&!Ds(Rs,"Edge"),Hs=Ds(Rs.toLowerCase(),"webkit")&&!Ds(Rs,"Edge");function Ws(){var e=ls.document;return e?e.documentMode:void 0}e:{var Gs="",Qs=function(){var e=Rs;return Ks?/rv:([^\);]+)(\)|;)/.exec(e):zs?/Edge\/([\d\.]+)/.exec(e):Bs?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):Hs?/WebKit\/(\S+)/.exec(e):js?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(Qs&&(Gs=Qs?Qs[1]:""),Bs){var Js=Ws();if(null!=Js&&Js>parseFloat(Gs)){qs=String(Js);break e}}qs=Gs}var Ys,Xs={};function Zs(){return function(e){var t=Xs;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}((function(){let e=0;const t=Ns(String(qs)).split("."),n=Ns("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=Os(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||Os(0==i[2].length,0==s[2].length)||Os(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}))}if(ls.document&&Bs){var eo=Ws();Ys=eo||(parseInt(qs,10)||void 0)}else Ys=void 0;var to=Ys,no=function(){if(!ls.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{ls.addEventListener("test",ds,t),ls.removeEventListener("test",ds,t)}catch(n){}return e}();function ro(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function io(e,t){if(ro.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Ks){e:{try{Vs(t.nodeName);var i=!0;break e}catch(s){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:so[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&io.Z.h.call(this)}}ro.prototype.h=function(){this.defaultPrevented=!0},bs(io,ro);var so={2:"touch",3:"pen",4:"mouse"};io.prototype.h=function(){io.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var oo="closure_listenable_"+(1e6*Math.random()|0),ao=0;function co(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++ao,this.ca=this.fa=!1}function uo(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function ho(e){this.src=e,this.g={},this.h=0}function lo(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Es(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(uo(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function fo(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}ho.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=fo(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new co(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var po="closure_lm_"+(1e6*Math.random()|0),mo={};function go(e,t,n,r,i){if(r&&r.once)return vo(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)go(e,t[s],n,r,i);return null}return n=ko(n),e&&e[oo]?e.N(t,n,ps(r)?!!r.capture:!!r,i):yo(e,t,n,!1,r,i)}function yo(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=ps(i)?!!i.capture:!!i,a=To(e);if(a||(e[po]=a=new ho(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}var t=Io;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)no||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(bo(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function vo(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)vo(e,t[s],n,r,i);return null}return n=ko(n),e&&e[oo]?e.O(t,n,ps(r)?!!r.capture:!!r,i):yo(e,t,n,!0,r,i)}function wo(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)wo(e,t[s],n,r,i);else r=ps(r)?!!r.capture:!!r,n=ko(n),e&&e[oo]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=fo(s=e.g[t],n,r,i))&&(uo(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--)))):e&&(e=To(e))&&(t=e.g[t.toString()],e=-1,t&&(e=fo(t,n,r,i)),(n=-1<e?t[e]:null)&&_o(n))}function _o(e){if("number"!==typeof e&&e&&!e.ca){var t=e.src;if(t&&t[oo])lo(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(bo(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=To(t))?(lo(n,e),0==n.h&&(n.src=null,t[po]=null)):uo(e)}}}function bo(e){return e in mo?mo[e]:mo[e]="on"+e}function Io(e,t){if(e.ca)e=!0;else{t=new io(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&_o(e),e=n.call(r,t)}return e}function To(e){return(e=e[po])instanceof ho?e:null}var Eo="__closure_events_fn_"+(1e9*Math.random()>>>0);function ko(e){return"function"===typeof e?e:(e[Eo]||(e[Eo]=function(t){return e.handleEvent(t)}),e[Eo])}function So(){Is.call(this),this.i=new ho(this),this.P=this,this.I=null}function Ao(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"===typeof t)t=new ro(t,e);else if(t instanceof ro)t.target=t.target||e;else{var i=t;Fs(t=new ro(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=Co(o,r,!0,t)&&i}if(i=Co(o=t.g=e,r,!0,t)&&i,i=Co(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=Co(o=t.g=n[s],r,!1,t)&&i}function Co(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&lo(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}bs(So,Is),So.prototype[oo]=!0,So.prototype.removeEventListener=function(e,t,n,r){wo(this,e,t,n,r)},So.prototype.M=function(){if(So.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)uo(n[r]);delete t.g[e],t.h--}}this.I=null},So.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},So.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Ro=ls.JSON.stringify;function No(){var e=Uo;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Do,Oo=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Po),(e=>e.reset()));class Po{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function xo(e){ls.setTimeout((()=>{throw e}),0)}function Lo(e,t){Do||function(){var e=ls.Promise.resolve(void 0);Do=function(){e.then(Fo)}}(),Mo||(Do(),Mo=!0),Uo.add(e,t)}var Mo=!1,Uo=new class{constructor(){this.h=this.g=null}add(e,t){const n=Oo.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Fo(){for(var e;e=No();){try{e.h.call(e.g)}catch(n){xo(n)}var t=Oo;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Mo=!1}function Vo(e,t){So.call(this),this.h=e||1,this.g=t||ls,this.j=ws(this.kb,this),this.l=Date.now()}function qo(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function jo(e,t,n){if("function"===typeof e)n&&(e=ws(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=ws(e.handleEvent,e)}return 2147483647<Number(t)?-1:ls.setTimeout(e,t||0)}function Bo(e){e.g=jo((()=>{e.g=null,e.i&&(e.i=!1,Bo(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}bs(Vo,So),(as=Vo.prototype).da=!1,as.S=null,as.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Ao(this,"tick"),this.da&&(qo(this),this.start()))}},as.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},as.M=function(){Vo.Z.M.call(this),qo(this),delete this.g};class zo extends Is{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Bo(this)}M(){super.M(),this.g&&(ls.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $o(e){Is.call(this),this.h=e,this.g={}}bs($o,Is);var Ko=[];function Ho(e,t,n,r){Array.isArray(n)||(n&&(Ko[0]=n.toString()),n=Ko);for(var i=0;i<n.length;i++){var s=go(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Wo(e){Ls(e.g,(function(e,t){this.g.hasOwnProperty(t)&&_o(e)}),e),e.g={}}function Go(){this.g=!0}function Qo(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Ro(n)}catch(a){return t}}(e,n)+(r?" "+r:"")}))}$o.prototype.M=function(){$o.Z.M.call(this),Wo(this)},$o.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Go.prototype.Aa=function(){this.g=!1},Go.prototype.info=function(){};var Jo={},Yo=null;function Xo(){return Yo=Yo||new So}function Zo(e){ro.call(this,Jo.Ma,e)}function ea(e){const t=Xo();Ao(t,new Zo(t,e))}function ta(e,t){ro.call(this,Jo.STAT_EVENT,e),this.stat=t}function na(e){const t=Xo();Ao(t,new ta(t,e))}function ra(e,t){ro.call(this,Jo.Na,e),this.size=t}function ia(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return ls.setTimeout((function(){e()}),t)}Jo.Ma="serverreachability",bs(Zo,ro),Jo.STAT_EVENT="statevent",bs(ta,ro),Jo.Na="timingevent",bs(ra,ro);var sa={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},oa={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function aa(){}function ca(e){return e.h||(e.h=e.i())}function ua(){}aa.prototype.h=null;var ha,la={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function da(){ro.call(this,"d")}function fa(){ro.call(this,"c")}function pa(){}function ma(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new $o(this),this.P=ya,e=$s?125:void 0,this.W=new Vo(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ga}function ga(){this.i=null,this.g="",this.h=!1}bs(da,ro),bs(fa,ro),bs(pa,aa),pa.prototype.g=function(){return new XMLHttpRequest},pa.prototype.i=function(){return{}},ha=new pa;var ya=45e3,va={},wa={};function _a(e,t,n){e.K=1,e.v=za(Ua(t)),e.s=n,e.U=!0,ba(e,null)}function ba(e,t){e.F=Date.now(),ka(e),e.A=Ua(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),nc(n.h,"t",r),e.C=0,n=e.l.H,e.h=new ga,e.g=ru(e.l,n?t:null,!e.s),0<e.O&&(e.L=new zo(ws(e.Ia,e,e.g),e.O)),Ho(e.V,e.g,"readystatechange",e.gb),t=e.H?Ms(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),ea(1),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.X,e.s)}function Ia(e){return!!e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function Ta(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=Ea(e,n),r==wa){4==t&&(e.o=4,na(14),i=!1),Qo(e.j,e.m,null,"[Incomplete Response]");break}if(r==va){e.o=4,na(15),Qo(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Qo(e.j,e.m,r,null),Na(e,r)}Ia(e)&&r!=wa&&r!=va&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,na(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qc(t),t.L=!0,na(11))):(Qo(e.j,e.m,n,"[Invalid Chunked Response]"),Ra(e),Ca(e))}function Ea(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?wa:(n=Number(t.substring(n,r)),isNaN(n)?va:(r+=1)+n>t.length?wa:(t=t.substr(r,n),e.C=r+n,t))}function ka(e){e.Y=Date.now()+e.P,Sa(e,e.P)}function Sa(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=ia(ws(e.eb,e),t)}function Aa(e){e.B&&(ls.clearTimeout(e.B),e.B=null)}function Ca(e){0==e.l.G||e.I||Xc(e.l,e)}function Ra(e){Aa(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,qo(e.W),Wo(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Na(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||uc(n.i,e)))if(n.I=e.N,!e.J&&uc(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Yc(n),qc(n)}Gc(n),na(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=ia(ws(n.ab,n),6e3));if(1>=cc(n.i)&&n.ka){try{n.ka()}catch(u){}n.ka=void 0}}else eu(n,11)}else if((e.J||n.g==e)&&Yc(n),!Cs(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const t=u[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const i=u[4];null!=i&&(n.za=i,n.h.info("SVER="+n.za));const h=u[5];null!=h&&"number"===typeof h&&0<h&&(r=1.5*h,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;!s.g&&(Ds(e,"spdy")||Ds(e,"quic")||Ds(e,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(hc(s,s.h),s.h=null))}if(r.D){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.sa=e,Ba(r.F,r.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((r=n).oa=nu(r,r.H?r.la:null,r.W),o.J){lc(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(Aa(a),ka(a)),r.g=o}else Wc(r);0<n.l.length&&zc(n)}else"stop"!=u[0]&&"close"!=u[0]||eu(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?eu(n,7):Vc(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}ea(4)}catch(u){}}function Da(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(fs(e)||"string"===typeof e)ks(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(fs(e)||"string"===typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"===typeof e)return e.split("");if(fs(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function Oa(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Oa)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function Pa(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];xa(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)xa(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function xa(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(as=ma.prototype).setTimeout=function(e){this.P=e},as.gb=function(e){e=e.target;const t=this.L;t&&3==xc(e)?t.l():this.Ia(e)},as.Ia=function(e){try{if(e==this.g)e:{const h=xc(this.g);var t=this.g.Da();const l=this.g.ba();if(!(3>h)&&(3!=h||$s||this.g&&(this.h.h||this.g.ga()||Lc(this.g)))){this.I||4!=h||7==t||ea(8==t||0>=l?3:2),Aa(this);var n=this.g.ba();this.N=n;t:if(Ia(this)){var r=Lc(this.g);e="";var i=r.length,s=4==xc(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Ra(this),Ca(this);var o="";break t}this.h.i=new ls.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.X,h,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Cs(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,na(12),Ra(this),Ca(this);break e}Qo(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Na(this,n)}this.U?(Ta(this,h,o),$s&&this.i&&3==h&&(Ho(this.V,this.W,"tick",this.fb),this.W.start())):(Qo(this.j,this.m,o,null),Na(this,o)),4==h&&Ra(this),this.i&&!this.I&&(4==h?Xc(this.l,this):(this.i=!1,ka(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,na(12)):(this.o=0,na(13)),Ra(this),Ca(this)}}}catch(h){}},as.fb=function(){if(this.g){var e=xc(this.g),t=this.g.ga();this.C<t.length&&(Aa(this),Ta(this,e,t),this.i&&4!=e&&ka(this))}},as.cancel=function(){this.I=!0,Ra(this)},as.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(ea(3),na(17)),Ra(this),this.o=2,Ca(this)):Sa(this,this.Y-e)},(as=Oa.prototype).R=function(){Pa(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},as.T=function(){return Pa(this),this.g.concat()},as.get=function(e,t){return xa(this.h,e)?this.h[e]:t},as.set=function(e,t){xa(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},as.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var La=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ma(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Ma){this.g=void 0!==t?t:e.g,Fa(this,e.j),this.s=e.s,Va(this,e.i),qa(this,e.m),this.l=e.l,t=e.h;var n=new Xa;n.i=t.i,t.g&&(n.g=new Oa(t.g),n.h=t.h),ja(this,n),this.o=e.o}else e&&(n=String(e).match(La))?(this.g=!!t,Fa(this,n[1]||"",!0),this.s=$a(n[2]||""),Va(this,n[3]||"",!0),qa(this,n[4]),this.l=$a(n[5]||"",!0),ja(this,n[6]||"",!0),this.o=$a(n[7]||"")):(this.g=!!t,this.h=new Xa(null,this.g))}function Ua(e){return new Ma(e)}function Fa(e,t,n){e.j=n?$a(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Va(e,t,n){e.i=n?$a(t,!0):t}function qa(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function ja(e,t,n){t instanceof Xa?(e.h=t,function(e,t){t&&!e.j&&(Za(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(ec(this,t),nc(this,n,e))}),e)),e.j=t}(e.h,e.g)):(n||(t=Ka(t,Ja)),e.h=new Xa(t,e.g))}function Ba(e,t,n){e.h.set(t,n)}function za(e){return Ba(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function $a(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Ka(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,Ha),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Ha(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ma.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Ka(t,Wa,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Ka(t,Wa,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(Ka(n,"/"==n.charAt(0)?Qa:Ga,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Ka(n,Ya)),e.join("")};var Wa=/[#\/\?@]/g,Ga=/[#\?:]/g,Qa=/[#\?]/g,Ja=/[#\?@]/g,Ya=/#/g;function Xa(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Za(e){e.g||(e.g=new Oa,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function ec(e,t){Za(e),t=rc(e,t),xa(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,xa((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&Pa(e)))}function tc(e,t){return Za(e),t=rc(e,t),xa(e.g.h,t)}function nc(e,t,n){ec(e,t),0<n.length&&(e.i=null,e.g.set(rc(e,t),As(n)),e.h+=n.length)}function rc(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(as=Xa.prototype).add=function(e,t){Za(this),this.i=null,e=rc(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},as.forEach=function(e,t){Za(this),this.g.forEach((function(n,r){ks(n,(function(n){e.call(t,n,r,this)}),this)}),this)},as.T=function(){Za(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},as.R=function(e){Za(this);var t=[];if("string"===typeof e)tc(this,e)&&(t=Ss(t,this.g.get(rc(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=Ss(t,e[n])}return t},as.set=function(e,t){return Za(this),this.i=null,tc(this,e=rc(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},as.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},as.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}}return this.i=e.join("&")};function ic(e){this.l=e||oc,ls.PerformanceNavigationTiming?e=0<(e=ls.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(ls.g&&ls.g.Ea&&ls.g.Ea()&&ls.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var sc,oc=10;function ac(e){return!!e.h||!!e.g&&e.g.size>=e.j}function cc(e){return e.h?1:e.g?e.g.size:0}function uc(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function hc(e,t){e.g?e.g.add(t):e.h=t}function lc(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function dc(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return As(e.i)}function fc(){}function pc(){this.g=new fc}function mc(e,t,n){const r=n||"";try{Da(e,(function(e,n){let i=e;ps(e)&&(i=Ro(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function gc(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(s){}}function yc(e){this.l=e.$b||null,this.j=e.ib||!1}function vc(e,t){So.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=wc,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ic.prototype.cancel=function(){if(this.i=dc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},fc.prototype.stringify=function(e){return ls.JSON.stringify(e,void 0)},fc.prototype.parse=function(e){return ls.JSON.parse(e,void 0)},bs(yc,aa),yc.prototype.g=function(){return new vc(this.l,this.j)},yc.prototype.i=(sc={},function(){return sc}),bs(vc,So);var wc=0;function _c(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function bc(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Ic(e)}function Ic(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(as=vc.prototype).open=function(e,t){if(this.readyState!=wc)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Ic(this)},as.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||ls).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},as.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,bc(this)),this.readyState=wc},as.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ic(this)),this.g&&(this.readyState=3,Ic(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if("undefined"!==typeof ls.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;_c(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},as.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?bc(this):Ic(this),3==this.readyState&&_c(this)}},as.Ua=function(e){this.g&&(this.response=this.responseText=e,bc(this))},as.Ta=function(e){this.g&&(this.response=e,bc(this))},as.ha=function(){this.g&&bc(this)},as.setRequestHeader=function(e,t){this.v.append(e,t)},as.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},as.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(vc.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Tc=ls.JSON.parse;function Ec(e){So.call(this),this.headers=new Oa,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=kc,this.K=this.L=!1}bs(Ec,So);var kc="",Sc=/^https?$/i,Ac=["POST","PUT"];function Cc(e){return"content-type"==e.toLowerCase()}function Rc(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Nc(e),Oc(e)}function Nc(e){e.D||(e.D=!0,Ao(e,"complete"),Ao(e,"error"))}function Dc(e){if(e.h&&"undefined"!=typeof hs&&(!e.C[1]||4!=xc(e)||2!=e.ba()))if(e.v&&4==xc(e))jo(e.Fa,0,e);else if(Ao(e,"readystatechange"),4==xc(e)){e.h=!1;try{const c=e.ba();e:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===c){var i=String(e.H).match(La)[1]||null;if(!i&&ls.self&&ls.self.location){var s=ls.self.location.protocol;i=s.substr(0,s.length-1)}r=!Sc.test(i?i.toLowerCase():"")}n=r}if(n)Ao(e,"complete"),Ao(e,"success");else{e.m=6;try{var o=2<xc(e)?e.g.statusText:""}catch(a){o=""}e.j=o+" ["+e.ba()+"]",Nc(e)}}finally{Oc(e)}}}function Oc(e,t){if(e.g){Pc(e);const r=e.g,i=e.C[0]?ds:null;e.g=null,e.C=null,t||Ao(e,"ready");try{r.onreadystatechange=i}catch(n){}}}function Pc(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(ls.clearTimeout(e.A),e.A=null)}function xc(e){return e.g?e.g.readyState:0}function Lc(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case kc:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Mc(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let t="";return Ls(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):Ba(e,t,n))}function Uc(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Fc(e){this.za=0,this.l=[],this.h=new Go,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Uc("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Uc("baseRetryDelayMs",5e3,e),this.$a=Uc("retryDelaySeedMs",1e4,e),this.Ya=Uc("forwardChannelMaxRetries",2,e),this.ra=Uc("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new ic(e&&e.concurrentRequestLimit),this.Ca=new pc,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function Vc(e){if(jc(e),3==e.G){var t=e.V++,n=Ua(e.F);Ba(n,"SID",e.J),Ba(n,"RID",t),Ba(n,"TYPE","terminate"),Kc(e,n),(t=new ma(e,e.h,t,void 0)).K=2,t.v=za(Ua(n)),n=!1,ls.navigator&&ls.navigator.sendBeacon&&(n=ls.navigator.sendBeacon(t.v.toString(),"")),!n&&ls.Image&&((new Image).src=t.v,n=!0),n||(t.g=ru(t.l,null),t.g.ea(t.v)),t.F=Date.now(),ka(t)}tu(e)}function qc(e){e.g&&(Qc(e),e.g.cancel(),e.g=null)}function jc(e){qc(e),e.u&&(ls.clearTimeout(e.u),e.u=null),Yc(e),e.i.cancel(),e.m&&("number"===typeof e.m&&ls.clearTimeout(e.m),e.m=null)}function Bc(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&zc(e)}function zc(e){ac(e.i)||e.m||(e.m=!0,Lo(e.Ha,e),e.C=0)}function $c(e,t){var n;n=t?t.m:e.V++;const r=Ua(e.F);Ba(r,"SID",e.J),Ba(r,"RID",n),Ba(r,"AID",e.U),Kc(e,r),e.o&&e.s&&Mc(r,e.o,e.s),n=new ma(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=Hc(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),hc(e.i,n),_a(n,r,t)}function Kc(e,t){e.j&&Da({},(function(e,n){Ba(t,n,e)}))}function Hc(e,t,n){n=Math.min(e.l.length,n);var r=e.j?ws(e.j.Oa,e.j,e):null;e:{var i=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{mc(a,e,"req"+n+"_")}catch(Lu){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,r}function Wc(e){e.g||e.u||(e.Y=1,Lo(e.Ga,e),e.A=0)}function Gc(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=ia(ws(e.Ga,e),Zc(e,e.A)),e.A++,!0)}function Qc(e){null!=e.B&&(ls.clearTimeout(e.B),e.B=null)}function Jc(e){e.g=new ma(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Ua(e.oa);Ba(t,"RID","rpc"),Ba(t,"SID",e.J),Ba(t,"CI",e.N?"0":"1"),Ba(t,"AID",e.U),Kc(e,t),Ba(t,"TYPE","xmlhttp"),e.o&&e.s&&Mc(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=za(Ua(t)),n.s=null,n.U=!0,ba(n,e)}function Yc(e){null!=e.v&&(ls.clearTimeout(e.v),e.v=null)}function Xc(e,t){var n=null;if(e.g==t){Yc(e),Qc(e),e.g=null;var r=2}else{if(!uc(e.i,t))return;n=t.D,lc(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;Ao(r=Xo(),new ra(r,n,t,i)),zc(e)}else Wc(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(cc(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.l=t.D.concat(e.l),!0):!(1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya))&&(e.m=ia(ws(e.Ha,e,t),Zc(e,e.C)),e.C++,!0))}(e,t)||2==r&&Gc(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:eu(e,5);break;case 4:eu(e,10);break;case 3:eu(e,6);break;default:eu(e,2)}}function Zc(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function eu(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=ws(e.jb,e);n||(n=new Ma("//www.google.com/images/cleardot.gif"),ls.location&&"http"==ls.location.protocol||Fa(n,"https"),za(n)),function(e,t){const n=new Go;if(ls.Image){const r=new Image;r.onload=_s(gc,n,r,"TestLoadImage: loaded",!0,t),r.onerror=_s(gc,n,r,"TestLoadImage: error",!1,t),r.onabort=_s(gc,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=_s(gc,n,r,"TestLoadImage: timeout",!1,t),ls.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else na(2);e.G=0,e.j&&e.j.va(t),tu(e),jc(e)}function tu(e){e.G=0,e.I=-1,e.j&&(0==dc(e.i).length&&0==e.l.length||(e.i.i.length=0,As(e.l),e.l.length=0),e.j.ua())}function nu(e,t,n){let r=function(e){return e instanceof Ma?Ua(e):new Ma(e,void 0)}(n);if(""!=r.i)t&&Va(r,t+"."+r.i),qa(r,r.m);else{const e=ls.location;r=function(e,t,n,r){var i=new Ma(null,void 0);return e&&Fa(i,e),t&&Va(i,t),n&&qa(i,n),r&&(i.l=r),i}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&Ls(e.aa,(function(e,t){Ba(r,t,e)})),t=e.D,n=e.sa,t&&n&&Ba(r,t,n),Ba(r,"VER",e.ma),Kc(e,r),r}function ru(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new Ec(new yc({ib:!0})):new Ec(e.qa)).L=e.H,t}function iu(){}function su(){if(Bs&&!(10<=Number(to)))throw Error("Environmental error: no available transport.")}function ou(e,t){So.call(this),this.g=new Fc(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!Cs(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Cs(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new uu(this)}function au(e){da.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function cu(){fa.call(this),this.status=1}function uu(e){this.g=e}(as=Ec.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ha.g(),this.C=this.u?ca(this.u):ca(ha),this.g.onreadystatechange=ws(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){return void Rc(this,s)}e=n||"";const i=new Oa(this.headers);r&&Da(r,(function(e,t){i.set(t,e)})),r=function(e){e:{var t=Cc;const n=e.length,r="string"===typeof e?e.split(""):e;for(let i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"===typeof e?e.charAt(t):e[t]}(i.T()),n=ls.FormData&&e instanceof ls.FormData,!(0<=Es(Ac,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(e,t){this.g.setRequestHeader(t,e)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Pc(this),0<this.B&&((this.K=function(e){return Bs&&Zs()&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=ws(this.pa,this)):this.A=jo(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){Rc(this,s)}},as.pa=function(){"undefined"!=typeof hs&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ao(this,"timeout"),this.abort(8))},as.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Ao(this,"complete"),Ao(this,"abort"),Oc(this))},as.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Oc(this,!0)),Ec.Z.M.call(this)},as.Fa=function(){this.s||(this.F||this.v||this.l?Dc(this):this.cb())},as.cb=function(){Dc(this)},as.ba=function(){try{return 2<xc(this)?this.g.status:-1}catch(sc){return-1}},as.ga=function(){try{return this.g?this.g.responseText:""}catch(sc){return""}},as.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Tc(t)}},as.Da=function(){return this.m},as.La=function(){return"string"===typeof this.j?this.j:String(this.j)},(as=Fc.prototype).ma=8,as.G=1,as.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}},as.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new ma(this,this.h,e,void 0);let s=this.s;if(this.P&&(s?(s=Ms(s),Fs(s,this.P)):s=this.P),null===this.o&&(i.H=s),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"===typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Hc(this,i,t),Ba(n=Ua(this.F),"RID",e),Ba(n,"CVER",22),this.D&&Ba(n,"X-HTTP-Session-Id",this.D),Kc(this,n),this.o&&s&&Mc(n,this.o,s),hc(this.i,i),this.Ra&&Ba(n,"TYPE","init"),this.ja?(Ba(n,"$req",t),Ba(n,"SID","null"),i.$=!0,_a(i,n,null)):_a(i,n,t),this.G=2}}else 3==this.G&&(e?$c(this,e):0==this.l.length||ac(this.i)||$c(this))},as.Ga=function(){if(this.u=null,Jc(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=ia(ws(this.bb,this),e)}},as.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,na(10),qc(this),Jc(this))},as.ab=function(){null!=this.v&&(this.v=null,qc(this),Gc(this),na(19))},as.jb=function(e){e?(this.h.info("Successfully pinged google.com"),na(2)):(this.h.info("Failed to ping google.com"),na(1))},(as=iu.prototype).xa=function(){},as.wa=function(){},as.va=function(){},as.ua=function(){},as.Oa=function(){},su.prototype.g=function(e,t){return new ou(e,t)},bs(ou,So),ou.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Lo(ws(e.hb,e,t))),na(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=nu(e,null,e.W),zc(e)},ou.prototype.close=function(){Vc(this.g)},ou.prototype.u=function(e){if("string"===typeof e){var t={};t.__data__=e,Bc(this.g,t)}else this.v?((t={}).__data__=Ro(e),Bc(this.g,t)):Bc(this.g,e)},ou.prototype.M=function(){this.g.j=null,delete this.j,Vc(this.g),delete this.g,ou.Z.M.call(this)},bs(au,da),bs(cu,fa),bs(uu,iu),uu.prototype.xa=function(){Ao(this.g,"a")},uu.prototype.wa=function(e){Ao(this.g,new au(e))},uu.prototype.va=function(e){Ao(this.g,new cu(e))},uu.prototype.ua=function(){Ao(this.g,"b")},su.prototype.createWebChannel=su.prototype.g,ou.prototype.send=ou.prototype.u,ou.prototype.open=ou.prototype.m,ou.prototype.close=ou.prototype.close,sa.NO_ERROR=0,sa.TIMEOUT=8,sa.HTTP_ERROR=6,oa.COMPLETE="complete",ua.EventType=la,la.OPEN="a",la.CLOSE="b",la.ERROR="c",la.MESSAGE="d",So.prototype.listen=So.prototype.N,Ec.prototype.listenOnce=Ec.prototype.O,Ec.prototype.getLastError=Ec.prototype.La,Ec.prototype.getLastErrorCode=Ec.prototype.Da,Ec.prototype.getStatus=Ec.prototype.ba,Ec.prototype.getResponseJson=Ec.prototype.Qa,Ec.prototype.getResponseText=Ec.prototype.ga,Ec.prototype.send=Ec.prototype.ea;var hu=us.createWebChannelTransport=function(){return new su},lu=us.getStatEventTarget=function(){return Xo()},du=us.ErrorCode=sa,fu=us.EventType=oa,pu=us.Event=Jo,mu=us.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},gu=us.FetchXmlHttpFactory=yc,yu=us.WebChannel=ua,vu=us.XhrIo=Ec,wu=n(3454);const _u="@firebase/firestore";class bu{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}bu.UNAUTHENTICATED=new bu(null),bu.GOOGLE_CREDENTIALS=new bu("google-credentials-uid"),bu.FIRST_PARTY=new bu("first-party-uid"),bu.MOCK_USER=new bu("mock-user");let Iu="9.6.3";const Tu=new z("@firebase/firestore");function Eu(){return Tu.logLevel}function ku(e,...t){if(Tu.logLevel<=F.DEBUG){const n=t.map(Cu);Tu.debug(`Firestore (${Iu}): ${e}`,...n)}}function Su(e,...t){if(Tu.logLevel<=F.ERROR){const n=t.map(Cu);Tu.error(`Firestore (${Iu}): ${e}`,...n)}}function Au(e,...t){if(Tu.logLevel<=F.WARN){const n=t.map(Cu);Tu.warn(`Firestore (${Iu}): ${e}`,...n)}}function Cu(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Ru(e="Unexpected state"){const t=`FIRESTORE (${Iu}) INTERNAL ASSERTION FAILED: `+e;throw Su(t),new Error(t)}function Nu(e,t){e||Ru()}function Du(e,t){return e}const Ou={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Pu extends _{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class xu{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Lu{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Mu{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(bu.UNAUTHENTICATED)))}shutdown(){}}class Uu{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class Fu{constructor(e){this.t=e,this.currentUser=bu.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new xu;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new xu,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{ku("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(ku("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new xu)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(ku("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Nu("string"==typeof t.accessToken),new Lu(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Nu(null===e||"string"==typeof e),new bu(e)}}class Vu{constructor(e,t,n){this.type="FirstParty",this.user=bu.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class qu{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Vu(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(bu.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ju{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Bu{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null}start(e,t){this.o=n=>{e.enqueueRetryable((()=>(e=>(null!=e.error&&ku("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`),t(e.token)))(n)))};const n=e=>{ku("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit((e=>n(e))),setTimeout((()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?n(e):ku("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Nu("string"==typeof e.token),new ju(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class zu{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.p(e),this.T=e=>t.writeSequenceNumber(e))}p(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function $u(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}zu.I=-1;class Ku{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=$u(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function Hu(e,t){return e<t?-1:e>t?1:0}function Wu(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function Gu(e){return e+"\0"}class Qu{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Pu(Ou.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Pu(Ou.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Pu(Ou.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Pu(Ou.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Qu.fromMillis(Date.now())}static fromDate(e){return Qu.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Qu(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Hu(this.nanoseconds,e.nanoseconds):Hu(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ju{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ju(e)}static min(){return new Ju(new Qu(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Yu(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Xu(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Zu(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class eh{constructor(e,t,n){void 0===t?t=0:t>e.length&&Ru(),void 0===n?n=e.length-t:n>e.length-t&&Ru(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===eh.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof eh?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class th extends eh{construct(e,t,n){return new th(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Pu(Ou.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new th(t)}static emptyPath(){return new th([])}}const nh=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rh extends eh{construct(e,t,n){return new rh(e,t,n)}static isValidIdentifier(e){return nh.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rh.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new rh(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Pu(Ou.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Pu(Ou.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Pu(Ou.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Pu(Ou.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new rh(t)}static emptyPath(){return new rh([])}}class ih{constructor(e){this.fields=e,e.sort(rh.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Wu(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class sh{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new sh(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new sh(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Hu(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}sh.EMPTY_BYTE_STRING=new sh("");const oh=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ah(e){if(Nu(!!e),"string"==typeof e){let t=0;const n=oh.exec(e);if(Nu(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:ch(e.seconds),nanos:ch(e.nanos)}}function ch(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function uh(e){return"string"==typeof e?sh.fromBase64String(e):sh.fromUint8Array(e)}function hh(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function lh(e){const t=e.mapValue.fields.__previous_value__;return hh(t)?lh(t):t}function dh(e){const t=ah(e.mapValue.fields.__local_write_time__.timestampValue);return new Qu(t.seconds,t.nanos)}function fh(e){return null==e}function ph(e){return 0===e&&1/e==-1/0}function mh(e){return"number"==typeof e&&Number.isInteger(e)&&!ph(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class gh{constructor(e){this.path=e}static fromPath(e){return new gh(th.fromString(e))}static fromName(e){return new gh(th.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===th.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return th.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new gh(new th(e.slice()))}}function yh(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?hh(e)?4:10:Ru()}function vh(e,t){if(e===t)return!0;const n=yh(e);if(n!==yh(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return dh(e).isEqual(dh(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=ah(e.timestampValue),r=ah(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return uh(e.bytesValue).isEqual(uh(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return ch(e.geoPointValue.latitude)===ch(t.geoPointValue.latitude)&&ch(e.geoPointValue.longitude)===ch(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return ch(e.integerValue)===ch(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=ch(e.doubleValue),r=ch(t.doubleValue);return n===r?ph(n)===ph(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Wu(e.arrayValue.values||[],t.arrayValue.values||[],vh);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Yu(n)!==Yu(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!vh(n[i],r[i])))return!1;return!0}(e,t);default:return Ru()}}function wh(e,t){return void 0!==(e.values||[]).find((e=>vh(e,t)))}function _h(e,t){if(e===t)return 0;const n=yh(e),r=yh(t);if(n!==r)return Hu(n,r);switch(n){case 0:return 0;case 1:return Hu(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=ch(e.integerValue||e.doubleValue),r=ch(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return bh(e.timestampValue,t.timestampValue);case 4:return bh(dh(e),dh(t));case 5:return Hu(e.stringValue,t.stringValue);case 6:return function(e,t){const n=uh(e),r=uh(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=Hu(n[i],r[i]);if(0!==e)return e}return Hu(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Hu(ch(e.latitude),ch(t.latitude));return 0!==n?n:Hu(ch(e.longitude),ch(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=_h(n[i],r[i]);if(e)return e}return Hu(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=Hu(r[o],s[o]);if(0!==e)return e;const t=_h(n[r[o]],i[s[o]]);if(0!==t)return t}return Hu(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Ru()}}function bh(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Hu(e,t);const n=ah(e),r=ah(t),i=Hu(n.seconds,r.seconds);return 0!==i?i:Hu(n.nanos,r.nanos)}function Ih(e){return Th(e)}function Th(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=ah(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?uh(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,gh.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Th(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Th(e.fields[i])}`;return n+"}"}(e.mapValue):Ru();var t,n}function Eh(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function kh(e){return!!e&&"integerValue"in e}function Sh(e){return!!e&&"arrayValue"in e}function Ah(e){return!!e&&"nullValue"in e}function Ch(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Rh(e){return!!e&&"mapValue"in e}function Nh(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Xu(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Nh(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Nh(e.arrayValue.values[n]);return t}return Object.assign({},e)}class Dh{constructor(e){this.value=e}static empty(){return new Dh({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Rh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Nh(t)}setAll(e){let t=rh.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Nh(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Rh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return vh(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Rh(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Xu(t,((t,n)=>e[t]=n));for(const r of n)delete e[r]}clone(){return new Dh(Nh(this.value))}}function Oh(e){const t=[];return Xu(e.fields,((e,n)=>{const r=new rh([e]);if(Rh(n)){const e=Oh(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new ih(t)}class Ph{constructor(e,t,n,r,i){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(e){return new Ph(e,0,Ju.min(),Dh.empty(),0)}static newFoundDocument(e,t,n){return new Ph(e,1,t,n,0)}static newNoDocument(e,t){return new Ph(e,2,t,Dh.empty(),0)}static newUnknownDocument(e,t){return new Ph(e,3,t,Dh.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Dh.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Dh.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ph&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ph(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class xh{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.R=null}}function Lh(e,t=null,n=[],r=[],i=null,s=null,o=null){return new xh(e,t,n,r,i,s,o)}function Mh(e){const t=Du(e);if(null===t.R){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>function(e){return e.field.canonicalString()+e.op.toString()+Ih(e.value)}(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),fh(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=Qh(t.startAt)),t.endAt&&(e+="|ub:",e+=Qh(t.endAt)),t.R=e}return t.R}function Uh(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(!Yh(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if(n=e.filters[i],r=t.filters[i],n.op!==r.op||!n.field.isEqual(r.field)||!vh(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Zh(e.startAt,t.startAt)&&Zh(e.endAt,t.endAt)}function Fh(e){return gh.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Vh extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,n):new qh(e,t,n):"array-contains"===t?new $h(e,n):"in"===t?new Kh(e,n):"not-in"===t?new Hh(e,n):"array-contains-any"===t?new Wh(e,n):new Vh(e,t,n)}static P(e,t,n){return"in"===t?new jh(e,n):new Bh(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(_h(t,this.value)):null!==t&&yh(this.value)===yh(t)&&this.v(_h(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Ru()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class qh extends Vh{constructor(e,t,n){super(e,t,n),this.key=gh.fromName(n.referenceValue)}matches(e){const t=gh.comparator(e.key,this.key);return this.v(t)}}class jh extends Vh{constructor(e,t){super(e,"in",t),this.keys=zh("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Bh extends Vh{constructor(e,t){super(e,"not-in",t),this.keys=zh("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function zh(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>gh.fromName(e.referenceValue)))}class $h extends Vh{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Sh(t)&&wh(t.arrayValue,this.value)}}class Kh extends Vh{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&wh(this.value.arrayValue,t)}}class Hh extends Vh{constructor(e,t){super(e,"not-in",t)}matches(e){if(wh(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!wh(this.value.arrayValue,t)}}class Wh extends Vh{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Sh(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>wh(this.value.arrayValue,e)))}}class Gh{constructor(e,t){this.position=e,this.before=t}}function Qh(e){return`${e.before?"b":"a"}:${e.position.map((e=>Ih(e))).join(",")}`}class Jh{constructor(e,t="asc"){this.field=e,this.dir=t}}function Yh(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function Xh(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?gh.comparator(gh.fromName(o.referenceValue),n.key):_h(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function Zh(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!vh(e.position[n],t.position[n]))return!1;return!0}class el{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.S=null,this.D=null,this.startAt,this.endAt}}function tl(e,t,n,r,i,s,o,a){return new el(e,t,n,r,i,s,o,a)}function nl(e){return new el(e)}function rl(e){return!fh(e.limit)&&"F"===e.limitType}function il(e){return!fh(e.limit)&&"L"===e.limitType}function sl(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function ol(e){for(const t of e.filters)if(t.V())return t.field;return null}function al(e){return null!==e.collectionGroup}function cl(e){const t=Du(e);if(null===t.S){t.S=[];const e=ol(t),n=sl(t);if(null!==e&&null===n)e.isKeyField()||t.S.push(new Jh(e)),t.S.push(new Jh(rh.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.S.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.S.push(new Jh(rh.keyField(),e))}}}return t.S}function ul(e){const t=Du(e);if(!t.D)if("F"===t.limitType)t.D=Lh(t.path,t.collectionGroup,cl(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of cl(t)){const t="desc"===i.dir?"asc":"desc";e.push(new Jh(i.field,t))}const n=t.endAt?new Gh(t.endAt.position,!t.endAt.before):null,r=t.startAt?new Gh(t.startAt.position,!t.startAt.before):null;t.D=Lh(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.D}function hl(e,t,n){return new el(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ll(e,t){return Uh(ul(e),ul(t))&&e.limitType===t.limitType}function dl(e){return`${Mh(ul(e))}|lt:${e.limitType}`}function fl(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>{return`${(t=e).field.canonicalString()} ${t.op} ${Ih(t.value)}`;var t})).join(", ")}]`),fh(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: "+Qh(e.startAt)),e.endAt&&(t+=", endAt: "+Qh(e.endAt)),`Target(${t})`}(ul(e))}; limitType=${e.limitType})`}function pl(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):gh.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!Xh(e.startAt,cl(e),t))&&(!e.endAt||!Xh(e.endAt,cl(e),t))}(e,t)}function ml(e){return(t,n)=>{let r=!1;for(const i of cl(e)){const e=gl(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function gl(e,t,n){const r=e.field.isKeyField()?gh.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?_h(r,i):Ru()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Ru()}}function yl(e,t){if(e.C){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ph(t)?"-0":t}}function vl(e){return{integerValue:""+e}}function wl(e,t){return mh(t)?vl(t):yl(e,t)}class _l{constructor(){this._=void 0}}function bl(e,t,n){return e instanceof El?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof kl?Sl(e,t):e instanceof Al?Cl(e,t):function(e,t){const n=Tl(e,t),r=Nl(n)+Nl(e.N);return kh(n)&&kh(e.N)?vl(r):yl(e.k,r)}(e,t)}function Il(e,t,n){return e instanceof kl?Sl(e,t):e instanceof Al?Cl(e,t):n}function Tl(e,t){return e instanceof Rl?kh(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class El extends _l{}class kl extends _l{constructor(e){super(),this.elements=e}}function Sl(e,t){const n=Dl(t);for(const r of e.elements)n.some((e=>vh(e,r)))||n.push(r);return{arrayValue:{values:n}}}class Al extends _l{constructor(e){super(),this.elements=e}}function Cl(e,t){let n=Dl(t);for(const r of e.elements)n=n.filter((e=>!vh(e,r)));return{arrayValue:{values:n}}}class Rl extends _l{constructor(e,t){super(),this.k=e,this.N=t}}function Nl(e){return ch(e.integerValue||e.doubleValue)}function Dl(e){return Sh(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ol{constructor(e,t){this.field=e,this.transform=t}}class Pl{constructor(e,t){this.version=e,this.transformResults=t}}class xl{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new xl}static exists(e){return new xl(void 0,e)}static updateTime(e){return new xl(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ll(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Ml{}function Ul(e,t,n){e instanceof Bl?function(e,t,n){const r=e.value.clone(),i=Kl(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof zl?function(e,t,n){if(!Ll(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Kl(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll($l(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Fl(e,t,n){e instanceof Bl?function(e,t,n){if(!Ll(e.precondition,t))return;const r=e.value.clone(),i=Hl(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(jl(t),r).setHasLocalMutations()}(e,t,n):e instanceof zl?function(e,t,n){if(!Ll(e.precondition,t))return;const r=Hl(e.fieldTransforms,n,t),i=t.data;i.setAll($l(e)),i.setAll(r),t.convertToFoundDocument(jl(t),i).setHasLocalMutations()}(e,t,n):function(e,t){Ll(e.precondition,t)&&t.convertToNoDocument(Ju.min())}(e,t)}function Vl(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Tl(r.transform,e||null);null!=i&&(null==n&&(n=Dh.empty()),n.set(r.field,i))}return n||null}function ql(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Wu(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof kl&&t instanceof kl||e instanceof Al&&t instanceof Al?Wu(e.elements,t.elements,vh):e instanceof Rl&&t instanceof Rl?vh(e.N,t.N):e instanceof El&&t instanceof El}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function jl(e){return e.isFoundDocument()?e.version:Ju.min()}class Bl extends Ml{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class zl extends Ml{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function $l(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Kl(e,t,n){const r=new Map;Nu(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Il(o,a,n[i]))}return r}function Hl(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,bl(e,s,t))}return r}class Wl extends Ml{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class Gl extends Ml{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class Ql{constructor(e){this.count=e}}var Jl,Yl;function Xl(e){switch(e){default:return Ru();case Ou.CANCELLED:case Ou.UNKNOWN:case Ou.DEADLINE_EXCEEDED:case Ou.RESOURCE_EXHAUSTED:case Ou.INTERNAL:case Ou.UNAVAILABLE:case Ou.UNAUTHENTICATED:return!1;case Ou.INVALID_ARGUMENT:case Ou.NOT_FOUND:case Ou.ALREADY_EXISTS:case Ou.PERMISSION_DENIED:case Ou.FAILED_PRECONDITION:case Ou.ABORTED:case Ou.OUT_OF_RANGE:case Ou.UNIMPLEMENTED:case Ou.DATA_LOSS:return!0}}function Zl(e){if(void 0===e)return Su("GRPC error has no .code"),Ou.UNKNOWN;switch(e){case Jl.OK:return Ou.OK;case Jl.CANCELLED:return Ou.CANCELLED;case Jl.UNKNOWN:return Ou.UNKNOWN;case Jl.DEADLINE_EXCEEDED:return Ou.DEADLINE_EXCEEDED;case Jl.RESOURCE_EXHAUSTED:return Ou.RESOURCE_EXHAUSTED;case Jl.INTERNAL:return Ou.INTERNAL;case Jl.UNAVAILABLE:return Ou.UNAVAILABLE;case Jl.UNAUTHENTICATED:return Ou.UNAUTHENTICATED;case Jl.INVALID_ARGUMENT:return Ou.INVALID_ARGUMENT;case Jl.NOT_FOUND:return Ou.NOT_FOUND;case Jl.ALREADY_EXISTS:return Ou.ALREADY_EXISTS;case Jl.PERMISSION_DENIED:return Ou.PERMISSION_DENIED;case Jl.FAILED_PRECONDITION:return Ou.FAILED_PRECONDITION;case Jl.ABORTED:return Ou.ABORTED;case Jl.OUT_OF_RANGE:return Ou.OUT_OF_RANGE;case Jl.UNIMPLEMENTED:return Ou.UNIMPLEMENTED;case Jl.DATA_LOSS:return Ou.DATA_LOSS;default:return Ru()}}(Yl=Jl||(Jl={}))[Yl.OK=0]="OK",Yl[Yl.CANCELLED=1]="CANCELLED",Yl[Yl.UNKNOWN=2]="UNKNOWN",Yl[Yl.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Yl[Yl.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Yl[Yl.NOT_FOUND=5]="NOT_FOUND",Yl[Yl.ALREADY_EXISTS=6]="ALREADY_EXISTS",Yl[Yl.PERMISSION_DENIED=7]="PERMISSION_DENIED",Yl[Yl.UNAUTHENTICATED=16]="UNAUTHENTICATED",Yl[Yl.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Yl[Yl.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Yl[Yl.ABORTED=10]="ABORTED",Yl[Yl.OUT_OF_RANGE=11]="OUT_OF_RANGE",Yl[Yl.UNIMPLEMENTED=12]="UNIMPLEMENTED",Yl[Yl.INTERNAL=13]="INTERNAL",Yl[Yl.UNAVAILABLE=14]="UNAVAILABLE",Yl[Yl.DATA_LOSS=15]="DATA_LOSS";class ed{constructor(e,t){this.comparator=e,this.root=t||nd.EMPTY}insert(e,t){return new ed(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,nd.BLACK,null,null))}remove(e){return new ed(this.comparator,this.root.remove(e,this.comparator).copy(null,null,nd.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new td(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new td(this.root,e,this.comparator,!1)}getReverseIterator(){return new td(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new td(this.root,e,this.comparator,!0)}}class td{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class nd{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:nd.RED,this.left=null!=r?r:nd.EMPTY,this.right=null!=i?i:nd.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new nd(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return nd.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return nd.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,nd.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,nd.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ru();if(this.right.isRed())throw Ru();const e=this.left.check();if(e!==this.right.check())throw Ru();return e+(this.isRed()?0:1)}}nd.EMPTY=null,nd.RED=!0,nd.BLACK=!1,nd.EMPTY=new class{constructor(){this.size=0}get key(){throw Ru()}get value(){throw Ru()}get color(){throw Ru()}get left(){throw Ru()}get right(){throw Ru()}copy(e,t,n,r,i){return this}insert(e,t,n){return new nd(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class rd{constructor(e){this.comparator=e,this.data=new ed(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new id(this.data.getIterator())}getIteratorFrom(e){return new id(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof rd))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new rd(this.comparator);return t.data=e,t}}class id{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const sd=new ed(gh.comparator);function od(){return sd}const ad=new ed(gh.comparator);function cd(){return ad}const ud=new ed(gh.comparator);function hd(){return ud}const ld=new rd(gh.comparator);function dd(...e){let t=ld;for(const n of e)t=t.add(n);return t}const fd=new rd(Hu);function pd(){return fd}class md{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,gd.createSynthesizedTargetChangeForCurrentChange(e,t)),new md(Ju.min(),n,pd(),od(),dd())}}class gd{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new gd(sh.EMPTY_BYTE_STRING,t,dd(),dd(),dd())}}class yd{constructor(e,t,n,r){this.$=e,this.removedTargetIds=t,this.key=n,this.O=r}}class vd{constructor(e,t){this.targetId=e,this.M=t}}class wd{constructor(e,t,n=sh.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class _d{constructor(){this.F=0,this.L=Td(),this.B=sh.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.F}get j(){return this.q}W(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}G(){let e=dd(),t=dd(),n=dd();return this.L.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Ru()}})),new gd(this.B,this.U,e,t,n)}H(){this.q=!1,this.L=Td()}J(e,t){this.q=!0,this.L=this.L.insert(e,t)}Y(e){this.q=!0,this.L=this.L.remove(e)}X(){this.F+=1}Z(){this.F-=1}tt(){this.q=!0,this.U=!0}}class bd{constructor(e){this.et=e,this.nt=new Map,this.st=od(),this.it=Id(),this.rt=new rd(Hu)}ot(e){for(const t of e.$)e.O&&e.O.isFoundDocument()?this.ct(t,e.O):this.at(t,e.key,e.O);for(const t of e.removedTargetIds)this.at(t,e.key,e.O)}ut(e){this.forEachTarget(e,(t=>{const n=this.ht(t);switch(e.state){case 0:this.lt(t)&&n.W(e.resumeToken);break;case 1:n.Z(),n.K||n.H(),n.W(e.resumeToken);break;case 2:n.Z(),n.K||this.removeTarget(t);break;case 3:this.lt(t)&&(n.tt(),n.W(e.resumeToken));break;case 4:this.lt(t)&&(this.ft(t),n.W(e.resumeToken));break;default:Ru()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach(((e,n)=>{this.lt(n)&&t(n)}))}dt(e){const t=e.targetId,n=e.M.count,r=this.wt(t);if(r){const e=r.target;if(Fh(e))if(0===n){const n=new gh(e.path);this.at(t,n,Ph.newNoDocument(n,Ju.min()))}else Nu(1===n);else this._t(t)!==n&&(this.ft(t),this.rt=this.rt.add(t))}}gt(e){const t=new Map;this.nt.forEach(((n,r)=>{const i=this.wt(r);if(i){if(n.current&&Fh(i.target)){const t=new gh(i.target.path);null!==this.st.get(t)||this.yt(r,t)||this.at(r,t,Ph.newNoDocument(t,e))}n.j&&(t.set(r,n.G()),n.H())}}));let n=dd();this.it.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.wt(e);return!t||2===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))}));const r=new md(e,t,this.rt,this.st,n);return this.st=od(),this.it=Id(),this.rt=new rd(Hu),r}ct(e,t){if(!this.lt(e))return;const n=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,n),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}at(e,t,n){if(!this.lt(e))return;const r=this.ht(e);this.yt(e,t)?r.J(t,1):r.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),n&&(this.st=this.st.insert(t,n))}removeTarget(e){this.nt.delete(e)}_t(e){const t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}X(e){this.ht(e).X()}ht(e){let t=this.nt.get(e);return t||(t=new _d,this.nt.set(e,t)),t}Tt(e){let t=this.it.get(e);return t||(t=new rd(Hu),this.it=this.it.insert(e,t)),t}lt(e){const t=null!==this.wt(e);return t||ku("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}ft(e){this.nt.set(e,new _d),this.et.getRemoteKeysForTarget(e).forEach((t=>{this.at(e,t,null)}))}yt(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}function Id(){return new ed(gh.comparator)}function Td(){return new ed(gh.comparator)}const Ed={asc:"ASCENDING",desc:"DESCENDING"},kd={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Sd{constructor(e,t){this.databaseId=e,this.C=t}}function Ad(e,t){return e.C?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Cd(e,t){return e.C?t.toBase64():t.toUint8Array()}function Rd(e,t){return Ad(e,t.toTimestamp())}function Nd(e){return Nu(!!e),Ju.fromTimestamp(function(e){const t=ah(e);return new Qu(t.seconds,t.nanos)}(e))}function Dd(e,t){return function(e){return new th(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Od(e){const t=th.fromString(e);return Nu(nf(t)),t}function Pd(e,t){return Dd(e.databaseId,t.path)}function xd(e,t){const n=Od(t);if(n.get(1)!==e.databaseId.projectId)throw new Pu(Ou.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Pu(Ou.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new gh(Fd(n))}function Ld(e,t){return Dd(e.databaseId,t)}function Md(e){const t=Od(e);return 4===t.length?th.emptyPath():Fd(t)}function Ud(e){return new th(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Fd(e){return Nu(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Vd(e,t,n){return{name:Pd(e,t),fields:n.value.mapValue.fields}}function qd(e,t,n){const r=xd(e,t.name),i=Nd(t.updateTime),s=new Dh({mapValue:{fields:t.fields}}),o=Ph.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function jd(e,t){let n;if(t instanceof Bl)n={update:Vd(e,t.key,t.value)};else if(t instanceof Wl)n={delete:Pd(e,t.key)};else if(t instanceof zl)n={update:Vd(e,t.key,t.data),updateMask:tf(t.fieldMask)};else{if(!(t instanceof Gl))return Ru();n={verify:Pd(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof El)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof kl)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Al)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Rl)return{fieldPath:t.field.canonicalString(),increment:n.N};throw Ru()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Rd(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ru()}(e,t.precondition)),n}function Bd(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?xl.updateTime(Nd(e.updateTime)):void 0!==e.exists?xl.exists(e.exists):xl.none()}(t.currentDocument):xl.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)Nu("REQUEST_TIME"===t.setToServerValue),n=new El;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new kl(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Al(e)}else"increment"in t?n=new Rl(e,t.increment):Ru();const r=rh.fromServerFormat(t.fieldPath);return new Ol(r,n)}(e,t))):[];if(t.update){t.update.name;const i=xd(e,t.update.name),s=new Dh({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new ih(t.map((e=>rh.fromServerFormat(e))))}(t.updateMask);return new zl(i,s,e,n,r)}return new Bl(i,s,n,r)}if(t.delete){const r=xd(e,t.delete);return new Wl(r,n)}if(t.verify){const r=xd(e,t.verify);return new Gl(r,n)}return Ru()}function zd(e,t){return{documents:[Ld(e,t.path)]}}function $d(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Ld(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Ld(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0===e.length)return;const t=e.map((e=>function(e){if("=="===e.op){if(Ch(e.value))return{unaryFilter:{field:Yd(e.field),op:"IS_NAN"}};if(Ah(e.value))return{unaryFilter:{field:Yd(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ch(e.value))return{unaryFilter:{field:Yd(e.field),op:"IS_NOT_NAN"}};if(Ah(e.value))return{unaryFilter:{field:Yd(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Yd(e.field),op:Jd(e.op),value:e.value}}}(e)));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Yd(e.field),direction:Qd(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.C||fh(t)?t:{value:t}}(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=Wd(t.startAt)),t.endAt&&(n.structuredQuery.endAt=Wd(t.endAt)),n}function Kd(e){let t=Md(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Nu(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=Hd(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new Jh(Xd(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,fh(t)?null:t}(n.limit));let c=null;n.startAt&&(c=Gd(n.startAt));let u=null;return n.endAt&&(u=Gd(n.endAt)),tl(t,i,o,s,a,"F",c,u)}function Hd(e){return e?void 0!==e.unaryFilter?[ef(e)]:void 0!==e.fieldFilter?[Zd(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((e=>Hd(e))).reduce(((e,t)=>e.concat(t))):Ru():[]}function Wd(e){return{before:e.before,values:e.position}}function Gd(e){const t=!!e.before,n=e.values||[];return new Gh(n,t)}function Qd(e){return Ed[e]}function Jd(e){return kd[e]}function Yd(e){return{fieldPath:e.canonicalString()}}function Xd(e){return rh.fromServerFormat(e.fieldPath)}function Zd(e){return Vh.create(Xd(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ru()}}(e.fieldFilter.op),e.fieldFilter.value)}function ef(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Xd(e.unaryFilter.field);return Vh.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Xd(e.unaryFilter.field);return Vh.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Xd(e.unaryFilter.field);return Vh.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Xd(e.unaryFilter.field);return Vh.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Ru()}}function tf(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function nf(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function rf(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=of(t)),t=sf(e.get(n),t);return of(t)}function sf(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=t}}return n}function of(e){return e+"\x01\x01"}function af(e){const t=e.length;if(Nu(t>=2),2===t)return Nu("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),th.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("\x01",s);switch((t<0||t>n)&&Ru(),e.charAt(t+1)){case"\x01":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:Ru()}s=t+2}return new th(r)}class cf{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class uf{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}uf.store="owner",uf.key="owner";class hf{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}hf.store="mutationQueues",hf.keyPath="userId";class lf{constructor(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}lf.store="mutations",lf.keyPath="batchId",lf.userMutationsIndex="userMutationsIndex",lf.userMutationsKeyPath=["userId","batchId"];class df{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,rf(t)]}static key(e,t,n){return[e,rf(t),n]}}df.store="documentMutations",df.PLACEHOLDER=new df;class ff{constructor(e,t){this.path=e,this.readTime=t}}class pf{constructor(e,t){this.path=e,this.version=t}}class mf{constructor(e,t,n,r,i,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}mf.store="remoteDocuments",mf.readTimeIndex="readTimeIndex",mf.readTimeIndexPath="readTime",mf.collectionReadTimeIndex="collectionReadTimeIndex",mf.collectionReadTimeIndexPath=["parentPath","readTime"];class gf{constructor(e){this.byteSize=e}}gf.store="remoteDocumentGlobal",gf.key="remoteDocumentGlobalKey";class yf{constructor(e,t,n,r,i,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}yf.store="targets",yf.keyPath="targetId",yf.queryTargetsIndexName="queryTargetsIndex",yf.queryTargetsKeyPath=["canonicalId","targetId"];class vf{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}vf.store="targetDocuments",vf.keyPath=["targetId","path"],vf.documentTargetsIndex="documentTargetsIndex",vf.documentTargetsKeyPath=["path","targetId"];class wf{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}wf.key="targetGlobalKey",wf.store="targetGlobal";class _f{constructor(e,t){this.collectionId=e,this.parent=t}}_f.store="collectionParents",_f.keyPath=["collectionId","parent"];class bf{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}bf.store="clientMetadata",bf.keyPath="clientId";class If{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}If.store="bundles",If.keyPath="bundleId";class Tf{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}Tf.store="namedQueries",Tf.keyPath="name";const Ef=[hf.store,lf.store,df.store,mf.store,yf.store,uf.store,wf.store,vf.store,bf.store,gf.store,_f.store,If.store,Tf.store],kf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Sf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}class Af{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ru(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Af(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Af?t:Af.resolve(t)}catch(e){return Af.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Af.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Af.reject(t)}static resolve(e){return new Af(((t,n)=>{t(e)}))}static reject(e){return new Af(((t,n)=>{n(e)}))}static waitFor(e){return new Af(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=Af.resolve(!1);for(const n of e)t=t.next((e=>e?Af.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}}class Cf{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.It=new xu,this.transaction.oncomplete=()=>{this.It.resolve()},this.transaction.onabort=()=>{t.error?this.It.reject(new Df(e,t.error)):this.It.resolve()},this.transaction.onerror=t=>{const n=Mf(t.target.error);this.It.reject(new Df(e,n))}}static open(e,t,n,r){try{return new Cf(t,e.transaction(r,n))}catch(e){throw new Df(t,e)}}get At(){return this.It.promise}abort(e){e&&this.It.reject(e),this.aborted||(ku("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){const t=this.transaction.objectStore(e);return new Pf(t)}}class Rf{constructor(e,t,n){this.name=e,this.version=t,this.Rt=n,12.2===Rf.bt(f())&&Su("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ku("SimpleDb","Removing database:",e),xf(window.indexedDB.deleteDatabase(e)).toPromise()}static Pt(){if(!w())return!1;if(Rf.vt())return!0;const e=f(),t=Rf.bt(e),n=0<t&&t<10,r=Rf.Vt(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static vt(){var e;return"undefined"!=typeof wu&&"YES"===(null===(e=wu.env)||void 0===e?void 0:e.St)}static Dt(e,t){return e.store(t)}static bt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Vt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Ct(e){return this.db||(ku("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new Df(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new Pu(Ou.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Pu(Ou.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Df(e,r))},r.onupgradeneeded=e=>{ku("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.Rt.Nt(t,r.transaction,e.oldVersion,this.version).next((()=>{ku("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.kt&&(this.db.onversionchange=e=>this.kt(e)),this.db}xt(e){this.kt=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.Ct(e);const t=Cf.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).catch((e=>(t.abort(e),Af.reject(e)))).toPromise();return s.catch((()=>{})),await t.At,s}catch(e){const t="FirebaseError"!==e.name&&s<3;if(ku("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Nf{constructor(e){this.$t=e,this.Ot=!1,this.Mt=null}get isDone(){return this.Ot}get Ft(){return this.Mt}set cursor(e){this.$t=e}done(){this.Ot=!0}Lt(e){this.Mt=e}delete(){return xf(this.$t.delete())}}class Df extends Pu{constructor(e,t){super(Ou.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Of(e){return"IndexedDbTransactionError"===e.name}class Pf{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(ku("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(ku("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),xf(n)}add(e){return ku("SimpleDb","ADD",this.store.name,e,e),xf(this.store.add(e))}get(e){return xf(this.store.get(e)).next((t=>(void 0===t&&(t=null),ku("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return ku("SimpleDb","DELETE",this.store.name,e),xf(this.store.delete(e))}count(){return ku("SimpleDb","COUNT",this.store.name),xf(this.store.count())}Bt(e,t){const n=this.cursor(this.options(e,t)),r=[];return this.Ut(n,((e,t)=>{r.push(t)})).next((()=>r))}qt(e,t){ku("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Kt=!1;const r=this.cursor(n);return this.Ut(r,((e,t,n)=>n.delete()))}jt(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.Ut(r,t)}Qt(e){const t=this.cursor({});return new Af(((n,r)=>{t.onerror=e=>{const t=Mf(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}Ut(e,t){const n=[];return new Af(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new Nf(i),o=t(i.primaryKey,i.value,s);if(o instanceof Af){const e=o.catch((e=>(s.done(),Af.reject(e))));n.push(e)}s.isDone?r():null===s.Ft?i.continue():i.continue(s.Ft)}})).next((()=>Af.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Kt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function xf(e){return new Af(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Mf(e.target.error);n(t)}}))}let Lf=!1;function Mf(e){const t=Rf.bt(f());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Pu("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Lf||(Lf=!0,setTimeout((()=>{throw e}),0)),e}}return e}class Uf extends Sf{constructor(e,t){super(),this.Wt=e,this.currentSequenceNumber=t}}function Ff(e,t){const n=Du(e);return Rf.Dt(n.Wt,t)}class Vf{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&Ul(t,e,n[r])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&Fl(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&Fl(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach((t=>{const n=e.get(t.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(Ju.min())}))}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),dd())}isEqual(e){return this.batchId===e.batchId&&Wu(this.mutations,e.mutations,((e,t)=>ql(e,t)))&&Wu(this.baseMutations,e.baseMutations,((e,t)=>ql(e,t)))}}class qf{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Nu(e.mutations.length===n.length);let r=hd();const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new qf(e,t,n,r)}}class jf{constructor(e,t,n,r,i=Ju.min(),s=Ju.min(),o=sh.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new jf(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new jf(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new jf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Bf{constructor(e){this.Gt=e}}function zf(e,t){if(t.document)return qd(e.Gt,t.document,!!t.hasCommittedMutations);if(t.noDocument){const e=gh.fromSegments(t.noDocument.path),n=Gf(t.noDocument.readTime),r=Ph.newNoDocument(e,n);return t.hasCommittedMutations?r.setHasCommittedMutations():r}if(t.unknownDocument){const e=gh.fromSegments(t.unknownDocument.path),n=Gf(t.unknownDocument.version);return Ph.newUnknownDocument(e,n)}return Ru()}function $f(e,t,n){const r=Kf(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){const n=function(e,t){return{name:Pd(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Ad(e,t.version.toTimestamp())}}(e.Gt,t),s=t.hasCommittedMutations;return new mf(null,null,n,s,r,i)}if(t.isNoDocument()){const e=t.key.path.toArray(),n=Wf(t.version),s=t.hasCommittedMutations;return new mf(null,new ff(e,n),null,s,r,i)}if(t.isUnknownDocument()){const e=t.key.path.toArray(),n=Wf(t.version);return new mf(new pf(e,n),null,null,!0,r,i)}return Ru()}function Kf(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Hf(e){const t=new Qu(e[0],e[1]);return Ju.fromTimestamp(t)}function Wf(e){const t=e.toTimestamp();return new cf(t.seconds,t.nanoseconds)}function Gf(e){const t=new Qu(e.seconds,e.nanoseconds);return Ju.fromTimestamp(t)}function Qf(e,t){const n=(t.baseMutations||[]).map((t=>Bd(e.Gt,t)));for(let s=0;s<t.mutations.length-1;++s){const e=t.mutations[s];if(s+1<t.mutations.length&&void 0!==t.mutations[s+1].transform){const n=t.mutations[s+1];e.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}const r=t.mutations.map((t=>Bd(e.Gt,t))),i=Qu.fromMillis(t.localWriteTimeMs);return new Vf(t.batchId,i,n,r)}function Jf(e){const t=Gf(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Gf(e.lastLimboFreeSnapshotVersion):Ju.min();let r;var i;return void 0!==e.query.documents?(Nu(1===(i=e.query).documents.length),r=ul(nl(Md(i.documents[0])))):r=function(e){return ul(Kd(e))}(e.query),new jf(r,e.targetId,0,e.lastListenSequenceNumber,t,n,sh.fromBase64String(e.resumeToken))}function Yf(e,t){const n=Wf(t.snapshotVersion),r=Wf(t.lastLimboFreeSnapshotVersion);let i;i=Fh(t.target)?zd(e.Gt,t.target):$d(e.Gt,t.target);const s=t.resumeToken.toBase64();return new yf(t.targetId,Mh(t.target),n,s,t.sequenceNumber,r,i)}function Xf(e){const t=Kd({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?hl(t,t.limit,"L"):t}class Zf{getBundleMetadata(e,t){return ep(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:Gf(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return ep(e).put({bundleId:(n=t).id,createTime:Wf(Nd(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return tp(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:Xf(t.bundledQuery),readTime:Gf(t.readTime)};var t}))}saveNamedQuery(e,t){return tp(e).put(function(e){return{name:e.name,readTime:Wf(Nd(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function ep(e){return Ff(e,If.store)}function tp(e){return Ff(e,Tf.store)}class np{constructor(){this.zt=new rp}addToCollectionParentIndex(e,t){return this.zt.add(t),Af.resolve()}getCollectionParents(e,t){return Af.resolve(this.zt.getEntries(t))}}class rp{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new rd(th.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new rd(th.comparator)).toArray()}}class ip{constructor(){this.Ht=new rp}addToCollectionParentIndex(e,t){if(!this.Ht.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.Ht.add(t)}));const i={collectionId:n,parent:rf(r)};return sp(e).put(i)}return Af.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[Gu(t),""],!1,!0);return sp(e).Bt(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(af(r.parent))}return n}))}}function sp(e){return Ff(e,_f.store)}const op={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class ap{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new ap(e,ap.DEFAULT_COLLECTION_PERCENTILE,ap.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function cp(e,t,n){const r=e.store(lf.store),i=e.store(df.store),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.jt({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{Nu(1===a)})));const u=[];for(const h of n.mutations){const e=df.key(t,h.key.path,n.batchId);s.push(i.delete(e)),u.push(h.key)}return Af.waitFor(s).next((()=>u))}function up(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Ru();t=e.noDocument}return JSON.stringify(t).length}ap.DEFAULT_COLLECTION_PERCENTILE=10,ap.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ap.DEFAULT=new ap(41943040,ap.DEFAULT_COLLECTION_PERCENTILE,ap.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ap.DISABLED=new ap(-1,0,0);class hp{constructor(e,t,n,r){this.userId=e,this.k=t,this.Jt=n,this.referenceDelegate=r,this.Yt={}}static Xt(e,t,n,r){Nu(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new hp(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return dp(e).jt({index:lf.userMutationsIndex,range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=fp(e),s=dp(e);return s.add({}).next((o=>{Nu("number"==typeof o);const a=new Vf(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>jd(e.Gt,t))),i=n.mutations.map((t=>jd(e.Gt,t)));return new lf(t,n.batchId,n.localWriteTime.toMillis(),r,i)}(this.k,this.userId,a),u=[];let h=new rd(((e,t)=>Hu(e.canonicalString(),t.canonicalString())));for(const e of r){const t=df.key(this.userId,e.key.path,o);h=h.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,df.PLACEHOLDER))}return h.forEach((t=>{u.push(this.Jt.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Yt[o]=a.keys()})),Af.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return dp(e).get(t).next((e=>e?(Nu(e.userId===this.userId),Qf(this.k,e)):null))}Zt(e,t){return this.Yt[t]?Af.resolve(this.Yt[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Yt[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return dp(e).jt({index:lf.userMutationsIndex,range:r},((e,t,r)=>{t.userId===this.userId&&(Nu(t.batchId>=n),i=Qf(this.k,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return dp(e).jt({index:lf.userMutationsIndex,range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return dp(e).Bt(lf.userMutationsIndex,t).next((e=>e.map((e=>Qf(this.k,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=df.prefixForPath(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return fp(e).jt({range:r},((n,r,s)=>{const[o,a,c]=n,u=af(a);if(o===this.userId&&t.path.isEqual(u))return dp(e).get(c).next((e=>{if(!e)throw Ru();Nu(e.userId===this.userId),i.push(Qf(this.k,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new rd(Hu);const r=[];return t.forEach((t=>{const i=df.prefixForPath(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=fp(e).jt({range:s},((e,r,i)=>{const[s,o,a]=e,c=af(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),Af.waitFor(r).next((()=>this.te(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=df.prefixForPath(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new rd(Hu);return fp(e).jt({range:s},((e,t,i)=>{const[s,a,c]=e,u=af(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.te(e,o)))}te(e,t){const n=[],r=[];return t.forEach((t=>{r.push(dp(e).get(t).next((e=>{if(null===e)throw Ru();Nu(e.userId===this.userId),n.push(Qf(this.k,e))})))})),Af.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return cp(e.Wt,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.ee(t.batchId)})),Af.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}ee(e){delete this.Yt[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return Af.resolve();const n=IDBKeyRange.lowerBound(df.prefixForUser(this.userId)),r=[];return fp(e).jt({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=af(e[1]);r.push(t)}else n.done()})).next((()=>{Nu(0===r.length)}))}))}containsKey(e,t){return lp(e,this.userId,t)}ne(e){return pp(e).get(this.userId).next((e=>e||new hf(this.userId,-1,"")))}}function lp(e,t,n){const r=df.prefixForPath(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return fp(e).jt({range:s,Kt:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function dp(e){return Ff(e,lf.store)}function fp(e){return Ff(e,df.store)}function pp(e){return Ff(e,hf.store)}class mp{constructor(e){this.se=e}next(){return this.se+=2,this.se}static ie(){return new mp(0)}static re(){return new mp(-1)}}class gp{constructor(e,t){this.referenceDelegate=e,this.k=t}allocateTargetId(e){return this.oe(e).next((t=>{const n=new mp(t.highestTargetId);return t.highestTargetId=n.next(),this.ce(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.oe(e).next((e=>Ju.fromTimestamp(new Qu(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.oe(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.oe(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.ce(e,r))))}addTargetData(e,t){return this.ae(e,t).next((()=>this.oe(e).next((n=>(n.targetCount+=1,this.ue(t,n),this.ce(e,n))))))}updateTargetData(e,t){return this.ae(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>yp(e).delete(t.targetId))).next((()=>this.oe(e))).next((t=>(Nu(t.targetCount>0),t.targetCount-=1,this.ce(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return yp(e).jt(((s,o)=>{const a=Jf(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>Af.waitFor(i))).next((()=>r))}forEachTarget(e,t){return yp(e).jt(((e,n)=>{const r=Jf(n);t(r)}))}oe(e){return vp(e).get(wf.key).next((e=>(Nu(null!==e),e)))}ce(e,t){return vp(e).put(wf.key,t)}ae(e,t){return yp(e).put(Yf(this.k,t))}ue(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.oe(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Mh(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return yp(e).jt({range:r,index:yf.queryTargetsIndexName},((e,n,r)=>{const s=Jf(n);Uh(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=wp(e);return t.forEach((t=>{const s=rf(t.path);r.push(i.put(new vf(n,s))),r.push(this.referenceDelegate.addReference(e,n,t))})),Af.waitFor(r)}removeMatchingKeys(e,t,n){const r=wp(e);return Af.forEach(t,(t=>{const i=rf(t.path);return Af.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=wp(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=wp(e);let i=dd();return r.jt({range:n,Kt:!0},((e,t,n)=>{const r=af(e[1]),s=new gh(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=rf(t.path),r=IDBKeyRange.bound([n],[Gu(n)],!1,!0);let i=0;return wp(e).jt({index:vf.documentTargetsIndex,Kt:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}Et(e,t){return yp(e).get(t).next((e=>e?Jf(e):null))}}function yp(e){return Ff(e,yf.store)}function vp(e){return Ff(e,wf.store)}function wp(e){return Ff(e,vf.store)}async function _p(e){if(e.code!==Ou.FAILED_PRECONDITION||e.message!==kf)throw e;ku("LocalStore","Unexpectedly lost primary lease")}function bp([e,t],[n,r]){const i=Hu(e,n);return 0===i?Hu(t,r):i}class Ip{constructor(e){this.he=e,this.buffer=new rd(bp),this.le=0}fe(){return++this.le}de(e){const t=[e,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();bp(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Tp{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.we=!1,this._e=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.me(e)}stop(){this._e&&(this._e.cancel(),this._e=null)}get started(){return null!==this._e}me(e){const t=this.we?3e5:6e4;ku("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this._e=null,this.we=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){Of(e)?ku("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await _p(e)}await this.me(e)}))}}class Ep{constructor(e,t){this.ge=e,this.params=t}calculateTargetCount(e,t){return this.ge.ye(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Af.resolve(zu.I);const n=new Ip(t);return this.ge.forEachTarget(e,(e=>n.de(e.sequenceNumber))).next((()=>this.ge.pe(e,(e=>n.de(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.ge.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.ge.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(ku("LruGarbageCollector","Garbage collection skipped; disabled"),Af.resolve(op)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(ku("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),op):this.Te(e,t)))}getCacheSize(e){return this.ge.getCacheSize(e)}Te(e,t){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(ku("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),Eu()<=F.DEBUG&&ku("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Af.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class kp{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new Ep(e,t)}(this,t)}ye(e){const t=this.Ee(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Ee(e){let t=0;return this.pe(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pe(e,t){return this.Ie(e,((e,n)=>t(n)))}addReference(e,t,n){return Sp(e,n)}removeReference(e,t,n){return Sp(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Sp(e,t)}Ae(e,t){return function(e,t){let n=!1;return pp(e).Qt((r=>lp(e,r,t).next((e=>(e&&(n=!0),Af.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Ie(e,((s,o)=>{if(o<=t){const t=this.Ae(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s),wp(e).delete([0,rf(s.path)]))))}));r.push(t)}})).next((()=>Af.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Sp(e,t)}Ie(e,t){const n=wp(e);let r,i=zu.I;return n.jt({index:vf.documentTargetsIndex},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==zu.I&&t(new gh(af(r)),i),i=o,r=s):i=zu.I})).next((()=>{i!==zu.I&&t(new gh(af(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Sp(e,t){return wp(e).put(function(e,t){return new vf(0,rf(e.path),t)}(t,e.currentSequenceNumber))}class Ap{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}forEach(e){Xu(this.inner,((t,n)=>{for(const[r,i]of n)e(r,i)}))}isEmpty(){return Zu(this.inner)}}class Cp{constructor(){this.changes=new Ap((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:Ju.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:Ph.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Af.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Rp{constructor(e,t){this.k=e,this.Jt=t}addEntry(e,t,n){return Op(e).put(Pp(t),n)}removeEntry(e,t){const n=Op(e),r=Pp(t);return n.delete(r)}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Re(e,n))))}getEntry(e,t){return Op(e).get(Pp(t)).next((e=>this.be(t,e)))}Pe(e,t){return Op(e).get(Pp(t)).next((e=>({document:this.be(t,e),size:up(e)})))}getEntries(e,t){let n=od();return this.ve(e,t,((e,t)=>{const r=this.be(e,t);n=n.insert(e,r)})).next((()=>n))}Ve(e,t){let n=od(),r=new ed(gh.comparator);return this.ve(e,t,((e,t)=>{const i=this.be(e,t);n=n.insert(e,i),r=r.insert(e,up(t))})).next((()=>({documents:n,Se:r})))}ve(e,t,n){if(t.isEmpty())return Af.resolve();const r=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator();let s=i.getNext();return Op(e).jt({range:r},((e,t,r)=>{const o=gh.fromSegments(e);for(;s&&gh.comparator(s,o)<0;)n(s,null),s=i.getNext();s&&s.isEqual(o)&&(n(s,t),s=i.hasNext()?i.getNext():null),s?r.Lt(s.path.toArray()):r.done()})).next((()=>{for(;s;)n(s,null),s=i.hasNext()?i.getNext():null}))}getDocumentsMatchingQuery(e,t,n){let r=od();const i=t.path.length+1,s={};if(n.isEqual(Ju.min())){const e=t.path.toArray();s.range=IDBKeyRange.lowerBound(e)}else{const e=t.path.toArray(),r=Kf(n);s.range=IDBKeyRange.lowerBound([e,r],!0),s.index=mf.collectionReadTimeIndex}return Op(e).jt(s,((e,n,s)=>{if(e.length!==i)return;const o=zf(this.k,n);t.path.isPrefixOf(o.key.path)?pl(t,o)&&(r=r.insert(o.key,o)):s.done()})).next((()=>r))}newChangeBuffer(e){return new Np(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return Dp(e).get(gf.key).next((e=>(Nu(!!e),e)))}Re(e,t){return Dp(e).put(gf.key,t)}be(e,t){if(t){const e=zf(this.k,t);if(!e.isNoDocument()||!e.version.isEqual(Ju.min()))return e}return Ph.newInvalidDocument(e)}}class Np extends Cp{constructor(e,t){super(),this.De=e,this.trackRemovals=t,this.Ce=new Ap((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new rd(((e,t)=>Hu(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.Ce.get(i);if(s.document.isValidDocument()){const a=$f(this.De.k,s.document,this.getReadTime(i));r=r.add(i.path.popLast());const c=up(a);n+=c-o,t.push(this.De.addEntry(e,i,a))}else if(n-=o,this.trackRemovals){const n=$f(this.De.k,Ph.newNoDocument(i,Ju.min()),this.getReadTime(i));t.push(this.De.addEntry(e,i,n))}else t.push(this.De.removeEntry(e,i))})),r.forEach((n=>{t.push(this.De.Jt.addToCollectionParentIndex(e,n))})),t.push(this.De.updateMetadata(e,n)),Af.waitFor(t)}getFromCache(e,t){return this.De.Pe(e,t).next((e=>(this.Ce.set(t,e.size),e.document)))}getAllFromCache(e,t){return this.De.Ve(e,t).next((({documents:e,Se:t})=>(t.forEach(((e,t)=>{this.Ce.set(e,t)})),e)))}}function Dp(e){return Ff(e,gf.store)}function Op(e){return Ff(e,mf.store)}function Pp(e){return e.path.toArray()}class xp{constructor(e){this.k=e}Nt(e,t,n,r){Nu(n<r&&n>=0&&r<=11);const i=new Cf("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(uf.store)}(e),function(e){e.createObjectStore(hf.store,{keyPath:hf.keyPath}),e.createObjectStore(lf.store,{keyPath:lf.keyPath,autoIncrement:!0}).createIndex(lf.userMutationsIndex,lf.userMutationsKeyPath,{unique:!0}),e.createObjectStore(df.store)}(e),Lp(e),function(e){e.createObjectStore(mf.store)}(e));let s=Af.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(vf.store),e.deleteObjectStore(yf.store),e.deleteObjectStore(wf.store)}(e),Lp(e)),s=s.next((()=>function(e){const t=e.store(wf.store),n=new wf(0,0,Ju.min().toTimestamp(),0);return t.put(wf.key,n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store(lf.store).Bt().next((n=>{e.deleteObjectStore(lf.store),e.createObjectStore(lf.store,{keyPath:lf.keyPath,autoIncrement:!0}).createIndex(lf.userMutationsIndex,lf.userMutationsKeyPath,{unique:!0});const r=t.store(lf.store),i=n.map((e=>r.put(e)));return Af.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore(bf.store,{keyPath:bf.keyPath})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Ne(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore(gf.store)}(e),this.ke(i))))),n<7&&r>=7&&(s=s.next((()=>this.xe(i)))),n<8&&r>=8&&(s=s.next((()=>this.$e(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e),function(e){const t=e.objectStore(mf.store);t.createIndex(mf.readTimeIndex,mf.readTimeIndexPath,{unique:!1}),t.createIndex(mf.collectionReadTimeIndex,mf.collectionReadTimeIndexPath,{unique:!1})}(t)}))),n<10&&r>=10&&(s=s.next((()=>this.Oe(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore(If.store,{keyPath:If.keyPath})}(e),function(e){e.createObjectStore(Tf.store,{keyPath:Tf.keyPath})}(e)}))),s}ke(e){let t=0;return e.store(mf.store).jt(((e,n)=>{t+=up(n)})).next((()=>{const n=new gf(t);return e.store(gf.store).put(gf.key,n)}))}Ne(e){const t=e.store(hf.store),n=e.store(lf.store);return t.Bt().next((t=>Af.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.Bt(lf.userMutationsIndex,r).next((n=>Af.forEach(n,(n=>{Nu(n.userId===t.userId);const r=Qf(this.k,n);return cp(e,t.userId,r).next((()=>{}))}))))}))))}xe(e){const t=e.store(vf.store),n=e.store(mf.store);return e.store(wf.store).get(wf.key).next((e=>{const r=[];return n.jt(((n,i)=>{const s=new th(n),o=function(e){return[0,rf(e)]}(s);r.push(t.get(o).next((n=>n?Af.resolve():(n=>t.put(new vf(0,rf(n),e.highestListenSequenceNumber)))(s))))})).next((()=>Af.waitFor(r)))}))}$e(e,t){e.createObjectStore(_f.store,{keyPath:_f.keyPath});const n=t.store(_f.store),r=new rp,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:rf(r)})}};return t.store(mf.store).jt({Kt:!0},((e,t)=>{const n=new th(e);return i(n.popLast())})).next((()=>t.store(df.store).jt({Kt:!0},(([e,t,n],r)=>{const s=af(t);return i(s.popLast())}))))}Oe(e){const t=e.store(yf.store);return t.jt(((e,n)=>{const r=Jf(n),i=Yf(this.k,r);return t.put(i)}))}}function Lp(e){e.createObjectStore(vf.store,{keyPath:vf.keyPath}).createIndex(vf.documentTargetsIndex,vf.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(yf.store,{keyPath:yf.keyPath}).createIndex(yf.queryTargetsIndexName,yf.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(wf.store)}const Mp="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Up{constructor(e,t,n,r,i,s,o,a,c,u){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Me=i,this.window=s,this.document=o,this.Fe=c,this.Le=u,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=e=>Promise.resolve(),!Up.Pt())throw new Pu(Ou.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new kp(this,r),this.Ge=t+"main",this.k=new Bf(a),this.ze=new Rf(this.Ge,11,new xp(this.k)),this.He=new gp(this.referenceDelegate,this.k),this.Jt=new ip,this.Je=function(e,t){return new Rp(e,t)}(this.k,this.Jt),this.Ye=new Zf,this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,!1===u&&Su("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ze().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Pu(Ou.FAILED_PRECONDITION,Mp);return this.tn(),this.en(),this.nn(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.He.getHighestSequenceNumber(e)))})).then((e=>{this.Be=new zu(e,this.Fe)})).then((()=>{this.Ue=!0})).catch((e=>(this.ze&&this.ze.close(),Promise.reject(e))))}sn(e){return this.We=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ze.xt((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Me.enqueueAndForget((async()=>{this.started&&await this.Ze()})))}Ze(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Vp(e).put(new bf(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next((()=>{if(this.isPrimary)return this.rn(e).next((e=>{e||(this.isPrimary=!1,this.Me.enqueueRetryable((()=>this.We(!1))))}))})).next((()=>this.on(e))).next((t=>this.isPrimary&&!t?this.cn(e).next((()=>!1)):!!t&&this.an(e).next((()=>!0)))))).catch((e=>{if(Of(e))return ku("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ku("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Me.enqueueRetryable((()=>this.We(e))),this.isPrimary=e}))}rn(e){return Fp(e).get(uf.key).next((e=>Af.resolve(this.un(e))))}hn(e){return Vp(e).delete(this.clientId)}async ln(){if(this.isPrimary&&!this.fn(this.Qe,18e5)){this.Qe=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=Ff(e,bf.store);return t.Bt().next((e=>{const n=this.dn(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return Af.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.Xe)for(const t of e)this.Xe.removeItem(this.wn(t.clientId))}}nn(){this.je=this.Me.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Ze().then((()=>this.ln())).then((()=>this.nn()))))}un(e){return!!e&&e.ownerId===this.clientId}on(e){return this.Le?Af.resolve(!0):Fp(e).get(uf.key).next((t=>{if(null!==t&&this.fn(t.leaseTimestampMs,5e3)&&!this._n(t.ownerId)){if(this.un(t)&&this.networkEnabled)return!0;if(!this.un(t)){if(!t.allowTabSynchronization)throw new Pu(Ou.FAILED_PRECONDITION,Mp);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vp(e).Bt().next((e=>void 0===this.dn(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&ku("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Ue=!1,this.mn(),this.je&&(this.je.cancel(),this.je=null),this.gn(),this.yn(),await this.ze.runTransaction("shutdown","readwrite",[uf.store,bf.store],(e=>{const t=new Uf(e,zu.I);return this.cn(t).next((()=>this.hn(t)))})),this.ze.close(),this.pn()}dn(e,t){return e.filter((e=>this.fn(e.updateTimeMs,t)&&!this._n(e.clientId)))}Tn(){return this.runTransaction("getActiveClients","readonly",(e=>Vp(e).Bt().next((e=>this.dn(e,18e5).map((e=>e.clientId))))))}get started(){return this.Ue}getMutationQueue(e){return hp.Xt(e,this.k,this.Jt,this.referenceDelegate)}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getIndexManager(){return this.Jt}getBundleCache(){return this.Ye}runTransaction(e,t,n){ku("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite";let i;return this.ze.runTransaction(e,r,Ef,(r=>(i=new Uf(r,this.Be?this.Be.next():zu.I),"readwrite-primary"===t?this.rn(i).next((e=>!!e||this.on(i))).next((t=>{if(!t)throw Su(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Me.enqueueRetryable((()=>this.We(!1))),new Pu(Ou.FAILED_PRECONDITION,kf);return n(i)})).next((e=>this.an(i).next((()=>e)))):this.En(i).next((()=>n(i)))))).then((e=>(i.raiseOnCommittedEvent(),e)))}En(e){return Fp(e).get(uf.key).next((e=>{if(null!==e&&this.fn(e.leaseTimestampMs,5e3)&&!this._n(e.ownerId)&&!this.un(e)&&!(this.Le||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Pu(Ou.FAILED_PRECONDITION,Mp)}))}an(e){const t=new uf(this.clientId,this.allowTabSynchronization,Date.now());return Fp(e).put(uf.key,t)}static Pt(){return Rf.Pt()}cn(e){const t=Fp(e);return t.get(uf.key).next((e=>this.un(e)?(ku("IndexedDbPersistence","Releasing primary lease."),t.delete(uf.key)):Af.resolve()))}fn(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(Su(`Detected an update time that is in the future: ${e} > ${n}`),!1))}tn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ke=()=>{this.Me.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Ze())))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground="visible"===this.document.visibilityState)}gn(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}en(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.qe=()=>{this.mn(),!m()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match(/Version\/1[45]/)&&this.Me.enterRestrictedMode(!0),this.Me.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.qe))}yn(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}_n(e){var t;try{const n=null!==(null===(t=this.Xe)||void 0===t?void 0:t.getItem(this.wn(e)));return ku("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Su("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}mn(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(bs){Su("Failed to set zombie client id.",bs)}}pn(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(bs){}}wn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Fp(e){return Ff(e,uf.store)}function Vp(e){return Ff(e,bf.store)}function qp(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class jp{constructor(e,t){this.progress=e,this.In=t}}class Bp{constructor(e,t,n){this.Je=e,this.An=t,this.Jt=n}Rn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next((n=>this.bn(e,t,n)))}bn(e,t,n){return this.Je.getEntry(e,t).next((e=>{for(const t of n)t.applyToLocalView(e);return e}))}Pn(e,t){e.forEach(((e,n)=>{for(const r of t)r.applyToLocalView(n)}))}vn(e,t){return this.Je.getEntries(e,t).next((t=>this.Vn(e,t).next((()=>t))))}Vn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>this.Pn(t,e)))}getDocumentsMatchingQuery(e,t,n){return function(e){return gh.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Sn(e,t.path):al(t)?this.Dn(e,t,n):this.Cn(e,t,n)}Sn(e,t){return this.Rn(e,new gh(t)).next((e=>{let t=cd();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}Dn(e,t,n){const r=t.collectionGroup;let i=cd();return this.Jt.getCollectionParents(e,r).next((s=>Af.forEach(s,(s=>{const o=function(e,t){return new el(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.Cn(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}Cn(e,t,n){let r,i;return this.Je.getDocumentsMatchingQuery(e,t,n).next((n=>(r=n,this.An.getAllMutationBatchesAffectingQuery(e,t)))).next((t=>(i=t,this.Nn(e,i,r).next((e=>{r=e;for(const t of i)for(const e of t.mutations){const n=e.key;let i=r.get(n);null==i&&(i=Ph.newInvalidDocument(n),r=r.insert(n,i)),Fl(e,i,t.localWriteTime),i.isFoundDocument()||(r=r.remove(n))}}))))).next((()=>(r.forEach(((e,n)=>{pl(t,n)||(r=r.remove(e))})),r)))}Nn(e,t,n){let r=dd();for(const s of t)for(const e of s.mutations)e instanceof zl&&null===n.get(e.key)&&(r=r.add(e.key));let i=n;return this.Je.getEntries(e,r).next((e=>(e.forEach(((e,t)=>{t.isFoundDocument()&&(i=i.insert(e,t))})),i)))}}class zp{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.kn=n,this.xn=r}static $n(e,t){let n=dd(),r=dd();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new zp(e,t.fromCache,n,r)}}class $p{On(e){this.Mn=e}getDocumentsMatchingQuery(e,t,n,r){return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(Ju.min())?this.Fn(e,t):this.Mn.vn(e,r).next((i=>{const s=this.Ln(t,i);return(rl(t)||il(t))&&this.Bn(t.limitType,s,r,n)?this.Fn(e,t):(Eu()<=F.DEBUG&&ku("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),fl(t)),this.Mn.getDocumentsMatchingQuery(e,t,n).next((e=>(s.forEach((t=>{e=e.insert(t.key,t)})),e))))}))}Ln(e,t){let n=new rd(ml(e));return t.forEach(((t,r)=>{pl(e,r)&&(n=n.add(r))})),n}Bn(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Fn(e,t){return Eu()<=F.DEBUG&&ku("QueryEngine","Using full collection scan to execute query:",fl(t)),this.Mn.getDocumentsMatchingQuery(e,t,Ju.min())}}class Kp{constructor(e,t,n,r){this.persistence=e,this.Un=t,this.k=r,this.qn=new ed(Hu),this.Kn=new Ap((e=>Mh(e)),Uh),this.jn=Ju.min(),this.An=e.getMutationQueue(n),this.Qn=e.getRemoteDocumentCache(),this.He=e.getTargetCache(),this.Wn=new Bp(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=e.getBundleCache(),this.Un.On(this.Wn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.qn)))}}function Hp(e,t,n,r){return new Kp(e,t,n,r)}async function Wp(e,t){const n=Du(e);let r=n.An,i=n.Wn;const s=await n.persistence.runTransaction("Handle user change","readonly",(e=>{let s;return n.An.getAllMutationBatches(e).next((o=>(s=o,r=n.persistence.getMutationQueue(t),i=new Bp(n.Qn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(e)))).next((t=>{const n=[],r=[];let o=dd();for(const e of s){n.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return i.vn(e,o).next((e=>({Gn:e,removedBatchIds:n,addedBatchIds:r})))}))}));return n.An=r,n.Wn=i,n.Un.On(n.Wn),s}function Gp(e){const t=Du(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.He.getLastRemoteSnapshotVersion(e)))}function Qp(e,t,n,r,i){let s=dd();return n.forEach((e=>s=s.add(e))),t.getEntries(e,s).next((e=>{let s=od();return n.forEach(((n,o)=>{const a=e.get(n),c=(null==i?void 0:i.get(n))||r;o.isNoDocument()&&o.version.isEqual(Ju.min())?(t.removeEntry(n,c),s=s.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(o,c),s=s.insert(n,o)):ku("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)})),s}))}function Jp(e,t){const n=Du(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.An.getNextMutationBatchAfterBatchId(e,t))))}function Yp(e,t){const n=Du(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.He.getTargetData(e,t).next((i=>i?(r=i,Af.resolve(r)):n.He.allocateTargetId(e).next((i=>(r=new jf(t,i,0,e.currentSequenceNumber),n.He.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.qn.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qn=n.qn.insert(e.targetId,e),n.Kn.set(t,e.targetId)),e}))}async function Xp(e,t,n){const r=Du(e),i=r.qn.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Of(e))throw e;ku("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.qn=r.qn.remove(t),r.Kn.delete(i.target)}function Zp(e,t,n){const r=Du(e);let i=Ju.min(),s=dd();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=Du(e),i=r.Kn.get(n);return void 0!==i?Af.resolve(r.qn.get(i)):r.He.getTargetData(t,n)}(r,e,ul(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Un.getDocumentsMatchingQuery(e,t,n?i:Ju.min(),n?s:dd()))).next((e=>({documents:e,zn:s})))))}function em(e,t){const n=Du(e),r=Du(n.He),i=n.qn.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.Et(e,t).next((e=>e?e.target:null))))}function tm(e){const t=Du(e);return t.persistence.runTransaction("Get new document changes","readonly",(e=>function(e,t,n){const r=Du(e);let i=od(),s=Kf(n);const o=Op(t),a=IDBKeyRange.lowerBound(s,!0);return o.jt({index:mf.readTimeIndex,range:a},((e,t)=>{const n=zf(r.k,t);i=i.insert(n.key,n),s=t.readTime})).next((()=>({In:i,readTime:Hf(s)})))}(t.Qn,e,t.jn))).then((({In:e,readTime:n})=>(t.jn=n,e)))}async function nm(e,t,n=dd()){const r=await Yp(e,ul(Xf(t.bundledQuery))),i=Du(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=Nd(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.Ye.saveNamedQuery(e,t);const o=r.withResumeToken(sh.EMPTY_BYTE_STRING,s);return i.qn=i.qn.insert(o.targetId,o),i.He.updateTargetData(e,o).next((()=>i.He.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.He.addMatchingKeys(e,n,r.targetId))).next((()=>i.Ye.saveNamedQuery(e,t)))}))}class rm{constructor(e){this.k=e,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(e,t){return Af.resolve(this.Xn.get(t))}saveBundleMetadata(e,t){var n;return this.Xn.set(t.id,{id:(n=t).id,version:n.version,createTime:Nd(n.createTime)}),Af.resolve()}getNamedQuery(e,t){return Af.resolve(this.Zn.get(t))}saveNamedQuery(e,t){return this.Zn.set(t.name,function(e){return{name:e.name,query:Xf(e.bundledQuery),readTime:Nd(e.readTime)}}(t)),Af.resolve()}}class im{constructor(){this.ts=new rd(sm.es),this.ns=new rd(sm.ss)}isEmpty(){return this.ts.isEmpty()}addReference(e,t){const n=new sm(e,t);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}rs(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.os(new sm(e,t))}cs(e,t){e.forEach((e=>this.removeReference(e,t)))}us(e){const t=new gh(new th([])),n=new sm(t,e),r=new sm(t,e+1),i=[];return this.ns.forEachInRange([n,r],(e=>{this.os(e),i.push(e.key)})),i}hs(){this.ts.forEach((e=>this.os(e)))}os(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}ls(e){const t=new gh(new th([])),n=new sm(t,e),r=new sm(t,e+1);let i=dd();return this.ns.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new sm(e,0),n=this.ts.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class sm{constructor(e,t){this.key=e,this.fs=t}static es(e,t){return gh.comparator(e.key,t.key)||Hu(e.fs,t.fs)}static ss(e,t){return Hu(e.fs,t.fs)||gh.comparator(e.key,t.key)}}class om{constructor(e,t){this.Jt=e,this.referenceDelegate=t,this.An=[],this.ds=1,this.ws=new rd(sm.es)}checkEmpty(e){return Af.resolve(0===this.An.length)}addMutationBatch(e,t,n,r){const i=this.ds;this.ds++,this.An.length>0&&this.An[this.An.length-1];const s=new Vf(i,t,n,r);this.An.push(s);for(const o of r)this.ws=this.ws.add(new sm(o.key,i)),this.Jt.addToCollectionParentIndex(e,o.key.path.popLast());return Af.resolve(s)}lookupMutationBatch(e,t){return Af.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.gs(n),i=r<0?0:r;return Af.resolve(this.An.length>i?this.An[i]:null)}getHighestUnacknowledgedBatchId(){return Af.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(e){return Af.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new sm(t,0),r=new sm(t,Number.POSITIVE_INFINITY),i=[];return this.ws.forEachInRange([n,r],(e=>{const t=this._s(e.fs);i.push(t)})),Af.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new rd(Hu);return t.forEach((e=>{const t=new sm(e,0),r=new sm(e,Number.POSITIVE_INFINITY);this.ws.forEachInRange([t,r],(e=>{n=n.add(e.fs)}))})),Af.resolve(this.ys(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;gh.isDocumentKey(i)||(i=i.child(""));const s=new sm(new gh(i),0);let o=new rd(Hu);return this.ws.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.fs)),!0)}),s),Af.resolve(this.ys(o))}ys(e){const t=[];return e.forEach((e=>{const n=this._s(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Nu(0===this.ps(t.batchId,"removed")),this.An.shift();let n=this.ws;return Af.forEach(t.mutations,(r=>{const i=new sm(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.ws=n}))}ee(e){}containsKey(e,t){const n=new sm(t,0),r=this.ws.firstAfterOrEqual(n);return Af.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.An.length,Af.resolve()}ps(e,t){return this.gs(e)}gs(e){return 0===this.An.length?0:e-this.An[0].batchId}_s(e){const t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}class am{constructor(e,t){this.Jt=e,this.Ts=t,this.docs=new ed(gh.comparator),this.size=0}addEntry(e,t,n){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Ts(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o,readTime:n}),this.size+=o-s,this.Jt.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Af.resolve(n?n.document.mutableCopy():Ph.newInvalidDocument(t))}getEntries(e,t){let n=od();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Ph.newInvalidDocument(e))})),Af.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=od();const i=new gh(t.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i,readTime:o}}=s.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||pl(t,i)&&(r=r.insert(i.key,i.mutableCopy()))}return Af.resolve(r)}Es(e,t){return Af.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new cm(this)}getSize(e){return Af.resolve(this.size)}}class cm extends Cp{constructor(e){super(),this.De=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.document.isValidDocument()?t.push(this.De.addEntry(e,r.document,this.getReadTime(n))):this.De.removeEntry(n)})),Af.waitFor(t)}getFromCache(e,t){return this.De.getEntry(e,t)}getAllFromCache(e,t){return this.De.getEntries(e,t)}}class um{constructor(e){this.persistence=e,this.Is=new Ap((e=>Mh(e)),Uh),this.lastRemoteSnapshotVersion=Ju.min(),this.highestTargetId=0,this.As=0,this.Rs=new im,this.targetCount=0,this.bs=mp.ie()}forEachTarget(e,t){return this.Is.forEach(((e,n)=>t(n))),Af.resolve()}getLastRemoteSnapshotVersion(e){return Af.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Af.resolve(this.As)}allocateTargetId(e){return this.highestTargetId=this.bs.next(),Af.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.As&&(this.As=t),Af.resolve()}ae(e){this.Is.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.bs=new mp(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,Af.resolve()}updateTargetData(e,t){return this.ae(t),Af.resolve()}removeTargetData(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,Af.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Is.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Is.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Af.waitFor(i).next((()=>r))}getTargetCount(e){return Af.resolve(this.targetCount)}getTargetData(e,t){const n=this.Is.get(t)||null;return Af.resolve(n)}addMatchingKeys(e,t,n){return this.Rs.rs(t,n),Af.resolve()}removeMatchingKeys(e,t,n){this.Rs.cs(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Af.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Rs.us(t),Af.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Rs.ls(t);return Af.resolve(n)}containsKey(e,t){return Af.resolve(this.Rs.containsKey(t))}}class hm{constructor(e,t){this.Ps={},this.Be=new zu(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=e(this),this.He=new um(this),this.Jt=new np,this.Je=function(e,t){return new am(e,t)}(this.Jt,(e=>this.referenceDelegate.vs(e))),this.k=new Bf(t),this.Ye=new rm(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(e){let t=this.Ps[e.toKey()];return t||(t=new om(this.Jt,this.referenceDelegate),this.Ps[e.toKey()]=t),t}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(e,t,n){ku("MemoryPersistence","Starting transaction:",e);const r=new lm(this.Be.next());return this.referenceDelegate.Vs(),n(r).next((e=>this.referenceDelegate.Ss(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Ds(e,t){return Af.or(Object.values(this.Ps).map((n=>()=>n.containsKey(e,t))))}}class lm extends Sf{constructor(e){super(),this.currentSequenceNumber=e}}class dm{constructor(e){this.persistence=e,this.Cs=new im,this.Ns=null}static ks(e){return new dm(e)}get xs(){if(this.Ns)return this.Ns;throw Ru()}addReference(e,t,n){return this.Cs.addReference(n,t),this.xs.delete(n.toString()),Af.resolve()}removeReference(e,t,n){return this.Cs.removeReference(n,t),this.xs.add(n.toString()),Af.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),Af.resolve()}removeTarget(e,t){this.Cs.us(t.targetId).forEach((e=>this.xs.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.xs.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Vs(){this.Ns=new Set}Ss(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Af.forEach(this.xs,(n=>{const r=gh.fromPath(n);return this.$s(e,r).next((e=>{e||t.removeEntry(r)}))})).next((()=>(this.Ns=null,t.apply(e))))}updateLimboDocument(e,t){return this.$s(e,t).next((e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())}))}vs(e){return 0}$s(e,t){return Af.or([()=>Af.resolve(this.Cs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ds(e,t)])}}function fm(e,t){return`firestore_clients_${e}_${t}`}function pm(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function mm(e,t){return`firestore_targets_${e}_${t}`}class gm{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Os(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new Pu(r.error.code,r.error.message))),s?new gm(e,t,r.state,i):(Su("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ms(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ym{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Os(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new Pu(n.error.code,n.error.message))),i?new ym(e,n.state,r):(Su("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Ms(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class vm{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Os(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=pd();for(let s=0;r&&s<n.activeTargetIds.length;++s)r=mh(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new vm(e,i):(Su("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class wm{constructor(e,t){this.clientId=e,this.onlineState=t}static Os(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new wm(t.clientId,t.onlineState):(Su("SharedClientState",`Failed to parse online state: ${e}`),null)}}class _m{constructor(){this.activeTargetIds=pd()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ls(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ms(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class bm{constructor(e,t,n,r,i){this.window=e,this.Me=t,this.persistenceKey=n,this.Bs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Us=this.qs.bind(this),this.Ks=new ed(Hu),this.started=!1,this.js=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Qs=fm(this.persistenceKey,this.Bs),this.Ws=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.Ks=this.Ks.insert(this.Bs,new _m),this.Gs=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.zs=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Hs=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.Js=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Ys=function(e){return`firestore_bundle_loaded_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.Us)}static Pt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Tn();for(const n of e){if(n===this.Bs)continue;const e=this.getItem(fm(this.persistenceKey,n));if(e){const t=vm.Os(n,e);t&&(this.Ks=this.Ks.insert(t.clientId,t))}}this.Xs();const t=this.storage.getItem(this.Js);if(t){const e=this.Zs(t);e&&this.ti(e)}for(const n of this.js)this.qs(n);this.js=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ei(this.Ks)}isActiveQueryTarget(e){let t=!1;return this.Ks.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.ni(e,"pending")}updateMutationState(e,t,n){this.ni(e,t,n),this.si(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(mm(this.persistenceKey,e));if(n){const r=ym.Os(e,n);r&&(t=r.state)}}return this.ii.Fs(e),this.Xs(),t}removeLocalQueryTarget(e){this.ii.Ls(e),this.Xs()}isLocalQueryTarget(e){return this.ii.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(mm(this.persistenceKey,e))}updateQueryState(e,t,n){this.ri(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.si(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.oi(e)}notifyBundleLoaded(){this.ci()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Us),this.removeItem(this.Qs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ku("SharedClientState","READ",e,t),t}setItem(e,t){ku("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ku("SharedClientState","REMOVE",e),this.storage.removeItem(e)}qs(e){const t=e;if(t.storageArea===this.storage){if(ku("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Qs)return void Su("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Me.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.Gs.test(t.key)){if(null==t.newValue){const e=this.ai(t.key);return this.ui(e,null)}{const e=this.hi(t.key,t.newValue);if(e)return this.ui(e.clientId,e)}}else if(this.zs.test(t.key)){if(null!==t.newValue){const e=this.li(t.key,t.newValue);if(e)return this.fi(e)}}else if(this.Hs.test(t.key)){if(null!==t.newValue){const e=this.di(t.key,t.newValue);if(e)return this.wi(e)}}else if(t.key===this.Js){if(null!==t.newValue){const e=this.Zs(t.newValue);if(e)return this.ti(e)}}else if(t.key===this.Ws){const e=function(e){let t=zu.I;if(null!=e)try{const n=JSON.parse(e);Nu("number"==typeof n),t=n}catch(e){Su("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==zu.I&&this.sequenceNumberHandler(e)}else if(t.key===this.Ys)return this.syncEngine._i()}else this.js.push(t)}))}}get ii(){return this.Ks.get(this.Bs)}Xs(){this.setItem(this.Qs,this.ii.Ms())}ni(e,t,n){const r=new gm(this.currentUser,e,t,n),i=pm(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Ms())}si(e){const t=pm(this.persistenceKey,this.currentUser,e);this.removeItem(t)}oi(e){const t={clientId:this.Bs,onlineState:e};this.storage.setItem(this.Js,JSON.stringify(t))}ri(e,t,n){const r=mm(this.persistenceKey,e),i=new ym(e,t,n);this.setItem(r,i.Ms())}ci(){this.setItem(this.Ys,"value-not-used")}ai(e){const t=this.Gs.exec(e);return t?t[1]:null}hi(e,t){const n=this.ai(e);return vm.Os(n,t)}li(e,t){const n=this.zs.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return gm.Os(new bu(i),r,t)}di(e,t){const n=this.Hs.exec(e),r=Number(n[1]);return ym.Os(r,t)}Zs(e){return wm.Os(e)}async fi(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.mi(e.batchId,e.state,e.error);ku("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}wi(e){return this.syncEngine.gi(e.targetId,e.state,e.error)}ui(e,t){const n=t?this.Ks.insert(e,t):this.Ks.remove(e),r=this.ei(this.Ks),i=this.ei(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.yi(s,o).then((()=>{this.Ks=n}))}ti(e){this.Ks.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ei(e){let t=pd();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class Im{constructor(){this.pi=new _m,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.pi.Fs(e),this.Ti[e]||"not-current"}updateQueryState(e,t,n){this.Ti[e]=t}removeLocalQueryTarget(e){this.pi.Ls(e)}isLocalQueryTarget(e){return this.pi.activeTargetIds.has(e)}clearQueryState(e){delete this.Ti[e]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(e){return this.pi.activeTargetIds.has(e)}start(){return this.pi=new _m,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class Tm{Ei(e){}shutdown(){}}class Em{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.bi(),this.Pi=[],this.vi()}Ei(e){this.Pi.push(e)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){ku("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Pi)e(0)}bi(){ku("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Pi)e(1)}static Pt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const km={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Sm{constructor(e){this.Vi=e.Vi,this.Si=e.Si}Di(e){this.Ci=e}Ni(e){this.ki=e}onMessage(e){this.xi=e}close(){this.Si()}send(e){this.Vi(e)}$i(){this.Ci()}Oi(e){this.ki(e)}Mi(e){this.xi(e)}}class Am extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.Fi=t+"://"+e.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(e,t,n,r,i){const s=this.Ui(e,t);ku("RestConnection","Sending: ",s,n);const o={};return this.qi(o,r,i),this.Ki(e,s,o,n).then((e=>(ku("RestConnection","Received: ",e),e)),(t=>{throw Au("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t}))}ji(e,t,n,r,i){return this.Bi(e,t,n,r,i)}qi(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Iu,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}Ui(e,t){const n=km[e];return`${this.Fi}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Ki(e,t,n,r){return new Promise(((i,s)=>{const o=new vu;o.listenOnce(fu.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case du.NO_ERROR:const t=o.getResponseJson();ku("Connection","XHR received:",JSON.stringify(t)),i(t);break;case du.TIMEOUT:ku("Connection",'RPC "'+e+'" timed out'),s(new Pu(Ou.DEADLINE_EXCEEDED,"Request time out"));break;case du.HTTP_ERROR:const n=o.getStatus();if(ku("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Ou).indexOf(t)>=0?t:Ou.UNKNOWN}(e.status);s(new Pu(t,e.message))}else s(new Pu(Ou.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Pu(Ou.UNAVAILABLE,"Connection failed."));break;default:Ru()}}finally{ku("Connection",'RPC "'+e+'" completed.')}}));const a=JSON.stringify(r);o.send(t,"POST",a,n,15)}))}Qi(e,t,n){const r=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=hu(),s=lu(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new gu({})),this.qi(o.initMessageHeaders,t,n),p()||y()||f().indexOf("Electron/")>=0||v()||f().indexOf("MSAppHost/")>=0||g()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=r.join("");ku("Connection","Creating WebChannel: "+a,o);const c=i.createWebChannel(a,o);let u=!1,h=!1;const l=new Sm({Vi:e=>{h?ku("Connection","Not sending because WebChannel is closed:",e):(u||(ku("Connection","Opening WebChannel transport."),c.open(),u=!0),ku("Connection","WebChannel sending:",e),c.send(e))},Si:()=>c.close()}),d=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return d(c,yu.EventType.OPEN,(()=>{h||ku("Connection","WebChannel transport opened.")})),d(c,yu.EventType.CLOSE,(()=>{h||(h=!0,ku("Connection","WebChannel transport closed"),l.Oi())})),d(c,yu.EventType.ERROR,(e=>{h||(h=!0,Au("Connection","WebChannel transport errored:",e),l.Oi(new Pu(Ou.UNAVAILABLE,"The operation could not be completed")))})),d(c,yu.EventType.MESSAGE,(e=>{var t;if(!h){const n=e.data[0];Nu(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){ku("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=Jl[e];if(void 0!==t)return Zl(t)}(e),n=i.message;void 0===t&&(t=Ou.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),h=!0,l.Oi(new Pu(t,n)),c.close()}else ku("Connection","WebChannel received:",n),l.Mi(n)}})),d(s,pu.STAT_EVENT,(e=>{e.stat===mu.PROXY?ku("Connection","Detected buffering proxy"):e.stat===mu.NOPROXY&&ku("Connection","Detected no buffering proxy")})),setTimeout((()=>{l.$i()}),0),l}}function Cm(){return"undefined"!=typeof window?window:null}function Rm(){return"undefined"!=typeof document?document:null}function Nm(e){return new Sd(e,!0)}class Dm{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Me=e,this.timerId=t,this.Wi=n,this.Gi=r,this.zi=i,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const t=Math.floor(this.Hi+this.tr()),n=Math.max(0,Date.now()-this.Yi),r=Math.max(0,t-n);r>0&&ku("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Hi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ji=this.Me.enqueueAfterDelay(this.timerId,r,(()=>(this.Yi=Date.now(),e()))),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class Om{constructor(e,t,n,r,i,s,o,a){this.Me=e,this.nr=n,this.sr=r,this.ir=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.rr=0,this.cr=null,this.ar=null,this.stream=null,this.ur=new Dm(e,t)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}async stop(){this.hr()&&await this.close(0)}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.cr&&(this.cr=this.Me.enqueueAfterDelay(this.nr,6e4,(()=>this.mr())))}gr(e){this.yr(),this.stream.send(e)}async mr(){if(this.lr())return this.close(0)}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}pr(){this.ar&&(this.ar.cancel(),this.ar=null)}async close(e,t){this.yr(),this.pr(),this.ur.cancel(),this.rr++,4!==e?this.ur.reset():t&&t.code===Ou.RESOURCE_EXHAUSTED?(Su(t.toString()),Su("Using maximum backoff delay to prevent overloading the backend."),this.ur.Xi()):t&&t.code===Ou.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Tr(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ni(t)}Tr(){}auth(){this.state=1;const e=this.Er(this.rr),t=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.rr===t&&this.Ir(e,n)}),(t=>{e((()=>{const e=new Pu(Ou.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Ar(e)}))}))}Ir(e,t){const n=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di((()=>{n((()=>(this.state=2,this.ar=this.Me.enqueueAfterDelay(this.sr,1e4,(()=>(this.lr()&&(this.state=3),Promise.resolve()))),this.listener.Di())))})),this.stream.Ni((e=>{n((()=>this.Ar(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}dr(){this.state=5,this.ur.Zi((async()=>{this.state=0,this.start()}))}Ar(e){return ku("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Er(e){return t=>{this.Me.enqueueAndForget((()=>this.rr===e?t():(ku("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Pm extends Om{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.k=i}Rr(e,t){return this.ir.Qi("Listen",e,t)}onMessage(e){this.ur.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Ru()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.C?(Nu(void 0===t||"string"==typeof t),sh.fromBase64String(t||"")):(Nu(void 0===t||t instanceof Uint8Array),sh.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Ou.UNKNOWN:Zl(e.code);return new Pu(t,e.message||"")}(o);n=new wd(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=xd(e,r.document.name),s=Nd(r.document.updateTime),o=new Dh({mapValue:{fields:r.document.fields}}),a=Ph.newFoundDocument(i,s,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new yd(c,u,a.key,a)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=xd(e,r.document),s=r.readTime?Nd(r.readTime):Ju.min(),o=Ph.newNoDocument(i,s),a=r.removedTargetIds||[];n=new yd([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=xd(e,r.document),s=r.removedTargetIds||[];n=new yd([],s,i,null)}else{if(!("filter"in t))return Ru();{t.filter;const e=t.filter;e.targetId;const r=e.count||0,i=new Ql(r),s=e.targetId;n=new vd(s,i)}}return n}(this.k,e),n=function(e){if(!("targetChange"in e))return Ju.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Ju.min():t.readTime?Nd(t.readTime):Ju.min()}(e);return this.listener.br(t,n)}Pr(e){const t={};t.database=Ud(this.k),t.addTarget=function(e,t){let n;const r=t.target;return n=Fh(r)?{documents:zd(e,r)}:{query:$d(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Cd(e,t.resumeToken):t.snapshotVersion.compareTo(Ju.min())>0&&(n.readTime=Ad(e,t.snapshotVersion.toTimestamp())),n}(this.k,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ru()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.k,e);n&&(t.labels=n),this.gr(t)}vr(e){const t={};t.database=Ud(this.k),t.removeTarget=e,this.gr(t)}}class xm extends Om{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.k=i,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(e,t){return this.ir.Qi("Write",e,t)}onMessage(e){if(Nu(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();const t=function(e,t){return e&&e.length>0?(Nu(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Nd(e.updateTime):Nd(t);return n.isEqual(Ju.min())&&(n=Nd(t)),new Pl(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Nd(e.commitTime);return this.listener.Cr(n,t)}return Nu(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}kr(){const e={};e.database=Ud(this.k),this.gr(e)}Dr(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>jd(this.k,e)))};this.gr(t)}}class Lm extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.ir=n,this.k=r,this.$r=!1}Or(){if(this.$r)throw new Pu(Ou.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.ir.Bi(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Ou.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Pu(Ou.UNKNOWN,e.toString())}))}ji(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.ir.ji(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Ou.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Pu(Ou.UNKNOWN,e.toString())}))}terminate(){this.$r=!0}}class Mm{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Mr=0,this.Fr=null,this.Lr=!0}Br(){0===this.Mr&&(this.Ur("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.Fr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve()))))}Kr(e){"Online"===this.state?this.Ur("Unknown"):(this.Mr++,this.Mr>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Ur("Offline")))}set(e){this.jr(),this.Mr=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}Ur(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}qr(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(Su(t),this.Lr=!1):ku("OnlineStateTracker",t)}jr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}class Um{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=i,this.Hr.Ei((e=>{n.enqueueAndForget((async()=>{Hm(this)&&(ku("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Du(e);t.Gr.add(4),await Vm(t),t.Jr.set("Unknown"),t.Gr.delete(4),await Fm(t)}(this))}))})),this.Jr=new Mm(n,r)}}async function Fm(e){if(Hm(e))for(const t of e.zr)await t(!0)}async function Vm(e){for(const t of e.zr)await t(!1)}function qm(e,t){const n=Du(e);n.Wr.has(t.targetId)||(n.Wr.set(t.targetId,t),Km(n)?$m(n):ug(n).lr()&&Bm(n,t))}function jm(e,t){const n=Du(e),r=ug(n);n.Wr.delete(t),r.lr()&&zm(n,t),0===n.Wr.size&&(r.lr()?r._r():Hm(n)&&n.Jr.set("Unknown"))}function Bm(e,t){e.Yr.X(t.targetId),ug(e).Pr(t)}function zm(e,t){e.Yr.X(t),ug(e).vr(t)}function $m(e){e.Yr=new bd({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Wr.get(t)||null}),ug(e).start(),e.Jr.Br()}function Km(e){return Hm(e)&&!ug(e).hr()&&e.Wr.size>0}function Hm(e){return 0===Du(e).Gr.size}function Wm(e){e.Yr=void 0}async function Gm(e){e.Wr.forEach(((t,n)=>{Bm(e,t)}))}async function Qm(e,t){Wm(e),Km(e)?(e.Jr.Kr(t),$m(e)):e.Jr.set("Unknown")}async function Jm(e,t,n){if(e.Jr.set("Online"),t instanceof wd&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Wr.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Wr.delete(r),e.Yr.removeTarget(r))}(e,t)}catch(n){ku("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Ym(e,n)}else if(t instanceof yd?e.Yr.ot(t):t instanceof vd?e.Yr.dt(t):e.Yr.ut(t),!n.isEqual(Ju.min()))try{const t=await Gp(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Yr.gt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Wr.get(r);i&&e.Wr.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e.Wr.get(t);if(!n)return;e.Wr.set(t,n.withResumeToken(sh.EMPTY_BYTE_STRING,n.snapshotVersion)),zm(e,t);const r=new jf(n.target,t,1,n.sequenceNumber);Bm(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){ku("RemoteStore","Failed to raise snapshot:",t),await Ym(e,t)}}async function Ym(e,t,n){if(!Of(t))throw t;e.Gr.add(1),await Vm(e),e.Jr.set("Offline"),n||(n=()=>Gp(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{ku("RemoteStore","Retrying IndexedDB access"),await n(),e.Gr.delete(1),await Fm(e)}))}function Xm(e,t){return t().catch((n=>Ym(e,n,t)))}async function Zm(e){const t=Du(e),n=hg(t);let r=t.Qr.length>0?t.Qr[t.Qr.length-1].batchId:-1;for(;eg(t);)try{const e=await Jp(t.localStore,r);if(null===e){0===t.Qr.length&&n._r();break}r=e.batchId,tg(t,e)}catch(e){await Ym(t,e)}ng(t)&&rg(t)}function eg(e){return Hm(e)&&e.Qr.length<10}function tg(e,t){e.Qr.push(t);const n=hg(e);n.lr()&&n.Sr&&n.Dr(t.mutations)}function ng(e){return Hm(e)&&!hg(e).hr()&&e.Qr.length>0}function rg(e){hg(e).start()}async function ig(e){hg(e).kr()}async function sg(e){const t=hg(e);for(const n of e.Qr)t.Dr(n.mutations)}async function og(e,t,n){const r=e.Qr.shift(),i=qf.from(r,t,n);await Xm(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Zm(e)}async function ag(e,t){t&&hg(e).Sr&&await async function(e,t){if(Xl(n=t.code)&&n!==Ou.ABORTED){const n=e.Qr.shift();hg(e).wr(),await Xm(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Zm(e)}var n}(e,t),ng(e)&&rg(e)}async function cg(e,t){const n=Du(e);t?(n.Gr.delete(2),await Fm(n)):t||(n.Gr.add(2),await Vm(n),n.Jr.set("Unknown"))}function ug(e){return e.Xr||(e.Xr=function(e,t,n){const r=Du(e);return r.Or(),new Pm(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:Gm.bind(null,e),Ni:Qm.bind(null,e),br:Jm.bind(null,e)}),e.zr.push((async t=>{t?(e.Xr.wr(),Km(e)?$m(e):e.Jr.set("Unknown")):(await e.Xr.stop(),Wm(e))}))),e.Xr}function hg(e){return e.Zr||(e.Zr=function(e,t,n){const r=Du(e);return r.Or(),new xm(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:ig.bind(null,e),Ni:ag.bind(null,e),Nr:sg.bind(null,e),Cr:og.bind(null,e)}),e.zr.push((async t=>{t?(e.Zr.wr(),await Zm(e)):(await e.Zr.stop(),e.Qr.length>0&&(ku("RemoteStore",`Stopping write stream with ${e.Qr.length} pending writes`),e.Qr=[]))}))),e.Zr}class lg{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new xu,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new lg(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Pu(Ou.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function dg(e,t){if(Su("AsyncQueue",`${t}: ${e}`),Of(e))return new Pu(Ou.UNAVAILABLE,`${t}: ${e}`);throw e}class fg{constructor(e){this.comparator=e?(t,n)=>e(t,n)||gh.comparator(t.key,n.key):(e,t)=>gh.comparator(e.key,t.key),this.keyedMap=cd(),this.sortedSet=new ed(this.comparator)}static emptySet(e){return new fg(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof fg))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new fg;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class pg{constructor(){this.eo=new ed(gh.comparator)}track(e){const t=e.doc.key,n=this.eo.get(t);n?0!==e.type&&3===n.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==n.type?this.eo=this.eo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.eo=this.eo.remove(t):1===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):Ru():this.eo=this.eo.insert(t,e)}no(){const e=[];return this.eo.inorderTraversal(((t,n)=>{e.push(n)})),e}}class mg{constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach((e=>{i.push({type:0,doc:e})})),new mg(e,t,fg.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ll(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class gg{constructor(){this.so=void 0,this.listeners=[]}}class yg{constructor(){this.queries=new Ap((e=>dl(e)),ll),this.onlineState="Unknown",this.io=new Set}}async function vg(e,t){const n=Du(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new gg),i)try{s.so=await n.onListen(r)}catch(e){const n=dg(e,`Initialization of query '${fl(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.ro(n.onlineState),s.so&&t.oo(s.so)&&Ig(n)}async function wg(e,t){const n=Du(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function _g(e,t){const n=Du(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.listeners)e.oo(i)&&(r=!0);t.so=i}}r&&Ig(n)}function bg(e,t,n){const r=Du(e),i=r.queries.get(t);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(t)}function Ig(e){e.io.forEach((e=>{e.next()}))}class Tg{constructor(e,t,n){this.query=e,this.co=t,this.ao=!1,this.uo=null,this.onlineState="Unknown",this.options=n||{}}oo(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new mg(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.ao?this.ho(e)&&(this.co.next(e),t=!0):this.lo(e,this.onlineState)&&(this.fo(e),t=!0),this.uo=e,t}onError(e){this.co.error(e)}ro(e){this.onlineState=e;let t=!1;return this.uo&&!this.ao&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}lo(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.wo||!n)&&(!e.docs.isEmpty()||"Offline"===t)}ho(e){if(e.docChanges.length>0)return!0;const t=this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}fo(e){e=mg.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.ao=!0,this.co.next(e)}}class Eg{constructor(e,t){this.payload=e,this.byteLength=t}_o(){return"metadata"in this.payload}}class kg{constructor(e){this.k=e}Hn(e){return xd(this.k,e)}Jn(e){return e.metadata.exists?qd(this.k,e.document,!1):Ph.newNoDocument(this.Hn(e.metadata.name),this.Yn(e.metadata.readTime))}Yn(e){return Nd(e)}}class Sg{constructor(e,t,n){this.mo=e,this.localStore=t,this.k=n,this.queries=[],this.documents=[],this.progress=Ag(e)}yo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}po(e){const t=new Map,n=new kg(this.k);for(const r of e)if(r.metadata.queries){const e=n.Hn(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||dd()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=Du(e);let s=dd(),o=od(),a=hd();for(const h of n){const e=t.Hn(h.metadata.name);h.document&&(s=s.add(e)),o=o.insert(e,t.Jn(h)),a=a.insert(e,t.Yn(h.metadata.readTime))}const c=i.Qn.newChangeBuffer({trackRemovals:!0}),u=await Yp(i,function(e){return ul(nl(th.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>Qp(e,c,o,Ju.min(),a).next((t=>(c.apply(e),t))).next((t=>i.He.removeMatchingKeysForTargetId(e,u.targetId).next((()=>i.He.addMatchingKeys(e,s,u.targetId))).next((()=>i.Wn.Vn(e,t))).next((()=>t))))))}(this.localStore,new kg(this.k),this.documents,this.mo.id),t=this.po(this.documents);for(const n of this.queries)await nm(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",new jp(Object.assign({},this.progress),e)}}function Ag(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Cg{constructor(e){this.key=e}}class Rg{constructor(e){this.key=e}}class Ng{constructor(e,t){this.query=e,this.To=t,this.Eo=null,this.current=!1,this.Io=dd(),this.mutatedKeys=dd(),this.Ao=ml(e),this.Ro=new fg(this.Ao)}get bo(){return this.To}Po(e,t){const n=t?t.vo:new pg,r=t?t.Ro:this.Ro;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a=rl(this.query)&&r.size===this.query.limit?r.last():null,c=il(this.query)&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),h=pl(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Vo(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Ao(h,a)>0||c&&this.Ao(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),rl(this.query)||il(this.query))for(;s.size>this.query.limit;){const e=rl(this.query)?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ro:s,vo:n,Bn:o,mutatedKeys:i}}Vo(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;const i=e.vo.no();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ru()}};return n(e)-n(t)}(e.type,t.type)||this.Ao(e.doc,t.doc))),this.So(n);const s=t?this.Do():[],o=0===this.Io.size&&this.current?1:0,a=o!==this.Eo;return this.Eo=o,0!==i.length||a?{snapshot:new mg(this.query,e.Ro,r,i,e.mutatedKeys,0===o,a,!1),Co:s}:{Co:s}}ro(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new pg,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}So(e){e&&(e.addedDocuments.forEach((e=>this.To=this.To.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.To=this.To.delete(e))),this.current=e.current)}Do(){if(!this.current)return[];const e=this.Io;this.Io=dd(),this.Ro.forEach((e=>{this.No(e.key)&&(this.Io=this.Io.add(e.key))}));const t=[];return e.forEach((e=>{this.Io.has(e)||t.push(new Rg(e))})),this.Io.forEach((n=>{e.has(n)||t.push(new Cg(n))})),t}ko(e){this.To=e.zn,this.Io=dd();const t=this.Po(e.documents);return this.applyChanges(t,!0)}xo(){return mg.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class Dg{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Og{constructor(e){this.key=e,this.$o=!1}}class Pg{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Oo={},this.Mo=new Ap((e=>dl(e)),ll),this.Fo=new Map,this.Lo=new Set,this.Bo=new ed(gh.comparator),this.Uo=new Map,this.qo=new im,this.Ko={},this.jo=new Map,this.Qo=mp.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}async function xg(e,t){const n=oy(e);let r,i;const s=n.Mo.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.xo();else{const e=await Yp(n.localStore,ul(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Lg(n,t,r,"current"===s),n.isPrimaryClient&&qm(n.remoteStore,e)}return i}async function Lg(e,t,n,r){e.Go=(t,n,r)=>async function(e,t,n,r){let i=t.view.Po(n);i.Bn&&(i=await Zp(e.localStore,t.query,!1).then((({documents:e})=>t.view.Po(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return Hg(e,t.targetId,o.Co),o.snapshot}(e,t,n,r);const i=await Zp(e.localStore,t,!0),s=new Ng(t,i.zn),o=s.Po(i.documents),a=gd.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState),c=s.applyChanges(o,e.isPrimaryClient,a);Hg(e,n,c.Co);const u=new Dg(t,n,s);return e.Mo.set(t,u),e.Fo.has(n)?e.Fo.get(n).push(t):e.Fo.set(n,[t]),c.snapshot}async function Mg(e,t){const n=Du(e),r=n.Mo.get(t),i=n.Fo.get(r.targetId);if(i.length>1)return n.Fo.set(r.targetId,i.filter((e=>!ll(e,t)))),void n.Mo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Xp(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),jm(n.remoteStore,r.targetId),$g(n,r.targetId)})).catch(_p)):($g(n,r.targetId),await Xp(n.localStore,r.targetId,!0))}async function Ug(e,t){const n=Du(e);try{const e=await function(e,t){const n=Du(e),r=t.snapshotVersion;let i=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.qn;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.He.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.He.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(a)?u=u.withResumeToken(sh.EMPTY_BYTE_STRING,Ju.min()).withLastLimboFreeSnapshotVersion(Ju.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.He.updateTargetData(e,u))}));let a=od();if(t.documentUpdates.forEach(((r,i)=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(Qp(e,s,t.documentUpdates,r,void 0).next((e=>{a=e}))),!r.isEqual(Ju.min())){const t=n.He.getLastRemoteSnapshotVersion(e).next((t=>n.He.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Af.waitFor(o).next((()=>s.apply(e))).next((()=>n.Wn.Vn(e,a))).next((()=>a))})).then((e=>(n.qn=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Uo.get(t);r&&(Nu(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.$o=!0:e.modifiedDocuments.size>0?Nu(r.$o):e.removedDocuments.size>0&&(Nu(r.$o),r.$o=!1))})),await Qg(n,e,t)}catch(e){await _p(e)}}function Fg(e,t,n){const r=Du(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Mo.forEach(((n,r)=>{const i=r.view.ro(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Du(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const i of n.listeners)i.ro(t)&&(r=!0)})),r&&Ig(n)}(r.eventManager,t),e.length&&r.Oo.br(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Vg(e,t,n){const r=Du(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Uo.get(t),s=i&&i.key;if(s){let e=new ed(gh.comparator);e=e.insert(s,Ph.newNoDocument(s,Ju.min()));const n=dd().add(s),i=new md(Ju.min(),new Map,new rd(Hu),e,n);await Ug(r,i),r.Bo=r.Bo.remove(s),r.Uo.delete(t),Gg(r)}else await Xp(r.localStore,t,!1).then((()=>$g(r,t,n))).catch(_p)}async function qg(e,t){const n=Du(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Du(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Qn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Af.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Nu(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))}))})),o.next((()=>e.An.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.An.performConsistencyCheck(e))).next((()=>n.Wn.vn(e,r)))}))}(n.localStore,t);zg(n,r,null),Bg(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Qg(n,e)}catch(e){await _p(e)}}async function jg(e,t,n){const r=Du(e);try{const e=await function(e,t){const n=Du(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.An.lookupMutationBatch(e,t).next((t=>(Nu(null!==t),r=t.keys(),n.An.removeMutationBatch(e,t)))).next((()=>n.An.performConsistencyCheck(e))).next((()=>n.Wn.vn(e,r)))}))}(r.localStore,t);zg(r,t,n),Bg(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Qg(r,e)}catch(n){await _p(n)}}function Bg(e,t){(e.jo.get(t)||[]).forEach((e=>{e.resolve()})),e.jo.delete(t)}function zg(e,t,n){const r=Du(e);let i=r.Ko[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ko[r.currentUser.toKey()]=i}}function $g(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Fo.get(t))e.Mo.delete(r),n&&e.Oo.zo(r,n);e.Fo.delete(t),e.isPrimaryClient&&e.qo.us(t).forEach((t=>{e.qo.containsKey(t)||Kg(e,t)}))}function Kg(e,t){e.Lo.delete(t.path.canonicalString());const n=e.Bo.get(t);null!==n&&(jm(e.remoteStore,n),e.Bo=e.Bo.remove(t),e.Uo.delete(n),Gg(e))}function Hg(e,t,n){for(const r of n)r instanceof Cg?(e.qo.addReference(r.key,t),Wg(e,r)):r instanceof Rg?(ku("SyncEngine","Document no longer in limbo: "+r.key),e.qo.removeReference(r.key,t),e.qo.containsKey(r.key)||Kg(e,r.key)):Ru()}function Wg(e,t){const n=t.key,r=n.path.canonicalString();e.Bo.get(n)||e.Lo.has(r)||(ku("SyncEngine","New document in limbo: "+n),e.Lo.add(r),Gg(e))}function Gg(e){for(;e.Lo.size>0&&e.Bo.size<e.maxConcurrentLimboResolutions;){const t=e.Lo.values().next().value;e.Lo.delete(t);const n=new gh(th.fromString(t)),r=e.Qo.next();e.Uo.set(r,new Og(n)),e.Bo=e.Bo.insert(n,r),qm(e.remoteStore,new jf(ul(nl(n.path)),r,2,zu.I))}}async function Qg(e,t,n){const r=Du(e),i=[],s=[],o=[];r.Mo.isEmpty()||(r.Mo.forEach(((e,a)=>{o.push(r.Go(a,t,n).then((e=>{if(e){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),i.push(e);const t=zp.$n(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.Oo.br(i),await async function(e,t){const n=Du(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Af.forEach(t,(t=>Af.forEach(t.kn,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Af.forEach(t.xn,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Of(e))throw e;ku("LocalStore","Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.qn.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.qn=n.qn.insert(e,i)}}}(r.localStore,s))}async function Jg(e,t){const n=Du(e);if(!n.currentUser.isEqual(t)){ku("SyncEngine","User change. New user:",t.toKey());const e=await Wp(n.localStore,t);n.currentUser=t,function(e,t){e.jo.forEach((e=>{e.forEach((e=>{e.reject(new Pu(Ou.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.jo.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Qg(n,e.Gn)}}function Yg(e,t){const n=Du(e),r=n.Uo.get(t);if(r&&r.$o)return dd().add(r.key);{let e=dd();const r=n.Fo.get(t);if(!r)return e;for(const t of r){const r=n.Mo.get(t);e=e.unionWith(r.view.bo)}return e}}async function Xg(e,t){const n=Du(e),r=await Zp(n.localStore,t.query,!0),i=t.view.ko(r);return n.isPrimaryClient&&Hg(n,t.targetId,i.Co),i}async function Zg(e){const t=Du(e);return tm(t.localStore).then((e=>Qg(t,e)))}async function ey(e,t,n,r){const i=Du(e),s=await function(e,t){const n=Du(e),r=Du(n.An);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.Zt(e,t).next((t=>t?n.Wn.vn(e,t):Af.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await Zm(i.remoteStore):"acknowledged"===n||"rejected"===n?(zg(i,t,r||null),Bg(i,t),function(e,t){Du(Du(e).An).ee(t)}(i.localStore,t)):Ru(),await Qg(i,s)):ku("SyncEngine","Cannot apply mutation batch with id: "+t)}async function ty(e,t,n){const r=Du(e),i=[],s=[];for(const o of t){let e;const t=r.Fo.get(o);if(t&&0!==t.length){e=await Yp(r.localStore,ul(t[0]));for(const e of t){const t=r.Mo.get(e),n=await Xg(r,t);n.snapshot&&s.push(n.snapshot)}}else{const t=await em(r.localStore,o);e=await Yp(r.localStore,t),await Lg(r,ny(t),o,!1)}i.push(e)}return r.Oo.br(s),i}function ny(e){return tl(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function ry(e){const t=Du(e);return Du(Du(t.localStore).persistence).Tn()}async function iy(e,t,n,r){const i=Du(e);if(i.Wo)ku("SyncEngine","Ignoring unexpected query state notification.");else if(i.Fo.has(t))switch(n){case"current":case"not-current":{const e=await tm(i.localStore),r=md.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await Qg(i,e,r);break}case"rejected":await Xp(i.localStore,t,!0),$g(i,t,r);break;default:Ru()}}async function sy(e,t,n){const r=oy(e);if(r.Wo){for(const e of t){if(r.Fo.has(e)){ku("SyncEngine","Adding an already active target "+e);continue}const t=await em(r.localStore,e),n=await Yp(r.localStore,t);await Lg(r,ny(t),n.targetId,!1),qm(r.remoteStore,n)}for(const e of n)r.Fo.has(e)&&await Xp(r.localStore,e,!1).then((()=>{jm(r.remoteStore,e),$g(r,e)})).catch(_p)}}function oy(e){const t=Du(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Ug.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Yg.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Vg.bind(null,t),t.Oo.br=_g.bind(null,t.eventManager),t.Oo.zo=bg.bind(null,t.eventManager),t}function ay(e){const t=Du(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=qg.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=jg.bind(null,t),t}class cy{constructor(){this.synchronizeTabs=!1}async initialize(e){this.k=Nm(e.databaseInfo.databaseId),this.sharedClientState=this.Jo(e),this.persistence=this.Yo(e),await this.persistence.start(),this.gcScheduler=this.Xo(e),this.localStore=this.Zo(e)}Xo(e){return null}Zo(e){return Hp(this.persistence,new $p,e.initialUser,this.k)}Yo(e){return new hm(dm.ks,this.k)}Jo(e){return new Im}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class uy extends cy{constructor(e,t,n){super(),this.tc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await async function(e){const t=Du(e);return t.persistence.runTransaction("Synchronize last document change read time","readonly",(e=>function(e){const t=Op(e);let n=Ju.min();return t.jt({index:mf.readTimeIndex,reverse:!0},((e,t,r)=>{t.readTime&&(n=Hf(t.readTime)),r.done()})).next((()=>n))}(e))).then((e=>{t.jn=e}))}(this.localStore),await this.tc.initialize(this,e),await ay(this.tc.syncEngine),await Zm(this.tc.remoteStore),await this.persistence.sn((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve())))}Zo(e){return Hp(this.persistence,new $p,e.initialUser,this.k)}Xo(e){const t=this.persistence.referenceDelegate.garbageCollector;return new Tp(t,e.asyncQueue)}Yo(e){const t=qp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ap.withCacheSize(this.cacheSizeBytes):ap.DEFAULT;return new Up(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Cm(),Rm(),this.k,this.sharedClientState,!!this.forceOwnership)}Jo(e){return new Im}}class hy extends uy{constructor(e,t){super(e,t,!1),this.tc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.tc.syncEngine;this.sharedClientState instanceof bm&&(this.sharedClientState.syncEngine={mi:ey.bind(null,t),gi:iy.bind(null,t),yi:sy.bind(null,t),Tn:ry.bind(null,t),_i:Zg.bind(null,t)},await this.sharedClientState.start()),await this.persistence.sn((async e=>{await async function(e,t){const n=Du(e);if(oy(n),ay(n),!0===t&&!0!==n.Wo){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await ty(n,e.toArray());n.Wo=!0,await cg(n.remoteStore,!0);for(const r of t)qm(n.remoteStore,r)}else if(!1===t&&!1!==n.Wo){const e=[];let t=Promise.resolve();n.Fo.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>($g(n,i),Xp(n.localStore,i,!0)))),jm(n.remoteStore,i)})),await t,await ty(n,e),function(e){const t=Du(e);t.Uo.forEach(((e,n)=>{jm(t.remoteStore,n)})),t.qo.hs(),t.Uo=new Map,t.Bo=new ed(gh.comparator)}(n),n.Wo=!1,await cg(n.remoteStore,!1)}}(this.tc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())}))}Jo(e){const t=Cm();if(!bm.Pt(t))throw new Pu(Ou.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=qp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new bm(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class ly{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Fg(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Jg.bind(null,this.syncEngine),await cg(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new yg}createDatastore(e){const t=Nm(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new Am(r));var r;return function(e,t,n,r){return new Lm(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>Fg(this.syncEngine,e,0),s=Em.Pt()?new Em:new Tm,new Um(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Pg(e,t,n,r,i,s);return o&&(a.Wo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Du(e);ku("RemoteStore","RemoteStore shutting down."),t.Gr.add(5),await Vm(t),t.Hr.shutdown(),t.Jr.set("Unknown")}(this.remoteStore)}}function dy(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class fy{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.ec(this.observer.next,e)}error(e){this.observer.error?this.ec(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}nc(){this.muted=!0}ec(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class py{constructor(e,t){this.sc=e,this.k=t,this.metadata=new xu,this.buffer=new Uint8Array,this.ic=new TextDecoder("utf-8"),this.rc().then((e=>{e&&e._o()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))}),(e=>this.metadata.reject(e)))}close(){return this.sc.cancel()}async getMetadata(){return this.metadata.promise}async Ho(){return await this.getMetadata(),this.rc()}async rc(){const e=await this.oc();if(null===e)return null;const t=this.ic.decode(e),n=Number(t);isNaN(n)&&this.cc(`length string (${t}) is not valid number`);const r=await this.ac(n);return new Eg(JSON.parse(r),e.length+n)}uc(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async oc(){for(;this.uc()<0&&!(await this.hc()););if(0===this.buffer.length)return null;const e=this.uc();e<0&&this.cc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async ac(e){for(;this.buffer.length<e;)await this.hc()&&this.cc("Reached the end of bundle when more is expected.");const t=this.ic.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}cc(e){throw this.sc.cancel(),new Error(`Invalid bundle format: ${e}`)}async hc(){const e=await this.sc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class my{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Pu(Ou.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=Du(e),r=Ud(n.k)+"/documents",i={documents:t.map((e=>Pd(n.k,e)))},s=await n.ji("BatchGetDocuments",r,i),o=new Map;s.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){Nu(!!t.found),t.found.name,t.found.updateTime;const n=xd(e,t.found.name),r=Nd(t.found.updateTime),i=new Dh({mapValue:{fields:t.found.fields}});return Ph.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){Nu(!!t.missing),Nu(!!t.readTime);const n=xd(e,t.missing),r=Nd(t.readTime);return Ph.newNoDocument(n,r)}(e,t):Ru()}(n.k,e);o.set(t.key.toString(),t)}));const a=[];return t.forEach((e=>{const t=o.get(e.toString());Nu(!!t),a.push(t)})),a}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Wl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=gh.fromPath(t);this.mutations.push(new Gl(n,this.precondition(n)))})),await async function(e,t){const n=Du(e),r=Ud(n.k)+"/documents",i={writes:t.map((e=>jd(n.k,e)))};await n.Bi("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ru();t=Ju.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Pu(Ou.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?xl.updateTime(t):xl.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Ju.min()))throw new Pu(Ou.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return xl.updateTime(t)}return xl.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class gy{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.lc=5,this.ur=new Dm(this.asyncQueue,"transaction_retry")}run(){this.lc-=1,this.fc()}fc(){this.ur.Zi((async()=>{const e=new my(this.datastore),t=this.dc(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.wc(e)}))))})).catch((e=>{this.wc(e)}))}))}dc(e){try{const t=this.updateFunction(e);return!fh(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}wc(e){this.lc>0&&this._c(e)?(this.lc-=1,this.asyncQueue.enqueueAndForget((()=>(this.fc(),Promise.resolve())))):this.deferred.reject(e)}_c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!Xl(t)}return!1}}class yy{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=bu.UNAUTHENTICATED,this.clientId=Ku.A(),this.authCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{ku("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(()=>Promise.resolve()))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Pu(Ou.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new xu;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=dg(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function vy(e,t){e.asyncQueue.verifyOperationInProgress(),ku("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Wp(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e.offlineComponents=t}async function wy(e,t){e.asyncQueue.verifyOperationInProgress();const n=await _y(e);ku("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>async function(e,t){const n=Du(e);n.asyncQueue.verifyOperationInProgress(),ku("RemoteStore","RemoteStore received new credentials");const r=Hm(n);n.Gr.add(3),await Vm(n),r&&n.Jr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Gr.delete(3),await Fm(n)}(t.remoteStore,e))),e.onlineComponents=t}async function _y(e){return e.offlineComponents||(ku("FirestoreClient","Using default OfflineComponentProvider"),await vy(e,new cy)),e.offlineComponents}async function by(e){return e.onlineComponents||(ku("FirestoreClient","Using default OnlineComponentProvider"),await wy(e,new ly)),e.onlineComponents}function Iy(e){return _y(e).then((e=>e.persistence))}function Ty(e){return _y(e).then((e=>e.localStore))}function Ey(e){return by(e).then((e=>e.remoteStore))}function ky(e){return by(e).then((e=>e.syncEngine))}async function Sy(e){const t=await by(e),n=t.eventManager;return n.onListen=xg.bind(null,t.syncEngine),n.onUnlisten=Mg.bind(null,t.syncEngine),n}function Ay(e,t,n={}){const r=new xu;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new fy({next:s=>{t.enqueueAndForget((()=>wg(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Pu(Ou.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Pu(Ou.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new Tg(nl(n.path),s,{includeMetadataChanges:!0,wo:!0});return vg(e,o)}(await Sy(e),e.asyncQueue,t,n,r))),r.promise}function Cy(e,t,n={}){const r=new xu;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new fy({next:n=>{t.enqueueAndForget((()=>wg(e,o))),n.fromCache&&"server"===r.source?i.reject(new Pu(Ou.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Tg(n,s,{includeMetadataChanges:!0,wo:!0});return vg(e,o)}(await Sy(e),e.asyncQueue,t,n,r))),r.promise}function Ry(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?(new TextEncoder).encode(e):e,function(e,t){return new py(e,t)}(function(e,t){if(e instanceof Uint8Array)return dy(e,t);if(e instanceof ArrayBuffer)return dy(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,Nm(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=Du(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=Du(e),r=Nd(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.Ye.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),void n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r));n._updateProgress(Ag(r));const i=new Sg(r,e.localStore,t.k);let s=await t.Ho();for(;s;){const e=await i.yo(s);e&&n._updateProgress(e),s=await t.Ho()}const o=await i.complete();await Qg(e,o.In,void 0),await function(e,t){const n=Du(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.Ye.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress)}catch(e){Au("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e)}})(r,t,n).then((()=>{r.sharedClientState.notifyBundleLoaded()}))}(await ky(e),i,r)}))}class Ny{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Dy{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Dy&&e.projectId===this.projectId&&e.database===this.database}}const Oy=new Map;function Py(e,t,n){if(!n)throw new Pu(Ou.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function xy(e,t,n,r){if(!0===t&&!0===r)throw new Pu(Ou.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Ly(e){if(!gh.isDocumentKey(e))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function My(e){if(gh.isDocumentKey(e))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Uy(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Ru()}function Fy(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Pu(Ou.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Uy(e);throw new Pu(Ou.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Vy(e,t){if(t<=0)throw new Pu(Ou.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class qy{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Pu(Ou.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Pu(Ou.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,xy("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class jy{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new qy({}),this._settingsFrozen=!1,e instanceof Dy?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Pu(Ou.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Dy(e.options.projectId)}(e))}get app(){if(!this._app)throw new Pu(Ou.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Pu(Ou.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new qy(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Mu;switch(e.type){case"gapi":const t=e.client;return Nu(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new qu(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new Pu(Ou.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Oy.get(e);t&&(ku("ComponentProvider","Removing Datastore"),Oy.delete(e),t.terminate())}(this),Promise.resolve()}}class By{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new $y(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new By(this.firestore,e,this._key)}}class zy{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new zy(this.firestore,e,this._query)}}class $y extends zy{constructor(e,t,n){super(e,t,nl(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new By(this.firestore,null,new gh(e))}withConverter(e){return new $y(this.firestore,e,this._path)}}function Ky(e,t,...n){if(e=O(e),Py("collection","path",t),e instanceof jy){const r=th.fromString(t,...n);return My(r),new $y(e,null,r)}{if(!(e instanceof By||e instanceof $y))throw new Pu(Ou.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(th.fromString(t,...n));return My(r),new $y(e.firestore,null,r)}}function Hy(e,t,...n){if(e=O(e),1===arguments.length&&(t=Ku.A()),Py("doc","path",t),e instanceof jy){const r=th.fromString(t,...n);return Ly(r),new By(e,null,new gh(r))}{if(!(e instanceof By||e instanceof $y))throw new Pu(Ou.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(th.fromString(t,...n));return Ly(r),new By(e.firestore,e instanceof $y?e.converter:null,new gh(r))}}function Wy(e,t){return e=O(e),t=O(t),(e instanceof By||e instanceof $y)&&(t instanceof By||t instanceof $y)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Gy(e,t){return e=O(e),t=O(t),e instanceof zy&&t instanceof zy&&e.firestore===t.firestore&&ll(e._query,t._query)&&e.converter===t.converter}class Qy{constructor(){this.mc=Promise.resolve(),this.gc=[],this.yc=!1,this.Tc=[],this.Ec=null,this.Ic=!1,this.Ac=!1,this.Rc=[],this.ur=new Dm(this,"async_queue_retry"),this.bc=()=>{const e=Rm();e&&ku("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ur.er()};const e=Rm();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.bc)}get isShuttingDown(){return this.yc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pc(),this.vc(e)}enterRestrictedMode(e){if(!this.yc){this.yc=!0,this.Ac=e||!1;const t=Rm();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc)}}enqueue(e){if(this.Pc(),this.yc)return new Promise((()=>{}));const t=new xu;return this.vc((()=>this.yc&&this.Ac?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.gc.push(e),this.Vc())))}async Vc(){if(0!==this.gc.length){try{await this.gc[0](),this.gc.shift(),this.ur.reset()}catch(bs){if(!Of(bs))throw bs;ku("AsyncQueue","Operation failed with retryable error: "+bs)}this.gc.length>0&&this.ur.Zi((()=>this.Vc()))}}vc(e){const t=this.mc.then((()=>(this.Ic=!0,e().catch((e=>{this.Ec=e,this.Ic=!1;throw Su("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e})).then((e=>(this.Ic=!1,e))))));return this.mc=t,t}enqueueAfterDelay(e,t,n){this.Pc(),this.Rc.indexOf(e)>-1&&(t=0);const r=lg.createAndSchedule(this,e,t,n,(e=>this.Sc(e)));return this.Tc.push(r),r}Pc(){this.Ec&&Ru()}verifyOperationInProgress(){}async Dc(){let e;do{e=this.mc,await e}while(e!==this.mc)}Cc(e){for(const t of this.Tc)if(t.timerId===e)return!0;return!1}Nc(e){return this.Dc().then((()=>{this.Tc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Dc()}))}kc(e){this.Rc.push(e)}Sc(e){const t=this.Tc.indexOf(e);this.Tc.splice(t,1)}}function Jy(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(e)}class Yy{constructor(){this._progressObserver={},this._taskCompletionResolver=new xu,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Xy extends jy{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new Qy,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||ev(this),this._firestoreClient.terminate()}}function Zy(e){return e._firestoreClient||ev(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function ev(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new Ny(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new yy(e._authCredentials,e._appCheckCredentials,e._queue,r)}function tv(e,t,n){const r=new xu;return e.asyncQueue.enqueue((async()=>{try{await vy(e,n),await wy(e,t),r.resolve()}catch(e){if(!function(e){return"FirebaseError"===e.name?e.code===Ou.FAILED_PRECONDITION||e.code===Ou.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(e))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),r.reject(e)}})).then((()=>r.promise))}function nv(e){return function(e){const t=new xu;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=Du(e);Hm(n.remoteStore)||ku("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=Du(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.An.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.jo.get(e)||[];r.push(t),n.jo.set(e,r)}catch(e){const n=dg(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await ky(e),t))),t.promise}(Zy(e=Fy(e,Xy)))}function rv(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await Iy(e),n=await Ey(e);return t.setNetworkEnabled(!0),function(e){const t=Du(e);return t.Gr.delete(0),Fm(t)}(n)}))}(Zy(e=Fy(e,Xy)))}function iv(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await Iy(e),n=await Ey(e);return t.setNetworkEnabled(!1),async function(e){const t=Du(e);t.Gr.add(0),await Vm(t),t.Jr.set("Offline")}(n)}))}(Zy(e=Fy(e,Xy)))}function sv(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=Du(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.Ye.getNamedQuery(e,t)))}(await Ty(e),t)))}(Zy(e=Fy(e,Xy)),t).then((t=>t?new zy(e,null,t.query):null))}function ov(e){if(e._initialized||e._terminated)throw new Pu(Ou.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class av{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Pu(Ou.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rh(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class cv{constructor(e){this._byteString=e}static fromBase64String(e){try{return new cv(sh.fromBase64String(e))}catch(e){throw new Pu(Ou.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new cv(sh.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class uv{constructor(e){this._methodName=e}}class hv{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Pu(Ou.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Pu(Ou.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Hu(this._lat,e._lat)||Hu(this._long,e._long)}}const lv=/^__.*__$/;class dv{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new zl(e,this.data,this.fieldMask,t,this.fieldTransforms):new Bl(e,this.data,t,this.fieldTransforms)}}class fv{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new zl(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function pv(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ru()}}class mv{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.k=n,this.ignoreUndefinedProperties=r,void 0===i&&this.xc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get $c(){return this.settings.$c}Oc(e){return new mv(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.Lc(e),r}Bc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.xc(),r}Uc(e){return this.Oc({path:void 0,Fc:!0})}qc(e){return Lv(e,this.settings.methodName,this.settings.Kc||!1,this.path,this.settings.jc)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lc(this.path.get(e))}Lc(e){if(0===e.length)throw this.qc("Document fields must not be empty");if(pv(this.$c)&&lv.test(e))throw this.qc('Document fields cannot begin and end with "__"')}}class gv{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.k=n||Nm(e)}Qc(e,t,n,r=!1){return new mv({$c:e,methodName:t,jc:n,path:rh.emptyPath(),Fc:!1,Kc:r},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function yv(e){const t=e._freezeSettings(),n=Nm(e._databaseId);return new gv(e._databaseId,!!t.ignoreUndefinedProperties,n)}function vv(e,t,n,r,i,s={}){const o=e.Qc(s.merge||s.mergeFields?2:0,t,n,i);Dv("Data must be an object, but it was:",o,r);const a=Rv(r,o);let c,u;if(s.merge)c=new ih(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Ov(t,r,n);if(!o.contains(i))throw new Pu(Ou.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Mv(e,i)||e.push(i)}c=new ih(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new dv(new Dh(a),c,u)}class wv extends uv{_toFieldTransform(e){if(2!==e.$c)throw 1===e.$c?e.qc(`${this._methodName}() can only appear at the top level of your update data`):e.qc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof wv}}function _v(e,t,n){return new mv({$c:3,jc:t.settings.jc,methodName:e._methodName,Fc:n},t.databaseId,t.k,t.ignoreUndefinedProperties)}class bv extends uv{_toFieldTransform(e){return new Ol(e.path,new El)}isEqual(e){return e instanceof bv}}class Iv extends uv{constructor(e,t){super(e),this.Wc=t}_toFieldTransform(e){const t=_v(this,e,!0),n=this.Wc.map((e=>Cv(e,t))),r=new kl(n);return new Ol(e.path,r)}isEqual(e){return this===e}}class Tv extends uv{constructor(e,t){super(e),this.Wc=t}_toFieldTransform(e){const t=_v(this,e,!0),n=this.Wc.map((e=>Cv(e,t))),r=new Al(n);return new Ol(e.path,r)}isEqual(e){return this===e}}class Ev extends uv{constructor(e,t){super(e),this.Gc=t}_toFieldTransform(e){const t=new Rl(e.k,wl(e.k,this.Gc));return new Ol(e.path,t)}isEqual(e){return this===e}}function kv(e,t,n,r){const i=e.Qc(1,t,n);Dv("Data must be an object, but it was:",i,r);const s=[],o=Dh.empty();Xu(r,((e,r)=>{const a=xv(t,e,n);r=O(r);const c=i.Bc(a);if(r instanceof wv)s.push(a);else{const e=Cv(r,c);null!=e&&(s.push(a),o.set(a,e))}}));const a=new ih(s);return new fv(o,a,i.fieldTransforms)}function Sv(e,t,n,r,i,s){const o=e.Qc(1,t,n),a=[Ov(t,r,n)],c=[i];if(s.length%2!=0)throw new Pu(Ou.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Ov(t,s[d])),c.push(s[d+1]);const u=[],h=Dh.empty();for(let d=a.length-1;d>=0;--d)if(!Mv(u,a[d])){const e=a[d];let t=c[d];t=O(t);const n=o.Bc(e);if(t instanceof wv)u.push(e);else{const r=Cv(t,n);null!=r&&(u.push(e),h.set(e,r))}}const l=new ih(u);return new fv(h,l,o.fieldTransforms)}function Av(e,t,n,r=!1){return Cv(n,e.Qc(r?4:3,t))}function Cv(e,t){if(Nv(e=O(e)))return Dv("Unsupported field value:",t,e),Rv(e,t);if(e instanceof uv)return function(e,t){if(!pv(t.$c))throw t.qc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.qc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&4!==t.$c)throw t.qc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Cv(i,t.Uc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=O(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return wl(t.k,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Qu.fromDate(e);return{timestampValue:Ad(t.k,n)}}if(e instanceof Qu){const n=new Qu(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Ad(t.k,n)}}if(e instanceof hv)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof cv)return{bytesValue:Cd(t.k,e._byteString)};if(e instanceof By){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.qc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Dd(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.qc(`Unsupported field value: ${Uy(e)}`)}(e,t)}function Rv(e,t){const n={};return Zu(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Xu(e,((e,r)=>{const i=Cv(r,t.Mc(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Nv(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Qu||e instanceof hv||e instanceof cv||e instanceof By||e instanceof uv)}function Dv(e,t,n){if(!Nv(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Uy(n);throw"an object"===r?t.qc(e+" a custom object"):t.qc(e+" "+r)}}function Ov(e,t,n){if((t=O(t))instanceof av)return t._internalPath;if("string"==typeof t)return xv(e,t);throw Lv("Field path arguments must be of type string or ",e,!1,void 0,n)}const Pv=new RegExp("[~\\*/\\[\\]]");function xv(e,t,n){if(t.search(Pv)>=0)throw Lv(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new av(...t.split("."))._internalPath}catch(r){throw Lv(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Lv(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Pu(Ou.INVALID_ARGUMENT,a+e+c)}function Mv(e,t){return e.some((e=>e.isEqual(t)))}class Uv{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new By(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Fv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Vv("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Fv extends Uv{data(){return super.data()}}function Vv(e,t){return"string"==typeof t?xv(e,t):t instanceof av?t._internalPath:t._delegate._internalPath}class qv{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class jv extends Uv{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Bv(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Vv("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Bv extends jv{data(e={}){return super.data(e)}}class zv{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new qv(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Bv(this._firestore,this._userDataWriter,n.key,n,new qv(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Pu(Ou.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>({type:"added",doc:new Bv(e._firestore,e._userDataWriter,n.doc.key,n.doc,new qv(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++})))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new Bv(e._firestore,e._userDataWriter,t.doc.key,t.doc,new qv(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:$v(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function $v(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ru()}}function Kv(e,t){return e instanceof jv&&t instanceof jv?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof zv&&t instanceof zv&&e._firestore===t._firestore&&Gy(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Hv(e){if(il(e)&&0===e.explicitOrderBy.length)throw new Pu(Ou.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Wv{}function Gv(e,...t){for(const n of t)e=n._apply(e);return e}class Qv extends Wv{constructor(e,t,n){super(),this.zc=e,this.Hc=t,this.Jc=n,this.type="where"}_apply(e){const t=yv(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Pu(Ou.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){nw(o,s);const t=[];for(const n of o)t.push(tw(r,e,n));a={arrayValue:{values:t}}}else a=tw(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||nw(o,s),a=Av(n,"where",o,"in"===s||"not-in"===s);const c=Vh.create(i,s,a);return function(e,t){if(t.V()){const n=ol(e);if(null!==n&&!n.isEqual(t.field))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const r=sl(e);null!==r&&rw(e,t.field,r)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Pu(Ou.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Pu(Ou.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,c),c}(e._query,0,t,e.firestore._databaseId,this.zc,this.Hc,this.Jc);return new zy(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new el(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}class Jv extends Wv{constructor(e,t){super(),this.zc=e,this.Yc=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Pu(Ou.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Pu(Ou.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new Jh(t,n);return function(e,t){if(null===sl(e)){const n=ol(e);null!==n&&rw(e,n,t.field)}}(e,r),r}(e._query,this.zc,this.Yc);return new zy(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new el(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class Yv extends Wv{constructor(e,t,n){super(),this.type=e,this.Xc=t,this.Zc=n}_apply(e){return new zy(e.firestore,e.converter,hl(e._query,this.Xc,this.Zc))}}class Xv extends Wv{constructor(e,t,n){super(),this.type=e,this.ta=t,this.ea=n}_apply(e){const t=ew(e,this.type,this.ta,this.ea);return new zy(e.firestore,e.converter,function(e,t){return new el(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class Zv extends Wv{constructor(e,t,n){super(),this.type=e,this.ta=t,this.ea=n}_apply(e){const t=ew(e,this.type,this.ta,this.ea);return new zy(e.firestore,e.converter,function(e,t){return new el(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function ew(e,t,n,r){if(n[0]=O(n[0]),n[0]instanceof Uv)return function(e,t,n,r,i){if(!r)throw new Pu(Ou.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const o of cl(e))if(o.field.isKeyField())s.push(Eh(t,r.key));else{const e=r.data.field(o.field);if(hh(e))throw new Pu(Ou.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=o.field.canonicalString();throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new Gh(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=yv(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new Pu(Ou.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let c=0;c<i.length;c++){const s=i[c];if(o[c].field.isKeyField()){if("string"!=typeof s)throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof s}`);if(!al(e)&&-1!==s.indexOf("/"))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${s}' contains a slash.`);const n=e.path.child(th.fromString(s));if(!gh.isDocumentKey(n))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new gh(n);a.push(Eh(t,i))}else{const e=Av(n,r,s);a.push(e)}}return new Gh(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function tw(e,t,n){if("string"==typeof(n=O(n))){if(""===n)throw new Pu(Ou.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!al(t)&&-1!==n.indexOf("/"))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(th.fromString(n));if(!gh.isDocumentKey(r))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Eh(e,new gh(r))}if(n instanceof By)return Eh(e,n._key);throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Uy(n)}.`)}function nw(e,t){if(!Array.isArray(e)||0===e.length)throw new Pu(Ou.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new Pu(Ou.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function rw(e,t,n){if(!n.isEqual(t))throw new Pu(Ou.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class iw{convertValue(e,t="none"){switch(yh(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ch(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(uh(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Ru()}}convertObject(e,t){const n={};return Xu(e.fields,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new hv(ch(e.latitude),ch(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=lh(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(dh(e));default:return null}}convertTimestamp(e){const t=ah(e);return new Qu(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=th.fromString(e);Nu(nf(n));const r=new Dy(n.get(1),n.get(3)),i=new gh(n.popFirst(5));return r.isEqual(t)||Su(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function sw(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class ow extends iw{constructor(e){super(),this.firestore=e}convertBytes(e){return new cv(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new By(this.firestore,null,t)}}class aw{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=yv(e)}set(e,t,n){this._verifyNotCommitted();const r=cw(e,this._firestore),i=sw(r.converter,t,n),s=vv(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,xl.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=cw(e,this._firestore);let s;return s="string"==typeof(t=O(t))||t instanceof av?Sv(this._dataReader,"WriteBatch.update",i._key,t,n,r):kv(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,xl.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=cw(e,this._firestore);return this._mutations=this._mutations.concat(new Wl(t._key,xl.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Pu(Ou.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function cw(e,t){if((e=O(e)).firestore!==t)throw new Pu(Ou.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class uw extends iw{constructor(e){super(),this.firestore=e}convertBytes(e){return new cv(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new By(this.firestore,null,t)}}function hw(e){e=Fy(e,By);const t=Fy(e.firestore,Xy),n=Zy(t),r=new uw(t);return function(e,t){const n=new xu;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=Du(e);return n.persistence.runTransaction("read document","readonly",(e=>n.Wn.Rn(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new Pu(Ou.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=dg(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await Ty(e),t,n))),n.promise}(n,e._key).then((n=>new jv(t,r,e._key,n,new qv(null!==n&&n.hasLocalMutations,!0),e.converter)))}function lw(e){e=Fy(e,zy);const t=Fy(e.firestore,Xy),n=Zy(t),r=new uw(t);return function(e,t){const n=new xu;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await Zp(e,t,!0),i=new Ng(t,r.zn),s=i.Po(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=dg(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await Ty(e),t,n))),n.promise}(n,e._query).then((n=>new zv(t,r,e,n)))}function dw(e,t,n){e=Fy(e,By);const r=Fy(e.firestore,Xy),i=sw(e.converter,t,n);return gw(r,[vv(yv(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,xl.none())])}function fw(e,t,n,...r){e=Fy(e,By);const i=Fy(e.firestore,Xy),s=yv(i);let o;return o="string"==typeof(t=O(t))||t instanceof av?Sv(s,"updateDoc",e._key,t,n,r):kv(s,"updateDoc",e._key,t),gw(i,[o.toMutation(e._key,xl.exists(!0))])}function pw(e,...t){var n,r,i;e=O(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||Jy(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(Jy(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,u,h;if(e instanceof By)u=Fy(e.firestore,Xy),h=nl(e._key.path),c={next:n=>{t[o]&&t[o](yw(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=Fy(e,zy);u=Fy(n.firestore,Xy),h=n._query;const r=new uw(u);c={next:e=>{t[o]&&t[o](new zv(u,r,n,e))},error:t[o+1],complete:t[o+2]},Hv(e._query)}return function(e,t,n,r){const i=new fy(r),s=new Tg(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>vg(await Sy(e),s))),()=>{i.nc(),e.asyncQueue.enqueueAndForget((async()=>wg(await Sy(e),s)))}}(Zy(u),h,a,c)}function mw(e,t){return function(e,t){const n=new fy(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){Du(e).io.add(t),t.next()}(await Sy(e),n))),()=>{n.nc(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){Du(e).io.delete(t)}(await Sy(e),n)))}}(Zy(e=Fy(e,Xy)),Jy(t)?t:{next:t})}function gw(e,t){return function(e,t){const n=new xu;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=ay(e);try{const e=await function(e,t){const n=Du(e),r=Qu.now(),i=t.reduce(((e,t)=>e.add(t.key)),dd());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>n.Wn.vn(e,i).next((i=>{s=i;const o=[];for(const e of t){const t=Vl(e,s.get(e.key));null!=t&&o.push(new zl(e.key,t,Oh(t.value.mapValue),xl.exists(!0)))}return n.An.addMutationBatch(e,r,o,t)})))).then((e=>(e.applyToLocalDocumentSet(s),{batchId:e.batchId,changes:s})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ko[e.currentUser.toKey()];r||(r=new ed(Hu)),r=r.insert(t,n),e.Ko[e.currentUser.toKey()]=r}(r,e.batchId,n),await Qg(r,e.changes),await Zm(r.remoteStore)}catch(e){const t=dg(e,"Failed to persist write");n.reject(t)}}(await ky(e),t,n))),n.promise}(Zy(e),t)}function yw(e,t,n){const r=n.docs.get(t._key),i=new uw(e);return new jv(e,i,t._key,r,new qv(n.hasPendingWrites,n.fromCache),t.converter)}class vw extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=yv(e)}get(e){const t=cw(e,this._firestore),n=new ow(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return Ru();const r=e[0];if(r.isFoundDocument())return new Uv(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Uv(this._firestore,n,t._key,null,t.converter);throw Ru()}))}set(e,t,n){const r=cw(e,this._firestore),i=sw(r.converter,t,n),s=vv(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=cw(e,this._firestore);let s;return s="string"==typeof(t=O(t))||t instanceof av?Sv(this._dataReader,"Transaction.update",i._key,t,n,r):kv(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=cw(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=cw(e,this._firestore),n=new uw(this._firestore);return super.get(e).then((e=>new jv(this._firestore,n,t._key,e._document,new qv(!1,!1),t.converter)))}}function ww(e,t){return function(e,t){const n=new xu;return e.asyncQueue.enqueueAndForget((async()=>{const r=await function(e){return by(e).then((e=>e.datastore))}(e);new gy(e.asyncQueue,r,t,n).run()})),n.promise}(Zy(e=Fy(e,Xy)),(n=>t(new vw(e,n))))}!function(e,t=!0){!function(e){Iu=e}(oe),ee(new P("firestore",((e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=new Xy(r,new Fu(e.getProvider("auth-internal")),new Bu(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i}),"PUBLIC")),le(_u,"3.4.3",e),le(_u,"3.4.3","esm2017")}();function _w(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Pu("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function bw(){if("undefined"===typeof Uint8Array)throw new Pu("unimplemented","Uint8Arrays are not available in this environment.")}function Iw(){if("undefined"==typeof atob)throw new Pu("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Tw{constructor(e){this._delegate=e}static fromBase64String(e){return Iw(),new Tw(cv.fromBase64String(e))}static fromUint8Array(e){return bw(),new Tw(cv.fromUint8Array(e))}toBase64(){return Iw(),this._delegate.toBase64()}toUint8Array(){return bw(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Ew(e){return function(e,t){if("object"!==typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"===typeof n[r])return!0;return!1}(e,["next","error","complete"])}class kw{enableIndexedDbPersistence(e,t){return function(e,t){ov(e=Fy(e,Xy));const n=Zy(e),r=e._freezeSettings(),i=new ly;return tv(n,i,new uy(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){ov(e=Fy(e,Xy));const t=Zy(e),n=e._freezeSettings(),r=new ly;return tv(t,r,new hy(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new Pu(Ou.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new xu;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!Rf.Pt())return Promise.resolve();const t=e+"main";await Rf.delete(t)}(qp(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}(e._delegate)}}class Sw{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Dy||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||Au("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(e,t,n,r={}){var i;const s=(e=Fy(e,jy))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&Au("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=bu.MOCK_USER;else{t=d(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Pu(Ou.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new bu(s)}e._authCredentials=new Uu(new Lu(t,n))}}(this._delegate,e,t,n)}enableNetwork(){return rv(this._delegate)}disableNetwork(){return iv(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,xy("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return nv(this._delegate)}onSnapshotsInSync(e){return mw(this._delegate,e)}get app(){if(!this._appCompat)throw new Pu("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new qw(this,Ky(this._delegate,e))}catch(t){throw Ow(t,"collection()","Firestore.collection()")}}doc(e){try{return new Dw(this,Hy(this._delegate,e))}catch(t){throw Ow(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Uw(this,function(e,t){if(e=Fy(e,jy),Py("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Pu(Ou.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new zy(e,null,function(e){return new el(th.emptyPath(),e)}(t))}(this._delegate,e))}catch(t){throw Ow(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return ww(this._delegate,(t=>e(new Cw(this,t))))}batch(){return Zy(this._delegate),new Rw(new aw(this._delegate,(e=>gw(this._delegate,e))))}loadBundle(e){return function(e,t){const n=Zy(e=Fy(e,Xy)),r=new Yy;return Ry(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return sv(this._delegate,e).then((e=>e?new Uw(this,e):null))}}class Aw extends iw{constructor(e){super(),this.firestore=e}convertBytes(e){return new Tw(new cv(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Dw.forKey(t,this.firestore,null)}}class Cw{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Aw(e)}get(e){const t=jw(e);return this._delegate.get(t).then((e=>new Lw(this._firestore,new jv(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){const r=jw(e);return n?(_w("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=jw(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=jw(e);return this._delegate.delete(t),this}}class Rw{constructor(e){this._delegate=e}set(e,t,n){const r=jw(e);return n?(_w("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=jw(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=jw(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Nw{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new Bv(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Mw(this._firestore,n),null!==t&&void 0!==t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=Nw.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new Nw(e,new Aw(e),t),r.set(t,i)),i}}Nw.INSTANCES=new WeakMap;class Dw{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Aw(e)}static forPath(e,t,n){if(e.length%2!==0)throw new Pu("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Dw(t,new By(t._delegate,n,new gh(e)))}static forKey(e,t,n){return new Dw(t,new By(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new qw(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new qw(this.firestore,Ky(this._delegate,e))}catch(t){throw Ow(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=O(e))instanceof By&&Wy(this._delegate,e)}set(e,t){t=_w("DocumentReference.set",t);try{return t?dw(this._delegate,e,t):dw(this._delegate,e)}catch(n){throw Ow(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?fw(this._delegate,e):fw(this._delegate,e,t,...n)}catch(r){throw Ow(r,"updateDoc()","DocumentReference.update()")}}delete(){return function(e){return gw(Fy(e.firestore,Xy),[new Wl(e._key,xl.none())])}(this._delegate)}onSnapshot(...e){const t=Pw(e),n=xw(e,(e=>new Lw(this.firestore,new jv(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return pw(this._delegate,t,n)}get(e){let t;return t="cache"===(null===e||void 0===e?void 0:e.source)?hw(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?function(e){e=Fy(e,By);const t=Fy(e.firestore,Xy);return Ay(Zy(t),e._key,{source:"server"}).then((n=>yw(t,e,n)))}(this._delegate):function(e){e=Fy(e,By);const t=Fy(e.firestore,Xy);return Ay(Zy(t),e._key).then((n=>yw(t,e,n)))}(this._delegate),t.then((e=>new Lw(this.firestore,new jv(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new Dw(this.firestore,e?this._delegate.withConverter(Nw.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Ow(e,t,n){return e.message=e.message.replace(t,n),e}function Pw(e){for(const t of e)if("object"===typeof t&&!Ew(t))return t;return{}}function xw(e,t){var n,r;let i;return i=Ew(e[0])?e[0]:Ew(e[1])?e[1]:"function"===typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Lw{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Dw(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Kv(this._delegate,e._delegate)}}class Mw extends Lw{data(e){const t=this._delegate.data(e);return function(e,t){e||Ru()}(void 0!==t),t}}class Uw{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Aw(e)}where(e,t,n){try{return new Uw(this.firestore,Gv(this._delegate,function(e,t,n){const r=t,i=Vv("where",e);return new Qv(i,r,n)}(e,t,n)))}catch(r){throw Ow(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Uw(this.firestore,Gv(this._delegate,function(e,t="asc"){const n=t,r=Vv("orderBy",e);return new Jv(r,n)}(e,t)))}catch(n){throw Ow(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Uw(this.firestore,Gv(this._delegate,function(e){return Vy("limit",e),new Yv("limit",e,"F")}(e)))}catch(t){throw Ow(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Uw(this.firestore,Gv(this._delegate,function(e){return Vy("limitToLast",e),new Yv("limitToLast",e,"L")}(e)))}catch(t){throw Ow(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Uw(this.firestore,Gv(this._delegate,function(...e){return new Xv("startAt",e,!0)}(...e)))}catch(t){throw Ow(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Uw(this.firestore,Gv(this._delegate,function(...e){return new Xv("startAfter",e,!1)}(...e)))}catch(t){throw Ow(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Uw(this.firestore,Gv(this._delegate,function(...e){return new Zv("endBefore",e,!0)}(...e)))}catch(t){throw Ow(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Uw(this.firestore,Gv(this._delegate,function(...e){return new Zv("endAt",e,!1)}(...e)))}catch(t){throw Ow(t,"endAt()","Query.endAt()")}}isEqual(e){return Gy(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null===e||void 0===e?void 0:e.source)?lw(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?function(e){e=Fy(e,zy);const t=Fy(e.firestore,Xy),n=Zy(t),r=new uw(t);return Cy(n,e._query,{source:"server"}).then((n=>new zv(t,r,e,n)))}(this._delegate):function(e){e=Fy(e,zy);const t=Fy(e.firestore,Xy),n=Zy(t),r=new uw(t);return Hv(e._query),Cy(n,e._query).then((n=>new zv(t,r,e,n)))}(this._delegate),t.then((e=>new Vw(this.firestore,new zv(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=Pw(e),n=xw(e,(e=>new Vw(this.firestore,new zv(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return pw(this._delegate,t,n)}withConverter(e){return new Uw(this.firestore,e?this._delegate.withConverter(Nw.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Fw{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Mw(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Vw{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Uw(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new Mw(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new Fw(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new Mw(this._firestore,n))}))}isEqual(e){return Kv(this._delegate,e._delegate)}}class qw extends Uw{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Dw(this.firestore,e):null}doc(e){try{return new Dw(this.firestore,void 0===e?Hy(this._delegate):Hy(this._delegate,e))}catch(t){throw Ow(t,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=Fy(e.firestore,Xy),r=Hy(e),i=sw(e.converter,t);return gw(n,[vv(yv(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,xl.exists(!1))]).then((()=>r))}(this._delegate,e).then((e=>new Dw(this.firestore,e)))}isEqual(e){return Wy(this._delegate,e._delegate)}withConverter(e){return new qw(this.firestore,e?this._delegate.withConverter(Nw.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function jw(e){return Fy(e,By)}class Bw{constructor(...e){this._delegate=new av(...e)}static documentId(){return new Bw(rh.keyField().canonicalString())}isEqual(e){return(e=O(e))instanceof av&&this._delegate._internalPath.isEqual(e._internalPath)}}class zw{constructor(e){this._delegate=e}static serverTimestamp(){const e=new bv("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new zw(e)}static delete(){const e=new wv("deleteField");return e._methodName="FieldValue.delete",new zw(e)}static arrayUnion(...e){const t=function(...e){return new Iv("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new zw(t)}static arrayRemove(...e){const t=function(...e){return new Tv("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new zw(t)}static increment(e){const t=function(e){return new Ev("increment",e)}(e);return t._methodName="FieldValue.increment",new zw(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const $w={Firestore:Sw,GeoPoint:hv,Timestamp:Qu,Blob:Tw,Transaction:Cw,WriteBatch:Rw,DocumentReference:Dw,DocumentSnapshot:Lw,Query:Uw,QueryDocumentSnapshot:Mw,QuerySnapshot:Vw,CollectionReference:qw,FieldPath:Bw,FieldValue:zw,setLogLevel:function(e){!function(e){Tu.setLogLevel(e)}(e)},CACHE_SIZE_UNLIMITED:-1};!function(e){!function(e,t){e.INTERNAL.registerComponent(new P("firestore-compat",(e=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("firestore").getImmediate();return t(n,r)}),"PUBLIC").setServiceProps(Object.assign({},$w)))}(e,((e,t)=>new Sw(e,t,new kw))),e.registerVersion("@firebase/firestore-compat","0.1.12")}(we);const Kw="firebasestorage.googleapis.com";class Hw extends _{constructor(e,t){super(Ww(e),`Firebase Storage: ${t} (${Ww(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Hw.prototype)}_codeEquals(e){return Ww(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function Ww(e){return"storage/"+e}function Gw(){return new Hw("unknown","An unknown error occurred, please check the error payload for server response.")}function Qw(){return new Hw("canceled","User canceled the upload/download.")}function Jw(){return new Hw("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function Yw(e){return new Hw("invalid-argument",e)}function Xw(){return new Hw("app-deleted","The Firebase app was deleted.")}function Zw(e){return new Hw("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function e_(e,t){return new Hw("invalid-format","String does not match format '"+e+"': "+t)}function t_(e){throw new Hw("internal-error","Internal error: "+e)}class n_{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=n_.makeFromUrl(e,t)}catch(r){return new n_(e,"")}if(""===n.path)return n;throw new Hw("invalid-default-bucket","Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";const i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===Kw?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let c=0;c<a.length;c++){const t=a[c],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let i=r[t.indices.path];i||(i=""),n=new n_(e,i),t.postModify(n);break}}if(null==n)throw function(e){return new Hw("invalid-url","Invalid URL '"+e+"'.")}(e);return n}}class r_{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function i_(e){return"string"===typeof e||e instanceof String}function s_(e){return o_()&&e instanceof Blob}function o_(){return"undefined"!==typeof Blob}function a_(e,t,n,r){if(r<t)throw Yw(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw Yw(`Invalid value for '${e}'. Expected ${n} or less.`)}function c_(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function u_(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1),n}var h_;!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(h_||(h_={}));class l_{constructor(e,t,n,r,i,s,o,a,c,u,h){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{if(t)return void e(!1,new d_(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===h_.NO_ERROR,i=n.getStatus();if(!t||this.isRetryStatusCode_(i)){const t=n.getErrorCode()===h_.ABORT;return void e(!1,new d_(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new d_(s,n))}))},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(s){r(s)}else if(null!==i){const e=Gw();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else if(t.canceled){r(this.appDelete_?Xw():Qw())}else{r(new Hw("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}};this.canceled_?t(0,new d_(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0;function c(){return 2===a}let u=!1;function h(...e){u||(u=!0,t.apply(null,e))}function l(t){i=setTimeout((()=>{i=null,e(f,c())}),t)}function d(){s&&clearTimeout(s)}function f(e,...t){if(u)return void d();if(e)return d(),void h.call(null,e,...t);if(c()||o)return d(),void h.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),l(n)}let p=!1;function m(e){p||(p=!0,d(),u||(null!==i?(e||(a=2),clearTimeout(i),l(0)):e||(a=1)))}return l(0),s=setTimeout((()=>{o=!0,m(!0)}),n),m}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(e){const t=e>=500&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||r}}class d_{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function f_(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function p_(...e){const t=f_();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(o_())return new Blob(e);throw new Hw("unsupported-environment","This browser doesn't seem to support creating Blobs")}const m_={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class g_{constructor(e,t){this.data=e,this.contentType=t||null}}function y_(e,t){switch(e){case m_.RAW:return new g_(v_(t));case m_.BASE64:case m_.BASE64URL:return new g_(w_(e,t));case m_.DATA_URL:return new g_(function(e){const t=new __(e);return t.base64?w_(m_.BASE64,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(n){throw e_(m_.DATA_URL,"Malformed data URL.")}return v_(t)}(t.rest)}(t),new __(t).contentType)}throw Gw()}function v_(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296===(64512&r)){if(n<e.length-1&&56320===(64512&e.charCodeAt(n+1))){r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else t.push(239,191,189)}else 56320===(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function w_(e,t){switch(e){case m_.BASE64:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r){throw e_(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case m_.BASE64URL:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r){throw e_(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=atob(t)}catch(i){throw e_(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class __{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw e_(m_.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){if(!(e.length>=t.length))return!1;return e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=e.substring(e.indexOf(",")+1)}}class b_{constructor(e,t){let n=0,r="";s_(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(s_(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new b_(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new b_(n,!0)}}static getBlob(...e){if(o_()){const t=e.map((e=>e instanceof b_?e.data_:e));return new b_(p_.apply(null,t))}{const t=e.map((e=>i_(e)?y_(m_.RAW,e).data:e.data_));let n=0;t.forEach((e=>{n+=e.byteLength}));const r=new Uint8Array(n);let i=0;return t.forEach((e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]})),new b_(r,!0)}}uploadData(){return this.data_}}function I_(e){let t;try{t=JSON.parse(e)}catch(n){return null}return function(e){return"object"===typeof e&&!Array.isArray(e)}(t)?t:null}function T_(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function E_(e,t){return t}class k_{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||E_}}let S_=null;function A_(){if(S_)return S_;const e=[];e.push(new k_("bucket")),e.push(new k_("generation")),e.push(new k_("metageneration")),e.push(new k_("name","fullPath",!0));const t=new k_("name");t.xform=function(e,t){return function(e){return!i_(e)||e.length<2?e:T_(e)}(t)},e.push(t);const n=new k_("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new k_("timeCreated")),e.push(new k_("updated")),e.push(new k_("md5Hash",null,!0)),e.push(new k_("cacheControl",null,!0)),e.push(new k_("contentDisposition",null,!0)),e.push(new k_("contentEncoding",null,!0)),e.push(new k_("contentLanguage",null,!0)),e.push(new k_("contentType",null,!0)),e.push(new k_("metadata","customMetadata",!0)),S_=e,S_}function C_(e,t,n){const r={type:"file"},i=n.length;for(let s=0;s<i;s++){const e=n[s];r[e.local]=e.xform(r,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,i=new n_(n,r);return t._makeStorageReference(i)}})}(r,e),r}function R_(e,t,n){const r=I_(t);if(null===r)return null;return C_(e,r,n)}function N_(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}function D_(e,t,n){const r=I_(n);if(null===r)return null;return function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(const i of n.prefixes){const n=i.replace(/\/$/,""),s=e._makeStorageReference(new n_(t,n));r.prefixes.push(s)}if(n.items)for(const i of n.items){const n=e._makeStorageReference(new n_(t,i.name));r.items.push(n)}return r}(e,t,r)}class O_{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function P_(e){if(!e)throw Gw()}function x_(e,t){return function(n,r){const i=R_(e,r,t);return P_(null!==i),i}}function L_(e,t){return function(n,r){const i=R_(e,r,t);return P_(null!==i),function(e,t,n,r){const i=I_(t);if(null===i)return null;if(!i_(i.downloadTokens))return null;const s=i.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map((t=>{const i=e.bucket,s=e.fullPath;return c_("/b/"+o(i)+"/o/"+o(s),n,r)+u_({alt:"media",token:t})}))[0]}(i,r,e.host,e._protocol)}}function M_(e){return function(t,n){let r;var i,s;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new Hw("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new Hw("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,r=new Hw("quota-exceeded","Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new Hw("unauthorized","User does not have permission to access '"+i+"'.")):r=n,r.serverResponse=n.serverResponse,r}}function U_(e){const t=M_(e);return function(n,r){let i=t(n,r);var s;return 404===n.getStatus()&&(s=e.path,i=new Hw("object-not-found","Object '"+s+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function F_(e,t,n){const r=c_(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new O_(r,"GET",x_(e,n),i);return s.errorHandler=U_(t),s}function V_(e,t,n,r,i){const s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&n.length>0&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i);const o=c_(t.bucketOnlyServerUrl(),e.host,e._protocol),a=e.maxOperationRetryTime,c=new O_(o,"GET",function(e,t){return function(n,r){const i=D_(e,t,r);return P_(null!==i),i}}(e,t.bucket),a);return c.urlParams=s,c.errorHandler=M_(t),c}function q_(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}function j_(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};const a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const c=q_(t,r,i),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+N_(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",h="\r\n--"+a+"--",l=b_.getBlob(u,r,h);if(null===l)throw Jw();const d={name:c.fullPath},f=c_(s,e.host,e._protocol),p=e.maxUploadRetryTime,m=new O_(f,"POST",x_(e,n),p);return m.urlParams=d,m.headers=o,m.body=l.uploadData(),m.errorHandler=M_(t),m}class B_{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function z_(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(r){P_(!1)}return P_(!!n&&-1!==(t||["active"]).indexOf(n)),n}const $_=262144;function K_(e,t,n,r,i,s,o,a){const c=new B_(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw new Hw("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");const u=c.total-c.current;let h=u;i>0&&(h=Math.min(h,i));const l=c.current,d=l+h,f={"X-Goog-Upload-Command":h===u?"upload, finalize":"upload","X-Goog-Upload-Offset":`${c.current}`},p=r.slice(l,d);if(null===p)throw Jw();const m=t.maxUploadRetryTime,g=new O_(n,"POST",(function(e,n){const i=z_(e,["active","final"]),o=c.current+h,a=r.size();let u;return u="final"===i?x_(t,s)(e,n):null,new B_(o,a,"final"===i,u)}),m);return g.headers=f,g.body=p.uploadData(),g.progressCallback=a||null,g.errorHandler=M_(e),g}const H_={STATE_CHANGED:"state_changed"},W_={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function G_(e){switch(e){case"running":case"pausing":case"canceling":return W_.RUNNING;case"paused":return W_.PAUSED;case"success":return W_.SUCCESS;case"canceled":return W_.CANCELED;case"error":default:return W_.ERROR}}class Q_{constructor(e,t,n){if(function(e){return"function"===typeof e}(e)||null!=t||null!=n)this.next=e,this.error=null!==t&&void 0!==t?t:void 0,this.complete=null!==n&&void 0!==n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function J_(e){return(...t)=>{Promise.resolve().then((()=>e(...t)))}}class Y_{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=h_.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=h_.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=h_.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,r){if(this.sent_)throw t_("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw t_("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw t_("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw t_("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw t_("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class X_ extends Y_{initXhr(){this.xhr_.responseType="text"}}function Z_(){return new X_}class eb{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=A_(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=e,this._transition("error"))},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t,this._start()})),this._promise.then(null,(()=>{}))}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then((([t,n])=>{switch(this._state){case"running":e(t,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}}))}_createResumable(){this._resolveToken(((e,t)=>{const n=function(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o=q_(t,r,i),a={name:o.fullPath},c=c_(s,e.host,e._protocol),u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=N_(o,n),l=e.maxUploadRetryTime,d=new O_(c,"POST",(function(e){let t;z_(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(n){P_(!1)}return P_(i_(t)),t}),l);return d.urlParams=a,d.headers=u,d.body=h,d.errorHandler=M_(t),d}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Z_,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()}),this._errorHandler)}))}_fetchStatus(){const e=this._uploadUrl;this._resolveToken(((t,n)=>{const r=function(e,t,n,r){const i=e.maxUploadRetryTime,s=new O_(n,"POST",(function(e){const t=z_(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(s){P_(!1)}n||P_(!1);const i=Number(n);return P_(!isNaN(i)),new B_(i,r.size(),"final"===t)}),i);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=M_(t),s}(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(r,Z_,t,n);this._request=i,i.getPromise().then((e=>{e=e,this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()}),this._errorHandler)}))}_continueUpload(){const e=$_*this._chunkMultiplier,t=new B_(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken(((r,i)=>{let s;try{s=K_(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(a){return this._error=a,void this._transition("error")}const o=this._ref.storage._makeRequest(s,Z_,r,i);this._request=o,o.getPromise().then((e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()}),this._errorHandler)}))}_increaseMultiplier(){$_*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken(((e,t)=>{const n=F_(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(n,Z_,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._transition("success")}),this._metadataErrorHandler)}))}_oneShotUpload(){this._resolveToken(((e,t)=>{const n=j_(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Z_,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")}),this._errorHandler)}))}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request&&this._request.cancel();break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=Qw(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=G_(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new Q_(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise();this._observers.slice().forEach((e=>{this._notifyObserver(e)}))}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(G_(this._state)){case W_.SUCCESS:J_(this._resolve.bind(null,this.snapshot))();break;case W_.CANCELED:case W_.ERROR:J_(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(G_(this._state)){case W_.RUNNING:case W_.PAUSED:e.next&&J_(e.next.bind(e,this.snapshot))();break;case W_.SUCCESS:e.complete&&J_(e.complete.bind(e))();break;case W_.CANCELED:case W_.ERROR:e.error&&J_(e.error.bind(e,this._error))();break;default:e.error&&J_(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class tb{constructor(e,t){this._service=e,this._location=t instanceof n_?t:n_.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new tb(e,t)}get root(){const e=new n_(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return T_(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new n_(this._location.bucket,e);return new tb(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw Zw(e)}}function nb(e){const t={prefixes:[],items:[]};return rb(e,t).then((()=>t))}async function rb(e,t,n){const r={pageToken:n},i=await ib(e,r);t.prefixes.push(...i.prefixes),t.items.push(...i.items),null!=i.nextPageToken&&await rb(e,t,i.nextPageToken)}function ib(e,t){null!=t&&"number"===typeof t.maxResults&&a_("options.maxResults",1,1e3,t.maxResults);const n=t||{},r=V_(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(r,Z_)}function sb(e,t){e._throwIfRoot("updateMetadata");const n=function(e,t,n,r){const i=c_(t.fullServerUrl(),e.host,e._protocol),s=N_(n,r),o=e.maxOperationRetryTime,a=new O_(i,"PATCH",x_(e,r),o);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=s,a.errorHandler=U_(t),a}(e.storage,e._location,t,A_());return e.storage.makeRequestWithTokens(n,Z_)}function ob(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=c_(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new O_(r,"GET",L_(e,n),i);return s.errorHandler=U_(t),s}(e.storage,e._location,A_());return e.storage.makeRequestWithTokens(t,Z_).then((e=>{if(null===e)throw new Hw("no-download-url","The given file does not have any download URLs.");return e}))}function ab(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=c_(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,i=new O_(n,"DELETE",(function(e,t){}),r);return i.successCodes=[200,204],i.errorHandler=U_(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,Z_)}function cb(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new n_(e._location.bucket,n);return new tb(e.storage,r)}function ub(e,t){if(e instanceof db){const n=e;if(null==n._bucket)throw new Hw("no-default-bucket","No default bucket found. Did you set the 'storageBucket' property when initializing the app?");const r=new tb(n,n._bucket);return null!=t?ub(r,t):r}return void 0!==t?cb(e,t):e}function hb(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof db)return new tb(e,t);throw Yw("To use ref(service, url), the first argument must be a Storage instance.")}return ub(e,t)}function lb(e,t){const n=null===t||void 0===t?void 0:t.storageBucket;return null==n?null:n_.makeFromBucketSpec(n,e)}class db{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=Kw,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?n_.makeFromBucketSpec(r,this._host):lb(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=n_.makeFromBucketSpec(this._url,e):this._bucket=lb(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){a_("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){a_("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new tb(this,e)}_makeRequest(e,t,n,r){if(this._deleted)return new r_(Xw());{const i=function(e,t,n,r,i,s){const o=u_(e.urlParams),a=e.url+o,c=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(c,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(c,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(c,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(c,r),new l_(a,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i)}(e,this._appId,n,r,t,this._firebaseVersion);return this._requests.add(i),i.getPromise().then((()=>this._requests.delete(i)),(()=>this._requests.delete(i))),i}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const fb="@firebase/storage",pb="0.9.1",mb="storage";function gb(e,t,n){return function(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new eb(e,new b_(t),n)}(e=O(e),t,n)}function yb(e){return function(e){e._throwIfRoot("getMetadata");const t=F_(e.storage,e._location,A_());return e.storage.makeRequestWithTokens(t,Z_)}(e=O(e))}function vb(e,t){return hb(e=O(e),t)}function wb(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"===typeof i?i:d(i,e.app.options.projectId))}(e,t,n,r)}function _b(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new db(n,r,i,t,oe)}ee(new P(mb,_b,"PUBLIC").setMultipleInstances(!0)),le(fb,pb,""),le(fb,pb,"esm2017");class bb{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class Ib{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new bb(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then((t=>{if(e)return e(new bb(t,this,this._ref))}),t)}on(e,t,n,r){let i;return t&&(i="function"===typeof t?e=>t(new bb(e,this,this._ref)):{next:t.next?e=>t.next(new bb(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class Tb{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map((e=>new Eb(e,this._service)))}get items(){return this._delegate.items.map((e=>new Eb(e,this._service)))}get nextPageToken(){return this._delegate.nextPageToken||null}}class Eb{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=function(e,t){return cb(e,t)}(this._delegate,e);return new Eb(t,this.storage)}get root(){return new Eb(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return null==e?null:new Eb(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new Ib(gb(this._delegate,e,t),this)}putString(e,t=m_.RAW,n){this._throwIfRoot("putString");const r=y_(t,e),i=Object.assign({},n);return null==i.contentType&&null!=r.contentType&&(i.contentType=r.contentType),new Ib(new eb(this._delegate,new b_(r.data,!0),i),this)}listAll(){return function(e){return nb(e=O(e))}(this._delegate).then((e=>new Tb(e,this.storage)))}list(e){return function(e,t){return ib(e=O(e),t)}(this._delegate,e||void 0).then((e=>new Tb(e,this.storage)))}getMetadata(){return yb(this._delegate)}updateMetadata(e){return function(e,t){return sb(e=O(e),t)}(this._delegate,e)}getDownloadURL(){return function(e){return ob(e=O(e))}(this._delegate)}delete(){return this._throwIfRoot("delete"),function(e){return ab(e=O(e))}(this._delegate)}_throwIfRoot(e){if(""===this._delegate._location.path)throw Zw(e)}}class kb{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(Sb(e))throw Yw("ref() expected a child path but got a URL, use refFromURL instead.");return new Eb(vb(this._delegate,e),this)}refFromURL(e){if(!Sb(e))throw Yw("refFromURL() expected a full URL but got a child path, use ref() instead.");try{n_.makeFromUrl(e,this._delegate.host)}catch(t){throw Yw("refFromUrl() expected a valid full URL but got an invalid one.")}return new Eb(vb(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){wb(this._delegate,e,t,n)}}function Sb(e){return/^[A-Za-z]+:\/\//.test(e)}function Ab(e,{instanceIdentifier:t}){const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("storage").getImmediate({identifier:t});return new kb(n,r)}!function(e){const t={TaskState:W_,TaskEvent:H_,StringFormat:m_,Storage:kb,Reference:Eb};e.INTERNAL.registerComponent(new P("storage-compat",Ab,"PUBLIC").setServiceProps(t).setMultipleInstances(!0)),e.registerVersion("@firebase/storage-compat","0.1.9")}(we);var Cb=we.initializeApp({apiKey:"AIzaSyCPGqmziPBIQahzwiDg9w95w0qzKDlpH3k",authDomain:"npotw-production.firebaseapp.com",databaseURL:"https://npotw-production-default-rtdb.europe-west1.firebasedatabase.app",projectId:"npotw-production",storageBucket:"npotw-production.appspot.com",messagingSenderId:"938102620349",appId:"1:938102620349:web:63c556beb2e8f3486cb7d4",measurementId:"G-NS4D0MNEQV"}),Rb=Cb.auth(),Nb=s.createContext();function Db(){return(0,s.useContext)(Nb)}function Ob(e){var t=e.children,n=(0,s.useState)(),r=n[0],o=n[1],a=(0,s.useState)(!0),c=a[0],u=a[1];(0,s.useEffect)((function(){return Rb.onAuthStateChanged((function(e){o(e),u(!1)}))}),[]);var h={currentUser:r,login:function(e,t){return Rb.signInWithEmailAndPassword(e,t)},signup:function(e,t){return Rb.createUserWithEmailAndPassword(e,t)},logout:function(){return Rb.signOut()},resetPassword:function(e){return Rb.sendPasswordResetEmail(e)}};return(0,i.jsx)(Nb.Provider,{value:h,children:!c&&t})}},8510:function(e,t,n){"use strict";n.r(t);var r=n(5893),i=(n(906),n(5819));function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){s(e,t,n[t])}))}return e}t.default=function(e){var t=e.Component,n=e.pageProps;return(0,r.jsx)(i.Z,{children:(0,r.jsx)(t,o({},n))})}},906:function(){},7663:function(e){!function(){var t={162:function(e){var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"===typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var a,c=[],u=!1,h=-1;function l(){u&&a&&(u=!1,a.length?c=a.concat(c):h=-1,c.length&&d())}function d(){if(!u){var e=o(l);u=!0;for(var t=c.length;t;){for(a=c,c=[];++h<t;)a&&a[h].run();h=-1,t=c.length}a=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||o(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}},o=!0;try{t[e](s,s.exports,r),o=!1}finally{o&&delete n[e]}return s.exports}r.ab="//";var i=r(162);e.exports=i}()}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[774,179],(function(){return t(1780),t(387)}));var n=e.O();_N_E=n}]);