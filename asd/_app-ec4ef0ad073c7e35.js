(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{1294:function(e,t,n){"use strict";n.d(t,{u7:function(){return Tf},Jj:function(){return vd},IX:function(){return rd},my:function(){return Wl},xU:function(){return Yd},Lz:function(){return yd},WA:function(){return Lr},F8:function(){return _d},$q:function(){return Xd},W:function(){return Zd},EK:function(){return Yr},PU:function(){return Sf},l7:function(){return xl},Ky:function(){return wi},Xb:function(){return si},Cf:function(){return jl},K9:function(){return Or},Me:function(){return ai},yq:function(){return Cr},Wi:function(){return Ul},ET:function(){return Ff},Ab:function(){return Gf},vr:function(){return Hf},Fc:function(){return hd},hJ:function(){return Ql},B$:function(){return Jl},at:function(){return Kl},oe:function(){return Uf},AK:function(){return Kf},TF:function(){return fd},JU:function(){return Yl},ST:function(){return ad},fH:function(){return cd},Ix:function(){return dd},Wu:function(){return vf},Lx:function(){return yf},qY:function(){return sd},GL:function(){return jf},QT:function(){return Cf},kl:function(){return Nf},Xk:function(){return Df},PL:function(){return Of},UQ:function(){return Pf},zN:function(){return xf},nP:function(){return Qf},b9:function(){return lf},vh:function(){return df},Pb:function(){return pd},L$:function(){return md},cf:function(){return Vf},sc:function(){return qf},Xo:function(){return uf},IO:function(){return sf},iE:function(){return Zl},Eo:function(){return Xl},i3:function(){return $f},Bt:function(){return Wf},pl:function(){return Lf},Ub:function(){return kr},qK:function(){return tf},TQ:function(){return mf},e0:function(){return pf},r7:function(){return Mf},Mx:function(){return ld},ar:function(){return af}});var r,i=n(2238),s=n(8463),o=n(3333),a=n(4444),c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},u={},h=h||{},l=c||self;function d(){}function f(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function p(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var m="closure_uid_"+(1e9*Math.random()>>>0),g=0;function y(e,t,n){return e.call.apply(e.bind,arguments)}function v(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function w(e,t,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:v).apply(null,arguments)}function _(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function b(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function I(){this.s=this.s,this.o=this.o}var T={};I.prototype.s=!1,I.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,m)&&e[m]||(e[m]=++g)}(this);delete T[e]}},I.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const E=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},k=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const r=e.length,i="string"===typeof e?e.split(""):e;for(let s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function S(e){return Array.prototype.concat.apply([],arguments)}function A(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function C(e){return/^[\s\xa0]*$/.test(e)}var R,N=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function D(e,t){return-1!=e.indexOf(t)}function O(e,t){return e<t?-1:e>t?1:0}e:{var P=l.navigator;if(P){var x=P.userAgent;if(x){R=x;break e}}R=""}function L(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function M(e){const t={};for(const n in e)t[n]=e[n];return t}var U="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function F(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<U.length;t++)n=U[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function V(e){return V[" "](e),e}V[" "]=d;var q,j=D(R,"Opera"),B=D(R,"Trident")||D(R,"MSIE"),z=D(R,"Edge"),$=z||B,K=D(R,"Gecko")&&!(D(R.toLowerCase(),"webkit")&&!D(R,"Edge"))&&!(D(R,"Trident")||D(R,"MSIE"))&&!D(R,"Edge"),W=D(R.toLowerCase(),"webkit")&&!D(R,"Edge");function H(){var e=l.document;return e?e.documentMode:void 0}e:{var G="",Q=function(){var e=R;return K?/rv:([^\);]+)(\)|;)/.exec(e):z?/Edge\/([\d\.]+)/.exec(e):B?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):W?/WebKit\/(\S+)/.exec(e):j?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(Q&&(G=Q?Q[1]:""),B){var J=H();if(null!=J&&J>parseFloat(G)){q=String(J);break e}}q=G}var Y,X={};function Z(){return function(e){var t=X;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}((function(){let e=0;const t=N(String(q)).split("."),n=N("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=O(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||O(0==i[2].length,0==s[2].length)||O(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}))}if(l.document&&B){var ee=H();Y=ee||(parseInt(q,10)||void 0)}else Y=void 0;var te=Y,ne=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{l.addEventListener("test",d,t),l.removeEventListener("test",d,t)}catch(n){}return e}();function re(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function ie(e,t){if(re.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(K){e:{try{V(t.nodeName);var i=!0;break e}catch(s){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:se[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&ie.Z.h.call(this)}}re.prototype.h=function(){this.defaultPrevented=!0},b(ie,re);var se={2:"touch",3:"pen",4:"mouse"};ie.prototype.h=function(){ie.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var oe="closure_listenable_"+(1e6*Math.random()|0),ae=0;function ce(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++ae,this.ca=this.fa=!1}function ue(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function he(e){this.src=e,this.g={},this.h=0}function le(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=E(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(ue(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function de(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}he.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=de(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new ce(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var fe="closure_lm_"+(1e6*Math.random()|0),pe={};function me(e,t,n,r,i){if(r&&r.once)return ye(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)me(e,t[s],n,r,i);return null}return n=Ee(n),e&&e[oe]?e.N(t,n,p(r)?!!r.capture:!!r,i):ge(e,t,n,!1,r,i)}function ge(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=p(i)?!!i.capture:!!i,a=Ie(e);if(a||(e[fe]=a=new he(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}var t=be;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)ne||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(_e(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ye(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)ye(e,t[s],n,r,i);return null}return n=Ee(n),e&&e[oe]?e.O(t,n,p(r)?!!r.capture:!!r,i):ge(e,t,n,!0,r,i)}function ve(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)ve(e,t[s],n,r,i);else r=p(r)?!!r.capture:!!r,n=Ee(n),e&&e[oe]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=de(s=e.g[t],n,r,i))&&(ue(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--)))):e&&(e=Ie(e))&&(t=e.g[t.toString()],e=-1,t&&(e=de(t,n,r,i)),(n=-1<e?t[e]:null)&&we(n))}function we(e){if("number"!==typeof e&&e&&!e.ca){var t=e.src;if(t&&t[oe])le(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(_e(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Ie(t))?(le(n,e),0==n.h&&(n.src=null,t[fe]=null)):ue(e)}}}function _e(e){return e in pe?pe[e]:pe[e]="on"+e}function be(e,t){if(e.ca)e=!0;else{t=new ie(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&we(e),e=n.call(r,t)}return e}function Ie(e){return(e=e[fe])instanceof he?e:null}var Te="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ee(e){return"function"===typeof e?e:(e[Te]||(e[Te]=function(t){return e.handleEvent(t)}),e[Te])}function ke(){I.call(this),this.i=new he(this),this.P=this,this.I=null}function Se(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"===typeof t)t=new re(t,e);else if(t instanceof re)t.target=t.target||e;else{var i=t;F(t=new re(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=Ae(o,r,!0,t)&&i}if(i=Ae(o=t.g=e,r,!0,t)&&i,i=Ae(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=Ae(o=t.g=n[s],r,!1,t)&&i}function Ae(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&le(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}b(ke,I),ke.prototype[oe]=!0,ke.prototype.removeEventListener=function(e,t,n,r){ve(this,e,t,n,r)},ke.prototype.M=function(){if(ke.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)ue(n[r]);delete t.g[e],t.h--}}this.I=null},ke.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},ke.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Ce=l.JSON.stringify;function Re(){var e=Me;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Ne,De=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new Oe),(e=>e.reset()));class Oe{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Pe(e){l.setTimeout((()=>{throw e}),0)}function xe(e,t){Ne||function(){var e=l.Promise.resolve(void 0);Ne=function(){e.then(Ue)}}(),Le||(Ne(),Le=!0),Me.add(e,t)}var Le=!1,Me=new class{constructor(){this.h=this.g=null}add(e,t){const n=De.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Ue(){for(var e;e=Re();){try{e.h.call(e.g)}catch(n){Pe(n)}var t=De;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Le=!1}function Fe(e,t){ke.call(this),this.h=e||1,this.g=t||l,this.j=w(this.kb,this),this.l=Date.now()}function Ve(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function qe(e,t,n){if("function"===typeof e)n&&(e=w(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=w(e.handleEvent,e)}return 2147483647<Number(t)?-1:l.setTimeout(e,t||0)}function je(e){e.g=qe((()=>{e.g=null,e.i&&(e.i=!1,je(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}b(Fe,ke),(r=Fe.prototype).da=!1,r.S=null,r.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Se(this,"tick"),this.da&&(Ve(this),this.start()))}},r.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Fe.Z.M.call(this),Ve(this),delete this.g};class Be extends I{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:je(this)}M(){super.M(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ze(e){I.call(this),this.h=e,this.g={}}b(ze,I);var $e=[];function Ke(e,t,n,r){Array.isArray(n)||(n&&($e[0]=n.toString()),n=$e);for(var i=0;i<n.length;i++){var s=me(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function We(e){L(e.g,(function(e,t){this.g.hasOwnProperty(t)&&we(e)}),e),e.g={}}function He(){this.g=!0}function Ge(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Ce(n)}catch(a){return t}}(e,n)+(r?" "+r:"")}))}ze.prototype.M=function(){ze.Z.M.call(this),We(this)},ze.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},He.prototype.Aa=function(){this.g=!1},He.prototype.info=function(){};var Qe={},Je=null;function Ye(){return Je=Je||new ke}function Xe(e){re.call(this,Qe.Ma,e)}function Ze(e){const t=Ye();Se(t,new Xe(t,e))}function et(e,t){re.call(this,Qe.STAT_EVENT,e),this.stat=t}function tt(e){const t=Ye();Se(t,new et(t,e))}function nt(e,t){re.call(this,Qe.Na,e),this.size=t}function rt(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){e()}),t)}Qe.Ma="serverreachability",b(Xe,re),Qe.STAT_EVENT="statevent",b(et,re),Qe.Na="timingevent",b(nt,re);var it={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},st={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function ot(){}function at(e){return e.h||(e.h=e.i())}function ct(){}ot.prototype.h=null;var ut,ht={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function lt(){re.call(this,"d")}function dt(){re.call(this,"c")}function ft(){}function pt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new ze(this),this.P=gt,e=$?125:void 0,this.W=new Fe(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new mt}function mt(){this.i=null,this.g="",this.h=!1}b(lt,re),b(dt,re),b(ft,ot),ft.prototype.g=function(){return new XMLHttpRequest},ft.prototype.i=function(){return{}},ut=new ft;var gt=45e3,yt={},vt={};function wt(e,t,n){e.K=1,e.v=Bt(Mt(t)),e.s=n,e.U=!0,_t(e,null)}function _t(e,t){e.F=Date.now(),Et(e),e.A=Mt(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),tn(n.h,"t",r),e.C=0,n=e.l.H,e.h=new mt,e.g=rr(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Be(w(e.Ia,e,e.g),e.O)),Ke(e.V,e.g,"readystatechange",e.gb),t=e.H?M(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ze(1),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.X,e.s)}function bt(e){return!!e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function It(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=Tt(e,n),r==vt){4==t&&(e.o=4,tt(14),i=!1),Ge(e.j,e.m,null,"[Incomplete Response]");break}if(r==yt){e.o=4,tt(15),Ge(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}Ge(e.j,e.m,r,null),Rt(e,r)}bt(e)&&r!=vt&&r!=yt&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,tt(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qn(t),t.L=!0,tt(11))):(Ge(e.j,e.m,n,"[Invalid Chunked Response]"),Ct(e),At(e))}function Tt(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?vt:(n=Number(t.substring(n,r)),isNaN(n)?yt:(r+=1)+n>t.length?vt:(t=t.substr(r,n),e.C=r+n,t))}function Et(e){e.Y=Date.now()+e.P,kt(e,e.P)}function kt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=rt(w(e.eb,e),t)}function St(e){e.B&&(l.clearTimeout(e.B),e.B=null)}function At(e){0==e.l.G||e.I||Xn(e.l,e)}function Ct(e){St(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Ve(e.W),We(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Rt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||un(n.i,e)))if(n.I=e.N,!e.J&&un(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Yn(n),qn(n)}Gn(n),tt(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=rt(w(n.ab,n),6e3));if(1>=cn(n.i)&&n.ka){try{n.ka()}catch(u){}n.ka=void 0}}else er(n,11)}else if((e.J||n.g==e)&&Yn(n),!C(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const t=u[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const i=u[4];null!=i&&(n.za=i,n.h.info("SVER="+n.za));const h=u[5];null!=h&&"number"===typeof h&&0<h&&(r=1.5*h,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;!s.g&&(D(e,"spdy")||D(e,"quic")||D(e,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(hn(s,s.h),s.h=null))}if(r.D){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.sa=e,jt(r.F,r.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((r=n).oa=nr(r,r.H?r.la:null,r.W),o.J){ln(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(St(a),Et(a)),r.g=o}else Hn(r);0<n.l.length&&zn(n)}else"stop"!=u[0]&&"close"!=u[0]||er(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?er(n,7):Vn(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}Ze(4)}catch(u){}}function Nt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(f(e)||"string"===typeof e)k(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(f(e)||"string"===typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"===typeof e)return e.split("");if(f(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function Dt(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Dt)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function Ot(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];Pt(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)Pt(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function Pt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(r=pt.prototype).setTimeout=function(e){this.P=e},r.gb=function(e){e=e.target;const t=this.L;t&&3==xn(e)?t.l():this.Ia(e)},r.Ia=function(e){try{if(e==this.g)e:{const h=xn(this.g);var t=this.g.Da();const d=this.g.ba();if(!(3>h)&&(3!=h||$||this.g&&(this.h.h||this.g.ga()||Ln(this.g)))){this.I||4!=h||7==t||Ze(8==t||0>=d?3:2),St(this);var n=this.g.ba();this.N=n;t:if(bt(this)){var r=Ln(this.g);e="";var i=r.length,s=4==xn(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Ct(this),At(this);var o="";break t}this.h.i=new l.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.X,h,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,tt(12),Ct(this),At(this);break e}Ge(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Rt(this,n)}this.U?(It(this,h,o),$&&this.i&&3==h&&(Ke(this.V,this.W,"tick",this.fb),this.W.start())):(Ge(this.j,this.m,o,null),Rt(this,o)),4==h&&Ct(this),this.i&&!this.I&&(4==h?Xn(this.l,this):(this.i=!1,Et(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,tt(12)):(this.o=0,tt(13)),Ct(this),At(this)}}}catch(h){}},r.fb=function(){if(this.g){var e=xn(this.g),t=this.g.ga();this.C<t.length&&(St(this),It(this,e,t),this.i&&4!=e&&Et(this))}},r.cancel=function(){this.I=!0,Ct(this)},r.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(Ze(3),tt(17)),Ct(this),this.o=2,At(this)):kt(this,this.Y-e)},(r=Dt.prototype).R=function(){Ot(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},r.T=function(){return Ot(this),this.g.concat()},r.get=function(e,t){return Pt(this.h,e)?this.h[e]:t},r.set=function(e,t){Pt(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},r.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var xt=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Lt(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Lt){this.g=void 0!==t?t:e.g,Ut(this,e.j),this.s=e.s,Ft(this,e.i),Vt(this,e.m),this.l=e.l,t=e.h;var n=new Yt;n.i=t.i,t.g&&(n.g=new Dt(t.g),n.h=t.h),qt(this,n),this.o=e.o}else e&&(n=String(e).match(xt))?(this.g=!!t,Ut(this,n[1]||"",!0),this.s=zt(n[2]||""),Ft(this,n[3]||"",!0),Vt(this,n[4]),this.l=zt(n[5]||"",!0),qt(this,n[6]||"",!0),this.o=zt(n[7]||"")):(this.g=!!t,this.h=new Yt(null,this.g))}function Mt(e){return new Lt(e)}function Ut(e,t,n){e.j=n?zt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Ft(e,t,n){e.i=n?zt(t,!0):t}function Vt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function qt(e,t,n){t instanceof Yt?(e.h=t,function(e,t){t&&!e.j&&(Xt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Zt(this,t),tn(this,n,e))}),e)),e.j=t}(e.h,e.g)):(n||(t=$t(t,Qt)),e.h=new Yt(t,e.g))}function jt(e,t,n){e.h.set(t,n)}function Bt(e){return jt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function zt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function $t(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,Kt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Kt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Lt.prototype.toString=function(){var e=[],t=this.j;t&&e.push($t(t,Wt,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push($t(t,Wt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push($t(n,"/"==n.charAt(0)?Gt:Ht,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",$t(n,Jt)),e.join("")};var Wt=/[#\/\?@]/g,Ht=/[#\?:]/g,Gt=/[#\?]/g,Qt=/[#\?@]/g,Jt=/#/g;function Yt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Xt(e){e.g||(e.g=new Dt,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Zt(e,t){Xt(e),t=nn(e,t),Pt(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Pt((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&Ot(e)))}function en(e,t){return Xt(e),t=nn(e,t),Pt(e.g.h,t)}function tn(e,t,n){Zt(e,t),0<n.length&&(e.i=null,e.g.set(nn(e,t),A(n)),e.h+=n.length)}function nn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(r=Yt.prototype).add=function(e,t){Xt(this),this.i=null,e=nn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){Xt(this),this.g.forEach((function(n,r){k(n,(function(n){e.call(t,n,r,this)}),this)}),this)},r.T=function(){Xt(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},r.R=function(e){Xt(this);var t=[];if("string"===typeof e)en(this,e)&&(t=S(t,this.g.get(nn(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=S(t,e[n])}return t},r.set=function(e,t){return Xt(this),this.i=null,en(this,e=nn(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}}return this.i=e.join("&")};function rn(e){this.l=e||on,l.PerformanceNavigationTiming?e=0<(e=l.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(l.g&&l.g.Ea&&l.g.Ea()&&l.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var sn,on=10;function an(e){return!!e.h||!!e.g&&e.g.size>=e.j}function cn(e){return e.h?1:e.g?e.g.size:0}function un(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function hn(e,t){e.g?e.g.add(t):e.h=t}function ln(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function dn(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return A(e.i)}function fn(){}function pn(){this.g=new fn}function mn(e,t,n){const r=n||"";try{Nt(e,(function(e,n){let i=e;p(e)&&(i=Ce(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function gn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(s){}}function yn(e){this.l=e.$b||null,this.j=e.ib||!1}function vn(e,t){ke.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=wn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}rn.prototype.cancel=function(){if(this.i=dn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},fn.prototype.stringify=function(e){return l.JSON.stringify(e,void 0)},fn.prototype.parse=function(e){return l.JSON.parse(e,void 0)},b(yn,ot),yn.prototype.g=function(){return new vn(this.l,this.j)},yn.prototype.i=(sn={},function(){return sn}),b(vn,ke);var wn=0;function _n(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function bn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,In(e)}function In(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(r=vn.prototype).open=function(e,t){if(this.readyState!=wn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,In(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||l).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,bn(this)),this.readyState=wn},r.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,In(this)),this.g&&(this.readyState=3,In(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if("undefined"!==typeof l.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;_n(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},r.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?bn(this):In(this),3==this.readyState&&_n(this)}},r.Ua=function(e){this.g&&(this.response=this.responseText=e,bn(this))},r.Ta=function(e){this.g&&(this.response=e,bn(this))},r.ha=function(){this.g&&bn(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(vn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Tn=l.JSON.parse;function En(e){ke.call(this),this.headers=new Dt,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=kn,this.K=this.L=!1}b(En,ke);var kn="",Sn=/^https?$/i,An=["POST","PUT"];function Cn(e){return"content-type"==e.toLowerCase()}function Rn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Nn(e),On(e)}function Nn(e){e.D||(e.D=!0,Se(e,"complete"),Se(e,"error"))}function Dn(e){if(e.h&&"undefined"!=typeof h&&(!e.C[1]||4!=xn(e)||2!=e.ba()))if(e.v&&4==xn(e))qe(e.Fa,0,e);else if(Se(e,"readystatechange"),4==xn(e)){e.h=!1;try{const c=e.ba();e:switch(c){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===c){var i=String(e.H).match(xt)[1]||null;if(!i&&l.self&&l.self.location){var s=l.self.location.protocol;i=s.substr(0,s.length-1)}r=!Sn.test(i?i.toLowerCase():"")}n=r}if(n)Se(e,"complete"),Se(e,"success");else{e.m=6;try{var o=2<xn(e)?e.g.statusText:""}catch(a){o=""}e.j=o+" ["+e.ba()+"]",Nn(e)}}finally{On(e)}}}function On(e,t){if(e.g){Pn(e);const r=e.g,i=e.C[0]?d:null;e.g=null,e.C=null,t||Se(e,"ready");try{r.onreadystatechange=i}catch(n){}}}function Pn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(l.clearTimeout(e.A),e.A=null)}function xn(e){return e.g?e.g.readyState:0}function Ln(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case kn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Mn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let t="";return L(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):jt(e,t,n))}function Un(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Fn(e){this.za=0,this.l=[],this.h=new He,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Un("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Un("baseRetryDelayMs",5e3,e),this.$a=Un("retryDelaySeedMs",1e4,e),this.Ya=Un("forwardChannelMaxRetries",2,e),this.ra=Un("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new rn(e&&e.concurrentRequestLimit),this.Ca=new pn,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function Vn(e){if(jn(e),3==e.G){var t=e.V++,n=Mt(e.F);jt(n,"SID",e.J),jt(n,"RID",t),jt(n,"TYPE","terminate"),Kn(e,n),(t=new pt(e,e.h,t,void 0)).K=2,t.v=Bt(Mt(n)),n=!1,l.navigator&&l.navigator.sendBeacon&&(n=l.navigator.sendBeacon(t.v.toString(),"")),!n&&l.Image&&((new Image).src=t.v,n=!0),n||(t.g=rr(t.l,null),t.g.ea(t.v)),t.F=Date.now(),Et(t)}tr(e)}function qn(e){e.g&&(Qn(e),e.g.cancel(),e.g=null)}function jn(e){qn(e),e.u&&(l.clearTimeout(e.u),e.u=null),Yn(e),e.i.cancel(),e.m&&("number"===typeof e.m&&l.clearTimeout(e.m),e.m=null)}function Bn(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&zn(e)}function zn(e){an(e.i)||e.m||(e.m=!0,xe(e.Ha,e),e.C=0)}function $n(e,t){var n;n=t?t.m:e.V++;const r=Mt(e.F);jt(r,"SID",e.J),jt(r,"RID",n),jt(r,"AID",e.U),Kn(e,r),e.o&&e.s&&Mn(r,e.o,e.s),n=new pt(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=Wn(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),hn(e.i,n),wt(n,r,t)}function Kn(e,t){e.j&&Nt({},(function(e,n){jt(t,n,e)}))}function Wn(e,t,n){n=Math.min(e.l.length,n);var r=e.j?w(e.j.Oa,e.j,e):null;e:{var i=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{mn(a,e,"req"+n+"_")}catch(Ur){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,r}function Hn(e){e.g||e.u||(e.Y=1,xe(e.Ga,e),e.A=0)}function Gn(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=rt(w(e.Ga,e),Zn(e,e.A)),e.A++,!0)}function Qn(e){null!=e.B&&(l.clearTimeout(e.B),e.B=null)}function Jn(e){e.g=new pt(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Mt(e.oa);jt(t,"RID","rpc"),jt(t,"SID",e.J),jt(t,"CI",e.N?"0":"1"),jt(t,"AID",e.U),Kn(e,t),jt(t,"TYPE","xmlhttp"),e.o&&e.s&&Mn(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=Bt(Mt(t)),n.s=null,n.U=!0,_t(n,e)}function Yn(e){null!=e.v&&(l.clearTimeout(e.v),e.v=null)}function Xn(e,t){var n=null;if(e.g==t){Yn(e),Qn(e),e.g=null;var r=2}else{if(!un(e.i,t))return;n=t.D,ln(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;Se(r=Ye(),new nt(r,n,t,i)),zn(e)}else Hn(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(cn(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.l=t.D.concat(e.l),!0):!(1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya))&&(e.m=rt(w(e.Ha,e,t),Zn(e,e.C)),e.C++,!0))}(e,t)||2==r&&Gn(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:er(e,5);break;case 4:er(e,10);break;case 3:er(e,6);break;default:er(e,2)}}function Zn(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function er(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=w(e.jb,e);n||(n=new Lt("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Ut(n,"https"),Bt(n)),function(e,t){const n=new He;if(l.Image){const r=new Image;r.onload=_(gn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=_(gn,n,r,"TestLoadImage: error",!1,t),r.onabort=_(gn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=_(gn,n,r,"TestLoadImage: timeout",!1,t),l.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else tt(2);e.G=0,e.j&&e.j.va(t),tr(e),jn(e)}function tr(e){e.G=0,e.I=-1,e.j&&(0==dn(e.i).length&&0==e.l.length||(e.i.i.length=0,A(e.l),e.l.length=0),e.j.ua())}function nr(e,t,n){let r=function(e){return e instanceof Lt?Mt(e):new Lt(e,void 0)}(n);if(""!=r.i)t&&Ft(r,t+"."+r.i),Vt(r,r.m);else{const e=l.location;r=function(e,t,n,r){var i=new Lt(null,void 0);return e&&Ut(i,e),t&&Ft(i,t),n&&Vt(i,n),r&&(i.l=r),i}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&L(e.aa,(function(e,t){jt(r,t,e)})),t=e.D,n=e.sa,t&&n&&jt(r,t,n),jt(r,"VER",e.ma),Kn(e,r),r}function rr(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new En(new yn({ib:!0})):new En(e.qa)).L=e.H,t}function ir(){}function sr(){if(B&&!(10<=Number(te)))throw Error("Environmental error: no available transport.")}function or(e,t){ke.call(this),this.g=new Fn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!C(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!C(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new ur(this)}function ar(e){lt.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function cr(){dt.call(this),this.status=1}function ur(e){this.g=e}(r=En.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ut.g(),this.C=this.u?at(this.u):at(ut),this.g.onreadystatechange=w(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){return void Rn(this,s)}e=n||"";const i=new Dt(this.headers);r&&Nt(r,(function(e,t){i.set(t,e)})),r=function(e){e:{var t=Cn;const n=e.length,r="string"===typeof e?e.split(""):e;for(let i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"===typeof e?e.charAt(t):e[t]}(i.T()),n=l.FormData&&e instanceof l.FormData,!(0<=E(An,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(e,t){this.g.setRequestHeader(t,e)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Pn(this),0<this.B&&((this.K=function(e){return B&&Z()&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=w(this.pa,this)):this.A=qe(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){Rn(this,s)}},r.pa=function(){"undefined"!=typeof h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Se(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Se(this,"complete"),Se(this,"abort"),On(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),On(this,!0)),En.Z.M.call(this)},r.Fa=function(){this.s||(this.F||this.v||this.l?Dn(this):this.cb())},r.cb=function(){Dn(this)},r.ba=function(){try{return 2<xn(this)?this.g.status:-1}catch(sn){return-1}},r.ga=function(){try{return this.g?this.g.responseText:""}catch(sn){return""}},r.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Tn(t)}},r.Da=function(){return this.m},r.La=function(){return"string"===typeof this.j?this.j:String(this.j)},(r=Fn.prototype).ma=8,r.G=1,r.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}},r.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new pt(this,this.h,e,void 0);let s=this.s;if(this.P&&(s?(s=M(s),F(s,this.P)):s=this.P),null===this.o&&(i.H=s),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"===typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Wn(this,i,t),jt(n=Mt(this.F),"RID",e),jt(n,"CVER",22),this.D&&jt(n,"X-HTTP-Session-Id",this.D),Kn(this,n),this.o&&s&&Mn(n,this.o,s),hn(this.i,i),this.Ra&&jt(n,"TYPE","init"),this.ja?(jt(n,"$req",t),jt(n,"SID","null"),i.$=!0,wt(i,n,null)):wt(i,n,t),this.G=2}}else 3==this.G&&(e?$n(this,e):0==this.l.length||an(this.i)||$n(this))},r.Ga=function(){if(this.u=null,Jn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=rt(w(this.bb,this),e)}},r.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,tt(10),qn(this),Jn(this))},r.ab=function(){null!=this.v&&(this.v=null,qn(this),Gn(this),tt(19))},r.jb=function(e){e?(this.h.info("Successfully pinged google.com"),tt(2)):(this.h.info("Failed to ping google.com"),tt(1))},(r=ir.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Oa=function(){},sr.prototype.g=function(e,t){return new or(e,t)},b(or,ke),or.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),xe(w(e.hb,e,t))),tt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=nr(e,null,e.W),zn(e)},or.prototype.close=function(){Vn(this.g)},or.prototype.u=function(e){if("string"===typeof e){var t={};t.__data__=e,Bn(this.g,t)}else this.v?((t={}).__data__=Ce(e),Bn(this.g,t)):Bn(this.g,e)},or.prototype.M=function(){this.g.j=null,delete this.j,Vn(this.g),delete this.g,or.Z.M.call(this)},b(ar,lt),b(cr,dt),b(ur,ir),ur.prototype.xa=function(){Se(this.g,"a")},ur.prototype.wa=function(e){Se(this.g,new ar(e))},ur.prototype.va=function(e){Se(this.g,new cr(e))},ur.prototype.ua=function(){Se(this.g,"b")},sr.prototype.createWebChannel=sr.prototype.g,or.prototype.send=or.prototype.u,or.prototype.open=or.prototype.m,or.prototype.close=or.prototype.close,it.NO_ERROR=0,it.TIMEOUT=8,it.HTTP_ERROR=6,st.COMPLETE="complete",ct.EventType=ht,ht.OPEN="a",ht.CLOSE="b",ht.ERROR="c",ht.MESSAGE="d",ke.prototype.listen=ke.prototype.N,En.prototype.listenOnce=En.prototype.O,En.prototype.getLastError=En.prototype.La,En.prototype.getLastErrorCode=En.prototype.Da,En.prototype.getStatus=En.prototype.ba,En.prototype.getResponseJson=En.prototype.Qa,En.prototype.getResponseText=En.prototype.ga,En.prototype.send=En.prototype.ea;var hr=u.createWebChannelTransport=function(){return new sr},lr=u.getStatEventTarget=function(){return Ye()},dr=u.ErrorCode=it,fr=u.EventType=st,pr=u.Event=Qe,mr=u.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},gr=u.FetchXmlHttpFactory=yn,yr=u.WebChannel=ct,vr=u.XhrIo=En,wr=n(3454);const _r="@firebase/firestore";class br{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}br.UNAUTHENTICATED=new br(null),br.GOOGLE_CREDENTIALS=new br("google-credentials-uid"),br.FIRST_PARTY=new br("first-party-uid"),br.MOCK_USER=new br("mock-user");let Ir="9.6.3";const Tr=new o.Yd("@firebase/firestore");function Er(){return Tr.logLevel}function kr(e){Tr.setLogLevel(e)}function Sr(e,...t){if(Tr.logLevel<=o.in.DEBUG){const n=t.map(Rr);Tr.debug(`Firestore (${Ir}): ${e}`,...n)}}function Ar(e,...t){if(Tr.logLevel<=o.in.ERROR){const n=t.map(Rr);Tr.error(`Firestore (${Ir}): ${e}`,...n)}}function Cr(e,...t){if(Tr.logLevel<=o.in.WARN){const n=t.map(Rr);Tr.warn(`Firestore (${Ir}): ${e}`,...n)}}function Rr(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Nr(e="Unexpected state"){const t=`FIRESTORE (${Ir}) INTERNAL ASSERTION FAILED: `+e;throw Ar(t),new Error(t)}function Dr(e,t){e||Nr()}function Or(e,t){e||Nr()}function Pr(e,t){return e}const xr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Lr extends a.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Mr{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Ur{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Fr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(br.UNAUTHENTICATED)))}shutdown(){}}class Vr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class qr{constructor(e){this.t=e,this.currentUser=br.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Mr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Mr,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{Sr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Sr("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Mr)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Sr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Dr("string"==typeof t.accessToken),new Ur(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Dr(null===e||"string"==typeof e),new br(e)}}class jr{constructor(e,t,n){this.type="FirstParty",this.user=br.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class Br{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new jr(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(br.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class zr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class $r{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null}start(e,t){this.o=n=>{e.enqueueRetryable((()=>(e=>(null!=e.error&&Sr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`),t(e.token)))(n)))};const n=e=>{Sr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit((e=>n(e))),setTimeout((()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?n(e):Sr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(Dr("string"==typeof e.token),new zr(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Kr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.p(e),this.T=e=>t.writeSequenceNumber(e))}p(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function Wr(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}Kr.I=-1;class Hr{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=Wr(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function Gr(e,t){return e<t?-1:e>t?1:0}function Qr(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function Jr(e){return e+"\0"}class Yr{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Lr(xr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Lr(xr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Lr(xr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Lr(xr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Yr.fromMillis(Date.now())}static fromDate(e){return Yr.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Yr(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Gr(this.nanoseconds,e.nanoseconds):Gr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Xr{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Xr(e)}static min(){return new Xr(new Yr(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Zr(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ei(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ti(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class ni{constructor(e,t,n){void 0===t?t=0:t>e.length&&Nr(),void 0===n?n=e.length-t:n>e.length-t&&Nr(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ni.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ni?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ri extends ni{construct(e,t,n){return new ri(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new Lr(xr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new ri(t)}static emptyPath(){return new ri([])}}const ii=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class si extends ni{construct(e,t,n){return new si(e,t,n)}static isValidIdentifier(e){return ii.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),si.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new si(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Lr(xr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new Lr(xr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Lr(xr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new Lr(xr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new si(t)}static emptyPath(){return new si([])}}class oi{constructor(e){this.fields=e,e.sort(si.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Qr(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}function ai(){return"undefined"!=typeof atob}class ci{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new ci(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new ci(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Gr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ci.EMPTY_BYTE_STRING=new ci("");const ui=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hi(e){if(Dr(!!e),"string"==typeof e){let t=0;const n=ui.exec(e);if(Dr(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:li(e.seconds),nanos:li(e.nanos)}}function li(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function di(e){return"string"==typeof e?ci.fromBase64String(e):ci.fromUint8Array(e)}function fi(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function pi(e){const t=e.mapValue.fields.__previous_value__;return fi(t)?pi(t):t}function mi(e){const t=hi(e.mapValue.fields.__local_write_time__.timestampValue);return new Yr(t.seconds,t.nanos)}function gi(e){return null==e}function yi(e){return 0===e&&1/e==-1/0}function vi(e){return"number"==typeof e&&Number.isInteger(e)&&!yi(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class wi{constructor(e){this.path=e}static fromPath(e){return new wi(ri.fromString(e))}static fromName(e){return new wi(ri.fromString(e).popFirst(5))}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}isEqual(e){return null!==e&&0===ri.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ri.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new wi(new ri(e.slice()))}}function _i(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?fi(e)?4:10:Nr()}function bi(e,t){if(e===t)return!0;const n=_i(e);if(n!==_i(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return mi(e).isEqual(mi(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=hi(e.timestampValue),r=hi(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return di(e.bytesValue).isEqual(di(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return li(e.geoPointValue.latitude)===li(t.geoPointValue.latitude)&&li(e.geoPointValue.longitude)===li(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return li(e.integerValue)===li(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=li(e.doubleValue),r=li(t.doubleValue);return n===r?yi(n)===yi(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Qr(e.arrayValue.values||[],t.arrayValue.values||[],bi);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Zr(n)!==Zr(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!bi(n[i],r[i])))return!1;return!0}(e,t);default:return Nr()}}function Ii(e,t){return void 0!==(e.values||[]).find((e=>bi(e,t)))}function Ti(e,t){if(e===t)return 0;const n=_i(e),r=_i(t);if(n!==r)return Gr(n,r);switch(n){case 0:return 0;case 1:return Gr(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=li(e.integerValue||e.doubleValue),r=li(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Ei(e.timestampValue,t.timestampValue);case 4:return Ei(mi(e),mi(t));case 5:return Gr(e.stringValue,t.stringValue);case 6:return function(e,t){const n=di(e),r=di(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=Gr(n[i],r[i]);if(0!==e)return e}return Gr(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Gr(li(e.latitude),li(t.latitude));return 0!==n?n:Gr(li(e.longitude),li(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=Ti(n[i],r[i]);if(e)return e}return Gr(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){const e=Gr(r[o],s[o]);if(0!==e)return e;const t=Ti(n[r[o]],i[s[o]]);if(0!==t)return t}return Gr(r.length,s.length)}(e.mapValue,t.mapValue);default:throw Nr()}}function Ei(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Gr(e,t);const n=hi(e),r=hi(t),i=Gr(n.seconds,r.seconds);return 0!==i?i:Gr(n.nanos,r.nanos)}function ki(e){return Si(e)}function Si(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=hi(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?di(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,wi.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Si(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Si(e.fields[i])}`;return n+"}"}(e.mapValue):Nr();var t,n}function Ai(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Ci(e){return!!e&&"integerValue"in e}function Ri(e){return!!e&&"arrayValue"in e}function Ni(e){return!!e&&"nullValue"in e}function Di(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Oi(e){return!!e&&"mapValue"in e}function Pi(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return ei(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Pi(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Pi(e.arrayValue.values[n]);return t}return Object.assign({},e)}class xi{constructor(e){this.value=e}static empty(){return new xi({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Oi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Pi(t)}setAll(e){let t=si.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Pi(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Oi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return bi(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Oi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){ei(t,((t,n)=>e[t]=n));for(const r of n)delete e[r]}clone(){return new xi(Pi(this.value))}}function Li(e){const t=[];return ei(e.fields,((e,n)=>{const r=new si([e]);if(Oi(n)){const e=Li(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new oi(t)}class Mi{constructor(e,t,n,r,i){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=i}static newInvalidDocument(e){return new Mi(e,0,Xr.min(),xi.empty(),0)}static newFoundDocument(e,t,n){return new Mi(e,1,t,n,0)}static newNoDocument(e,t){return new Mi(e,2,t,xi.empty(),0)}static newUnknownDocument(e,t){return new Mi(e,3,t,xi.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=xi.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=xi.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Mi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Mi(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ui{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.R=null}}function Fi(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Ui(e,t,n,r,i,s,o)}function Vi(e){const t=Pr(e);if(null===t.R){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>function(e){return e.field.canonicalString()+e.op.toString()+ki(e.value)}(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),gi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=Xi(t.startAt)),t.endAt&&(e+="|ub:",e+=Xi(t.endAt)),t.R=e}return t.R}function qi(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++)if(!es(e.orderBy[i],t.orderBy[i]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if(n=e.filters[i],r=t.filters[i],n.op!==r.op||!n.field.isEqual(r.field)||!bi(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ns(e.startAt,t.startAt)&&ns(e.endAt,t.endAt)}function ji(e){return wi.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Bi extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,n):new zi(e,t,n):"array-contains"===t?new Hi(e,n):"in"===t?new Gi(e,n):"not-in"===t?new Qi(e,n):"array-contains-any"===t?new Ji(e,n):new Bi(e,t,n)}static P(e,t,n){return"in"===t?new $i(e,n):new Ki(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(Ti(t,this.value)):null!==t&&_i(this.value)===_i(t)&&this.v(Ti(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Nr()}}V(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class zi extends Bi{constructor(e,t,n){super(e,t,n),this.key=wi.fromName(n.referenceValue)}matches(e){const t=wi.comparator(e.key,this.key);return this.v(t)}}class $i extends Bi{constructor(e,t){super(e,"in",t),this.keys=Wi("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Ki extends Bi{constructor(e,t){super(e,"not-in",t),this.keys=Wi("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Wi(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>wi.fromName(e.referenceValue)))}class Hi extends Bi{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ri(t)&&Ii(t.arrayValue,this.value)}}class Gi extends Bi{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Ii(this.value.arrayValue,t)}}class Qi extends Bi{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ii(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Ii(this.value.arrayValue,t)}}class Ji extends Bi{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ri(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Ii(this.value.arrayValue,e)))}}class Yi{constructor(e,t){this.position=e,this.before=t}}function Xi(e){return`${e.before?"b":"a"}:${e.position.map((e=>ki(e))).join(",")}`}class Zi{constructor(e,t="asc"){this.field=e,this.dir=t}}function es(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function ts(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?wi.comparator(wi.fromName(o.referenceValue),n.key):Ti(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function ns(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!bi(e.position[n],t.position[n]))return!1;return!0}class rs{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.S=null,this.D=null,this.startAt,this.endAt}}function is(e,t,n,r,i,s,o,a){return new rs(e,t,n,r,i,s,o,a)}function ss(e){return new rs(e)}function os(e){return!gi(e.limit)&&"F"===e.limitType}function as(e){return!gi(e.limit)&&"L"===e.limitType}function cs(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function us(e){for(const t of e.filters)if(t.V())return t.field;return null}function hs(e){return null!==e.collectionGroup}function ls(e){const t=Pr(e);if(null===t.S){t.S=[];const e=us(t),n=cs(t);if(null!==e&&null===n)e.isKeyField()||t.S.push(new Zi(e)),t.S.push(new Zi(si.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.S.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.S.push(new Zi(si.keyField(),e))}}}return t.S}function ds(e){const t=Pr(e);if(!t.D)if("F"===t.limitType)t.D=Fi(t.path,t.collectionGroup,ls(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const i of ls(t)){const t="desc"===i.dir?"asc":"desc";e.push(new Zi(i.field,t))}const n=t.endAt?new Yi(t.endAt.position,!t.endAt.before):null,r=t.startAt?new Yi(t.startAt.position,!t.startAt.before):null;t.D=Fi(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.D}function fs(e,t,n){return new rs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ps(e,t){return qi(ds(e),ds(t))&&e.limitType===t.limitType}function ms(e){return`${Vi(ds(e))}|lt:${e.limitType}`}function gs(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>{return`${(t=e).field.canonicalString()} ${t.op} ${ki(t.value)}`;var t})).join(", ")}]`),gi(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: "+Xi(e.startAt)),e.endAt&&(t+=", endAt: "+Xi(e.endAt)),`Target(${t})`}(ds(e))}; limitType=${e.limitType})`}function ys(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):wi.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!ts(e.startAt,ls(e),t))&&(!e.endAt||!ts(e.endAt,ls(e),t))}(e,t)}function vs(e){return(t,n)=>{let r=!1;for(const i of ls(e)){const e=ws(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function ws(e,t,n){const r=e.field.isKeyField()?wi.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?Ti(r,i):Nr()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Nr()}}function _s(e,t){if(e.C){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:yi(t)?"-0":t}}function bs(e){return{integerValue:""+e}}function Is(e,t){return vi(t)?bs(t):_s(e,t)}class Ts{constructor(){this._=void 0}}function Es(e,t,n){return e instanceof As?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Cs?Rs(e,t):e instanceof Ns?Ds(e,t):function(e,t){const n=Ss(e,t),r=Ps(n)+Ps(e.N);return Ci(n)&&Ci(e.N)?bs(r):_s(e.k,r)}(e,t)}function ks(e,t,n){return e instanceof Cs?Rs(e,t):e instanceof Ns?Ds(e,t):n}function Ss(e,t){return e instanceof Os?Ci(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class As extends Ts{}class Cs extends Ts{constructor(e){super(),this.elements=e}}function Rs(e,t){const n=xs(t);for(const r of e.elements)n.some((e=>bi(e,r)))||n.push(r);return{arrayValue:{values:n}}}class Ns extends Ts{constructor(e){super(),this.elements=e}}function Ds(e,t){let n=xs(t);for(const r of e.elements)n=n.filter((e=>!bi(e,r)));return{arrayValue:{values:n}}}class Os extends Ts{constructor(e,t){super(),this.k=e,this.N=t}}function Ps(e){return li(e.integerValue||e.doubleValue)}function xs(e){return Ri(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ls{constructor(e,t){this.field=e,this.transform=t}}class Ms{constructor(e,t){this.version=e,this.transformResults=t}}class Us{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Us}static exists(e){return new Us(void 0,e)}static updateTime(e){return new Us(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Fs(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Vs{}function qs(e,t,n){e instanceof Ks?function(e,t,n){const r=e.value.clone(),i=Gs(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Ws?function(e,t,n){if(!Fs(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=Gs(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Hs(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function js(e,t,n){e instanceof Ks?function(e,t,n){if(!Fs(e.precondition,t))return;const r=e.value.clone(),i=Qs(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument($s(t),r).setHasLocalMutations()}(e,t,n):e instanceof Ws?function(e,t,n){if(!Fs(e.precondition,t))return;const r=Qs(e.fieldTransforms,n,t),i=t.data;i.setAll(Hs(e)),i.setAll(r),t.convertToFoundDocument($s(t),i).setHasLocalMutations()}(e,t,n):function(e,t){Fs(e.precondition,t)&&t.convertToNoDocument(Xr.min())}(e,t)}function Bs(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Ss(r.transform,e||null);null!=i&&(null==n&&(n=xi.empty()),n.set(r.field,i))}return n||null}function zs(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Qr(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Cs&&t instanceof Cs||e instanceof Ns&&t instanceof Ns?Qr(e.elements,t.elements,bi):e instanceof Os&&t instanceof Os?bi(e.N,t.N):e instanceof As&&t instanceof As}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function $s(e){return e.isFoundDocument()?e.version:Xr.min()}class Ks extends Vs{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class Ws extends Vs{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function Hs(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function Gs(e,t,n){const r=new Map;Dr(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,ks(o,a,n[i]))}return r}function Qs(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Es(e,s,t))}return r}class Js extends Vs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class Ys extends Vs{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class Xs{constructor(e){this.count=e}}var Zs,eo;function to(e){switch(e){default:return Nr();case xr.CANCELLED:case xr.UNKNOWN:case xr.DEADLINE_EXCEEDED:case xr.RESOURCE_EXHAUSTED:case xr.INTERNAL:case xr.UNAVAILABLE:case xr.UNAUTHENTICATED:return!1;case xr.INVALID_ARGUMENT:case xr.NOT_FOUND:case xr.ALREADY_EXISTS:case xr.PERMISSION_DENIED:case xr.FAILED_PRECONDITION:case xr.ABORTED:case xr.OUT_OF_RANGE:case xr.UNIMPLEMENTED:case xr.DATA_LOSS:return!0}}function no(e){if(void 0===e)return Ar("GRPC error has no .code"),xr.UNKNOWN;switch(e){case Zs.OK:return xr.OK;case Zs.CANCELLED:return xr.CANCELLED;case Zs.UNKNOWN:return xr.UNKNOWN;case Zs.DEADLINE_EXCEEDED:return xr.DEADLINE_EXCEEDED;case Zs.RESOURCE_EXHAUSTED:return xr.RESOURCE_EXHAUSTED;case Zs.INTERNAL:return xr.INTERNAL;case Zs.UNAVAILABLE:return xr.UNAVAILABLE;case Zs.UNAUTHENTICATED:return xr.UNAUTHENTICATED;case Zs.INVALID_ARGUMENT:return xr.INVALID_ARGUMENT;case Zs.NOT_FOUND:return xr.NOT_FOUND;case Zs.ALREADY_EXISTS:return xr.ALREADY_EXISTS;case Zs.PERMISSION_DENIED:return xr.PERMISSION_DENIED;case Zs.FAILED_PRECONDITION:return xr.FAILED_PRECONDITION;case Zs.ABORTED:return xr.ABORTED;case Zs.OUT_OF_RANGE:return xr.OUT_OF_RANGE;case Zs.UNIMPLEMENTED:return xr.UNIMPLEMENTED;case Zs.DATA_LOSS:return xr.DATA_LOSS;default:return Nr()}}(eo=Zs||(Zs={}))[eo.OK=0]="OK",eo[eo.CANCELLED=1]="CANCELLED",eo[eo.UNKNOWN=2]="UNKNOWN",eo[eo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",eo[eo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",eo[eo.NOT_FOUND=5]="NOT_FOUND",eo[eo.ALREADY_EXISTS=6]="ALREADY_EXISTS",eo[eo.PERMISSION_DENIED=7]="PERMISSION_DENIED",eo[eo.UNAUTHENTICATED=16]="UNAUTHENTICATED",eo[eo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",eo[eo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",eo[eo.ABORTED=10]="ABORTED",eo[eo.OUT_OF_RANGE=11]="OUT_OF_RANGE",eo[eo.UNIMPLEMENTED=12]="UNIMPLEMENTED",eo[eo.INTERNAL=13]="INTERNAL",eo[eo.UNAVAILABLE=14]="UNAVAILABLE",eo[eo.DATA_LOSS=15]="DATA_LOSS";class ro{constructor(e,t){this.comparator=e,this.root=t||so.EMPTY}insert(e,t){return new ro(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,so.BLACK,null,null))}remove(e){return new ro(this.comparator,this.root.remove(e,this.comparator).copy(null,null,so.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new io(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new io(this.root,e,this.comparator,!1)}getReverseIterator(){return new io(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new io(this.root,e,this.comparator,!0)}}class io{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class so{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:so.RED,this.left=null!=r?r:so.EMPTY,this.right=null!=i?i:so.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new so(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return so.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return so.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,so.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,so.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Nr();if(this.right.isRed())throw Nr();const e=this.left.check();if(e!==this.right.check())throw Nr();return e+(this.isRed()?0:1)}}so.EMPTY=null,so.RED=!0,so.BLACK=!1,so.EMPTY=new class{constructor(){this.size=0}get key(){throw Nr()}get value(){throw Nr()}get color(){throw Nr()}get left(){throw Nr()}get right(){throw Nr()}copy(e,t,n,r,i){return this}insert(e,t,n){return new so(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class oo{constructor(e){this.comparator=e,this.data=new ro(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ao(this.data.getIterator())}getIteratorFrom(e){return new ao(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof oo))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new oo(this.comparator);return t.data=e,t}}class ao{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const co=new ro(wi.comparator);function uo(){return co}const ho=new ro(wi.comparator);function lo(){return ho}const fo=new ro(wi.comparator);function po(){return fo}const mo=new oo(wi.comparator);function go(...e){let t=mo;for(const n of e)t=t.add(n);return t}const yo=new oo(Gr);function vo(){return yo}class wo{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,_o.createSynthesizedTargetChangeForCurrentChange(e,t)),new wo(Xr.min(),n,vo(),uo(),go())}}class _o{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new _o(ci.EMPTY_BYTE_STRING,t,go(),go(),go())}}class bo{constructor(e,t,n,r){this.$=e,this.removedTargetIds=t,this.key=n,this.O=r}}class Io{constructor(e,t){this.targetId=e,this.M=t}}class To{constructor(e,t,n=ci.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Eo{constructor(){this.F=0,this.L=Ao(),this.B=ci.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}get current(){return this.U}get resumeToken(){return this.B}get K(){return 0!==this.F}get j(){return this.q}W(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}G(){let e=go(),t=go(),n=go();return this.L.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Nr()}})),new _o(this.B,this.U,e,t,n)}H(){this.q=!1,this.L=Ao()}J(e,t){this.q=!0,this.L=this.L.insert(e,t)}Y(e){this.q=!0,this.L=this.L.remove(e)}X(){this.F+=1}Z(){this.F-=1}tt(){this.q=!0,this.U=!0}}class ko{constructor(e){this.et=e,this.nt=new Map,this.st=uo(),this.it=So(),this.rt=new oo(Gr)}ot(e){for(const t of e.$)e.O&&e.O.isFoundDocument()?this.ct(t,e.O):this.at(t,e.key,e.O);for(const t of e.removedTargetIds)this.at(t,e.key,e.O)}ut(e){this.forEachTarget(e,(t=>{const n=this.ht(t);switch(e.state){case 0:this.lt(t)&&n.W(e.resumeToken);break;case 1:n.Z(),n.K||n.H(),n.W(e.resumeToken);break;case 2:n.Z(),n.K||this.removeTarget(t);break;case 3:this.lt(t)&&(n.tt(),n.W(e.resumeToken));break;case 4:this.lt(t)&&(this.ft(t),n.W(e.resumeToken));break;default:Nr()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach(((e,n)=>{this.lt(n)&&t(n)}))}dt(e){const t=e.targetId,n=e.M.count,r=this.wt(t);if(r){const e=r.target;if(ji(e))if(0===n){const n=new wi(e.path);this.at(t,n,Mi.newNoDocument(n,Xr.min()))}else Dr(1===n);else this._t(t)!==n&&(this.ft(t),this.rt=this.rt.add(t))}}gt(e){const t=new Map;this.nt.forEach(((n,r)=>{const i=this.wt(r);if(i){if(n.current&&ji(i.target)){const t=new wi(i.target.path);null!==this.st.get(t)||this.yt(r,t)||this.at(r,t,Mi.newNoDocument(t,e))}n.j&&(t.set(r,n.G()),n.H())}}));let n=go();this.it.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.wt(e);return!t||2===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))}));const r=new wo(e,t,this.rt,this.st,n);return this.st=uo(),this.it=So(),this.rt=new oo(Gr),r}ct(e,t){if(!this.lt(e))return;const n=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,n),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}at(e,t,n){if(!this.lt(e))return;const r=this.ht(e);this.yt(e,t)?r.J(t,1):r.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),n&&(this.st=this.st.insert(t,n))}removeTarget(e){this.nt.delete(e)}_t(e){const t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}X(e){this.ht(e).X()}ht(e){let t=this.nt.get(e);return t||(t=new Eo,this.nt.set(e,t)),t}Tt(e){let t=this.it.get(e);return t||(t=new oo(Gr),this.it=this.it.insert(e,t)),t}lt(e){const t=null!==this.wt(e);return t||Sr("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}ft(e){this.nt.set(e,new Eo),this.et.getRemoteKeysForTarget(e).forEach((t=>{this.at(e,t,null)}))}yt(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}function So(){return new ro(wi.comparator)}function Ao(){return new ro(wi.comparator)}const Co={asc:"ASCENDING",desc:"DESCENDING"},Ro={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class No{constructor(e,t){this.databaseId=e,this.C=t}}function Do(e,t){return e.C?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Oo(e,t){return e.C?t.toBase64():t.toUint8Array()}function Po(e,t){return Do(e,t.toTimestamp())}function xo(e){return Dr(!!e),Xr.fromTimestamp(function(e){const t=hi(e);return new Yr(t.seconds,t.nanos)}(e))}function Lo(e,t){return function(e){return new ri(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Mo(e){const t=ri.fromString(e);return Dr(oa(t)),t}function Uo(e,t){return Lo(e.databaseId,t.path)}function Fo(e,t){const n=Mo(t);if(n.get(1)!==e.databaseId.projectId)throw new Lr(xr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Lr(xr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new wi(Bo(n))}function Vo(e,t){return Lo(e.databaseId,t)}function qo(e){const t=Mo(e);return 4===t.length?ri.emptyPath():Bo(t)}function jo(e){return new ri(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Bo(e){return Dr(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function zo(e,t,n){return{name:Uo(e,t),fields:n.value.mapValue.fields}}function $o(e,t,n){const r=Fo(e,t.name),i=xo(t.updateTime),s=new xi({mapValue:{fields:t.fields}}),o=Mi.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Ko(e,t){let n;if(t instanceof Ks)n={update:zo(e,t.key,t.value)};else if(t instanceof Js)n={delete:Uo(e,t.key)};else if(t instanceof Ws)n={update:zo(e,t.key,t.data),updateMask:sa(t.fieldMask)};else{if(!(t instanceof Ys))return Nr();n={verify:Uo(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof As)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Cs)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ns)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Os)return{fieldPath:t.field.canonicalString(),increment:n.N};throw Nr()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Po(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Nr()}(e,t.precondition)),n}function Wo(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Us.updateTime(xo(e.updateTime)):void 0!==e.exists?Us.exists(e.exists):Us.none()}(t.currentDocument):Us.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)Dr("REQUEST_TIME"===t.setToServerValue),n=new As;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Cs(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Ns(e)}else"increment"in t?n=new Os(e,t.increment):Nr();const r=si.fromServerFormat(t.fieldPath);return new Ls(r,n)}(e,t))):[];if(t.update){t.update.name;const i=Fo(e,t.update.name),s=new xi({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new oi(t.map((e=>si.fromServerFormat(e))))}(t.updateMask);return new Ws(i,s,e,n,r)}return new Ks(i,s,n,r)}if(t.delete){const r=Fo(e,t.delete);return new Js(r,n)}if(t.verify){const r=Fo(e,t.verify);return new Ys(r,n)}return Nr()}function Ho(e,t){return{documents:[Vo(e,t.path)]}}function Go(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Vo(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Vo(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0===e.length)return;const t=e.map((e=>function(e){if("=="===e.op){if(Di(e.value))return{unaryFilter:{field:ta(e.field),op:"IS_NAN"}};if(Ni(e.value))return{unaryFilter:{field:ta(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Di(e.value))return{unaryFilter:{field:ta(e.field),op:"IS_NOT_NAN"}};if(Ni(e.value))return{unaryFilter:{field:ta(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ta(e.field),op:ea(e.op),value:e.value}}}(e)));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:ta(e.field),direction:Zo(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.C||gi(t)?t:{value:t}}(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=Yo(t.startAt)),t.endAt&&(n.structuredQuery.endAt=Yo(t.endAt)),n}function Qo(e){let t=qo(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Dr(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=Jo(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new Zi(na(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,gi(t)?null:t}(n.limit));let c=null;n.startAt&&(c=Xo(n.startAt));let u=null;return n.endAt&&(u=Xo(n.endAt)),is(t,i,o,s,a,"F",c,u)}function Jo(e){return e?void 0!==e.unaryFilter?[ia(e)]:void 0!==e.fieldFilter?[ra(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((e=>Jo(e))).reduce(((e,t)=>e.concat(t))):Nr():[]}function Yo(e){return{before:e.before,values:e.position}}function Xo(e){const t=!!e.before,n=e.values||[];return new Yi(n,t)}function Zo(e){return Co[e]}function ea(e){return Ro[e]}function ta(e){return{fieldPath:e.canonicalString()}}function na(e){return si.fromServerFormat(e.fieldPath)}function ra(e){return Bi.create(na(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Nr()}}(e.fieldFilter.op),e.fieldFilter.value)}function ia(e){switch(e.unaryFilter.op){case"IS_NAN":const t=na(e.unaryFilter.field);return Bi.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=na(e.unaryFilter.field);return Bi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=na(e.unaryFilter.field);return Bi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=na(e.unaryFilter.field);return Bi.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Nr()}}function sa(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function oa(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function aa(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=ua(t)),t=ca(e.get(n),t);return ua(t)}function ca(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=t}}return n}function ua(e){return e+"\x01\x01"}function ha(e){const t=e.length;if(Dr(t>=2),2===t)return Dr("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),ri.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("\x01",s);switch((t<0||t>n)&&Nr(),e.charAt(t+1)){case"\x01":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"\x10":i+=e.substring(s,t),i+="\0";break;case"\x11":i+=e.substring(s,t+1);break;default:Nr()}s=t+2}return new ri(r)}class la{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class da{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}da.store="owner",da.key="owner";class fa{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}fa.store="mutationQueues",fa.keyPath="userId";class pa{constructor(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}}pa.store="mutations",pa.keyPath="batchId",pa.userMutationsIndex="userMutationsIndex",pa.userMutationsKeyPath=["userId","batchId"];class ma{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,aa(t)]}static key(e,t,n){return[e,aa(t),n]}}ma.store="documentMutations",ma.PLACEHOLDER=new ma;class ga{constructor(e,t){this.path=e,this.readTime=t}}class ya{constructor(e,t){this.path=e,this.version=t}}class va{constructor(e,t,n,r,i,s){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=s}}va.store="remoteDocuments",va.readTimeIndex="readTimeIndex",va.readTimeIndexPath="readTime",va.collectionReadTimeIndex="collectionReadTimeIndex",va.collectionReadTimeIndexPath=["parentPath","readTime"];class wa{constructor(e){this.byteSize=e}}wa.store="remoteDocumentGlobal",wa.key="remoteDocumentGlobalKey";class _a{constructor(e,t,n,r,i,s,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=s,this.query=o}}_a.store="targets",_a.keyPath="targetId",_a.queryTargetsIndexName="queryTargetsIndex",_a.queryTargetsKeyPath=["canonicalId","targetId"];class ba{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}ba.store="targetDocuments",ba.keyPath=["targetId","path"],ba.documentTargetsIndex="documentTargetsIndex",ba.documentTargetsKeyPath=["path","targetId"];class Ia{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}Ia.key="targetGlobalKey",Ia.store="targetGlobal";class Ta{constructor(e,t){this.collectionId=e,this.parent=t}}Ta.store="collectionParents",Ta.keyPath=["collectionId","parent"];class Ea{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}Ea.store="clientMetadata",Ea.keyPath="clientId";class ka{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}ka.store="bundles",ka.keyPath="bundleId";class Sa{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}Sa.store="namedQueries",Sa.keyPath="name";const Aa=[fa.store,pa.store,ma.store,va.store,_a.store,da.store,Ia.store,ba.store,Ea.store,wa.store,Ta.store,ka.store,Sa.store],Ca="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ra{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}class Na{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Nr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Na(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Na?t:Na.resolve(t)}catch(e){return Na.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Na.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Na.reject(t)}static resolve(e){return new Na(((t,n)=>{t(e)}))}static reject(e){return new Na(((t,n)=>{n(e)}))}static waitFor(e){return new Na(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=Na.resolve(!1);for(const n of e)t=t.next((e=>e?Na.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}}class Da{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.It=new Mr,this.transaction.oncomplete=()=>{this.It.resolve()},this.transaction.onabort=()=>{t.error?this.It.reject(new xa(e,t.error)):this.It.resolve()},this.transaction.onerror=t=>{const n=Va(t.target.error);this.It.reject(new xa(e,n))}}static open(e,t,n,r){try{return new Da(t,e.transaction(r,n))}catch(e){throw new xa(t,e)}}get At(){return this.It.promise}abort(e){e&&this.It.reject(e),this.aborted||(Sr("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(e){const t=this.transaction.objectStore(e);return new Ma(t)}}class Oa{constructor(e,t,n){this.name=e,this.version=t,this.Rt=n,12.2===Oa.bt((0,a.z$)())&&Ar("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Sr("SimpleDb","Removing database:",e),Ua(window.indexedDB.deleteDatabase(e)).toPromise()}static Pt(){if(!(0,a.hl)())return!1;if(Oa.vt())return!0;const e=(0,a.z$)(),t=Oa.bt(e),n=0<t&&t<10,r=Oa.Vt(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static vt(){var e;return"undefined"!=typeof wr&&"YES"===(null===(e=wr.env)||void 0===e?void 0:e.St)}static Dt(e,t){return e.store(t)}static bt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Vt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Ct(e){return this.db||(Sr("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new xa(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new Lr(xr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Lr(xr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new xa(e,r))},r.onupgradeneeded=e=>{Sr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.Rt.Nt(t,r.transaction,e.oldVersion,this.version).next((()=>{Sr("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.kt&&(this.db.onversionchange=e=>this.kt(e)),this.db}xt(e){this.kt=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.Ct(e);const t=Da.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).catch((e=>(t.abort(e),Na.reject(e)))).toPromise();return s.catch((()=>{})),await t.At,s}catch(e){const t="FirebaseError"!==e.name&&s<3;if(Sr("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Pa{constructor(e){this.$t=e,this.Ot=!1,this.Mt=null}get isDone(){return this.Ot}get Ft(){return this.Mt}set cursor(e){this.$t=e}done(){this.Ot=!0}Lt(e){this.Mt=e}delete(){return Ua(this.$t.delete())}}class xa extends Lr{constructor(e,t){super(xr.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function La(e){return"IndexedDbTransactionError"===e.name}class Ma{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(Sr("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Sr("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Ua(n)}add(e){return Sr("SimpleDb","ADD",this.store.name,e,e),Ua(this.store.add(e))}get(e){return Ua(this.store.get(e)).next((t=>(void 0===t&&(t=null),Sr("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return Sr("SimpleDb","DELETE",this.store.name,e),Ua(this.store.delete(e))}count(){return Sr("SimpleDb","COUNT",this.store.name),Ua(this.store.count())}Bt(e,t){const n=this.cursor(this.options(e,t)),r=[];return this.Ut(n,((e,t)=>{r.push(t)})).next((()=>r))}qt(e,t){Sr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.Kt=!1;const r=this.cursor(n);return this.Ut(r,((e,t,n)=>n.delete()))}jt(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.Ut(r,t)}Qt(e){const t=this.cursor({});return new Na(((n,r)=>{t.onerror=e=>{const t=Va(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}Ut(e,t){const n=[];return new Na(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new Pa(i),o=t(i.primaryKey,i.value,s);if(o instanceof Na){const e=o.catch((e=>(s.done(),Na.reject(e))));n.push(e)}s.isDone?r():null===s.Ft?i.continue():i.continue(s.Ft)}})).next((()=>Na.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Kt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ua(e){return new Na(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Va(e.target.error);n(t)}}))}let Fa=!1;function Va(e){const t=Oa.bt((0,a.z$)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new Lr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Fa||(Fa=!0,setTimeout((()=>{throw e}),0)),e}}return e}class qa extends Ra{constructor(e,t){super(),this.Wt=e,this.currentSequenceNumber=t}}function ja(e,t){const n=Pr(e);return Oa.Dt(n.Wt,t)}class Ba{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&qs(t,e,n[r])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&js(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&js(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach((t=>{const n=e.get(t.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(Xr.min())}))}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),go())}isEqual(e){return this.batchId===e.batchId&&Qr(this.mutations,e.mutations,((e,t)=>zs(e,t)))&&Qr(this.baseMutations,e.baseMutations,((e,t)=>zs(e,t)))}}class za{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){Dr(e.mutations.length===n.length);let r=po();const i=e.mutations;for(let s=0;s<i.length;s++)r=r.insert(i[s].key,n[s].version);return new za(e,t,n,r)}}class $a{constructor(e,t,n,r,i=Xr.min(),s=Xr.min(),o=ci.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new $a(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new $a(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new $a(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Ka{constructor(e){this.Gt=e}}function Wa(e,t){if(t.document)return $o(e.Gt,t.document,!!t.hasCommittedMutations);if(t.noDocument){const e=wi.fromSegments(t.noDocument.path),n=Ya(t.noDocument.readTime),r=Mi.newNoDocument(e,n);return t.hasCommittedMutations?r.setHasCommittedMutations():r}if(t.unknownDocument){const e=wi.fromSegments(t.unknownDocument.path),n=Ya(t.unknownDocument.version);return Mi.newUnknownDocument(e,n)}return Nr()}function Ha(e,t,n){const r=Ga(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){const n=function(e,t){return{name:Uo(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Do(e,t.version.toTimestamp())}}(e.Gt,t),s=t.hasCommittedMutations;return new va(null,null,n,s,r,i)}if(t.isNoDocument()){const e=t.key.path.toArray(),n=Ja(t.version),s=t.hasCommittedMutations;return new va(null,new ga(e,n),null,s,r,i)}if(t.isUnknownDocument()){const e=t.key.path.toArray(),n=Ja(t.version);return new va(new ya(e,n),null,null,!0,r,i)}return Nr()}function Ga(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Qa(e){const t=new Yr(e[0],e[1]);return Xr.fromTimestamp(t)}function Ja(e){const t=e.toTimestamp();return new la(t.seconds,t.nanoseconds)}function Ya(e){const t=new Yr(e.seconds,e.nanoseconds);return Xr.fromTimestamp(t)}function Xa(e,t){const n=(t.baseMutations||[]).map((t=>Wo(e.Gt,t)));for(let s=0;s<t.mutations.length-1;++s){const e=t.mutations[s];if(s+1<t.mutations.length&&void 0!==t.mutations[s+1].transform){const n=t.mutations[s+1];e.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}const r=t.mutations.map((t=>Wo(e.Gt,t))),i=Yr.fromMillis(t.localWriteTimeMs);return new Ba(t.batchId,i,n,r)}function Za(e){const t=Ya(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Ya(e.lastLimboFreeSnapshotVersion):Xr.min();let r;var i;return void 0!==e.query.documents?(Dr(1===(i=e.query).documents.length),r=ds(ss(qo(i.documents[0])))):r=function(e){return ds(Qo(e))}(e.query),new $a(r,e.targetId,0,e.lastListenSequenceNumber,t,n,ci.fromBase64String(e.resumeToken))}function ec(e,t){const n=Ja(t.snapshotVersion),r=Ja(t.lastLimboFreeSnapshotVersion);let i;i=ji(t.target)?Ho(e.Gt,t.target):Go(e.Gt,t.target);const s=t.resumeToken.toBase64();return new _a(t.targetId,Vi(t.target),n,s,t.sequenceNumber,r,i)}function tc(e){const t=Qo({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?fs(t,t.limit,"L"):t}class nc{getBundleMetadata(e,t){return rc(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:Ya(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return rc(e).put({bundleId:(n=t).id,createTime:Ja(xo(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return ic(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:tc(t.bundledQuery),readTime:Ya(t.readTime)};var t}))}saveNamedQuery(e,t){return ic(e).put(function(e){return{name:e.name,readTime:Ja(xo(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function rc(e){return ja(e,ka.store)}function ic(e){return ja(e,Sa.store)}class sc{constructor(){this.zt=new oc}addToCollectionParentIndex(e,t){return this.zt.add(t),Na.resolve()}getCollectionParents(e,t){return Na.resolve(this.zt.getEntries(t))}}class oc{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new oo(ri.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new oo(ri.comparator)).toArray()}}class ac{constructor(){this.Ht=new oc}addToCollectionParentIndex(e,t){if(!this.Ht.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.Ht.add(t)}));const i={collectionId:n,parent:aa(r)};return cc(e).put(i)}return Na.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[Jr(t),""],!1,!0);return cc(e).Bt(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(ha(r.parent))}return n}))}}function cc(e){return ja(e,Ta.store)}const uc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class hc{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new hc(e,hc.DEFAULT_COLLECTION_PERCENTILE,hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function lc(e,t,n){const r=e.store(pa.store),i=e.store(ma.store),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.jt({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{Dr(1===a)})));const u=[];for(const h of n.mutations){const e=ma.key(t,h.key.path,n.batchId);s.push(i.delete(e)),u.push(h.key)}return Na.waitFor(s).next((()=>u))}function dc(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Nr();t=e.noDocument}return JSON.stringify(t).length}hc.DEFAULT_COLLECTION_PERCENTILE=10,hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hc.DEFAULT=new hc(41943040,hc.DEFAULT_COLLECTION_PERCENTILE,hc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hc.DISABLED=new hc(-1,0,0);class fc{constructor(e,t,n,r){this.userId=e,this.k=t,this.Jt=n,this.referenceDelegate=r,this.Yt={}}static Xt(e,t,n,r){Dr(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new fc(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mc(e).jt({index:pa.userMutationsIndex,range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=gc(e),s=mc(e);return s.add({}).next((o=>{Dr("number"==typeof o);const a=new Ba(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>Ko(e.Gt,t))),i=n.mutations.map((t=>Ko(e.Gt,t)));return new pa(t,n.batchId,n.localWriteTime.toMillis(),r,i)}(this.k,this.userId,a),u=[];let h=new oo(((e,t)=>Gr(e.canonicalString(),t.canonicalString())));for(const e of r){const t=ma.key(this.userId,e.key.path,o);h=h.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,ma.PLACEHOLDER))}return h.forEach((t=>{u.push(this.Jt.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Yt[o]=a.keys()})),Na.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return mc(e).get(t).next((e=>e?(Dr(e.userId===this.userId),Xa(this.k,e)):null))}Zt(e,t){return this.Yt[t]?Na.resolve(this.Yt[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Yt[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return mc(e).jt({index:pa.userMutationsIndex,range:r},((e,t,r)=>{t.userId===this.userId&&(Dr(t.batchId>=n),i=Xa(this.k,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return mc(e).jt({index:pa.userMutationsIndex,range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return mc(e).Bt(pa.userMutationsIndex,t).next((e=>e.map((e=>Xa(this.k,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=ma.prefixForPath(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return gc(e).jt({range:r},((n,r,s)=>{const[o,a,c]=n,u=ha(a);if(o===this.userId&&t.path.isEqual(u))return mc(e).get(c).next((e=>{if(!e)throw Nr();Dr(e.userId===this.userId),i.push(Xa(this.k,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new oo(Gr);const r=[];return t.forEach((t=>{const i=ma.prefixForPath(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=gc(e).jt({range:s},((e,r,i)=>{const[s,o,a]=e,c=ha(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),Na.waitFor(r).next((()=>this.te(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=ma.prefixForPath(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new oo(Gr);return gc(e).jt({range:s},((e,t,i)=>{const[s,a,c]=e,u=ha(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.te(e,o)))}te(e,t){const n=[],r=[];return t.forEach((t=>{r.push(mc(e).get(t).next((e=>{if(null===e)throw Nr();Dr(e.userId===this.userId),n.push(Xa(this.k,e))})))})),Na.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return lc(e.Wt,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.ee(t.batchId)})),Na.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}ee(e){delete this.Yt[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return Na.resolve();const n=IDBKeyRange.lowerBound(ma.prefixForUser(this.userId)),r=[];return gc(e).jt({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=ha(e[1]);r.push(t)}else n.done()})).next((()=>{Dr(0===r.length)}))}))}containsKey(e,t){return pc(e,this.userId,t)}ne(e){return yc(e).get(this.userId).next((e=>e||new fa(this.userId,-1,"")))}}function pc(e,t,n){const r=ma.prefixForPath(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return gc(e).jt({range:s,Kt:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function mc(e){return ja(e,pa.store)}function gc(e){return ja(e,ma.store)}function yc(e){return ja(e,fa.store)}class vc{constructor(e){this.se=e}next(){return this.se+=2,this.se}static ie(){return new vc(0)}static re(){return new vc(-1)}}class wc{constructor(e,t){this.referenceDelegate=e,this.k=t}allocateTargetId(e){return this.oe(e).next((t=>{const n=new vc(t.highestTargetId);return t.highestTargetId=n.next(),this.ce(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.oe(e).next((e=>Xr.fromTimestamp(new Yr(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.oe(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.oe(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.ce(e,r))))}addTargetData(e,t){return this.ae(e,t).next((()=>this.oe(e).next((n=>(n.targetCount+=1,this.ue(t,n),this.ce(e,n))))))}updateTargetData(e,t){return this.ae(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>_c(e).delete(t.targetId))).next((()=>this.oe(e))).next((t=>(Dr(t.targetCount>0),t.targetCount-=1,this.ce(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return _c(e).jt(((s,o)=>{const a=Za(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>Na.waitFor(i))).next((()=>r))}forEachTarget(e,t){return _c(e).jt(((e,n)=>{const r=Za(n);t(r)}))}oe(e){return bc(e).get(Ia.key).next((e=>(Dr(null!==e),e)))}ce(e,t){return bc(e).put(Ia.key,t)}ae(e,t){return _c(e).put(ec(this.k,t))}ue(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.oe(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Vi(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return _c(e).jt({range:r,index:_a.queryTargetsIndexName},((e,n,r)=>{const s=Za(n);qi(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=Ic(e);return t.forEach((t=>{const s=aa(t.path);r.push(i.put(new ba(n,s))),r.push(this.referenceDelegate.addReference(e,n,t))})),Na.waitFor(r)}removeMatchingKeys(e,t,n){const r=Ic(e);return Na.forEach(t,(t=>{const i=aa(t.path);return Na.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=Ic(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Ic(e);let i=go();return r.jt({range:n,Kt:!0},((e,t,n)=>{const r=ha(e[1]),s=new wi(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=aa(t.path),r=IDBKeyRange.bound([n],[Jr(n)],!1,!0);let i=0;return Ic(e).jt({index:ba.documentTargetsIndex,Kt:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}Et(e,t){return _c(e).get(t).next((e=>e?Za(e):null))}}function _c(e){return ja(e,_a.store)}function bc(e){return ja(e,Ia.store)}function Ic(e){return ja(e,ba.store)}async function Tc(e){if(e.code!==xr.FAILED_PRECONDITION||e.message!==Ca)throw e;Sr("LocalStore","Unexpectedly lost primary lease")}function Ec([e,t],[n,r]){const i=Gr(e,n);return 0===i?Gr(t,r):i}class kc{constructor(e){this.he=e,this.buffer=new oo(Ec),this.le=0}fe(){return++this.le}de(e){const t=[e,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Ec(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Sc{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.we=!1,this._e=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.me(e)}stop(){this._e&&(this._e.cancel(),this._e=null)}get started(){return null!==this._e}me(e){const t=this.we?3e5:6e4;Sr("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this._e=null,this.we=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){La(e)?Sr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await Tc(e)}await this.me(e)}))}}class Ac{constructor(e,t){this.ge=e,this.params=t}calculateTargetCount(e,t){return this.ge.ye(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Na.resolve(Kr.I);const n=new kc(t);return this.ge.forEachTarget(e,(e=>n.de(e.sequenceNumber))).next((()=>this.ge.pe(e,(e=>n.de(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.ge.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.ge.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Sr("LruGarbageCollector","Garbage collection skipped; disabled"),Na.resolve(uc)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(Sr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),uc):this.Te(e,t)))}getCacheSize(e){return this.ge.getCacheSize(e)}Te(e,t){let n,r,i,s,a,c,u;const h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(Sr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,a=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,c=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(u=Date.now(),Er()<=o.in.DEBUG&&Sr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-h}ms\n\tDetermined least recently used ${r} in `+(a-s)+"ms\n"+`\tRemoved ${i} targets in `+(c-a)+"ms\n"+`\tRemoved ${e} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-h}ms`),Na.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class Cc{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new Ac(e,t)}(this,t)}ye(e){const t=this.Ee(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}Ee(e){let t=0;return this.pe(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pe(e,t){return this.Ie(e,((e,n)=>t(n)))}addReference(e,t,n){return Rc(e,n)}removeReference(e,t,n){return Rc(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return Rc(e,t)}Ae(e,t){return function(e,t){let n=!1;return yc(e).Qt((r=>pc(e,r,t).next((e=>(e&&(n=!0),Na.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Ie(e,((s,o)=>{if(o<=t){const t=this.Ae(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s),Ic(e).delete([0,aa(s.path)]))))}));r.push(t)}})).next((()=>Na.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return Rc(e,t)}Ie(e,t){const n=Ic(e);let r,i=Kr.I;return n.jt({index:ba.documentTargetsIndex},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==Kr.I&&t(new wi(ha(r)),i),i=o,r=s):i=Kr.I})).next((()=>{i!==Kr.I&&t(new wi(ha(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Rc(e,t){return Ic(e).put(function(e,t){return new ba(0,aa(e.path),t)}(t,e.currentSequenceNumber))}class Nc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}forEach(e){ei(this.inner,((t,n)=>{for(const[r,i]of n)e(r,i)}))}isEmpty(){return ti(this.inner)}}class Dc{constructor(){this.changes=new Nc((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}getReadTime(e){const t=this.changes.get(e);return t?t.readTime:Xr.min()}addEntry(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}removeEntry(e,t=null){this.assertNotApplied(),this.changes.set(e,{document:Mi.newInvalidDocument(e),readTime:t})}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Na.resolve(n.document):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Oc{constructor(e,t){this.k=e,this.Jt=t}addEntry(e,t,n){return Lc(e).put(Mc(t),n)}removeEntry(e,t){const n=Lc(e),r=Mc(t);return n.delete(r)}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Re(e,n))))}getEntry(e,t){return Lc(e).get(Mc(t)).next((e=>this.be(t,e)))}Pe(e,t){return Lc(e).get(Mc(t)).next((e=>({document:this.be(t,e),size:dc(e)})))}getEntries(e,t){let n=uo();return this.ve(e,t,((e,t)=>{const r=this.be(e,t);n=n.insert(e,r)})).next((()=>n))}Ve(e,t){let n=uo(),r=new ro(wi.comparator);return this.ve(e,t,((e,t)=>{const i=this.be(e,t);n=n.insert(e,i),r=r.insert(e,dc(t))})).next((()=>({documents:n,Se:r})))}ve(e,t,n){if(t.isEmpty())return Na.resolve();const r=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator();let s=i.getNext();return Lc(e).jt({range:r},((e,t,r)=>{const o=wi.fromSegments(e);for(;s&&wi.comparator(s,o)<0;)n(s,null),s=i.getNext();s&&s.isEqual(o)&&(n(s,t),s=i.hasNext()?i.getNext():null),s?r.Lt(s.path.toArray()):r.done()})).next((()=>{for(;s;)n(s,null),s=i.hasNext()?i.getNext():null}))}getDocumentsMatchingQuery(e,t,n){let r=uo();const i=t.path.length+1,s={};if(n.isEqual(Xr.min())){const e=t.path.toArray();s.range=IDBKeyRange.lowerBound(e)}else{const e=t.path.toArray(),r=Ga(n);s.range=IDBKeyRange.lowerBound([e,r],!0),s.index=va.collectionReadTimeIndex}return Lc(e).jt(s,((e,n,s)=>{if(e.length!==i)return;const o=Wa(this.k,n);t.path.isPrefixOf(o.key.path)?ys(t,o)&&(r=r.insert(o.key,o)):s.done()})).next((()=>r))}newChangeBuffer(e){return new Pc(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return xc(e).get(wa.key).next((e=>(Dr(!!e),e)))}Re(e,t){return xc(e).put(wa.key,t)}be(e,t){if(t){const e=Wa(this.k,t);if(!e.isNoDocument()||!e.version.isEqual(Xr.min()))return e}return Mi.newInvalidDocument(e)}}class Pc extends Dc{constructor(e,t){super(),this.De=e,this.trackRemovals=t,this.Ce=new Nc((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new oo(((e,t)=>Gr(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.Ce.get(i);if(s.document.isValidDocument()){const a=Ha(this.De.k,s.document,this.getReadTime(i));r=r.add(i.path.popLast());const c=dc(a);n+=c-o,t.push(this.De.addEntry(e,i,a))}else if(n-=o,this.trackRemovals){const n=Ha(this.De.k,Mi.newNoDocument(i,Xr.min()),this.getReadTime(i));t.push(this.De.addEntry(e,i,n))}else t.push(this.De.removeEntry(e,i))})),r.forEach((n=>{t.push(this.De.Jt.addToCollectionParentIndex(e,n))})),t.push(this.De.updateMetadata(e,n)),Na.waitFor(t)}getFromCache(e,t){return this.De.Pe(e,t).next((e=>(this.Ce.set(t,e.size),e.document)))}getAllFromCache(e,t){return this.De.Ve(e,t).next((({documents:e,Se:t})=>(t.forEach(((e,t)=>{this.Ce.set(e,t)})),e)))}}function xc(e){return ja(e,wa.store)}function Lc(e){return ja(e,va.store)}function Mc(e){return e.path.toArray()}class Uc{constructor(e){this.k=e}Nt(e,t,n,r){Dr(n<r&&n>=0&&r<=11);const i=new Da("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(da.store)}(e),function(e){e.createObjectStore(fa.store,{keyPath:fa.keyPath}),e.createObjectStore(pa.store,{keyPath:pa.keyPath,autoIncrement:!0}).createIndex(pa.userMutationsIndex,pa.userMutationsKeyPath,{unique:!0}),e.createObjectStore(ma.store)}(e),Fc(e),function(e){e.createObjectStore(va.store)}(e));let s=Na.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(ba.store),e.deleteObjectStore(_a.store),e.deleteObjectStore(Ia.store)}(e),Fc(e)),s=s.next((()=>function(e){const t=e.store(Ia.store),n=new Ia(0,0,Xr.min().toTimestamp(),0);return t.put(Ia.key,n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store(pa.store).Bt().next((n=>{e.deleteObjectStore(pa.store),e.createObjectStore(pa.store,{keyPath:pa.keyPath,autoIncrement:!0}).createIndex(pa.userMutationsIndex,pa.userMutationsKeyPath,{unique:!0});const r=t.store(pa.store),i=n.map((e=>r.put(e)));return Na.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore(Ea.store,{keyPath:Ea.keyPath})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Ne(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore(wa.store)}(e),this.ke(i))))),n<7&&r>=7&&(s=s.next((()=>this.xe(i)))),n<8&&r>=8&&(s=s.next((()=>this.$e(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e),function(e){const t=e.objectStore(va.store);t.createIndex(va.readTimeIndex,va.readTimeIndexPath,{unique:!1}),t.createIndex(va.collectionReadTimeIndex,va.collectionReadTimeIndexPath,{unique:!1})}(t)}))),n<10&&r>=10&&(s=s.next((()=>this.Oe(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore(ka.store,{keyPath:ka.keyPath})}(e),function(e){e.createObjectStore(Sa.store,{keyPath:Sa.keyPath})}(e)}))),s}ke(e){let t=0;return e.store(va.store).jt(((e,n)=>{t+=dc(n)})).next((()=>{const n=new wa(t);return e.store(wa.store).put(wa.key,n)}))}Ne(e){const t=e.store(fa.store),n=e.store(pa.store);return t.Bt().next((t=>Na.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.Bt(pa.userMutationsIndex,r).next((n=>Na.forEach(n,(n=>{Dr(n.userId===t.userId);const r=Xa(this.k,n);return lc(e,t.userId,r).next((()=>{}))}))))}))))}xe(e){const t=e.store(ba.store),n=e.store(va.store);return e.store(Ia.store).get(Ia.key).next((e=>{const r=[];return n.jt(((n,i)=>{const s=new ri(n),o=function(e){return[0,aa(e)]}(s);r.push(t.get(o).next((n=>n?Na.resolve():(n=>t.put(new ba(0,aa(n),e.highestListenSequenceNumber)))(s))))})).next((()=>Na.waitFor(r)))}))}$e(e,t){e.createObjectStore(Ta.store,{keyPath:Ta.keyPath});const n=t.store(Ta.store),r=new oc,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:aa(r)})}};return t.store(va.store).jt({Kt:!0},((e,t)=>{const n=new ri(e);return i(n.popLast())})).next((()=>t.store(ma.store).jt({Kt:!0},(([e,t,n],r)=>{const s=ha(t);return i(s.popLast())}))))}Oe(e){const t=e.store(_a.store);return t.jt(((e,n)=>{const r=Za(n),i=ec(this.k,r);return t.put(i)}))}}function Fc(e){e.createObjectStore(ba.store,{keyPath:ba.keyPath}).createIndex(ba.documentTargetsIndex,ba.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(_a.store,{keyPath:_a.keyPath}).createIndex(_a.queryTargetsIndexName,_a.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Ia.store)}const Vc="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class qc{constructor(e,t,n,r,i,s,o,a,c,u){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Me=i,this.window=s,this.document=o,this.Fe=c,this.Le=u,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=e=>Promise.resolve(),!qc.Pt())throw new Lr(xr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Cc(this,r),this.Ge=t+"main",this.k=new Ka(a),this.ze=new Oa(this.Ge,11,new Uc(this.k)),this.He=new wc(this.referenceDelegate,this.k),this.Jt=new ac,this.Je=function(e,t){return new Oc(e,t)}(this.k,this.Jt),this.Ye=new nc,this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,!1===u&&Ar("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ze().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Lr(xr.FAILED_PRECONDITION,Vc);return this.tn(),this.en(),this.nn(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.He.getHighestSequenceNumber(e)))})).then((e=>{this.Be=new Kr(e,this.Fe)})).then((()=>{this.Ue=!0})).catch((e=>(this.ze&&this.ze.close(),Promise.reject(e))))}sn(e){return this.We=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ze.xt((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Me.enqueueAndForget((async()=>{this.started&&await this.Ze()})))}Ze(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Bc(e).put(new Ea(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next((()=>{if(this.isPrimary)return this.rn(e).next((e=>{e||(this.isPrimary=!1,this.Me.enqueueRetryable((()=>this.We(!1))))}))})).next((()=>this.on(e))).next((t=>this.isPrimary&&!t?this.cn(e).next((()=>!1)):!!t&&this.an(e).next((()=>!0)))))).catch((e=>{if(La(e))return Sr("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Sr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Me.enqueueRetryable((()=>this.We(e))),this.isPrimary=e}))}rn(e){return jc(e).get(da.key).next((e=>Na.resolve(this.un(e))))}hn(e){return Bc(e).delete(this.clientId)}async ln(){if(this.isPrimary&&!this.fn(this.Qe,18e5)){this.Qe=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=ja(e,Ea.store);return t.Bt().next((e=>{const n=this.dn(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return Na.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.Xe)for(const t of e)this.Xe.removeItem(this.wn(t.clientId))}}nn(){this.je=this.Me.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.Ze().then((()=>this.ln())).then((()=>this.nn()))))}un(e){return!!e&&e.ownerId===this.clientId}on(e){return this.Le?Na.resolve(!0):jc(e).get(da.key).next((t=>{if(null!==t&&this.fn(t.leaseTimestampMs,5e3)&&!this._n(t.ownerId)){if(this.un(t)&&this.networkEnabled)return!0;if(!this.un(t)){if(!t.allowTabSynchronization)throw new Lr(xr.FAILED_PRECONDITION,Vc);return!1}}return!(!this.networkEnabled||!this.inForeground)||Bc(e).Bt().next((e=>void 0===this.dn(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&Sr("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.Ue=!1,this.mn(),this.je&&(this.je.cancel(),this.je=null),this.gn(),this.yn(),await this.ze.runTransaction("shutdown","readwrite",[da.store,Ea.store],(e=>{const t=new qa(e,Kr.I);return this.cn(t).next((()=>this.hn(t)))})),this.ze.close(),this.pn()}dn(e,t){return e.filter((e=>this.fn(e.updateTimeMs,t)&&!this._n(e.clientId)))}Tn(){return this.runTransaction("getActiveClients","readonly",(e=>Bc(e).Bt().next((e=>this.dn(e,18e5).map((e=>e.clientId))))))}get started(){return this.Ue}getMutationQueue(e){return fc.Xt(e,this.k,this.Jt,this.referenceDelegate)}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getIndexManager(){return this.Jt}getBundleCache(){return this.Ye}runTransaction(e,t,n){Sr("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite";let i;return this.ze.runTransaction(e,r,Aa,(r=>(i=new qa(r,this.Be?this.Be.next():Kr.I),"readwrite-primary"===t?this.rn(i).next((e=>!!e||this.on(i))).next((t=>{if(!t)throw Ar(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Me.enqueueRetryable((()=>this.We(!1))),new Lr(xr.FAILED_PRECONDITION,Ca);return n(i)})).next((e=>this.an(i).next((()=>e)))):this.En(i).next((()=>n(i)))))).then((e=>(i.raiseOnCommittedEvent(),e)))}En(e){return jc(e).get(da.key).next((e=>{if(null!==e&&this.fn(e.leaseTimestampMs,5e3)&&!this._n(e.ownerId)&&!this.un(e)&&!(this.Le||this.allowTabSynchronization&&e.allowTabSynchronization))throw new Lr(xr.FAILED_PRECONDITION,Vc)}))}an(e){const t=new da(this.clientId,this.allowTabSynchronization,Date.now());return jc(e).put(da.key,t)}static Pt(){return Oa.Pt()}cn(e){const t=jc(e);return t.get(da.key).next((e=>this.un(e)?(Sr("IndexedDbPersistence","Releasing primary lease."),t.delete(da.key)):Na.resolve()))}fn(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(Ar(`Detected an update time that is in the future: ${e} > ${n}`),!1))}tn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ke=()=>{this.Me.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.Ze())))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground="visible"===this.document.visibilityState)}gn(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}en(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.qe=()=>{this.mn(),(0,a.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Me.enterRestrictedMode(!0),this.Me.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.qe))}yn(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}_n(e){var t;try{const n=null!==(null===(t=this.Xe)||void 0===t?void 0:t.getItem(this.wn(e)));return Sr("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return Ar("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}mn(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(b){Ar("Failed to set zombie client id.",b)}}pn(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(b){}}wn(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function jc(e){return ja(e,da.store)}function Bc(e){return ja(e,Ea.store)}function zc(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class $c{constructor(e,t){this.progress=e,this.In=t}}class Kc{constructor(e,t,n){this.Je=e,this.An=t,this.Jt=n}Rn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next((n=>this.bn(e,t,n)))}bn(e,t,n){return this.Je.getEntry(e,t).next((e=>{for(const t of n)t.applyToLocalView(e);return e}))}Pn(e,t){e.forEach(((e,n)=>{for(const r of t)r.applyToLocalView(n)}))}vn(e,t){return this.Je.getEntries(e,t).next((t=>this.Vn(e,t).next((()=>t))))}Vn(e,t){return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>this.Pn(t,e)))}getDocumentsMatchingQuery(e,t,n){return function(e){return wi.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Sn(e,t.path):hs(t)?this.Dn(e,t,n):this.Cn(e,t,n)}Sn(e,t){return this.Rn(e,new wi(t)).next((e=>{let t=lo();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}Dn(e,t,n){const r=t.collectionGroup;let i=lo();return this.Jt.getCollectionParents(e,r).next((s=>Na.forEach(s,(s=>{const o=function(e,t){return new rs(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.Cn(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}Cn(e,t,n){let r,i;return this.Je.getDocumentsMatchingQuery(e,t,n).next((n=>(r=n,this.An.getAllMutationBatchesAffectingQuery(e,t)))).next((t=>(i=t,this.Nn(e,i,r).next((e=>{r=e;for(const t of i)for(const e of t.mutations){const n=e.key;let i=r.get(n);null==i&&(i=Mi.newInvalidDocument(n),r=r.insert(n,i)),js(e,i,t.localWriteTime),i.isFoundDocument()||(r=r.remove(n))}}))))).next((()=>(r.forEach(((e,n)=>{ys(t,n)||(r=r.remove(e))})),r)))}Nn(e,t,n){let r=go();for(const s of t)for(const e of s.mutations)e instanceof Ws&&null===n.get(e.key)&&(r=r.add(e.key));let i=n;return this.Je.getEntries(e,r).next((e=>(e.forEach(((e,t)=>{t.isFoundDocument()&&(i=i.insert(e,t))})),i)))}}class Wc{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.kn=n,this.xn=r}static $n(e,t){let n=go(),r=go();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Wc(e,t.fromCache,n,r)}}class Hc{On(e){this.Mn=e}getDocumentsMatchingQuery(e,t,n,r){return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(Xr.min())?this.Fn(e,t):this.Mn.vn(e,r).next((i=>{const s=this.Ln(t,i);return(os(t)||as(t))&&this.Bn(t.limitType,s,r,n)?this.Fn(e,t):(Er()<=o.in.DEBUG&&Sr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),gs(t)),this.Mn.getDocumentsMatchingQuery(e,t,n).next((e=>(s.forEach((t=>{e=e.insert(t.key,t)})),e))))}))}Ln(e,t){let n=new oo(vs(e));return t.forEach(((t,r)=>{ys(e,r)&&(n=n.add(r))})),n}Bn(e,t,n,r){if(n.size!==t.size)return!0;const i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Fn(e,t){return Er()<=o.in.DEBUG&&Sr("QueryEngine","Using full collection scan to execute query:",gs(t)),this.Mn.getDocumentsMatchingQuery(e,t,Xr.min())}}class Gc{constructor(e,t,n,r){this.persistence=e,this.Un=t,this.k=r,this.qn=new ro(Gr),this.Kn=new Nc((e=>Vi(e)),qi),this.jn=Xr.min(),this.An=e.getMutationQueue(n),this.Qn=e.getRemoteDocumentCache(),this.He=e.getTargetCache(),this.Wn=new Kc(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=e.getBundleCache(),this.Un.On(this.Wn)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.qn)))}}function Qc(e,t,n,r){return new Gc(e,t,n,r)}async function Jc(e,t){const n=Pr(e);let r=n.An,i=n.Wn;const s=await n.persistence.runTransaction("Handle user change","readonly",(e=>{let s;return n.An.getAllMutationBatches(e).next((o=>(s=o,r=n.persistence.getMutationQueue(t),i=new Kc(n.Qn,r,n.persistence.getIndexManager()),r.getAllMutationBatches(e)))).next((t=>{const n=[],r=[];let o=go();for(const e of s){n.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return i.vn(e,o).next((e=>({Gn:e,removedBatchIds:n,addedBatchIds:r})))}))}));return n.An=r,n.Wn=i,n.Un.On(n.Wn),s}function Yc(e){const t=Pr(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.He.getLastRemoteSnapshotVersion(e)))}function Xc(e,t,n,r,i){let s=go();return n.forEach((e=>s=s.add(e))),t.getEntries(e,s).next((e=>{let s=uo();return n.forEach(((n,o)=>{const a=e.get(n),c=(null==i?void 0:i.get(n))||r;o.isNoDocument()&&o.version.isEqual(Xr.min())?(t.removeEntry(n,c),s=s.insert(n,o)):!a.isValidDocument()||o.version.compareTo(a.version)>0||0===o.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(o,c),s=s.insert(n,o)):Sr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",o.version)})),s}))}function Zc(e,t){const n=Pr(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.An.getNextMutationBatchAfterBatchId(e,t))))}function eu(e,t){const n=Pr(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.He.getTargetData(e,t).next((i=>i?(r=i,Na.resolve(r)):n.He.allocateTargetId(e).next((i=>(r=new $a(t,i,0,e.currentSequenceNumber),n.He.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.qn.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qn=n.qn.insert(e.targetId,e),n.Kn.set(t,e.targetId)),e}))}async function tu(e,t,n){const r=Pr(e),i=r.qn.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!La(e))throw e;Sr("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.qn=r.qn.remove(t),r.Kn.delete(i.target)}function nu(e,t,n){const r=Pr(e);let i=Xr.min(),s=go();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=Pr(e),i=r.Kn.get(n);return void 0!==i?Na.resolve(r.qn.get(i)):r.He.getTargetData(t,n)}(r,e,ds(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Un.getDocumentsMatchingQuery(e,t,n?i:Xr.min(),n?s:go()))).next((e=>({documents:e,zn:s})))))}function ru(e,t){const n=Pr(e),r=Pr(n.He),i=n.qn.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.Et(e,t).next((e=>e?e.target:null))))}function iu(e){const t=Pr(e);return t.persistence.runTransaction("Get new document changes","readonly",(e=>function(e,t,n){const r=Pr(e);let i=uo(),s=Ga(n);const o=Lc(t),a=IDBKeyRange.lowerBound(s,!0);return o.jt({index:va.readTimeIndex,range:a},((e,t)=>{const n=Wa(r.k,t);i=i.insert(n.key,n),s=t.readTime})).next((()=>({In:i,readTime:Qa(s)})))}(t.Qn,e,t.jn))).then((({In:e,readTime:n})=>(t.jn=n,e)))}async function su(e,t,n=go()){const r=await eu(e,ds(tc(t.bundledQuery))),i=Pr(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=xo(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i.Ye.saveNamedQuery(e,t);const o=r.withResumeToken(ci.EMPTY_BYTE_STRING,s);return i.qn=i.qn.insert(o.targetId,o),i.He.updateTargetData(e,o).next((()=>i.He.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.He.addMatchingKeys(e,n,r.targetId))).next((()=>i.Ye.saveNamedQuery(e,t)))}))}class ou{constructor(e){this.k=e,this.Xn=new Map,this.Zn=new Map}getBundleMetadata(e,t){return Na.resolve(this.Xn.get(t))}saveBundleMetadata(e,t){var n;return this.Xn.set(t.id,{id:(n=t).id,version:n.version,createTime:xo(n.createTime)}),Na.resolve()}getNamedQuery(e,t){return Na.resolve(this.Zn.get(t))}saveNamedQuery(e,t){return this.Zn.set(t.name,function(e){return{name:e.name,query:tc(e.bundledQuery),readTime:xo(e.readTime)}}(t)),Na.resolve()}}class au{constructor(){this.ts=new oo(cu.es),this.ns=new oo(cu.ss)}isEmpty(){return this.ts.isEmpty()}addReference(e,t){const n=new cu(e,t);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}rs(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.os(new cu(e,t))}cs(e,t){e.forEach((e=>this.removeReference(e,t)))}us(e){const t=new wi(new ri([])),n=new cu(t,e),r=new cu(t,e+1),i=[];return this.ns.forEachInRange([n,r],(e=>{this.os(e),i.push(e.key)})),i}hs(){this.ts.forEach((e=>this.os(e)))}os(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}ls(e){const t=new wi(new ri([])),n=new cu(t,e),r=new cu(t,e+1);let i=go();return this.ns.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new cu(e,0),n=this.ts.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class cu{constructor(e,t){this.key=e,this.fs=t}static es(e,t){return wi.comparator(e.key,t.key)||Gr(e.fs,t.fs)}static ss(e,t){return Gr(e.fs,t.fs)||wi.comparator(e.key,t.key)}}class uu{constructor(e,t){this.Jt=e,this.referenceDelegate=t,this.An=[],this.ds=1,this.ws=new oo(cu.es)}checkEmpty(e){return Na.resolve(0===this.An.length)}addMutationBatch(e,t,n,r){const i=this.ds;this.ds++,this.An.length>0&&this.An[this.An.length-1];const s=new Ba(i,t,n,r);this.An.push(s);for(const o of r)this.ws=this.ws.add(new cu(o.key,i)),this.Jt.addToCollectionParentIndex(e,o.key.path.popLast());return Na.resolve(s)}lookupMutationBatch(e,t){return Na.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.gs(n),i=r<0?0:r;return Na.resolve(this.An.length>i?this.An[i]:null)}getHighestUnacknowledgedBatchId(){return Na.resolve(0===this.An.length?-1:this.ds-1)}getAllMutationBatches(e){return Na.resolve(this.An.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new cu(t,0),r=new cu(t,Number.POSITIVE_INFINITY),i=[];return this.ws.forEachInRange([n,r],(e=>{const t=this._s(e.fs);i.push(t)})),Na.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new oo(Gr);return t.forEach((e=>{const t=new cu(e,0),r=new cu(e,Number.POSITIVE_INFINITY);this.ws.forEachInRange([t,r],(e=>{n=n.add(e.fs)}))})),Na.resolve(this.ys(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;wi.isDocumentKey(i)||(i=i.child(""));const s=new cu(new wi(i),0);let o=new oo(Gr);return this.ws.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.fs)),!0)}),s),Na.resolve(this.ys(o))}ys(e){const t=[];return e.forEach((e=>{const n=this._s(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){Dr(0===this.ps(t.batchId,"removed")),this.An.shift();let n=this.ws;return Na.forEach(t.mutations,(r=>{const i=new cu(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.ws=n}))}ee(e){}containsKey(e,t){const n=new cu(t,0),r=this.ws.firstAfterOrEqual(n);return Na.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.An.length,Na.resolve()}ps(e,t){return this.gs(e)}gs(e){return 0===this.An.length?0:e-this.An[0].batchId}_s(e){const t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}class hu{constructor(e,t){this.Jt=e,this.Ts=t,this.docs=new ro(wi.comparator),this.size=0}addEntry(e,t,n){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Ts(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o,readTime:n}),this.size+=o-s,this.Jt.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Na.resolve(n?n.document.mutableCopy():Mi.newInvalidDocument(t))}getEntries(e,t){let n=uo();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Mi.newInvalidDocument(e))})),Na.resolve(n)}getDocumentsMatchingQuery(e,t,n){let r=uo();const i=new wi(t.path.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i,readTime:o}}=s.getNext();if(!t.path.isPrefixOf(e.path))break;o.compareTo(n)<=0||ys(t,i)&&(r=r.insert(i.key,i.mutableCopy()))}return Na.resolve(r)}Es(e,t){return Na.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new lu(this)}getSize(e){return Na.resolve(this.size)}}class lu extends Dc{constructor(e){super(),this.De=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.document.isValidDocument()?t.push(this.De.addEntry(e,r.document,this.getReadTime(n))):this.De.removeEntry(n)})),Na.waitFor(t)}getFromCache(e,t){return this.De.getEntry(e,t)}getAllFromCache(e,t){return this.De.getEntries(e,t)}}class du{constructor(e){this.persistence=e,this.Is=new Nc((e=>Vi(e)),qi),this.lastRemoteSnapshotVersion=Xr.min(),this.highestTargetId=0,this.As=0,this.Rs=new au,this.targetCount=0,this.bs=vc.ie()}forEachTarget(e,t){return this.Is.forEach(((e,n)=>t(n))),Na.resolve()}getLastRemoteSnapshotVersion(e){return Na.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Na.resolve(this.As)}allocateTargetId(e){return this.highestTargetId=this.bs.next(),Na.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.As&&(this.As=t),Na.resolve()}ae(e){this.Is.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.bs=new vc(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}addTargetData(e,t){return this.ae(t),this.targetCount+=1,Na.resolve()}updateTargetData(e,t){return this.ae(t),Na.resolve()}removeTargetData(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,Na.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Is.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Is.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Na.waitFor(i).next((()=>r))}getTargetCount(e){return Na.resolve(this.targetCount)}getTargetData(e,t){const n=this.Is.get(t)||null;return Na.resolve(n)}addMatchingKeys(e,t,n){return this.Rs.rs(t,n),Na.resolve()}removeMatchingKeys(e,t,n){this.Rs.cs(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Na.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Rs.us(t),Na.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Rs.ls(t);return Na.resolve(n)}containsKey(e,t){return Na.resolve(this.Rs.containsKey(t))}}class fu{constructor(e,t){this.Ps={},this.Be=new Kr(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=e(this),this.He=new du(this),this.Jt=new sc,this.Je=function(e,t){return new hu(e,t)}(this.Jt,(e=>this.referenceDelegate.vs(e))),this.k=new Ka(t),this.Ye=new ou(this.k)}start(){return Promise.resolve()}shutdown(){return this.Ue=!1,Promise.resolve()}get started(){return this.Ue}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(){return this.Jt}getMutationQueue(e){let t=this.Ps[e.toKey()];return t||(t=new uu(this.Jt,this.referenceDelegate),this.Ps[e.toKey()]=t),t}getTargetCache(){return this.He}getRemoteDocumentCache(){return this.Je}getBundleCache(){return this.Ye}runTransaction(e,t,n){Sr("MemoryPersistence","Starting transaction:",e);const r=new pu(this.Be.next());return this.referenceDelegate.Vs(),n(r).next((e=>this.referenceDelegate.Ss(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Ds(e,t){return Na.or(Object.values(this.Ps).map((n=>()=>n.containsKey(e,t))))}}class pu extends Ra{constructor(e){super(),this.currentSequenceNumber=e}}class mu{constructor(e){this.persistence=e,this.Cs=new au,this.Ns=null}static ks(e){return new mu(e)}get xs(){if(this.Ns)return this.Ns;throw Nr()}addReference(e,t,n){return this.Cs.addReference(n,t),this.xs.delete(n.toString()),Na.resolve()}removeReference(e,t,n){return this.Cs.removeReference(n,t),this.xs.add(n.toString()),Na.resolve()}markPotentiallyOrphaned(e,t){return this.xs.add(t.toString()),Na.resolve()}removeTarget(e,t){this.Cs.us(t.targetId).forEach((e=>this.xs.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.xs.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Vs(){this.Ns=new Set}Ss(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Na.forEach(this.xs,(n=>{const r=wi.fromPath(n);return this.$s(e,r).next((e=>{e||t.removeEntry(r)}))})).next((()=>(this.Ns=null,t.apply(e))))}updateLimboDocument(e,t){return this.$s(e,t).next((e=>{e?this.xs.delete(t.toString()):this.xs.add(t.toString())}))}vs(e){return 0}$s(e,t){return Na.or([()=>Na.resolve(this.Cs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ds(e,t)])}}function gu(e,t){return`firestore_clients_${e}_${t}`}function yu(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function vu(e,t){return`firestore_targets_${e}_${t}`}class wu{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Os(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new Lr(r.error.code,r.error.message))),s?new wu(e,t,r.state,i):(Ar("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ms(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class _u{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Os(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new Lr(n.error.code,n.error.message))),i?new _u(e,n.state,r):(Ar("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Ms(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class bu{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Os(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=vo();for(let s=0;r&&s<n.activeTargetIds.length;++s)r=vi(n.activeTargetIds[s]),i=i.add(n.activeTargetIds[s]);return r?new bu(e,i):(Ar("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Iu{constructor(e,t){this.clientId=e,this.onlineState=t}static Os(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Iu(t.clientId,t.onlineState):(Ar("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Tu{constructor(){this.activeTargetIds=vo()}Fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ls(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ms(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Eu{constructor(e,t,n,r,i){this.window=e,this.Me=t,this.persistenceKey=n,this.Bs=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Us=this.qs.bind(this),this.Ks=new ro(Gr),this.started=!1,this.js=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Qs=gu(this.persistenceKey,this.Bs),this.Ws=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.Ks=this.Ks.insert(this.Bs,new Tu),this.Gs=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this.zs=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.Hs=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.Js=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.Ys=function(e){return`firestore_bundle_loaded_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.Us)}static Pt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Tn();for(const n of e){if(n===this.Bs)continue;const e=this.getItem(gu(this.persistenceKey,n));if(e){const t=bu.Os(n,e);t&&(this.Ks=this.Ks.insert(t.clientId,t))}}this.Xs();const t=this.storage.getItem(this.Js);if(t){const e=this.Zs(t);e&&this.ti(e)}for(const n of this.js)this.qs(n);this.js=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.Ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ei(this.Ks)}isActiveQueryTarget(e){let t=!1;return this.Ks.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.ni(e,"pending")}updateMutationState(e,t,n){this.ni(e,t,n),this.si(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(vu(this.persistenceKey,e));if(n){const r=_u.Os(e,n);r&&(t=r.state)}}return this.ii.Fs(e),this.Xs(),t}removeLocalQueryTarget(e){this.ii.Ls(e),this.Xs()}isLocalQueryTarget(e){return this.ii.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(vu(this.persistenceKey,e))}updateQueryState(e,t,n){this.ri(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.si(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.oi(e)}notifyBundleLoaded(){this.ci()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Us),this.removeItem(this.Qs),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Sr("SharedClientState","READ",e,t),t}setItem(e,t){Sr("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){Sr("SharedClientState","REMOVE",e),this.storage.removeItem(e)}qs(e){const t=e;if(t.storageArea===this.storage){if(Sr("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Qs)return void Ar("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Me.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.Gs.test(t.key)){if(null==t.newValue){const e=this.ai(t.key);return this.ui(e,null)}{const e=this.hi(t.key,t.newValue);if(e)return this.ui(e.clientId,e)}}else if(this.zs.test(t.key)){if(null!==t.newValue){const e=this.li(t.key,t.newValue);if(e)return this.fi(e)}}else if(this.Hs.test(t.key)){if(null!==t.newValue){const e=this.di(t.key,t.newValue);if(e)return this.wi(e)}}else if(t.key===this.Js){if(null!==t.newValue){const e=this.Zs(t.newValue);if(e)return this.ti(e)}}else if(t.key===this.Ws){const e=function(e){let t=Kr.I;if(null!=e)try{const n=JSON.parse(e);Dr("number"==typeof n),t=n}catch(e){Ar("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==Kr.I&&this.sequenceNumberHandler(e)}else if(t.key===this.Ys)return this.syncEngine._i()}else this.js.push(t)}))}}get ii(){return this.Ks.get(this.Bs)}Xs(){this.setItem(this.Qs,this.ii.Ms())}ni(e,t,n){const r=new wu(this.currentUser,e,t,n),i=yu(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Ms())}si(e){const t=yu(this.persistenceKey,this.currentUser,e);this.removeItem(t)}oi(e){const t={clientId:this.Bs,onlineState:e};this.storage.setItem(this.Js,JSON.stringify(t))}ri(e,t,n){const r=vu(this.persistenceKey,e),i=new _u(e,t,n);this.setItem(r,i.Ms())}ci(){this.setItem(this.Ys,"value-not-used")}ai(e){const t=this.Gs.exec(e);return t?t[1]:null}hi(e,t){const n=this.ai(e);return bu.Os(n,t)}li(e,t){const n=this.zs.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return wu.Os(new br(i),r,t)}di(e,t){const n=this.Hs.exec(e),r=Number(n[1]);return _u.Os(r,t)}Zs(e){return Iu.Os(e)}async fi(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.mi(e.batchId,e.state,e.error);Sr("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}wi(e){return this.syncEngine.gi(e.targetId,e.state,e.error)}ui(e,t){const n=t?this.Ks.insert(e,t):this.Ks.remove(e),r=this.ei(this.Ks),i=this.ei(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.yi(s,o).then((()=>{this.Ks=n}))}ti(e){this.Ks.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ei(e){let t=vo();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class ku{constructor(){this.pi=new Tu,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.pi.Fs(e),this.Ti[e]||"not-current"}updateQueryState(e,t,n){this.Ti[e]=t}removeLocalQueryTarget(e){this.pi.Ls(e)}isLocalQueryTarget(e){return this.pi.activeTargetIds.has(e)}clearQueryState(e){delete this.Ti[e]}getAllActiveQueryTargets(){return this.pi.activeTargetIds}isActiveQueryTarget(e){return this.pi.activeTargetIds.has(e)}start(){return this.pi=new Tu,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class Su{Ei(e){}shutdown(){}}class Au{constructor(){this.Ii=()=>this.Ai(),this.Ri=()=>this.bi(),this.Pi=[],this.vi()}Ei(e){this.Pi.push(e)}shutdown(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}vi(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}Ai(){Sr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Pi)e(0)}bi(){Sr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Pi)e(1)}static Pt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Cu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Ru{constructor(e){this.Vi=e.Vi,this.Si=e.Si}Di(e){this.Ci=e}Ni(e){this.ki=e}onMessage(e){this.xi=e}close(){this.Si()}send(e){this.Vi(e)}$i(){this.Ci()}Oi(e){this.ki(e)}Mi(e){this.xi(e)}}class Nu extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.Fi=t+"://"+e.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Bi(e,t,n,r,i){const s=this.Ui(e,t);Sr("RestConnection","Sending: ",s,n);const o={};return this.qi(o,r,i),this.Ki(e,s,o,n).then((e=>(Sr("RestConnection","Received: ",e),e)),(t=>{throw Cr("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t}))}ji(e,t,n,r,i){return this.Bi(e,t,n,r,i)}qi(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ir,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}Ui(e,t){const n=Cu[e];return`${this.Fi}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Ki(e,t,n,r){return new Promise(((i,s)=>{const o=new vr;o.listenOnce(fr.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case dr.NO_ERROR:const t=o.getResponseJson();Sr("Connection","XHR received:",JSON.stringify(t)),i(t);break;case dr.TIMEOUT:Sr("Connection",'RPC "'+e+'" timed out'),s(new Lr(xr.DEADLINE_EXCEEDED,"Request time out"));break;case dr.HTTP_ERROR:const n=o.getStatus();if(Sr("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(xr).indexOf(t)>=0?t:xr.UNKNOWN}(e.status);s(new Lr(t,e.message))}else s(new Lr(xr.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new Lr(xr.UNAVAILABLE,"Connection failed."));break;default:Nr()}}finally{Sr("Connection",'RPC "'+e+'" completed.')}}));const a=JSON.stringify(r);o.send(t,"POST",a,n,15)}))}Qi(e,t,n){const r=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=hr(),s=lr(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new gr({})),this.qi(o.initMessageHeaders,t,n),(0,a.uI)()||(0,a.b$)()||(0,a.d)()||(0,a.w1)()||(0,a.Mn)()||(0,a.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");const c=r.join("");Sr("Connection","Creating WebChannel: "+c,o);const u=i.createWebChannel(c,o);let h=!1,l=!1;const d=new Ru({Vi:e=>{l?Sr("Connection","Not sending because WebChannel is closed:",e):(h||(Sr("Connection","Opening WebChannel transport."),u.open(),h=!0),Sr("Connection","WebChannel sending:",e),u.send(e))},Si:()=>u.close()}),f=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return f(u,yr.EventType.OPEN,(()=>{l||Sr("Connection","WebChannel transport opened.")})),f(u,yr.EventType.CLOSE,(()=>{l||(l=!0,Sr("Connection","WebChannel transport closed"),d.Oi())})),f(u,yr.EventType.ERROR,(e=>{l||(l=!0,Cr("Connection","WebChannel transport errored:",e),d.Oi(new Lr(xr.UNAVAILABLE,"The operation could not be completed")))})),f(u,yr.EventType.MESSAGE,(e=>{var t;if(!l){const n=e.data[0];Dr(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){Sr("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=Zs[e];if(void 0!==t)return no(t)}(e),n=i.message;void 0===t&&(t=xr.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),l=!0,d.Oi(new Lr(t,n)),u.close()}else Sr("Connection","WebChannel received:",n),d.Mi(n)}})),f(s,pr.STAT_EVENT,(e=>{e.stat===mr.PROXY?Sr("Connection","Detected buffering proxy"):e.stat===mr.NOPROXY&&Sr("Connection","Detected no buffering proxy")})),setTimeout((()=>{d.$i()}),0),d}}function Du(){return"undefined"!=typeof window?window:null}function Ou(){return"undefined"!=typeof document?document:null}function Pu(e){return new No(e,!0)}class xu{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Me=e,this.timerId=t,this.Wi=n,this.Gi=r,this.zi=i,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}reset(){this.Hi=0}Xi(){this.Hi=this.zi}Zi(e){this.cancel();const t=Math.floor(this.Hi+this.tr()),n=Math.max(0,Date.now()-this.Yi),r=Math.max(0,t-n);r>0&&Sr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Hi} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Ji=this.Me.enqueueAfterDelay(this.timerId,r,(()=>(this.Yi=Date.now(),e()))),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}er(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}cancel(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}tr(){return(Math.random()-.5)*this.Hi}}class Lu{constructor(e,t,n,r,i,s,o,a){this.Me=e,this.nr=n,this.sr=r,this.ir=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.rr=0,this.cr=null,this.ar=null,this.stream=null,this.ur=new xu(e,t)}hr(){return 1===this.state||5===this.state||this.lr()}lr(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.dr()}async stop(){this.hr()&&await this.close(0)}wr(){this.state=0,this.ur.reset()}_r(){this.lr()&&null===this.cr&&(this.cr=this.Me.enqueueAfterDelay(this.nr,6e4,(()=>this.mr())))}gr(e){this.yr(),this.stream.send(e)}async mr(){if(this.lr())return this.close(0)}yr(){this.cr&&(this.cr.cancel(),this.cr=null)}pr(){this.ar&&(this.ar.cancel(),this.ar=null)}async close(e,t){this.yr(),this.pr(),this.ur.cancel(),this.rr++,4!==e?this.ur.reset():t&&t.code===xr.RESOURCE_EXHAUSTED?(Ar(t.toString()),Ar("Using maximum backoff delay to prevent overloading the backend."),this.ur.Xi()):t&&t.code===xr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Tr(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Ni(t)}Tr(){}auth(){this.state=1;const e=this.Er(this.rr),t=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.rr===t&&this.Ir(e,n)}),(t=>{e((()=>{const e=new Lr(xr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Ar(e)}))}))}Ir(e,t){const n=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di((()=>{n((()=>(this.state=2,this.ar=this.Me.enqueueAfterDelay(this.sr,1e4,(()=>(this.lr()&&(this.state=3),Promise.resolve()))),this.listener.Di())))})),this.stream.Ni((e=>{n((()=>this.Ar(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}dr(){this.state=5,this.ur.Zi((async()=>{this.state=0,this.start()}))}Ar(e){return Sr("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Er(e){return t=>{this.Me.enqueueAndForget((()=>this.rr===e?t():(Sr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Mu extends Lu{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.k=i}Rr(e,t){return this.ir.Qi("Listen",e,t)}onMessage(e){this.ur.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Nr()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.C?(Dr(void 0===t||"string"==typeof t),ci.fromBase64String(t||"")):(Dr(void 0===t||t instanceof Uint8Array),ci.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?xr.UNKNOWN:no(e.code);return new Lr(t,e.message||"")}(o);n=new To(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Fo(e,r.document.name),s=xo(r.document.updateTime),o=new xi({mapValue:{fields:r.document.fields}}),a=Mi.newFoundDocument(i,s,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new bo(c,u,a.key,a)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Fo(e,r.document),s=r.readTime?xo(r.readTime):Xr.min(),o=Mi.newNoDocument(i,s),a=r.removedTargetIds||[];n=new bo([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Fo(e,r.document),s=r.removedTargetIds||[];n=new bo([],s,i,null)}else{if(!("filter"in t))return Nr();{t.filter;const e=t.filter;e.targetId;const r=e.count||0,i=new Xs(r),s=e.targetId;n=new Io(s,i)}}return n}(this.k,e),n=function(e){if(!("targetChange"in e))return Xr.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Xr.min():t.readTime?xo(t.readTime):Xr.min()}(e);return this.listener.br(t,n)}Pr(e){const t={};t.database=jo(this.k),t.addTarget=function(e,t){let n;const r=t.target;return n=ji(r)?{documents:Ho(e,r)}:{query:Go(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Oo(e,t.resumeToken):t.snapshotVersion.compareTo(Xr.min())>0&&(n.readTime=Do(e,t.snapshotVersion.toTimestamp())),n}(this.k,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Nr()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.k,e);n&&(t.labels=n),this.gr(t)}vr(e){const t={};t.database=jo(this.k),t.removeTarget=e,this.gr(t)}}class Uu extends Lu{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.k=i,this.Vr=!1}get Sr(){return this.Vr}start(){this.Vr=!1,this.lastStreamToken=void 0,super.start()}Tr(){this.Vr&&this.Dr([])}Rr(e,t){return this.ir.Qi("Write",e,t)}onMessage(e){if(Dr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();const t=function(e,t){return e&&e.length>0?(Dr(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?xo(e.updateTime):xo(t);return n.isEqual(Xr.min())&&(n=xo(t)),new Ms(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=xo(e.commitTime);return this.listener.Cr(n,t)}return Dr(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}kr(){const e={};e.database=jo(this.k),this.gr(e)}Dr(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Ko(this.k,e)))};this.gr(t)}}class Fu extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.ir=n,this.k=r,this.$r=!1}Or(){if(this.$r)throw new Lr(xr.FAILED_PRECONDITION,"The client has already been terminated.")}Bi(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.ir.Bi(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===xr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Lr(xr.UNKNOWN,e.toString())}))}ji(e,t,n){return this.Or(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.ir.ji(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===xr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Lr(xr.UNKNOWN,e.toString())}))}terminate(){this.$r=!0}}class Vu{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Mr=0,this.Fr=null,this.Lr=!0}Br(){0===this.Mr&&(this.Ur("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.Fr=null,this.qr("Backend didn't respond within 10 seconds."),this.Ur("Offline"),Promise.resolve()))))}Kr(e){"Online"===this.state?this.Ur("Unknown"):(this.Mr++,this.Mr>=1&&(this.jr(),this.qr(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.Ur("Offline")))}set(e){this.jr(),this.Mr=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}Ur(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}qr(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Lr?(Ar(t),this.Lr=!1):Sr("OnlineStateTracker",t)}jr(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}class qu{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=i,this.Hr.Ei((e=>{n.enqueueAndForget((async()=>{Qu(this)&&(Sr("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=Pr(e);t.Gr.add(4),await Bu(t),t.Jr.set("Unknown"),t.Gr.delete(4),await ju(t)}(this))}))})),this.Jr=new Vu(n,r)}}async function ju(e){if(Qu(e))for(const t of e.zr)await t(!0)}async function Bu(e){for(const t of e.zr)await t(!1)}function zu(e,t){const n=Pr(e);n.Wr.has(t.targetId)||(n.Wr.set(t.targetId,t),Gu(n)?Hu(n):dh(n).lr()&&Ku(n,t))}function $u(e,t){const n=Pr(e),r=dh(n);n.Wr.delete(t),r.lr()&&Wu(n,t),0===n.Wr.size&&(r.lr()?r._r():Qu(n)&&n.Jr.set("Unknown"))}function Ku(e,t){e.Yr.X(t.targetId),dh(e).Pr(t)}function Wu(e,t){e.Yr.X(t),dh(e).vr(t)}function Hu(e){e.Yr=new ko({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Wr.get(t)||null}),dh(e).start(),e.Jr.Br()}function Gu(e){return Qu(e)&&!dh(e).hr()&&e.Wr.size>0}function Qu(e){return 0===Pr(e).Gr.size}function Ju(e){e.Yr=void 0}async function Yu(e){e.Wr.forEach(((t,n)=>{Ku(e,t)}))}async function Xu(e,t){Ju(e),Gu(e)?(e.Jr.Kr(t),Hu(e)):e.Jr.set("Unknown")}async function Zu(e,t,n){if(e.Jr.set("Online"),t instanceof To&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.Wr.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Wr.delete(r),e.Yr.removeTarget(r))}(e,t)}catch(n){Sr("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await eh(e,n)}else if(t instanceof bo?e.Yr.ot(t):t instanceof Io?e.Yr.dt(t):e.Yr.ut(t),!n.isEqual(Xr.min()))try{const t=await Yc(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Yr.gt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.Wr.get(r);i&&e.Wr.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e.Wr.get(t);if(!n)return;e.Wr.set(t,n.withResumeToken(ci.EMPTY_BYTE_STRING,n.snapshotVersion)),Wu(e,t);const r=new $a(n.target,t,1,n.sequenceNumber);Ku(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Sr("RemoteStore","Failed to raise snapshot:",t),await eh(e,t)}}async function eh(e,t,n){if(!La(t))throw t;e.Gr.add(1),await Bu(e),e.Jr.set("Offline"),n||(n=()=>Yc(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Sr("RemoteStore","Retrying IndexedDB access"),await n(),e.Gr.delete(1),await ju(e)}))}function th(e,t){return t().catch((n=>eh(e,n,t)))}async function nh(e){const t=Pr(e),n=fh(t);let r=t.Qr.length>0?t.Qr[t.Qr.length-1].batchId:-1;for(;rh(t);)try{const e=await Zc(t.localStore,r);if(null===e){0===t.Qr.length&&n._r();break}r=e.batchId,ih(t,e)}catch(e){await eh(t,e)}sh(t)&&oh(t)}function rh(e){return Qu(e)&&e.Qr.length<10}function ih(e,t){e.Qr.push(t);const n=fh(e);n.lr()&&n.Sr&&n.Dr(t.mutations)}function sh(e){return Qu(e)&&!fh(e).hr()&&e.Qr.length>0}function oh(e){fh(e).start()}async function ah(e){fh(e).kr()}async function ch(e){const t=fh(e);for(const n of e.Qr)t.Dr(n.mutations)}async function uh(e,t,n){const r=e.Qr.shift(),i=za.from(r,t,n);await th(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await nh(e)}async function hh(e,t){t&&fh(e).Sr&&await async function(e,t){if(to(n=t.code)&&n!==xr.ABORTED){const n=e.Qr.shift();fh(e).wr(),await th(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await nh(e)}var n}(e,t),sh(e)&&oh(e)}async function lh(e,t){const n=Pr(e);t?(n.Gr.delete(2),await ju(n)):t||(n.Gr.add(2),await Bu(n),n.Jr.set("Unknown"))}function dh(e){return e.Xr||(e.Xr=function(e,t,n){const r=Pr(e);return r.Or(),new Mu(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:Yu.bind(null,e),Ni:Xu.bind(null,e),br:Zu.bind(null,e)}),e.zr.push((async t=>{t?(e.Xr.wr(),Gu(e)?Hu(e):e.Jr.set("Unknown")):(await e.Xr.stop(),Ju(e))}))),e.Xr}function fh(e){return e.Zr||(e.Zr=function(e,t,n){const r=Pr(e);return r.Or(),new Uu(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:ah.bind(null,e),Ni:hh.bind(null,e),Nr:ch.bind(null,e),Cr:uh.bind(null,e)}),e.zr.push((async t=>{t?(e.Zr.wr(),await nh(e)):(await e.Zr.stop(),e.Qr.length>0&&(Sr("RemoteStore",`Stopping write stream with ${e.Qr.length} pending writes`),e.Qr=[]))}))),e.Zr}class ph{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Mr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new ph(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Lr(xr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function mh(e,t){if(Ar("AsyncQueue",`${t}: ${e}`),La(e))return new Lr(xr.UNAVAILABLE,`${t}: ${e}`);throw e}class gh{constructor(e){this.comparator=e?(t,n)=>e(t,n)||wi.comparator(t.key,n.key):(e,t)=>wi.comparator(e.key,t.key),this.keyedMap=lo(),this.sortedSet=new ro(this.comparator)}static emptySet(e){return new gh(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof gh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new gh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class yh{constructor(){this.eo=new ro(wi.comparator)}track(e){const t=e.doc.key,n=this.eo.get(t);n?0!==e.type&&3===n.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==n.type?this.eo=this.eo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.eo=this.eo.remove(t):1===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):Nr():this.eo=this.eo.insert(t,e)}no(){const e=[];return this.eo.inorderTraversal(((t,n)=>{e.push(n)})),e}}class vh{constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach((e=>{i.push({type:0,doc:e})})),new vh(e,t,gh.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ps(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class wh{constructor(){this.so=void 0,this.listeners=[]}}class _h{constructor(){this.queries=new Nc((e=>ms(e)),ps),this.onlineState="Unknown",this.io=new Set}}async function bh(e,t){const n=Pr(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new wh),i)try{s.so=await n.onListen(r)}catch(e){const n=mh(e,`Initialization of query '${gs(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.ro(n.onlineState),s.so&&t.oo(s.so)&&kh(n)}async function Ih(e,t){const n=Pr(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Th(e,t){const n=Pr(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.listeners)e.oo(i)&&(r=!0);t.so=i}}r&&kh(n)}function Eh(e,t,n){const r=Pr(e),i=r.queries.get(t);if(i)for(const s of i.listeners)s.onError(n);r.queries.delete(t)}function kh(e){e.io.forEach((e=>{e.next()}))}class Sh{constructor(e,t,n){this.query=e,this.co=t,this.ao=!1,this.uo=null,this.onlineState="Unknown",this.options=n||{}}oo(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new vh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.ao?this.ho(e)&&(this.co.next(e),t=!0):this.lo(e,this.onlineState)&&(this.fo(e),t=!0),this.uo=e,t}onError(e){this.co.error(e)}ro(e){this.onlineState=e;let t=!1;return this.uo&&!this.ao&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}lo(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return(!this.options.wo||!n)&&(!e.docs.isEmpty()||"Offline"===t)}ho(e){if(e.docChanges.length>0)return!0;const t=this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}fo(e){e=vh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.ao=!0,this.co.next(e)}}class Ah{constructor(e,t){this.payload=e,this.byteLength=t}_o(){return"metadata"in this.payload}}class Ch{constructor(e){this.k=e}Hn(e){return Fo(this.k,e)}Jn(e){return e.metadata.exists?$o(this.k,e.document,!1):Mi.newNoDocument(this.Hn(e.metadata.name),this.Yn(e.metadata.readTime))}Yn(e){return xo(e)}}class Rh{constructor(e,t,n){this.mo=e,this.localStore=t,this.k=n,this.queries=[],this.documents=[],this.progress=Nh(e)}yo(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}po(e){const t=new Map,n=new Ch(this.k);for(const r of e)if(r.metadata.queries){const e=n.Hn(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||go()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=Pr(e);let s=go(),o=uo(),a=po();for(const h of n){const e=t.Hn(h.metadata.name);h.document&&(s=s.add(e)),o=o.insert(e,t.Jn(h)),a=a.insert(e,t.Yn(h.metadata.readTime))}const c=i.Qn.newChangeBuffer({trackRemovals:!0}),u=await eu(i,function(e){return ds(ss(ri.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>Xc(e,c,o,Xr.min(),a).next((t=>(c.apply(e),t))).next((t=>i.He.removeMatchingKeysForTargetId(e,u.targetId).next((()=>i.He.addMatchingKeys(e,s,u.targetId))).next((()=>i.Wn.Vn(e,t))).next((()=>t))))))}(this.localStore,new Ch(this.k),this.documents,this.mo.id),t=this.po(this.documents);for(const n of this.queries)await su(this.localStore,n,t.get(n.name));return this.progress.taskState="Success",new $c(Object.assign({},this.progress),e)}}function Nh(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class Dh{constructor(e){this.key=e}}class Oh{constructor(e){this.key=e}}class Ph{constructor(e,t){this.query=e,this.To=t,this.Eo=null,this.current=!1,this.Io=go(),this.mutatedKeys=go(),this.Ao=vs(e),this.Ro=new gh(this.Ao)}get bo(){return this.To}Po(e,t){const n=t?t.vo:new yh,r=t?t.Ro:this.Ro;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a=os(this.query)&&r.size===this.query.limit?r.last():null,c=as(this.query)&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),h=ys(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Vo(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Ao(h,a)>0||c&&this.Ao(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),os(this.query)||as(this.query))for(;s.size>this.query.limit;){const e=os(this.query)?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Ro:s,vo:n,Bn:o,mutatedKeys:i}}Vo(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;const i=e.vo.no();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Nr()}};return n(e)-n(t)}(e.type,t.type)||this.Ao(e.doc,t.doc))),this.So(n);const s=t?this.Do():[],o=0===this.Io.size&&this.current?1:0,a=o!==this.Eo;return this.Eo=o,0!==i.length||a?{snapshot:new vh(this.query,e.Ro,r,i,e.mutatedKeys,0===o,a,!1),Co:s}:{Co:s}}ro(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new yh,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}No(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}So(e){e&&(e.addedDocuments.forEach((e=>this.To=this.To.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.To=this.To.delete(e))),this.current=e.current)}Do(){if(!this.current)return[];const e=this.Io;this.Io=go(),this.Ro.forEach((e=>{this.No(e.key)&&(this.Io=this.Io.add(e.key))}));const t=[];return e.forEach((e=>{this.Io.has(e)||t.push(new Oh(e))})),this.Io.forEach((n=>{e.has(n)||t.push(new Dh(n))})),t}ko(e){this.To=e.zn,this.Io=go();const t=this.Po(e.documents);return this.applyChanges(t,!0)}xo(){return vh.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}class xh{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Lh{constructor(e){this.key=e,this.$o=!1}}class Mh{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Oo={},this.Mo=new Nc((e=>ms(e)),ps),this.Fo=new Map,this.Lo=new Set,this.Bo=new ro(wi.comparator),this.Uo=new Map,this.qo=new au,this.Ko={},this.jo=new Map,this.Qo=vc.re(),this.onlineState="Unknown",this.Wo=void 0}get isPrimaryClient(){return!0===this.Wo}}async function Uh(e,t){const n=ul(e);let r,i;const s=n.Mo.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.xo();else{const e=await eu(n.localStore,ds(t)),s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await Fh(n,t,r,"current"===s),n.isPrimaryClient&&zu(n.remoteStore,e)}return i}async function Fh(e,t,n,r){e.Go=(t,n,r)=>async function(e,t,n,r){let i=t.view.Po(n);i.Bn&&(i=await nu(e.localStore,t.query,!1).then((({documents:e})=>t.view.Po(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return Qh(e,t.targetId,o.Co),o.snapshot}(e,t,n,r);const i=await nu(e.localStore,t,!0),s=new Ph(t,i.zn),o=s.Po(i.documents),a=_o.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState),c=s.applyChanges(o,e.isPrimaryClient,a);Qh(e,n,c.Co);const u=new xh(t,n,s);return e.Mo.set(t,u),e.Fo.has(n)?e.Fo.get(n).push(t):e.Fo.set(n,[t]),c.snapshot}async function Vh(e,t){const n=Pr(e),r=n.Mo.get(t),i=n.Fo.get(r.targetId);if(i.length>1)return n.Fo.set(r.targetId,i.filter((e=>!ps(e,t)))),void n.Mo.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await tu(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),$u(n.remoteStore,r.targetId),Hh(n,r.targetId)})).catch(Tc)):(Hh(n,r.targetId),await tu(n.localStore,r.targetId,!0))}async function qh(e,t){const n=Pr(e);try{const e=await function(e,t){const n=Pr(e),r=t.snapshotVersion;let i=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.qn;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.He.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.He.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(a)?u=u.withResumeToken(ci.EMPTY_BYTE_STRING,Xr.min()).withLastLimboFreeSnapshotVersion(Xr.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.He.updateTargetData(e,u))}));let a=uo();if(t.documentUpdates.forEach(((r,i)=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(Xc(e,s,t.documentUpdates,r,void 0).next((e=>{a=e}))),!r.isEqual(Xr.min())){const t=n.He.getLastRemoteSnapshotVersion(e).next((t=>n.He.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Na.waitFor(o).next((()=>s.apply(e))).next((()=>n.Wn.Vn(e,a))).next((()=>a))})).then((e=>(n.qn=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Uo.get(t);r&&(Dr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.$o=!0:e.modifiedDocuments.size>0?Dr(r.$o):e.removedDocuments.size>0&&(Dr(r.$o),r.$o=!1))})),await Xh(n,e,t)}catch(e){await Tc(e)}}function jh(e,t,n){const r=Pr(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.Mo.forEach(((n,r)=>{const i=r.view.ro(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=Pr(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const i of n.listeners)i.ro(t)&&(r=!0)})),r&&kh(n)}(r.eventManager,t),e.length&&r.Oo.br(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Bh(e,t,n){const r=Pr(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Uo.get(t),s=i&&i.key;if(s){let e=new ro(wi.comparator);e=e.insert(s,Mi.newNoDocument(s,Xr.min()));const n=go().add(s),i=new wo(Xr.min(),new Map,new oo(Gr),e,n);await qh(r,i),r.Bo=r.Bo.remove(s),r.Uo.delete(t),Yh(r)}else await tu(r.localStore,t,!1).then((()=>Hh(r,t,n))).catch(Tc)}async function zh(e,t){const n=Pr(e),r=t.batch.batchId;try{const e=await function(e,t){const n=Pr(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.Qn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=Na.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);Dr(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))}))})),o.next((()=>e.An.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.An.performConsistencyCheck(e))).next((()=>n.Wn.vn(e,r)))}))}(n.localStore,t);Wh(n,r,null),Kh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Xh(n,e)}catch(e){await Tc(e)}}async function $h(e,t,n){const r=Pr(e);try{const e=await function(e,t){const n=Pr(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.An.lookupMutationBatch(e,t).next((t=>(Dr(null!==t),r=t.keys(),n.An.removeMutationBatch(e,t)))).next((()=>n.An.performConsistencyCheck(e))).next((()=>n.Wn.vn(e,r)))}))}(r.localStore,t);Wh(r,t,n),Kh(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Xh(r,e)}catch(n){await Tc(n)}}function Kh(e,t){(e.jo.get(t)||[]).forEach((e=>{e.resolve()})),e.jo.delete(t)}function Wh(e,t,n){const r=Pr(e);let i=r.Ko[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Ko[r.currentUser.toKey()]=i}}function Hh(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Fo.get(t))e.Mo.delete(r),n&&e.Oo.zo(r,n);e.Fo.delete(t),e.isPrimaryClient&&e.qo.us(t).forEach((t=>{e.qo.containsKey(t)||Gh(e,t)}))}function Gh(e,t){e.Lo.delete(t.path.canonicalString());const n=e.Bo.get(t);null!==n&&($u(e.remoteStore,n),e.Bo=e.Bo.remove(t),e.Uo.delete(n),Yh(e))}function Qh(e,t,n){for(const r of n)r instanceof Dh?(e.qo.addReference(r.key,t),Jh(e,r)):r instanceof Oh?(Sr("SyncEngine","Document no longer in limbo: "+r.key),e.qo.removeReference(r.key,t),e.qo.containsKey(r.key)||Gh(e,r.key)):Nr()}function Jh(e,t){const n=t.key,r=n.path.canonicalString();e.Bo.get(n)||e.Lo.has(r)||(Sr("SyncEngine","New document in limbo: "+n),e.Lo.add(r),Yh(e))}function Yh(e){for(;e.Lo.size>0&&e.Bo.size<e.maxConcurrentLimboResolutions;){const t=e.Lo.values().next().value;e.Lo.delete(t);const n=new wi(ri.fromString(t)),r=e.Qo.next();e.Uo.set(r,new Lh(n)),e.Bo=e.Bo.insert(n,r),zu(e.remoteStore,new $a(ds(ss(n.path)),r,2,Kr.I))}}async function Xh(e,t,n){const r=Pr(e),i=[],s=[],o=[];r.Mo.isEmpty()||(r.Mo.forEach(((e,a)=>{o.push(r.Go(a,t,n).then((e=>{if(e){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),i.push(e);const t=Wc.$n(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.Oo.br(i),await async function(e,t){const n=Pr(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Na.forEach(t,(t=>Na.forEach(t.kn,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Na.forEach(t.xn,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!La(e))throw e;Sr("LocalStore","Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.qn.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.qn=n.qn.insert(e,i)}}}(r.localStore,s))}async function Zh(e,t){const n=Pr(e);if(!n.currentUser.isEqual(t)){Sr("SyncEngine","User change. New user:",t.toKey());const e=await Jc(n.localStore,t);n.currentUser=t,function(e,t){e.jo.forEach((e=>{e.forEach((e=>{e.reject(new Lr(xr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.jo.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Xh(n,e.Gn)}}function el(e,t){const n=Pr(e),r=n.Uo.get(t);if(r&&r.$o)return go().add(r.key);{let e=go();const r=n.Fo.get(t);if(!r)return e;for(const t of r){const r=n.Mo.get(t);e=e.unionWith(r.view.bo)}return e}}async function tl(e,t){const n=Pr(e),r=await nu(n.localStore,t.query,!0),i=t.view.ko(r);return n.isPrimaryClient&&Qh(n,t.targetId,i.Co),i}async function nl(e){const t=Pr(e);return iu(t.localStore).then((e=>Xh(t,e)))}async function rl(e,t,n,r){const i=Pr(e),s=await function(e,t){const n=Pr(e),r=Pr(n.An);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.Zt(e,t).next((t=>t?n.Wn.vn(e,t):Na.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await nh(i.remoteStore):"acknowledged"===n||"rejected"===n?(Wh(i,t,r||null),Kh(i,t),function(e,t){Pr(Pr(e).An).ee(t)}(i.localStore,t)):Nr(),await Xh(i,s)):Sr("SyncEngine","Cannot apply mutation batch with id: "+t)}async function il(e,t,n){const r=Pr(e),i=[],s=[];for(const o of t){let e;const t=r.Fo.get(o);if(t&&0!==t.length){e=await eu(r.localStore,ds(t[0]));for(const e of t){const t=r.Mo.get(e),n=await tl(r,t);n.snapshot&&s.push(n.snapshot)}}else{const t=await ru(r.localStore,o);e=await eu(r.localStore,t),await Fh(r,sl(t),o,!1)}i.push(e)}return r.Oo.br(s),i}function sl(e){return is(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function ol(e){const t=Pr(e);return Pr(Pr(t.localStore).persistence).Tn()}async function al(e,t,n,r){const i=Pr(e);if(i.Wo)Sr("SyncEngine","Ignoring unexpected query state notification.");else if(i.Fo.has(t))switch(n){case"current":case"not-current":{const e=await iu(i.localStore),r=wo.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await Xh(i,e,r);break}case"rejected":await tu(i.localStore,t,!0),Hh(i,t,r);break;default:Nr()}}async function cl(e,t,n){const r=ul(e);if(r.Wo){for(const e of t){if(r.Fo.has(e)){Sr("SyncEngine","Adding an already active target "+e);continue}const t=await ru(r.localStore,e),n=await eu(r.localStore,t);await Fh(r,sl(t),n.targetId,!1),zu(r.remoteStore,n)}for(const e of n)r.Fo.has(e)&&await tu(r.localStore,e,!1).then((()=>{$u(r.remoteStore,e),Hh(r,e)})).catch(Tc)}}function ul(e){const t=Pr(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=qh.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=el.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Bh.bind(null,t),t.Oo.br=Th.bind(null,t.eventManager),t.Oo.zo=Eh.bind(null,t.eventManager),t}function hl(e){const t=Pr(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=zh.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=$h.bind(null,t),t}class ll{constructor(){this.synchronizeTabs=!1}async initialize(e){this.k=Pu(e.databaseInfo.databaseId),this.sharedClientState=this.Jo(e),this.persistence=this.Yo(e),await this.persistence.start(),this.gcScheduler=this.Xo(e),this.localStore=this.Zo(e)}Xo(e){return null}Zo(e){return Qc(this.persistence,new Hc,e.initialUser,this.k)}Yo(e){return new fu(mu.ks,this.k)}Jo(e){return new ku}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class dl extends ll{constructor(e,t,n){super(),this.tc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await async function(e){const t=Pr(e);return t.persistence.runTransaction("Synchronize last document change read time","readonly",(e=>function(e){const t=Lc(e);let n=Xr.min();return t.jt({index:va.readTimeIndex,reverse:!0},((e,t,r)=>{t.readTime&&(n=Qa(t.readTime)),r.done()})).next((()=>n))}(e))).then((e=>{t.jn=e}))}(this.localStore),await this.tc.initialize(this,e),await hl(this.tc.syncEngine),await nh(this.tc.remoteStore),await this.persistence.sn((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve())))}Zo(e){return Qc(this.persistence,new Hc,e.initialUser,this.k)}Xo(e){const t=this.persistence.referenceDelegate.garbageCollector;return new Sc(t,e.asyncQueue)}Yo(e){const t=zc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?hc.withCacheSize(this.cacheSizeBytes):hc.DEFAULT;return new qc(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Du(),Ou(),this.k,this.sharedClientState,!!this.forceOwnership)}Jo(e){return new ku}}class fl extends dl{constructor(e,t){super(e,t,!1),this.tc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.tc.syncEngine;this.sharedClientState instanceof Eu&&(this.sharedClientState.syncEngine={mi:rl.bind(null,t),gi:al.bind(null,t),yi:cl.bind(null,t),Tn:ol.bind(null,t),_i:nl.bind(null,t)},await this.sharedClientState.start()),await this.persistence.sn((async e=>{await async function(e,t){const n=Pr(e);if(ul(n),hl(n),!0===t&&!0!==n.Wo){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await il(n,e.toArray());n.Wo=!0,await lh(n.remoteStore,!0);for(const r of t)zu(n.remoteStore,r)}else if(!1===t&&!1!==n.Wo){const e=[];let t=Promise.resolve();n.Fo.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(Hh(n,i),tu(n.localStore,i,!0)))),$u(n.remoteStore,i)})),await t,await il(n,e),function(e){const t=Pr(e);t.Uo.forEach(((e,n)=>{$u(t.remoteStore,n)})),t.qo.hs(),t.Uo=new Map,t.Bo=new ro(wi.comparator)}(n),n.Wo=!1,await lh(n.remoteStore,!1)}}(this.tc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())}))}Jo(e){const t=Du();if(!Eu.Pt(t))throw new Lr(xr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=zc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Eu(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class pl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>jh(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Zh.bind(null,this.syncEngine),await lh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new _h}createDatastore(e){const t=Pu(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new Nu(r));var r;return function(e,t,n,r){return new Fu(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>jh(this.syncEngine,e,0),s=Au.Pt()?new Au:new Su,new qu(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new Mh(e,t,n,r,i,s);return o&&(a.Wo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=Pr(e);Sr("RemoteStore","RemoteStore shutting down."),t.Gr.add(5),await Bu(t),t.Hr.shutdown(),t.Jr.set("Unknown")}(this.remoteStore)}}function ml(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class gl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.ec(this.observer.next,e)}error(e){this.observer.error?this.ec(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}nc(){this.muted=!0}ec(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class yl{constructor(e,t){this.sc=e,this.k=t,this.metadata=new Mr,this.buffer=new Uint8Array,this.ic=new TextDecoder("utf-8"),this.rc().then((e=>{e&&e._o()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))}),(e=>this.metadata.reject(e)))}close(){return this.sc.cancel()}async getMetadata(){return this.metadata.promise}async Ho(){return await this.getMetadata(),this.rc()}async rc(){const e=await this.oc();if(null===e)return null;const t=this.ic.decode(e),n=Number(t);isNaN(n)&&this.cc(`length string (${t}) is not valid number`);const r=await this.ac(n);return new Ah(JSON.parse(r),e.length+n)}uc(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async oc(){for(;this.uc()<0&&!(await this.hc()););if(0===this.buffer.length)return null;const e=this.uc();e<0&&this.cc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async ac(e){for(;this.buffer.length<e;)await this.hc()&&this.cc("Reached the end of bundle when more is expected.");const t=this.ic.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}cc(e){throw this.sc.cancel(),new Error(`Invalid bundle format: ${e}`)}async hc(){const e=await this.sc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class vl{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Lr(xr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=Pr(e),r=jo(n.k)+"/documents",i={documents:t.map((e=>Uo(n.k,e)))},s=await n.ji("BatchGetDocuments",r,i),o=new Map;s.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){Dr(!!t.found),t.found.name,t.found.updateTime;const n=Fo(e,t.found.name),r=xo(t.found.updateTime),i=new xi({mapValue:{fields:t.found.fields}});return Mi.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){Dr(!!t.missing),Dr(!!t.readTime);const n=Fo(e,t.missing),r=xo(t.readTime);return Mi.newNoDocument(n,r)}(e,t):Nr()}(n.k,e);o.set(t.key.toString(),t)}));const a=[];return t.forEach((e=>{const t=o.get(e.toString());Dr(!!t),a.push(t)})),a}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Js(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=wi.fromPath(t);this.mutations.push(new Ys(n,this.precondition(n)))})),await async function(e,t){const n=Pr(e),r=jo(n.k)+"/documents",i={writes:t.map((e=>Ko(n.k,e)))};await n.Bi("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Nr();t=Xr.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Lr(xr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Us.updateTime(t):Us.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Xr.min()))throw new Lr(xr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Us.updateTime(t)}return Us.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class wl{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.lc=5,this.ur=new xu(this.asyncQueue,"transaction_retry")}run(){this.lc-=1,this.fc()}fc(){this.ur.Zi((async()=>{const e=new vl(this.datastore),t=this.dc(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.wc(e)}))))})).catch((e=>{this.wc(e)}))}))}dc(e){try{const t=this.updateFunction(e);return!gi(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}wc(e){this.lc>0&&this._c(e)?(this.lc-=1,this.asyncQueue.enqueueAndForget((()=>(this.fc(),Promise.resolve())))):this.deferred.reject(e)}_c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!to(t)}return!1}}class _l{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=br.UNAUTHENTICATED,this.clientId=Hr.A(),this.authCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Sr("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(()=>Promise.resolve()))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Lr(xr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Mr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=mh(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function bl(e,t){e.asyncQueue.verifyOperationInProgress(),Sr("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Jc(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e.offlineComponents=t}async function Il(e,t){e.asyncQueue.verifyOperationInProgress();const n=await Tl(e);Sr("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>async function(e,t){const n=Pr(e);n.asyncQueue.verifyOperationInProgress(),Sr("RemoteStore","RemoteStore received new credentials");const r=Qu(n);n.Gr.add(3),await Bu(n),r&&n.Jr.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Gr.delete(3),await ju(n)}(t.remoteStore,e))),e.onlineComponents=t}async function Tl(e){return e.offlineComponents||(Sr("FirestoreClient","Using default OfflineComponentProvider"),await bl(e,new ll)),e.offlineComponents}async function El(e){return e.onlineComponents||(Sr("FirestoreClient","Using default OnlineComponentProvider"),await Il(e,new pl)),e.onlineComponents}function kl(e){return Tl(e).then((e=>e.persistence))}function Sl(e){return Tl(e).then((e=>e.localStore))}function Al(e){return El(e).then((e=>e.remoteStore))}function Cl(e){return El(e).then((e=>e.syncEngine))}async function Rl(e){const t=await El(e),n=t.eventManager;return n.onListen=Uh.bind(null,t.syncEngine),n.onUnlisten=Vh.bind(null,t.syncEngine),n}function Nl(e,t,n={}){const r=new Mr;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new gl({next:s=>{t.enqueueAndForget((()=>Ih(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Lr(xr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Lr(xr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new Sh(ss(n.path),s,{includeMetadataChanges:!0,wo:!0});return bh(e,o)}(await Rl(e),e.asyncQueue,t,n,r))),r.promise}function Dl(e,t,n={}){const r=new Mr;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new gl({next:n=>{t.enqueueAndForget((()=>Ih(e,o))),n.fromCache&&"server"===r.source?i.reject(new Lr(xr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new Sh(n,s,{includeMetadataChanges:!0,wo:!0});return bh(e,o)}(await Rl(e),e.asyncQueue,t,n,r))),r.promise}function Ol(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?(new TextEncoder).encode(e):e,function(e,t){return new yl(e,t)}(function(e,t){if(e instanceof Uint8Array)return ml(e,t);if(e instanceof ArrayBuffer)return ml(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,Pu(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=Pr(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=Pr(e),r=xo(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n.Ye.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),void n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r));n._updateProgress(Nh(r));const i=new Rh(r,e.localStore,t.k);let s=await t.Ho();for(;s;){const e=await i.yo(s);e&&n._updateProgress(e),s=await t.Ho()}const o=await i.complete();await Xh(e,o.In,void 0),await function(e,t){const n=Pr(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n.Ye.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress)}catch(e){Cr("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e)}})(r,t,n).then((()=>{r.sharedClientState.notifyBundleLoaded()}))}(await Cl(e),i,r)}))}class Pl{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class xl{constructor(e,t){this.projectId=e,this.database=t||"(default)"}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof xl&&e.projectId===this.projectId&&e.database===this.database}}const Ll=new Map;function Ml(e,t,n){if(!n)throw new Lr(xr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Ul(e,t,n,r){if(!0===t&&!0===r)throw new Lr(xr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function Fl(e){if(!wi.isDocumentKey(e))throw new Lr(xr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Vl(e){if(wi.isDocumentKey(e))throw new Lr(xr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function ql(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":Nr()}function jl(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Lr(xr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ql(e);throw new Lr(xr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Bl(e,t){if(t<=0)throw new Lr(xr.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class zl{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Lr(xr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Lr(xr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Ul("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class $l{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new zl({}),this._settingsFrozen=!1,e instanceof xl?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Lr(xr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xl(e.options.projectId)}(e))}get app(){if(!this._app)throw new Lr(xr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Lr(xr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new zl(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Fr;switch(e.type){case"gapi":const t=e.client;return Dr(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new Br(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new Lr(xr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Ll.get(e);t&&(Sr("ComponentProvider","Removing Datastore"),Ll.delete(e),t.terminate())}(this),Promise.resolve()}}function Kl(e,t,n,r={}){var i;const s=(e=jl(e,$l))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&Cr("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=br.MOCK_USER;else{t=(0,a.Sg)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Lr(xr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new br(s)}e._authCredentials=new Vr(new Ur(t,n))}}class Wl{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Gl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Wl(this.firestore,e,this._key)}}class Hl{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Hl(this.firestore,e,this._query)}}class Gl extends Hl{constructor(e,t,n){super(e,t,ss(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Wl(this.firestore,null,new wi(e))}withConverter(e){return new Gl(this.firestore,e,this._path)}}function Ql(e,t,...n){if(e=(0,a.m9)(e),Ml("collection","path",t),e instanceof $l){const r=ri.fromString(t,...n);return Vl(r),new Gl(e,null,r)}{if(!(e instanceof Wl||e instanceof Gl))throw new Lr(xr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ri.fromString(t,...n));return Vl(r),new Gl(e.firestore,null,r)}}function Jl(e,t){if(e=jl(e,$l),Ml("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Lr(xr.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Hl(e,null,function(e){return new rs(ri.emptyPath(),e)}(t))}function Yl(e,t,...n){if(e=(0,a.m9)(e),1===arguments.length&&(t=Hr.A()),Ml("doc","path",t),e instanceof $l){const r=ri.fromString(t,...n);return Fl(r),new Wl(e,null,new wi(r))}{if(!(e instanceof Wl||e instanceof Gl))throw new Lr(xr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(ri.fromString(t,...n));return Fl(r),new Wl(e.firestore,e instanceof Gl?e.converter:null,new wi(r))}}function Xl(e,t){return e=(0,a.m9)(e),t=(0,a.m9)(t),(e instanceof Wl||e instanceof Gl)&&(t instanceof Wl||t instanceof Gl)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Zl(e,t){return e=(0,a.m9)(e),t=(0,a.m9)(t),e instanceof Hl&&t instanceof Hl&&e.firestore===t.firestore&&ps(e._query,t._query)&&e.converter===t.converter}class ed{constructor(){this.mc=Promise.resolve(),this.gc=[],this.yc=!1,this.Tc=[],this.Ec=null,this.Ic=!1,this.Ac=!1,this.Rc=[],this.ur=new xu(this,"async_queue_retry"),this.bc=()=>{const e=Ou();e&&Sr("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ur.er()};const e=Ou();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.bc)}get isShuttingDown(){return this.yc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Pc(),this.vc(e)}enterRestrictedMode(e){if(!this.yc){this.yc=!0,this.Ac=e||!1;const t=Ou();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bc)}}enqueue(e){if(this.Pc(),this.yc)return new Promise((()=>{}));const t=new Mr;return this.vc((()=>this.yc&&this.Ac?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.gc.push(e),this.Vc())))}async Vc(){if(0!==this.gc.length){try{await this.gc[0](),this.gc.shift(),this.ur.reset()}catch(b){if(!La(b))throw b;Sr("AsyncQueue","Operation failed with retryable error: "+b)}this.gc.length>0&&this.ur.Zi((()=>this.Vc()))}}vc(e){const t=this.mc.then((()=>(this.Ic=!0,e().catch((e=>{this.Ec=e,this.Ic=!1;throw Ar("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e})).then((e=>(this.Ic=!1,e))))));return this.mc=t,t}enqueueAfterDelay(e,t,n){this.Pc(),this.Rc.indexOf(e)>-1&&(t=0);const r=ph.createAndSchedule(this,e,t,n,(e=>this.Sc(e)));return this.Tc.push(r),r}Pc(){this.Ec&&Nr()}verifyOperationInProgress(){}async Dc(){let e;do{e=this.mc,await e}while(e!==this.mc)}Cc(e){for(const t of this.Tc)if(t.timerId===e)return!0;return!1}Nc(e){return this.Dc().then((()=>{this.Tc.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.Tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Dc()}))}kc(e){this.Rc.push(e)}Sc(e){const t=this.Tc.indexOf(e);this.Tc.splice(t,1)}}function td(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of["next","error","complete"])if(r in n&&"function"==typeof n[r])return!0;return!1}(e)}class nd{constructor(){this._progressObserver={},this._taskCompletionResolver=new Mr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const rd=-1;class id extends $l{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new ed,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||od(this),this._firestoreClient.terminate()}}function sd(e){return e._firestoreClient||od(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function od(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new Pl(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new _l(e._authCredentials,e._appCheckCredentials,e._queue,r)}function ad(e,t){gd(e=jl(e,id));const n=sd(e),r=e._freezeSettings(),i=new pl;return ud(n,i,new dl(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function cd(e){gd(e=jl(e,id));const t=sd(e),n=e._freezeSettings(),r=new pl;return ud(t,r,new fl(r,n.cacheSizeBytes))}function ud(e,t,n){const r=new Mr;return e.asyncQueue.enqueue((async()=>{try{await bl(e,n),await Il(e,t),r.resolve()}catch(e){if(!function(e){return"FirebaseError"===e.name?e.code===xr.FAILED_PRECONDITION||e.code===xr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(e))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),r.reject(e)}})).then((()=>r.promise))}function hd(e){if(e._initialized&&!e._terminated)throw new Lr(xr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Mr;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!Oa.Pt())return Promise.resolve();const t=e+"main";await Oa.delete(t)}(zc(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function ld(e){return function(e){const t=new Mr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=Pr(e);Qu(n.remoteStore)||Sr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=Pr(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.An.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.jo.get(e)||[];r.push(t),n.jo.set(e,r)}catch(e){const n=mh(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await Cl(e),t))),t.promise}(sd(e=jl(e,id)))}function dd(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await kl(e),n=await Al(e);return t.setNetworkEnabled(!0),function(e){const t=Pr(e);return t.Gr.delete(0),ju(t)}(n)}))}(sd(e=jl(e,id)))}function fd(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await kl(e),n=await Al(e);return t.setNetworkEnabled(!1),async function(e){const t=Pr(e);t.Gr.add(0),await Bu(t),t.Jr.set("Offline")}(n)}))}(sd(e=jl(e,id)))}function pd(e,t){const n=sd(e=jl(e,id)),r=new nd;return Ol(n,e._databaseId,t,r),r}function md(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=Pr(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n.Ye.getNamedQuery(e,t)))}(await Sl(e),t)))}(sd(e=jl(e,id)),t).then((t=>t?new Hl(e,null,t.query):null))}function gd(e){if(e._initialized||e._terminated)throw new Lr(xr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class yd{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new Lr(xr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new si(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class vd{constructor(e){this._byteString=e}static fromBase64String(e){try{return new vd(ci.fromBase64String(e))}catch(e){throw new Lr(xr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new vd(ci.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class wd{constructor(e){this._methodName=e}}class _d{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Lr(xr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Lr(xr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Gr(this._lat,e._lat)||Gr(this._long,e._long)}}const bd=/^__.*__$/;class Id{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Ws(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ks(e,this.data,t,this.fieldTransforms)}}class Td{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Ws(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ed(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Nr()}}class kd{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.k=n,this.ignoreUndefinedProperties=r,void 0===i&&this.xc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get $c(){return this.settings.$c}Oc(e){return new kd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.Lc(e),r}Bc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Oc({path:n,Fc:!1});return r.xc(),r}Uc(e){return this.Oc({path:void 0,Fc:!0})}qc(e){return Kd(e,this.settings.methodName,this.settings.Kc||!1,this.path,this.settings.jc)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.Lc(this.path.get(e))}Lc(e){if(0===e.length)throw this.qc("Document fields must not be empty");if(Ed(this.$c)&&bd.test(e))throw this.qc('Document fields cannot begin and end with "__"')}}class Sd{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.k=n||Pu(e)}Qc(e,t,n,r=!1){return new kd({$c:e,methodName:t,jc:n,path:si.emptyPath(),Fc:!1,Kc:r},this.databaseId,this.k,this.ignoreUndefinedProperties)}}function Ad(e){const t=e._freezeSettings(),n=Pu(e._databaseId);return new Sd(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Cd(e,t,n,r,i,s={}){const o=e.Qc(s.merge||s.mergeFields?2:0,t,n,i);jd("Data must be an object, but it was:",o,r);const a=Vd(r,o);let c,u;if(s.merge)c=new oi(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=Bd(t,r,n);if(!o.contains(i))throw new Lr(xr.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Wd(e,i)||e.push(i)}c=new oi(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Id(new xi(a),c,u)}class Rd extends wd{_toFieldTransform(e){if(2!==e.$c)throw 1===e.$c?e.qc(`${this._methodName}() can only appear at the top level of your update data`):e.qc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Rd}}function Nd(e,t,n){return new kd({$c:3,jc:t.settings.jc,methodName:e._methodName,Fc:n},t.databaseId,t.k,t.ignoreUndefinedProperties)}class Dd extends wd{_toFieldTransform(e){return new Ls(e.path,new As)}isEqual(e){return e instanceof Dd}}class Od extends wd{constructor(e,t){super(e),this.Wc=t}_toFieldTransform(e){const t=Nd(this,e,!0),n=this.Wc.map((e=>Fd(e,t))),r=new Cs(n);return new Ls(e.path,r)}isEqual(e){return this===e}}class Pd extends wd{constructor(e,t){super(e),this.Wc=t}_toFieldTransform(e){const t=Nd(this,e,!0),n=this.Wc.map((e=>Fd(e,t))),r=new Ns(n);return new Ls(e.path,r)}isEqual(e){return this===e}}class xd extends wd{constructor(e,t){super(e),this.Gc=t}_toFieldTransform(e){const t=new Os(e.k,Is(e.k,this.Gc));return new Ls(e.path,t)}isEqual(e){return this===e}}function Ld(e,t,n,r){const i=e.Qc(1,t,n);jd("Data must be an object, but it was:",i,r);const s=[],o=xi.empty();ei(r,((e,r)=>{const c=$d(t,e,n);r=(0,a.m9)(r);const u=i.Bc(c);if(r instanceof Rd)s.push(c);else{const e=Fd(r,u);null!=e&&(s.push(c),o.set(c,e))}}));const c=new oi(s);return new Td(o,c,i.fieldTransforms)}function Md(e,t,n,r,i,s){const o=e.Qc(1,t,n),c=[Bd(t,r,n)],u=[i];if(s.length%2!=0)throw new Lr(xr.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let a=0;a<s.length;a+=2)c.push(Bd(t,s[a])),u.push(s[a+1]);const h=[],l=xi.empty();for(let f=c.length-1;f>=0;--f)if(!Wd(h,c[f])){const e=c[f];let t=u[f];t=(0,a.m9)(t);const n=o.Bc(e);if(t instanceof Rd)h.push(e);else{const r=Fd(t,n);null!=r&&(h.push(e),l.set(e,r))}}const d=new oi(h);return new Td(l,d,o.fieldTransforms)}function Ud(e,t,n,r=!1){return Fd(n,e.Qc(r?4:3,t))}function Fd(e,t){if(qd(e=(0,a.m9)(e)))return jd("Unsupported field value:",t,e),Vd(e,t);if(e instanceof wd)return function(e,t){if(!Ed(t.$c))throw t.qc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.qc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&4!==t.$c)throw t.qc("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Fd(i,t.Uc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,a.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Is(t.k,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Yr.fromDate(e);return{timestampValue:Do(t.k,n)}}if(e instanceof Yr){const n=new Yr(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Do(t.k,n)}}if(e instanceof _d)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof vd)return{bytesValue:Oo(t.k,e._byteString)};if(e instanceof Wl){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.qc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Lo(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.qc(`Unsupported field value: ${ql(e)}`)}(e,t)}function Vd(e,t){const n={};return ti(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ei(e,((e,r)=>{const i=Fd(r,t.Mc(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function qd(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Yr||e instanceof _d||e instanceof vd||e instanceof Wl||e instanceof wd)}function jd(e,t,n){if(!qd(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=ql(n);throw"an object"===r?t.qc(e+" a custom object"):t.qc(e+" "+r)}}function Bd(e,t,n){if((t=(0,a.m9)(t))instanceof yd)return t._internalPath;if("string"==typeof t)return $d(e,t);throw Kd("Field path arguments must be of type string or ",e,!1,void 0,n)}const zd=new RegExp("[~\\*/\\[\\]]");function $d(e,t,n){if(t.search(zd)>=0)throw Kd(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new yd(...t.split("."))._internalPath}catch(r){throw Kd(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Kd(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Lr(xr.INVALID_ARGUMENT,a+e+c)}function Wd(e,t){return e.some((e=>e.isEqual(t)))}class Hd{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Wl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Gd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Qd("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Gd extends Hd{data(){return super.data()}}function Qd(e,t){return"string"==typeof t?$d(e,t):t instanceof yd?t._internalPath:t._delegate._internalPath}class Jd{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Yd extends Hd{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Xd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Qd("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Xd extends Yd{data(e={}){return super.data(e)}}class Zd{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Jd(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Xd(this._firestore,this._userDataWriter,n.key,n,new Jd(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Lr(xr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>({type:"added",doc:new Xd(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Jd(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++})))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new Xd(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Jd(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:ef(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function ef(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Nr()}}function tf(e,t){return e instanceof Yd&&t instanceof Yd?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Zd&&t instanceof Zd&&e._firestore===t._firestore&&Zl(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function nf(e){if(as(e)&&0===e.explicitOrderBy.length)throw new Lr(xr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class rf{}function sf(e,...t){for(const n of t)e=n._apply(e);return e}class of extends rf{constructor(e,t,n){super(),this.zc=e,this.Hc=t,this.Jc=n,this.type="where"}_apply(e){const t=Ad(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Lr(xr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){bf(o,s);const t=[];for(const n of o)t.push(_f(r,e,n));a={arrayValue:{values:t}}}else a=_f(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||bf(o,s),a=Ud(n,"where",o,"in"===s||"not-in"===s);const c=Bi.create(i,s,a);return function(e,t){if(t.V()){const n=us(e);if(null!==n&&!n.isEqual(t.field))throw new Lr(xr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const r=cs(e);null!==r&&If(e,t.field,r)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new Lr(xr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new Lr(xr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,c),c}(e._query,0,t,e.firestore._databaseId,this.zc,this.Hc,this.Jc);return new Hl(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new rs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}function af(e,t,n){const r=t,i=Qd("where",e);return new of(i,r,n)}class cf extends rf{constructor(e,t){super(),this.zc=e,this.Yc=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new Lr(xr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Lr(xr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new Zi(t,n);return function(e,t){if(null===cs(e)){const n=us(e);null!==n&&If(e,n,t.field)}}(e,r),r}(e._query,this.zc,this.Yc);return new Hl(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new rs(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function uf(e,t="asc"){const n=t,r=Qd("orderBy",e);return new cf(r,n)}class hf extends rf{constructor(e,t,n){super(),this.type=e,this.Xc=t,this.Zc=n}_apply(e){return new Hl(e.firestore,e.converter,fs(e._query,this.Xc,this.Zc))}}function lf(e){return Bl("limit",e),new hf("limit",e,"F")}function df(e){return Bl("limitToLast",e),new hf("limitToLast",e,"L")}class ff extends rf{constructor(e,t,n){super(),this.type=e,this.ta=t,this.ea=n}_apply(e){const t=wf(e,this.type,this.ta,this.ea);return new Hl(e.firestore,e.converter,function(e,t){return new rs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}function pf(...e){return new ff("startAt",e,!0)}function mf(...e){return new ff("startAfter",e,!1)}class gf extends rf{constructor(e,t,n){super(),this.type=e,this.ta=t,this.ea=n}_apply(e){const t=wf(e,this.type,this.ta,this.ea);return new Hl(e.firestore,e.converter,function(e,t){return new rs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function yf(...e){return new gf("endBefore",e,!0)}function vf(...e){return new gf("endAt",e,!1)}function wf(e,t,n,r){if(n[0]=(0,a.m9)(n[0]),n[0]instanceof Hd)return function(e,t,n,r,i){if(!r)throw new Lr(xr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const o of ls(e))if(o.field.isKeyField())s.push(Ai(t,r.key));else{const e=r.data.field(o.field);if(fi(e))throw new Lr(xr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=o.field.canonicalString();throw new Lr(xr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new Yi(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=Ad(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new Lr(xr.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let c=0;c<i.length;c++){const s=i[c];if(o[c].field.isKeyField()){if("string"!=typeof s)throw new Lr(xr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof s}`);if(!hs(e)&&-1!==s.indexOf("/"))throw new Lr(xr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${s}' contains a slash.`);const n=e.path.child(ri.fromString(s));if(!wi.isDocumentKey(n))throw new Lr(xr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new wi(n);a.push(Ai(t,i))}else{const e=Ud(n,r,s);a.push(e)}}return new Yi(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function _f(e,t,n){if("string"==typeof(n=(0,a.m9)(n))){if(""===n)throw new Lr(xr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!hs(t)&&-1!==n.indexOf("/"))throw new Lr(xr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(ri.fromString(n));if(!wi.isDocumentKey(r))throw new Lr(xr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ai(e,new wi(r))}if(n instanceof Wl)return Ai(e,n._key);throw new Lr(xr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ql(n)}.`)}function bf(e,t){if(!Array.isArray(e)||0===e.length)throw new Lr(xr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new Lr(xr.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function If(e,t,n){if(!n.isEqual(t))throw new Lr(xr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Tf{convertValue(e,t="none"){switch(_i(e)){case 0:return null;case 1:return e.booleanValue;case 2:return li(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(di(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Nr()}}convertObject(e,t){const n={};return ei(e.fields,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new _d(li(e.latitude),li(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=pi(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(mi(e));default:return null}}convertTimestamp(e){const t=hi(e);return new Yr(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ri.fromString(e);Dr(oa(n));const r=new xl(n.get(1),n.get(3)),i=new wi(n.popFirst(5));return r.isEqual(t)||Ar(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Ef(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class kf extends Tf{constructor(e){super(),this.firestore=e}convertBytes(e){return new vd(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Wl(this.firestore,null,t)}}class Sf{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ad(e)}set(e,t,n){this._verifyNotCommitted();const r=Af(e,this._firestore),i=Ef(r.converter,t,n),s=Cd(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Us.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=Af(e,this._firestore);let s;return s="string"==typeof(t=(0,a.m9)(t))||t instanceof yd?Md(this._dataReader,"WriteBatch.update",i._key,t,n,r):Ld(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Us.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Af(e,this._firestore);return this._mutations=this._mutations.concat(new Js(t._key,Us.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Lr(xr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Af(e,t){if((e=(0,a.m9)(e)).firestore!==t)throw new Lr(xr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function Cf(e){e=jl(e,Wl);const t=jl(e.firestore,id);return Nl(sd(t),e._key).then((n=>Bf(t,e,n)))}class Rf extends Tf{constructor(e){super(),this.firestore=e}convertBytes(e){return new vd(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Wl(this.firestore,null,t)}}function Nf(e){e=jl(e,Wl);const t=jl(e.firestore,id),n=sd(t),r=new Rf(t);return function(e,t){const n=new Mr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=Pr(e);return n.persistence.runTransaction("read document","readonly",(e=>n.Wn.Rn(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new Lr(xr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=mh(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await Sl(e),t,n))),n.promise}(n,e._key).then((n=>new Yd(t,r,e._key,n,new Jd(null!==n&&n.hasLocalMutations,!0),e.converter)))}function Df(e){e=jl(e,Wl);const t=jl(e.firestore,id);return Nl(sd(t),e._key,{source:"server"}).then((n=>Bf(t,e,n)))}function Of(e){e=jl(e,Hl);const t=jl(e.firestore,id),n=sd(t),r=new Rf(t);return nf(e._query),Dl(n,e._query).then((n=>new Zd(t,r,e,n)))}function Pf(e){e=jl(e,Hl);const t=jl(e.firestore,id),n=sd(t),r=new Rf(t);return function(e,t){const n=new Mr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await nu(e,t,!0),i=new Ph(t,r.zn),s=i.Po(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=mh(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await Sl(e),t,n))),n.promise}(n,e._query).then((n=>new Zd(t,r,e,n)))}function xf(e){e=jl(e,Hl);const t=jl(e.firestore,id),n=sd(t),r=new Rf(t);return Dl(n,e._query,{source:"server"}).then((n=>new Zd(t,r,e,n)))}function Lf(e,t,n){e=jl(e,Wl);const r=jl(e.firestore,id),i=Ef(e.converter,t,n);return jf(r,[Cd(Ad(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Us.none())])}function Mf(e,t,n,...r){e=jl(e,Wl);const i=jl(e.firestore,id),s=Ad(i);let o;return o="string"==typeof(t=(0,a.m9)(t))||t instanceof yd?Md(s,"updateDoc",e._key,t,n,r):Ld(s,"updateDoc",e._key,t),jf(i,[o.toMutation(e._key,Us.exists(!0))])}function Uf(e){return jf(jl(e.firestore,id),[new Js(e._key,Us.none())])}function Ff(e,t){const n=jl(e.firestore,id),r=Yl(e),i=Ef(e.converter,t);return jf(n,[Cd(Ad(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Us.exists(!1))]).then((()=>r))}function Vf(e,...t){var n,r,i;e=(0,a.m9)(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||td(t[o])||(s=t[o],o++);const c={includeMetadataChanges:s.includeMetadataChanges};if(td(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let u,h,l;if(e instanceof Wl)h=jl(e.firestore,id),l=ss(e._key.path),u={next:n=>{t[o]&&t[o](Bf(h,e,n))},error:t[o+1],complete:t[o+2]};else{const n=jl(e,Hl);h=jl(n.firestore,id),l=n._query;const r=new Rf(h);u={next:e=>{t[o]&&t[o](new Zd(h,r,n,e))},error:t[o+1],complete:t[o+2]},nf(e._query)}return function(e,t,n,r){const i=new gl(r),s=new Sh(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>bh(await Rl(e),s))),()=>{i.nc(),e.asyncQueue.enqueueAndForget((async()=>Ih(await Rl(e),s)))}}(sd(h),l,c,u)}function qf(e,t){return function(e,t){const n=new gl(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){Pr(e).io.add(t),t.next()}(await Rl(e),n))),()=>{n.nc(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){Pr(e).io.delete(t)}(await Rl(e),n)))}}(sd(e=jl(e,id)),td(t)?t:{next:t})}function jf(e,t){return function(e,t){const n=new Mr;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=hl(e);try{const e=await function(e,t){const n=Pr(e),r=Yr.now(),i=t.reduce(((e,t)=>e.add(t.key)),go());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>n.Wn.vn(e,i).next((i=>{s=i;const o=[];for(const e of t){const t=Bs(e,s.get(e.key));null!=t&&o.push(new Ws(e.key,t,Li(t.value.mapValue),Us.exists(!0)))}return n.An.addMutationBatch(e,r,o,t)})))).then((e=>(e.applyToLocalDocumentSet(s),{batchId:e.batchId,changes:s})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Ko[e.currentUser.toKey()];r||(r=new ro(Gr)),r=r.insert(t,n),e.Ko[e.currentUser.toKey()]=r}(r,e.batchId,n),await Xh(r,e.changes),await nh(r.remoteStore)}catch(e){const t=mh(e,"Failed to persist write");n.reject(t)}}(await Cl(e),t,n))),n.promise}(sd(e),t)}function Bf(e,t,n){const r=n.docs.get(t._key),i=new Rf(e);return new Yd(e,i,t._key,r,new Jd(n.hasPendingWrites,n.fromCache),t.converter)}class zf extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ad(e)}get(e){const t=Af(e,this._firestore),n=new kf(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return Nr();const r=e[0];if(r.isFoundDocument())return new Hd(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new Hd(this._firestore,n,t._key,null,t.converter);throw Nr()}))}set(e,t,n){const r=Af(e,this._firestore),i=Ef(r.converter,t,n),s=Cd(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=Af(e,this._firestore);let s;return s="string"==typeof(t=(0,a.m9)(t))||t instanceof yd?Md(this._dataReader,"Transaction.update",i._key,t,n,r):Ld(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=Af(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Af(e,this._firestore),n=new Rf(this._firestore);return super.get(e).then((e=>new Yd(this._firestore,n,t._key,e._document,new Jd(!1,!1),t.converter)))}}function $f(e,t){return function(e,t){const n=new Mr;return e.asyncQueue.enqueueAndForget((async()=>{const r=await function(e){return El(e).then((e=>e.datastore))}(e);new wl(e.asyncQueue,r,t,n).run()})),n.promise}(sd(e=jl(e,id)),(n=>t(new zf(e,n))))}function Kf(){return new Rd("deleteField")}function Wf(){return new Dd("serverTimestamp")}function Hf(...e){return new Od("arrayUnion",e)}function Gf(...e){return new Pd("arrayRemove",e)}function Qf(e){return new xd("increment",e)}!function(e,t=!0){!function(e){Ir=e}(i.SDK_VERSION),(0,i._registerComponent)(new s.wA("firestore",((e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=new id(r,new qr(e.getProvider("auth-internal")),new $r(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i}),"PUBLIC")),(0,i.registerVersion)(_r,"3.4.3",e),(0,i.registerVersion)(_r,"3.4.3","esm2017")}()},4444:function(e,t,n){"use strict";n.d(t,{BH:function(){return c},LL:function(){return E},ZR:function(){return T},zI:function(){return I},tV:function(){return o},$s:function(){return M},r3:function(){return S},Sg:function(){return u},ne:function(){return P},vZ:function(){return C},ZB:function(){return a},pd:function(){return O},m9:function(){return U},z$:function(){return h},jU:function(){return f},ru:function(){return p},d:function(){return g},xb:function(){return A},w1:function(){return y},hl:function(){return _},uI:function(){return l},UG:function(){return d},b$:function(){return m},G6:function(){return w},Mn:function(){return v},xO:function(){return N},zd:function(){return D},eu:function(){return b}});const r=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,c=a?e[i+2]:0,u=t>>2,h=(3&t)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const o=i<e.length?n[e.charAt(i)]:64;++i;const a=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==o||null==a)throw Error();const c=t<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},s=function(e){return function(e){const t=r(e);return i.encodeByteArray(t,!0)}(e).replace(/\./g,"")},o=function(e){try{return i.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function a(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=a(e[n],t[n]));return e}class c{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function u(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}function h(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function l(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(h())}function d(){try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function f(){return"object"===typeof self&&self.self===self}function p(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function m(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function g(){return h().indexOf("Electron/")>=0}function y(){const e=h();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function v(){return h().indexOf("MSAppHost/")>=0}function w(){return!d()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _(){return"object"===typeof indexedDB}function b(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}))}function I(){return!("undefined"===typeof navigator||!navigator.cookieEnabled)}class T extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,T.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,E.prototype.create)}}class E{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(k,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new T(r,o,n)}}const k=/\{\$([^}]+)}/g;function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function A(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function C(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(R(n)&&R(s)){if(!C(n,s))return!1}else if(n!==s)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function R(e){return null!==e&&"object"===typeof e}function N(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function D(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function O(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function P(e,t){const n=new x(e,t);return n.subscribe.bind(n)}class x{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=L),void 0===r.error&&(r.error=L),void 0===r.complete&&(r.complete=L);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function L(){}function M(e,t=1e3,n=2){const r=t*Math.pow(n,e),i=Math.round(.5*r*(Math.random()-.5)*2);return Math.min(144e5,r+i)}function U(e){return e&&e._delegate?e._delegate:e}},8676:function(e,t){!function(e){"use strict";function t(e){return Array.prototype.slice.call(e)}function n(e){return new Promise((function(t,n){e.onsuccess=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function r(e,t,r){var i,s=new Promise((function(s,o){n(i=e[t].apply(e,r)).then(s,o)}));return s.request=i,s}function i(e,t,n){var i=r(e,t,n);return i.then((function(e){if(e)return new h(e,i.request)}))}function s(e,t,n){n.forEach((function(n){Object.defineProperty(e.prototype,n,{get:function(){return this[t][n]},set:function(e){this[t][n]=e}})}))}function o(e,t,n,i){i.forEach((function(i){i in n.prototype&&(e.prototype[i]=function(){return r(this[t],i,arguments)})}))}function a(e,t,n,r){r.forEach((function(r){r in n.prototype&&(e.prototype[r]=function(){return this[t][r].apply(this[t],arguments)})}))}function c(e,t,n,r){r.forEach((function(r){r in n.prototype&&(e.prototype[r]=function(){return i(this[t],r,arguments)})}))}function u(e){this._index=e}function h(e,t){this._cursor=e,this._request=t}function l(e){this._store=e}function d(e){this._tx=e,this.complete=new Promise((function(t,n){e.oncomplete=function(){t()},e.onerror=function(){n(e.error)},e.onabort=function(){n(e.error)}}))}function f(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new d(n)}function p(e){this._db=e}function m(e,t,n){var i=r(indexedDB,"open",[e,t]),s=i.request;return s&&(s.onupgradeneeded=function(e){n&&n(new f(s.result,e.oldVersion,s.transaction))}),i.then((function(e){return new p(e)}))}function g(e){return r(indexedDB,"deleteDatabase",[e])}s(u,"_index",["name","keyPath","multiEntry","unique"]),o(u,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),c(u,"_index",IDBIndex,["openCursor","openKeyCursor"]),s(h,"_cursor",["direction","key","primaryKey","value"]),o(h,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(e){e in IDBCursor.prototype&&(h.prototype[e]=function(){var t=this,r=arguments;return Promise.resolve().then((function(){return t._cursor[e].apply(t._cursor,r),n(t._request).then((function(e){if(e)return new h(e,t._request)}))}))})})),l.prototype.createIndex=function(){return new u(this._store.createIndex.apply(this._store,arguments))},l.prototype.index=function(){return new u(this._store.index.apply(this._store,arguments))},s(l,"_store",["name","keyPath","indexNames","autoIncrement"]),o(l,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),c(l,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),a(l,"_store",IDBObjectStore,["deleteIndex"]),d.prototype.objectStore=function(){return new l(this._tx.objectStore.apply(this._tx,arguments))},s(d,"_tx",["objectStoreNames","mode"]),a(d,"_tx",IDBTransaction,["abort"]),f.prototype.createObjectStore=function(){return new l(this._db.createObjectStore.apply(this._db,arguments))},s(f,"_db",["name","version","objectStoreNames"]),a(f,"_db",IDBDatabase,["deleteObjectStore","close"]),p.prototype.transaction=function(){return new d(this._db.transaction.apply(this._db,arguments))},s(p,"_db",["name","version","objectStoreNames"]),a(p,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(e){[l,u].forEach((function(n){e in n.prototype&&(n.prototype[e.replace("open","iterate")]=function(){var n=t(arguments),r=n[n.length-1],i=this._store||this._index,s=i[e].apply(i,n.slice(0,-1));s.onsuccess=function(){r(s.result)}})}))})),[u,l].forEach((function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var n=this,r=[];return new Promise((function(i){n.iterateCursor(e,(function(e){e?(r.push(e.value),void 0===t||r.length!=t?e.continue():i(r)):i(r)}))}))})})),e.openDb=m,e.deleteDb=g,Object.defineProperty(e,"__esModule",{value:!0})}(t)},3454:function(e,t,n){"use strict";e.exports=n.g.process||n(7663)},1780:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return n(8510)}])},7802:function(e,t,n){"use strict";n.d(t,{a:function(){return a},Z:function(){return c}});var r=n(5893),i=n(7294),s=n(1323),o=i.createContext();function a(){return(0,i.useContext)(o)}function c(e){var t=e.children,n=(0,i.useState)(),a=n[0],c=n[1],u=(0,i.useState)(!0),h=u[0],l=u[1];(0,i.useEffect)((function(){return s.I.onAuthStateChanged((function(e){c(e),l(!1)}))}),[]);var d={currentUser:a,login:function(e,t){return s.I.signInWithEmailAndPassword(e,t)},signup:function(e,t){return s.I.createUserWithEmailAndPassword(e,t)},logout:function(){return s.I.signOut()},resetPassword:function(e){return s.I.sendPasswordResetEmail(e)}};return(0,r.jsx)(o.Provider,{value:d,children:!h&&t})}},1323:function(e,t,n){"use strict";n.d(t,{I:function(){return Ra},db:function(){return Na}});var r=n(4444),i=n(8463),s=n(2238),o=n(3333);class a{constructor(e,t){this._delegate=e,this.firebase=t,(0,s._addComponent)(e,new i.wA("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),(0,s.deleteApp)(this._delegate))))}_getService(e,t=s._DEFAULT_ENTRY_NAME){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=s._DEFAULT_ENTRY_NAME){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){(0,s._addComponent)(this._delegate,e)}_addOrOverwriteComponent(e){(0,s._addOrOverwriteComponent)(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const c={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},u=new r.LL("app-compat","Firebase",c);const h=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(i,o={}){const a=s.initializeApp(i,o);if((0,r.r3)(t,a.name))return t[a.name];const c=new e(a,n);return t[a.name]=c,c},app:i,registerVersion:s.registerVersion,setLogLevel:s.setLogLevel,onLog:s.onLog,apps:null,SDK_VERSION:s.SDK_VERSION,INTERNAL:{registerComponent:function(t){const o=t.name,a=o.replace("-compat","");if(s._registerComponent(t)&&"PUBLIC"===t.type){const s=(e=i())=>{if("function"!==typeof e[a])throw u.create("invalid-app-argument",{appName:o});return e[a]()};void 0!==t.serviceProps&&(0,r.ZB)(s,t.serviceProps),n[a]=s,e.prototype[a]=function(...e){return this._getService.bind(this,o).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[a]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:s}};function i(e){if(e=e||s._DEFAULT_ENTRY_NAME,!(0,r.r3)(t,e))throw u.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),i.App=e,n}(a);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){(0,r.ZB)(t,e)},createSubscribe:r.ne,ErrorFactory:r.LL,deepExtend:r.ZB}),t}(),l=new o.Yd("@firebase/app-compat");if((0,r.jU)()&&void 0!==self.firebase){l.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&l.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const d=h;var f;(0,s.registerVersion)("@firebase/app-compat","0.1.15",f);d.registerVersion("firebase","9.6.4","app-compat");function p(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;const m="facebook.com",g="github.com",y="google.com",v="password",w="twitter.com",_="EMAIL_SIGNIN",b="PASSWORD_RESET",I="RECOVER_EMAIL",T="REVERT_SECOND_FACTOR_ADDITION",E="VERIFY_AND_CHANGE_EMAIL",k="VERIFY_EMAIL";function S(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const A=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},C=S,R=new r.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),N=new o.Yd("@firebase/auth");function D(e,...t){N.logLevel<=o.in.ERROR&&N.error(`Auth (${s.SDK_VERSION}): ${e}`,...t)}function O(e,...t){throw M(e,...t)}function P(e,...t){return M(e,...t)}function x(e,t,n){const i=Object.assign(Object.assign({},C()),{[t]:n});return new r.LL("auth","Firebase",i).create(t,{appName:e.name})}function L(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&O(e,"argument-error"),x(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function M(e,...t){if("string"!==typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return R.create(e,...t)}function U(e,t,...n){if(!e)throw M(t,...n)}function F(e){const t="INTERNAL ASSERTION FAILED: "+e;throw D(t),new Error(t)}function V(e,t){e||F(t)}const q=new Map;function j(e){V(e instanceof Function,"Expected a class definition");let t=q.get(e);return t?(V(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,q.set(e,t),t)}function B(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function z(){return"http:"===$()||"https:"===$()}function $(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class K{constructor(e,t){this.shortDelay=e,this.longDelay=t,V(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,r.uI)()||(0,r.b$)()}get(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(z()||(0,r.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function W(e,t){V(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class H{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:void F("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:void F("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:void F("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const G={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Q=new K(3e4,6e4);function J(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Y(e,t,n,i,s={}){return X(e,s,(async()=>{let s={},o={};i&&("GET"===t?o=i:s={body:JSON.stringify(i)});const a=(0,r.xO)(Object.assign({key:e.config.apiKey},o)).slice(1),c=await e._getAdditionalHeaders();return c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode),H.fetch()(ee(e,e.config.apiHost,n,a),Object.assign({method:t,headers:c,referrerPolicy:"no-referrer"},s))}))}async function X(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},G),t);try{const t=new te(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await r.json();if("needConfirmation"in s)throw ne(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{const t=r.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw ne(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw ne(e,"email-already-in-use",s);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw x(e,a,o);O(e,a)}}catch(s){if(s instanceof r.ZR)throw s;O(e,"network-request-failed")}}async function Z(e,t,n,r,i={}){const s=await Y(e,t,n,r,i);return"mfaPendingCredential"in s&&O(e,"multi-factor-auth-required",{_serverResponse:s}),s}function ee(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?W(e.config,i):`${e.config.apiScheme}://${i}`}class te{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(P(this.auth,"network-request-failed"))),Q.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function ne(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=P(e,t,r);return i.customData._tokenResponse=n,i}function re(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function ie(e){return 1e3*Number(e)}function se(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return D("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,r.tV)(n);return e?JSON.parse(e):(D("Failed to decode base64 JWT payload"),null)}catch(s){return D("Caught error parsing JWT payload as JSON",s),null}}async function oe(e,t,n=!1){if(n)return t;try{return await t}catch(i){throw i instanceof r.ZR&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(i)&&e.auth.currentUser===e&&await e.auth.signOut(),i}}class ae{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class ce{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=re(this.lastLoginAt),this.creationTime=re(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ue(e){var t;const n=e.auth,r=await e.getIdToken(),i=await oe(e,async function(e,t){return Y(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));U(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=p(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[];const a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const h=e.isAnonymous,l=!(e.email&&s.passwordHash)&&!(null===a||void 0===a?void 0:a.length),d=!!h&&l,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new ce(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class he{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){U(e.idToken,"internal-error"),U("undefined"!==typeof e.idToken,"internal-error"),U("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):function(e){const t=se(e);return U(t,"internal-error"),U("undefined"!==typeof t.exp,"internal-error"),U("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return U(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:s}=await async function(e,t){const n=await X(e,{},(async()=>{const n=(0,r.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,o=ee(e,i,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",H.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new he;return n&&(U("string"===typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(U("string"===typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(U("number"===typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new he,this.toJSON())}_performRefresh(){return F("not implemented")}}function le(e,t){U("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class de{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=p(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.emailVerified=!1,this.isAnonymous=!1,this.tenantId=null,this.providerData=[],this.proactiveRefresh=new ae(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.metadata=new ce(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await oe(this,this.stsTokenManager.getToken(this.auth,e));return U(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,r.m9)(e),i=await n.getIdToken(t),s=se(i);U(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o="object"===typeof s.firebase?s.firebase:void 0,a=null===o||void 0===o?void 0:o.sign_in_provider;return{claims:s,token:i,authTime:re(ie(s.auth_time)),issuedAtTime:re(ie(s.iat)),expirationTime:re(ie(s.exp)),signInProvider:a||null,signInSecondFactor:(null===o||void 0===o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,r.m9)(e);await ue(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(U(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new de(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){U(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await ue(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await oe(this,async function(e,t){return Y(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,l=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:b,stsTokenManager:I}=t;U(v&&I,e,"internal-error");const T=he.fromJSON(this.name,I);U("string"===typeof v,e,"internal-error"),le(h,e.name),le(l,e.name),U("boolean"===typeof w,e,"internal-error"),U("boolean"===typeof _,e,"internal-error"),le(d,e.name),le(f,e.name),le(p,e.name),le(m,e.name),le(g,e.name),le(y,e.name);const E=new de({uid:v,auth:e,email:l,emailVerified:w,displayName:h,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return b&&Array.isArray(b)&&(E.providerData=b.map((e=>Object.assign({},e)))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,n=!1){const r=new he;r.updateFromServerResponse(t);const i=new de({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await ue(i),i}}class fe{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}fe.type="NONE";const pe=fe;function me(e,t,n){return`firebase:${e}:${t}:${n}`}class ge{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=me(this.userKey,r.apiKey,i),this.fullPersistenceKey=me("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?de._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ge(j(pe),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||j(pe);const s=me(n,e.config.apiKey,e.name);let o=null;for(const u of t)try{const t=await u._get(s);if(t){const n=de._fromJSON(e,t);u!==i&&(o=n),i=u;break}}catch(c){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(c){}}))),new ge(i,e,n)):new ge(i,e,n)}}function ye(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(be(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ve(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Te(t))return"Blackberry";if(Ee(t))return"Webos";if(we(t))return"Safari";if((t.includes("chrome/")||_e(t))&&!t.includes("edge/"))return"Chrome";if(Ie(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function ve(e=(0,r.z$)()){return/firefox\//i.test(e)}function we(e=(0,r.z$)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function _e(e=(0,r.z$)()){return/crios\//i.test(e)}function be(e=(0,r.z$)()){return/iemobile/i.test(e)}function Ie(e=(0,r.z$)()){return/android/i.test(e)}function Te(e=(0,r.z$)()){return/blackberry/i.test(e)}function Ee(e=(0,r.z$)()){return/webos/i.test(e)}function ke(e=(0,r.z$)()){return/iphone|ipad|ipod/i.test(e)}function Se(e=(0,r.z$)()){return ke(e)||Ie(e)||Ee(e)||Te(e)||/windows phone/i.test(e)||be(e)}function Ae(e,t=[]){let n;switch(e){case"Browser":n=ye((0,r.z$)());break;case"Worker":n=`${ye((0,r.z$)())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${s.SDK_VERSION}/${i}`}class Ce{constructor(e,t){this.app=e,this.config=t,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ne(this),this.idTokenSubscription=new Ne(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=R,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=t.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=j(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await ge.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(i){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(await this.currentUser.getIdToken())):void(await this._updateCurrentUser(e)):void 0}async initializeCurrentUser(e){var t;let n=await this.assertedPersistence.getCurrentUser();if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null===n||void 0===n?void 0:n._redirectEventId,s=await this.tryRedirectSignIn(e);r&&r!==i||!(null===s||void 0===s?void 0:s.user)||(n=s.user)}return n?n._redirectEventId?(U(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)):this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ue(e)}catch(t){if("auth/network-request-failed"!==t.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?(0,r.m9)(e):null;return t&&U(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){if(!this._deleted)return e&&U(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(j(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new r.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&j(e)||this._popupRedirectResolver;U(t,this,"argument-error"),this.redirectPersistenceManager=await ge.create(this,[j(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return U(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"===typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return U(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Ae(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};return this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId),e}}function Re(e){return(0,r.m9)(e)}class Ne{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,r.ne)((e=>this.observer=e))}get next(){return U(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function De(e,t,n){const r=Re(e);U(r._canInitEmulator,r,"emulator-config-failed"),U(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null===n||void 0===n?void 0:n.disableWarnings),s=Oe(t),{host:o,port:a}=function(e){const t=Oe(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Pe(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Pe(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function Oe(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Pe(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class xe{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return F("not implemented")}_getIdTokenResponse(e){return F("not implemented")}_linkToIdToken(e,t){return F("not implemented")}_getReauthenticationResolver(e){return F("not implemented")}}async function Le(e,t){return Y(e,"POST","/v1/accounts:resetPassword",J(e,t))}async function Me(e,t){return Y(e,"POST","/v1/accounts:update",t)}async function Ue(e,t){return Y(e,"POST","/v1/accounts:sendOobCode",J(e,t))}class Fe extends xe{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Fe(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Fe(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return Z(e,"POST","/v1/accounts:signInWithPassword",J(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Z(e,"POST","/v1/accounts:signInWithEmailLink",J(e,t))}(e,{email:this._email,oobCode:this._password});default:O(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Me(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Z(e,"POST","/v1/accounts:signInWithEmailLink",J(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:O(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Ve(e,t){return Z(e,"POST","/v1/accounts:signInWithIdp",J(e,t))}class qe extends xe{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new qe(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):O("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=p(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new qe(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return Ve(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ve(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ve(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,r.xO)(t)}return e}}const je={USER_NOT_FOUND:"user-not-found"};class Be extends xe{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Be({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Be({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Z(e,"POST","/v1/accounts:signInWithPhoneNumber",J(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Z(e,"POST","/v1/accounts:signInWithPhoneNumber",J(e,t));if(n.temporaryProof)throw ne(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Z(e,"POST","/v1/accounts:signInWithPhoneNumber",J(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),je)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Be({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class ze{constructor(e){var t,n,i,s,o,a;const c=(0,r.zd)((0,r.pd)(e)),u=null!==(t=c.apiKey)&&void 0!==t?t:null,h=null!==(n=c.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=c.mode)&&void 0!==i?i:null);U(u&&h&&l,"argument-error"),this.apiKey=u,this.operation=l,this.code=h,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,r.zd)((0,r.pd)(e)).link,n=t?(0,r.zd)((0,r.pd)(t)).deep_link_id:null,i=(0,r.zd)((0,r.pd)(e)).deep_link_id;return(i?(0,r.zd)((0,r.pd)(i)).link:null)||i||n||t||e}(e);try{return new ze(t)}catch(n){return null}}}class $e{constructor(){this.providerId=$e.PROVIDER_ID}static credential(e,t){return Fe._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=ze.parseLink(t);return U(n,"argument-error"),Fe._fromEmailAndCode(e,n.code,n.tenantId)}}$e.PROVIDER_ID="password",$e.EMAIL_PASSWORD_SIGN_IN_METHOD="password",$e.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Ke{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class We extends Ke{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class He extends We{static credentialFromJSON(e){const t="string"===typeof e?JSON.parse(e):e;return U("providerId"in t&&"signInMethod"in t,"argument-error"),qe._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return U(e.idToken||e.accessToken,"argument-error"),qe._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return He.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return He.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!n&&!r&&!t&&!i)return null;if(!o)return null;try{return new He(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(a){return null}}}class Ge extends We{constructor(){super("facebook.com")}static credential(e){return qe._fromParams({providerId:Ge.PROVIDER_ID,signInMethod:Ge.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ge.credentialFromTaggedObject(e)}static credentialFromError(e){return Ge.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ge.credential(e.oauthAccessToken)}catch(t){return null}}}Ge.FACEBOOK_SIGN_IN_METHOD="facebook.com",Ge.PROVIDER_ID="facebook.com";class Qe extends We{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return qe._fromParams({providerId:Qe.PROVIDER_ID,signInMethod:Qe.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Qe.credentialFromTaggedObject(e)}static credentialFromError(e){return Qe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Qe.credential(t,n)}catch(r){return null}}}Qe.GOOGLE_SIGN_IN_METHOD="google.com",Qe.PROVIDER_ID="google.com";class Je extends We{constructor(){super("github.com")}static credential(e){return qe._fromParams({providerId:Je.PROVIDER_ID,signInMethod:Je.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Je.credentialFromTaggedObject(e)}static credentialFromError(e){return Je.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Je.credential(e.oauthAccessToken)}catch(t){return null}}}Je.GITHUB_SIGN_IN_METHOD="github.com",Je.PROVIDER_ID="github.com";class Ye extends xe{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return Ve(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Ve(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Ve(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new Ye(n,i):null}static _create(e,t){return new Ye(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Xe extends Ke{constructor(e){U(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return Xe.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Xe.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Ye.fromJSON(e);return U(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return Ye._create(n,t)}catch(r){return null}}}class Ze extends We{constructor(){super("twitter.com")}static credential(e,t){return qe._fromParams({providerId:Ze.PROVIDER_ID,signInMethod:Ze.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ze.credentialFromTaggedObject(e)}static credentialFromError(e){return Ze.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Ze.credential(t,n)}catch(r){return null}}}async function et(e,t){return Z(e,"POST","/v1/accounts:signUp",J(e,t))}Ze.TWITTER_SIGN_IN_METHOD="twitter.com",Ze.PROVIDER_ID="twitter.com";class tt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await de._fromIdTokenResponse(e,n,r),s=nt(n);return new tt({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=nt(n);return new tt({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function nt(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class rt extends r.ZR{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,rt.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new rt(e,t,n,r)}}function it(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw rt._fromErrorAndOperation(e,n,t,r);throw n}))}function st(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function ot(e,t){const n=(0,r.m9)(e);await ct(!0,n,t);const{providerUserInfo:i}=await async function(e,t){return Y(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),s=st(i||[]);return n.providerData=n.providerData.filter((e=>s.has(e.providerId))),s.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}async function at(e,t,n=!1){const r=await oe(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return tt._forOperation(e,"link",r)}async function ct(e,t,n){await ue(t);const r=!1===e?"provider-already-linked":"no-such-provider";U(st(t.providerData).has(n)===e,t.auth,r)}async function ut(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await oe(e,it(r,i,t,e),n);U(s.idToken,r,"internal-error");const o=se(s.idToken);U(o,r,"internal-error");const{sub:a}=o;return U(e.uid===a,r,"user-mismatch"),tt._forOperation(e,i,s)}catch(s){throw"auth/user-not-found"===(null===s||void 0===s?void 0:s.code)&&O(r,"user-mismatch"),s}}async function ht(e,t,n=!1){const r="signIn",i=await it(e,r,t),s=await tt._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function lt(e,t){return ht(Re(e),t)}async function dt(e,t){const n=(0,r.m9)(e);return await ct(!1,n,t.providerId),at(n,t)}async function ft(e,t){return ut((0,r.m9)(e),t)}async function pt(e,t){const n=Re(e),r=await async function(e,t){return Z(e,"POST","/v1/accounts:signInWithCustomToken",J(e,t))}(n,{token:t,returnSecureToken:!0}),i=await tt._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}class mt{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?gt._fromServerResponse(e,t):O(e,"internal-error")}}class gt extends mt{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new gt(t)}}function yt(e,t,n){var r;U((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),U("undefined"===typeof n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(U(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(U(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function vt(e,t,n){const i=(0,r.m9)(e),s={requestType:"PASSWORD_RESET",email:t};n&&yt(i,s,n),await async function(e,t){return Ue(e,t)}(i,s)}async function wt(e,t){await async function(e,t){return Y(e,"POST","/v1/accounts:update",J(e,t))}((0,r.m9)(e),{oobCode:t})}async function _t(e,t){const n=(0,r.m9)(e),i=await Le(n,{oobCode:t}),s=i.requestType;switch(U(s,n,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":U(i.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":U(i.mfaInfo,n,"internal-error");default:U(i.email,n,"internal-error")}let o=null;return i.mfaInfo&&(o=mt._fromServerResponse(Re(n),i.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===i.requestType?i.newEmail:i.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===i.requestType?i.email:i.newEmail)||null,multiFactorInfo:o},operation:s}}async function bt(e,t,n){const i=(0,r.m9)(e),s={requestType:"EMAIL_SIGNIN",email:t};U(n.handleCodeInApp,i,"argument-error"),n&&yt(i,s,n),await async function(e,t){return Ue(e,t)}(i,s)}async function It(e,t){const n={identifier:t,continueUri:z()?B():"http://localhost"},{signinMethods:i}=await async function(e,t){return Y(e,"POST","/v1/accounts:createAuthUri",J(e,t))}((0,r.m9)(e),n);return i||[]}async function Tt(e,t){const n=(0,r.m9)(e),i={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&yt(n.auth,i,t);const{email:s}=await async function(e,t){return Ue(e,t)}(n.auth,i);s!==e.email&&await e.reload()}async function Et(e,t,n){const i=(0,r.m9)(e),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&yt(i.auth,s,n);const{email:o}=await async function(e,t){return Ue(e,t)}(i.auth,s);o!==e.email&&await e.reload()}async function kt(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const i=(0,r.m9)(e),s={idToken:await i.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},o=await oe(i,async function(e,t){return Y(e,"POST","/v1/accounts:update",t)}(i.auth,s));i.displayName=o.displayName||null,i.photoURL=o.photoUrl||null;const a=i.providerData.find((({providerId:e})=>"password"===e));a&&(a.displayName=i.displayName,a.photoURL=i.photoURL),await i._updateTokensIfNecessary(o)}async function St(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await oe(e,Me(r,i));await e._updateTokensIfNecessary(s,!0)}class At{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Ct extends At{constructor(e,t,n,r){super(e,t,n),this.username=r}}class Rt extends At{constructor(e,t){super(e,"facebook.com",t)}}class Nt extends Ct{constructor(e,t){super(e,"github.com",t,"string"===typeof(null===t||void 0===t?void 0:t.login)?null===t||void 0===t?void 0:t.login:null)}}class Dt extends At{constructor(e,t){super(e,"google.com",t)}}class Ot extends Ct{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Pt(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null===e||void 0===e?void 0:e.idToken)){const r=null===(n=null===(t=se(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new At(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new Rt(s,i);case"github.com":return new Nt(s,i);case"google.com":return new Dt(s,i);case"twitter.com":return new Ot(s,i,e.screenName||null);case"custom":case"anonymous":return new At(s,null);default:return new At(s,r,i)}}(n)}class xt{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new xt("enroll",e)}static _fromMfaPendingCredential(e){return new xt("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null===e||void 0===e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return xt._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return xt._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Lt{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=Re(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map((e=>mt._fromServerResponse(n,e)));U(r.mfaPendingCredential,n,"internal-error");const s=xt._fromMfaPendingCredential(r.mfaPendingCredential);return new Lt(s,i,(async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await tt._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return U(t.user,n,"internal-error"),tt._forOperation(t.user,t.operationType,o);default:O(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}class Mt{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>mt._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new Mt(e)}async getSession(){return xt._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e,r=await this.getSession(),i=await oe(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"===typeof e?e:e.uid,n=await this.user.getIdToken(),r=await oe(this.user,function(e,t){return Y(e,"POST","/v2/accounts/mfaEnrollment:withdraw",J(e,t))}(this.user.auth,{idToken:n,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(i){if("auth/user-token-expired"!==i.code)throw i}}}const Ut=new WeakMap;const Ft="__sak";class Vt{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ft,"1"),this.storage.removeItem(Ft),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class qt extends Vt{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=(0,r.z$)();return we(e)||ke(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Se(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,r.w1)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}qt.type="LOCAL";const jt=qt;class Bt extends Vt{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Bt.type="SESSION";const zt=Bt;class $t{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new $t(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null===s||void 0===s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Kt(e="",t=10){let n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}$t.receivers=[];class Wt{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=Kt("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function Ht(){return window}function Gt(){return"undefined"!==typeof Ht().WorkerGlobalScope&&"function"===typeof Ht().importScripts}const Qt="firebaseLocalStorageDb",Jt="firebaseLocalStorage",Yt="fbase_key";class Xt{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Zt(e,t){return e.transaction([Jt],t?"readwrite":"readonly").objectStore(Jt)}function en(){const e=indexedDB.open(Qt,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Jt,{keyPath:Yt})}catch(r){n(r)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Jt)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Qt);return new Xt(e).toPromise()}(),t(await en()))}))}))}async function tn(e,t,n){const r=Zt(e,!0).put({[Yt]:t,value:n});return new Xt(r).toPromise()}function nn(e,t){const n=Zt(e,!0).delete(t);return new Xt(n).toPromise()}class rn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await en()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Gt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$t._getInstance(Gt()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Wt(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await en();return await tn(e,Ft,"1"),await nn(e,Ft),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>tn(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Zt(e,!1).get(t),r=await new Xt(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>nn(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Zt(e,!1).getAll();return new Xt(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}rn.type="LOCAL";const sn=rn;function on(e){return new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=P("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}))}function an(e){return`__${e}${Math.floor(1e6*Math.random())}`}const cn=1e12;class un{constructor(e){this.auth=e,this.counter=cn,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new hn(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||cn;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||cn;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||cn;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class hn{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"===typeof e?document.getElementById(e):e;U(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<e;r++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(n){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(n){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const ln=an("rcb"),dn=new K(3e4,6e4);class fn{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!Ht().grecaptcha}load(e,t=""){return U(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(Ht().grecaptcha):new Promise(((n,i)=>{const s=Ht().setTimeout((()=>{i(P(e,"network-request-failed"))}),dn.get());Ht()[ln]=()=>{Ht().clearTimeout(s),delete Ht()[ln];const r=Ht().grecaptcha;if(!r)return void i(P(e,"internal-error"));const o=r.render;r.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(r)};on(`https://www.google.com/recaptcha/api.js??${(0,r.xO)({onload:ln,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(s),i(P(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!Ht().grecaptcha&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class pn{async load(e){return new un(e)}clearedOneInstance(){}}const mn="recaptcha",gn={theme:"light",type:"image"};class yn{constructor(e,t=Object.assign({},gn),n){this.parameters=t,this.type=mn,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Re(n),this.isInvisible="invisible"===this.parameters.size,U("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"===typeof e?document.getElementById(e):e;U(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new pn:new fn,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),n=t.getResponse(e);return n||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){U(!this.parameters.sitekey,this.auth,"argument-error"),U(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),U("undefined"!==typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"===typeof e)e(t);else if("string"===typeof e){const n=Ht()[e];"function"===typeof n&&n(t)}}}assertNotDestroyed(){U(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){U(z()&&!Gt(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await Y(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);U(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return U(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class vn{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Be._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function wn(e,t,n){var r;const i=await n.verify();try{let s;if(U("string"===typeof i,e,"argument-error"),U(n.type===mn,e,"argument-error"),s="string"===typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){U("enroll"===t.type,e,"internal-error");return(await function(e,t){return Y(e,"POST","/v2/accounts/mfaEnrollment:start",J(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}})).phoneSessionInfo.sessionInfo}{U("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;U(n,e,"missing-multi-factor-info");return(await function(e,t){return Y(e,"POST","/v2/accounts/mfaSignIn:start",J(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Y(e,"POST","/v1/accounts:sendVerificationCode",J(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class _n{constructor(e){this.providerId=_n.PROVIDER_ID,this.auth=Re(e)}verifyPhoneNumber(e,t){return wn(this.auth,e,(0,r.m9)(t))}static credential(e,t){return Be._fromVerification(e,t)}static credentialFromResult(e){const t=e;return _n.credentialFromTaggedObject(t)}static credentialFromError(e){return _n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Be._fromTokenResponse(t,n):null}}function bn(e,t){return t?j(t):(U(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}_n.PROVIDER_ID="phone",_n.PHONE_SIGN_IN_METHOD="phone";class In extends xe{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Ve(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Ve(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Ve(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Tn(e){return ht(e.auth,new In(e),e.bypassAuthState)}function En(e){const{auth:t,user:n}=e;return U(n,t,"internal-error"),ut(n,new In(e),e.bypassAuthState)}async function kn(e){const{auth:t,user:n}=e;return U(n,t,"internal-error"),at(n,new In(e),e.bypassAuthState)}class Sn{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Tn;case"linkViaPopup":case"linkViaRedirect":return kn;case"reauthViaPopup":case"reauthViaRedirect":return En;default:O(this.auth,"internal-error")}}resolve(e){V(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){V(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const An=new K(2e3,1e4);class Cn extends Sn{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Cn.currentPopupAction&&Cn.currentPopupAction.cancel(),Cn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return U(e,this.auth,"internal-error"),e}async onExecution(){V(1===this.filter.length,"Popup operations only handle one event");const e=Kt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(P(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(P(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Cn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(P(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,An.get())};e()}}Cn.currentPopupAction=null;const Rn=new Map;class Nn extends Sn{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Rn.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Pn(t),r=On(e);if(!(await r._isAvailable()))return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Rn.set(this.auth._key(),e)}return this.bypassAuthState||Rn.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Dn(e,t){return On(e)._set(Pn(t),"true")}function On(e){return j(e._redirectPersistence)}function Pn(e){return me("pendingRedirect",e.config.apiKey,e.name)}function xn(e,t,n){return async function(e,t,n){const r=Re(e);L(e,t,Ke);const i=bn(r,n);return await Dn(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}function Ln(e,t,n){return async function(e,t,n){const i=(0,r.m9)(e);L(i.auth,t,Ke);const s=bn(i.auth,n);await Dn(s,i.auth);const o=await Fn(i);return s._openRedirect(i.auth,t,"reauthViaRedirect",o)}(e,t,n)}function Mn(e,t,n){return async function(e,t,n){const i=(0,r.m9)(e);L(i.auth,t,Ke);const s=bn(i.auth,n);await ct(!1,i,t.providerId),await Dn(s,i.auth);const o=await Fn(i);return s._openRedirect(i.auth,t,"linkViaRedirect",o)}(e,t,n)}async function Un(e,t,n=!1){const r=Re(e),i=bn(r,t),s=new Nn(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function Fn(e){const t=Kt(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Vn{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return jn(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!jn(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(P(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(qn(e))}saveEventToCache(e){this.cachedEventUids.add(qn(e)),this.lastProcessedEventTime=Date.now()}}function qn(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function jn({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null===t||void 0===t?void 0:t.code)}async function Bn(e,t={}){return Y(e,"GET","/v1/projects",t)}const zn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,$n=/^https?/;function Kn(e){const t=B(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!$n.test(n))return!1;if(zn.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Wn=new K(3e4,6e4);function Hn(){const e=Ht().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}let Gn=null;function Qn(e){return Gn=Gn||function(e){return new Promise(((t,n)=>{var r,i,s;function o(){Hn(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Hn(),n(P(e,"network-request-failed"))},timeout:Wn.get()})}if(null===(i=null===(r=Ht().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=Ht().gapi)||void 0===s?void 0:s.load)){const t=an("iframefcb");return Ht()[t]=()=>{gapi.load?o():n(P(e,"network-request-failed"))},on(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Gn=null,e}))}(e),Gn}const Jn=new K(5e3,15e3),Yn={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Xn=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Zn(e){const t=e.config;U(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?W(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:s.SDK_VERSION},o=Xn.get(e.config.apiHost);o&&(i.eid=o);const a=e._getFrameworks();return a.length&&(i.fw=a.join(",")),`${n}?${(0,r.xO)(i).slice(1)}`}const er={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class tr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function nr(e,t,n,i=500,s=600){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let c="";const u=Object.assign(Object.assign({},er),{width:i.toString(),height:s.toString(),top:o,left:a}),h=(0,r.z$)().toLowerCase();n&&(c=_e(h)?"_blank":n),ve(h)&&(t=t||"http://localhost",u.scrollbars="yes");const l=Object.entries(u).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=(0,r.z$)()){var t;return ke(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(h)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new tr(null);const d=window.open(t||"",c,l);U(d,e,"popup-blocked");try{d.focus()}catch(f){}return new tr(d)}const rr="__/auth/handler",ir="emulator/auth/handler";function sr(e,t,n,i,o,a){U(e.config.authDomain,e,"auth-domain-config-required"),U(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:s.SDK_VERSION,eventId:o};if(t instanceof Ke){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,r.xb)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof We){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const u=c;for(const r of Object.keys(u))void 0===u[r]&&delete u[r];return`${function({config:e}){if(!e.emulator)return`https://${e.authDomain}/${rr}`;return W(e,ir)}(e)}?${(0,r.xO)(u).slice(1)}`}const or="webStorageSupport";const ar=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=zt,this._completeRedirectFn=Un}async _openPopup(e,t,n,r){var i;V(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return nr(e,sr(e,t,n,B(),r),Kt())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=sr(e,t,n,B(),r),Ht().location.href=i,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(V(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await Qn(e),n=Ht().gapi;return U(n,e,"internal-error"),t.open({where:document.body,url:Zn(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Yn,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=P(e,"network-request-failed"),s=Ht().setTimeout((()=>{r(i)}),Jn.get());function o(){Ht().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new Vn(e);return t.register("authEvent",(t=>{U(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(or,{type:or},(n=>{var r;const i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r.webStorageSupport;void 0!==i&&t(!!i),O(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await Bn(e);for(const r of t)try{if(Kn(r))return}catch(n){}O(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Se()||we()||ke()}};class cr extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return F("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new cr(e)}_finalizeEnroll(e,t,n){return function(e,t){return Y(e,"POST","/v2/accounts/mfaEnrollment:finalize",J(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return Y(e,"POST","/v2/accounts/mfaSignIn:finalize",J(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class ur{constructor(){}static assertion(e){return cr._fromCredential(e)}}ur.FACTOR_ID="phone";var hr,lr="@firebase/auth",dr="0.19.6";class fr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){U(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function pr(){return window}hr="Browser",(0,s._registerComponent)(new i.wA("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),{apiKey:r,authDomain:i}=n.options;return(e=>{U(r&&!r.includes(":"),"invalid-api-key",{appName:e.name}),U(!(null===i||void 0===i?void 0:i.includes(":")),"argument-error",{appName:e.name});const n={apiKey:r,authDomain:i,clientPlatform:hr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ae(hr)},s=new Ce(e,n);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(j);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(s,t),s})(n)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),(0,s._registerComponent)(new i.wA("auth-internal",(e=>(e=>new fr(e))(Re(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,s.registerVersion)(lr,dr,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(hr)),(0,s.registerVersion)(lr,dr,"esm2017");async function mr(e,t,n){var r;const{BuildInfo:i}=pr();V(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(V(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!==typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),o={};return ke()?o.ibi=i.packageName:Ie()?o.apn=i.packageName:O(e,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,sr(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}function gr(e){const{cordova:t}=pr();return new Promise((n=>{t.plugins.browsertab.isAvailable((i=>{let s=null;i?t.plugins.browsertab.openUrl(e):s=t.InAppBrowser.open(e,function(e=(0,r.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(s)}))}))}class yr extends Vn{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function vr(e){const t=await br()._get(Ir(e));return t&&await br()._remove(Ir(e)),t}function wr(e,t){var n,r;const i=function(e){const t=Tr(e),n=t.link?decodeURIComponent(t.link):void 0,r=Tr(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return Tr(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){const t=Tr(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(t){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(r=null===(n=null===s||void 0===s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],a=o?P(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}function _r(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<20;n++){const n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}function br(){return j(jt)}function Ir(e){return me("authEvent",e.config.apiKey,e.name)}function Tr(e){if(!(null===e||void 0===e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return(0,r.zd)(n.join("?"))}const Er=class{constructor(){this._redirectPersistence=zt,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Un}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new yr(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){O(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,o,a,c,u,h;const l=pr();U("function"===typeof(null===(t=null===l||void 0===l?void 0:l.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),U("undefined"!==typeof(null===(n=null===l||void 0===l?void 0:l.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),U("function"===typeof(null===(s=null===(i=null===(r=null===l||void 0===l?void 0:l.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),U("function"===typeof(null===(c=null===(a=null===(o=null===l||void 0===l?void 0:l.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),U("function"===typeof(null===(h=null===(u=null===l||void 0===l?void 0:l.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===h?void 0:h.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const i=await this._initialize(e);await i.initialized(),i.resetRedirect(),Rn.clear(),await this._originValidation(e);const s=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:_r(),postBody:null,tenantId:e.tenantId,error:P(e,"no-auth-event")}}(e,n,r);await function(e,t){return br()._set(Ir(e),t)}(e,s);const o=await mr(e,s,t);return async function(e,t,n){const{cordova:r}=pr();let i=()=>{};try{await new Promise(((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"===typeof t&&t(),"function"===typeof(null===n||void 0===n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout((()=>{o(P(e,"redirect-cancelled-by-user"))}),2e3))}function h(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),Ie()&&document.addEventListener("visibilitychange",h,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",h,!1),a&&window.clearTimeout(a)}}))}finally{i()}}(e,i,await gr(o))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=pr(),n={};ke()?n.iosBundleId=t.packageName:Ie()?n.androidPackageName=t.packageName:O(e,"operation-not-supported-in-this-environment"),await Bn(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=pr(),s=setTimeout((async()=>{await vr(e),t.onEvent(kr())}),500),o=async n=>{clearTimeout(s);const r=await vr(e);let i=null;r&&(null===n||void 0===n?void 0:n.url)&&(i=wr(r,n.url)),t.onEvent(i||kr())};"undefined"!==typeof n&&"function"===typeof n.subscribe&&n.subscribe(null,o);const a=r,c=`${i.packageName.toLowerCase()}://`;pr().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"===typeof a)try{a(e)}catch(t){console.error(t)}}}};function kr(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:P("no-auth-event")}}function Sr(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Ar(e=(0,r.z$)()){return!("file:"!==Sr()&&"ionic:"!==Sr()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Cr(e=(0,r.z$)()){return(0,r.w1)()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=(0,r.z$)()){return/Edge\/\d+/.test(e)}(e)}function Rr(){try{const e=self.localStorage,t=Kt();if(e)return e.setItem(t,"1"),e.removeItem(t),!Cr()||(0,r.hl)()}catch(e){return Nr()&&(0,r.hl)()}return!1}function Nr(){return"undefined"!==typeof n.g&&"WorkerGlobalScope"in n.g&&"importScripts"in n.g}function Dr(){return("http:"===Sr()||"https:"===Sr()||(0,r.ru)()||Ar())&&!((0,r.b$)()||(0,r.UG)())&&Rr()&&!Nr()}function Or(){return Ar()&&"undefined"!==typeof document}const Pr={LOCAL:"local",NONE:"none",SESSION:"session"},xr=U,Lr="persistence";async function Mr(e){await e._initializationPromise;const t=Ur(),n=me(Lr,e.config.apiKey,e.name);(null===t||void 0===t?void 0:t.sessionStorage)&&t.sessionStorage.setItem(n,e._getPersistence())}function Ur(){return"undefined"!==typeof window?window:null}const Fr=U;class Vr{constructor(){this.browserResolver=j(ar),this.cordovaResolver=j(Er),this.underlyingResolver=null,this._redirectPersistence=zt,this._completeRedirectFn=Un}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Or()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Fr(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!Or()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function qr(e){return e.unwrap()}function jr(e,t){var n;const i=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===t.code){t.resolver=new Kr(e,function(e,t){var n;const i=(0,r.m9)(e),s=t;return U(t.customData.operationType,i,"argument-error"),U(null===(n=s.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,i,"argument-error"),Lt._fromError(i,s)}(e,t))}else if(i){const e=Br(t),n=t;e&&(n.credential=e,n.tenantId=i.tenantId||void 0,n.email=i.email||void 0,n.phoneNumber=i.phoneNumber||void 0)}}function Br(e){const{_tokenResponse:t}=e instanceof r.ZR?e.customData:e;if(!t)return null;if(!(e instanceof r.ZR)&&"temporaryProof"in t&&"phoneNumber"in t)return _n.credentialFromResult(e);const n=t.providerId;if(!n||n===v)return null;let i;switch(n){case y:i=Qe;break;case m:i=Ge;break;case g:i=Je;break;case w:i=Ze;break;default:const{oauthIdToken:e,oauthAccessToken:r,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return r||s||e||o?o?n.startsWith("saml.")?Ye._create(n,o):qe._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:r}):new He(n).credential({idToken:e,accessToken:r,rawNonce:a}):null}return e instanceof r.ZR?i.credentialFromError(e):i.credentialFromResult(e)}function zr(e,t){return t.catch((t=>{throw t instanceof r.ZR&&jr(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(r=e,Br(r)),additionalUserInfo:Pt(e),user:Wr.getOrCreate(n)};var r}))}async function $r(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>zr(e,n.confirm(t))}}class Kr{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return zr(qr(this.auth),this.resolver.resolveSignIn(e))}}class Wr{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=(0,r.m9)(e);return Ut.has(t)||Ut.set(t,Mt._fromUser(t)),Ut.get(t)}(e)}static getOrCreate(e){return Wr.USER_MAP.has(e)||Wr.USER_MAP.set(e,new Wr(e)),Wr.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return zr(this.auth,dt(this._delegate,e))}async linkWithPhoneNumber(e,t){return $r(this.auth,async function(e,t,n){const i=(0,r.m9)(e);await ct(!1,i,"phone");const s=await wn(i.auth,t,(0,r.m9)(n));return new vn(s,(e=>dt(i,e)))}(this._delegate,e,t))}async linkWithPopup(e){return zr(this.auth,async function(e,t,n){const i=(0,r.m9)(e);L(i.auth,t,Ke);const s=bn(i.auth,n);return new Cn(i.auth,"linkViaPopup",t,s,i).executeNotNull()}(this._delegate,e,Vr))}async linkWithRedirect(e){return await Mr(Re(this.auth)),Mn(this._delegate,e,Vr)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return zr(this.auth,ft(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return $r(this.auth,async function(e,t,n){const i=(0,r.m9)(e),s=await wn(i.auth,t,(0,r.m9)(n));return new vn(s,(e=>ft(i,e)))}(this._delegate,e,t))}reauthenticateWithPopup(e){return zr(this.auth,async function(e,t,n){const i=(0,r.m9)(e);L(i.auth,t,Ke);const s=bn(i.auth,n);return new Cn(i.auth,"reauthViaPopup",t,s,i).executeNotNull()}(this._delegate,e,Vr))}async reauthenticateWithRedirect(e){return await Mr(Re(this.auth)),Ln(this._delegate,e,Vr)}sendEmailVerification(e){return Tt(this._delegate,e)}async unlink(e){return await ot(this._delegate,e),this}updateEmail(e){return function(e,t){return St((0,r.m9)(e),t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return St((0,r.m9)(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){await at((0,r.m9)(e),t)}(this._delegate,e)}updateProfile(e){return kt(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return Et(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Wr.USER_MAP=new WeakMap;const Hr=U;class Gr{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;Hr(n,"invalid-api-key",{appName:e.name}),Hr(n,"invalid-api-key",{appName:e.name});const r="undefined"!==typeof window?Vr:void 0;this._delegate=t.initialize({options:{persistence:Jr(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(A),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Wr.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){De(this._delegate,e,t)}applyActionCode(e){return wt(this._delegate,e)}checkActionCode(e){return _t(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await Le((0,r.m9)(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return zr(this._delegate,async function(e,t,n){const r=Re(e),i=await et(r,{returnSecureToken:!0,email:t,password:n}),s=await tt._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(s.user),s}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return It(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=ze.parseLink(t);return"EMAIL_SIGNIN"===(null===n||void 0===n?void 0:n.operation)}(this._delegate,e)}async getRedirectResult(){Hr(Dr(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await Re(e)._initializationPromise,Un(e,t,!1)}(this._delegate,Vr);return e?zr(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){Re(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=Qr(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=Qr(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return bt(this._delegate,e,t)}sendPasswordResetEmail(e,t){return vt(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){xr(Object.values(Pr).includes(t),e,"invalid-persistence-type"),(0,r.b$)()?xr(t!==Pr.SESSION,e,"unsupported-persistence-type"):(0,r.UG)()?xr(t===Pr.NONE,e,"unsupported-persistence-type"):Nr()?xr(t===Pr.NONE||t===Pr.LOCAL&&(0,r.hl)(),e,"unsupported-persistence-type"):xr(t===Pr.NONE||Rr(),e,"unsupported-persistence-type")}(this._delegate,e),e){case Pr.SESSION:t=zt;break;case Pr.LOCAL:t=await j(sn)._isAvailable()?sn:jt;break;case Pr.NONE:t=pe;break;default:return O("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return zr(this._delegate,async function(e){var t;const n=Re(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new tt({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await et(n,{returnSecureToken:!0}),i=await tt._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}(this._delegate))}signInWithCredential(e){return zr(this._delegate,lt(this._delegate,e))}signInWithCustomToken(e){return zr(this._delegate,pt(this._delegate,e))}signInWithEmailAndPassword(e,t){return zr(this._delegate,function(e,t,n){return lt((0,r.m9)(e),$e.credential(t,n))}(this._delegate,e,t))}signInWithEmailLink(e,t){return zr(this._delegate,async function(e,t,n){const i=(0,r.m9)(e),s=$e.credentialWithLink(t,n||B());return U(s._tenantId===(i.tenantId||null),i,"tenant-id-mismatch"),lt(i,s)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return $r(this._delegate,async function(e,t,n){const i=Re(e),s=await wn(i,t,(0,r.m9)(n));return new vn(s,(e=>lt(i,e)))}(this._delegate,e,t))}async signInWithPopup(e){return Hr(Dr(),this._delegate,"operation-not-supported-in-this-environment"),zr(this._delegate,async function(e,t,n){const r=Re(e);L(e,t,Ke);const i=bn(r,n);return new Cn(r,"signInViaPopup",t,i).executeNotNull()}(this._delegate,e,Vr))}async signInWithRedirect(e){return Hr(Dr(),this._delegate,"operation-not-supported-in-this-environment"),await Mr(this._delegate),xn(this._delegate,e,Vr)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await _t((0,r.m9)(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function Qr(e,t,n){let r=e;"function"!==typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&Wr.getOrCreate(e)),error:t,complete:n}}function Jr(e,t){const n=function(e,t){const n=Ur();if(!(null===n||void 0===n?void 0:n.sessionStorage))return[];const r=me(Lr,e,t);switch(n.sessionStorage.getItem(r)){case Pr.NONE:return[pe];case Pr.LOCAL:return[sn,zt];case Pr.SESSION:return[zt];default:return[]}}(e,t);if("undefined"===typeof self||n.includes(sn)||n.push(sn),"undefined"!==typeof window)for(const r of[jt,zt])n.includes(r)||n.push(r);return n.includes(pe)||n.push(pe),n}Gr.Persistence=Pr;class Yr{constructor(){this.providerId="phone",this._delegate=new _n(qr(d.auth()))}static credential(e,t){return _n.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Yr.PHONE_SIGN_IN_METHOD=_n.PHONE_SIGN_IN_METHOD,Yr.PROVIDER_ID=_n.PROVIDER_ID;const Xr=U;class Zr{constructor(e,t,n=d.app()){var r;Xr(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new yn(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}var ei;(ei=d).INTERNAL.registerComponent(new i.wA("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new Gr(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:_,PASSWORD_RESET:b,RECOVER_EMAIL:I,REVERT_SECOND_FACTOR_ADDITION:T,VERIFY_AND_CHANGE_EMAIL:E,VERIFY_EMAIL:k}},EmailAuthProvider:$e,FacebookAuthProvider:Ge,GithubAuthProvider:Je,GoogleAuthProvider:Qe,OAuthProvider:He,SAMLAuthProvider:Xe,PhoneAuthProvider:Yr,PhoneMultiFactorGenerator:ur,RecaptchaVerifier:Zr,TwitterAuthProvider:Ze,Auth:Gr,AuthCredential:xe,Error:r.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),ei.registerVersion("@firebase/auth-compat","0.2.6");var ti=n(1294);function ni(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new ti.WA("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function ri(){if("undefined"===typeof Uint8Array)throw new ti.WA("unimplemented","Uint8Arrays are not available in this environment.")}function ii(){if(!(0,ti.Me)())throw new ti.WA("unimplemented","Blobs are unavailable in Firestore in this environment.")}class si{constructor(e){this._delegate=e}static fromBase64String(e){return ii(),new si(ti.Jj.fromBase64String(e))}static fromUint8Array(e){return ri(),new si(ti.Jj.fromUint8Array(e))}toBase64(){return ii(),this._delegate.toBase64()}toUint8Array(){return ri(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function oi(e){return function(e,t){if("object"!==typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"===typeof n[r])return!0;return!1}(e,["next","error","complete"])}class ai{enableIndexedDbPersistence(e,t){return(0,ti.ST)(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return(0,ti.fH)(e._delegate)}clearIndexedDbPersistence(e){return(0,ti.Fc)(e._delegate)}}class ci{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof ti.l7||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||(0,ti.yq)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){(0,ti.at)(this._delegate,e,t,n)}enableNetwork(){return(0,ti.Ix)(this._delegate)}disableNetwork(){return(0,ti.TF)(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,(0,ti.Wi)("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return(0,ti.Mx)(this._delegate)}onSnapshotsInSync(e){return(0,ti.sc)(this._delegate,e)}get app(){if(!this._appCompat)throw new ti.WA("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Ii(this,(0,ti.hJ)(this._delegate,e))}catch(t){throw pi(t,"collection()","Firestore.collection()")}}doc(e){try{return new fi(this,(0,ti.JU)(this._delegate,e))}catch(t){throw pi(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new wi(this,(0,ti.B$)(this._delegate,e))}catch(t){throw pi(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return(0,ti.i3)(this._delegate,(t=>e(new hi(this,t))))}batch(){return(0,ti.qY)(this._delegate),new li(new ti.PU(this._delegate,(e=>(0,ti.GL)(this._delegate,e))))}loadBundle(e){return(0,ti.Pb)(this._delegate,e)}namedQuery(e){return(0,ti.L$)(this._delegate,e).then((e=>e?new wi(this,e):null))}}class ui extends ti.u7{constructor(e){super(),this.firestore=e}convertBytes(e){return new si(new ti.Jj(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return fi.forKey(t,this.firestore,null)}}class hi{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ui(e)}get(e){const t=Ti(e);return this._delegate.get(t).then((e=>new yi(this._firestore,new ti.xU(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){const r=Ti(e);return n?(ni("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Ti(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Ti(e);return this._delegate.delete(t),this}}class li{constructor(e){this._delegate=e}set(e,t,n){const r=Ti(e);return n?(ni("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Ti(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Ti(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class di{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new ti.$q(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new vi(this._firestore,n),null!==t&&void 0!==t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=di.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new di(e,new ui(e),t),r.set(t,i)),i}}di.INSTANCES=new WeakMap;class fi{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ui(e)}static forPath(e,t,n){if(e.length%2!==0)throw new ti.WA("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new fi(t,new ti.my(t._delegate,n,new ti.Ky(e)))}static forKey(e,t,n){return new fi(t,new ti.my(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Ii(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Ii(this.firestore,(0,ti.hJ)(this._delegate,e))}catch(t){throw pi(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,r.m9)(e))instanceof ti.my&&(0,ti.Eo)(this._delegate,e)}set(e,t){t=ni("DocumentReference.set",t);try{return t?(0,ti.pl)(this._delegate,e,t):(0,ti.pl)(this._delegate,e)}catch(n){throw pi(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?(0,ti.r7)(this._delegate,e):(0,ti.r7)(this._delegate,e,t,...n)}catch(r){throw pi(r,"updateDoc()","DocumentReference.update()")}}delete(){return(0,ti.oe)(this._delegate)}onSnapshot(...e){const t=mi(e),n=gi(e,(e=>new yi(this.firestore,new ti.xU(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return(0,ti.cf)(this._delegate,t,n)}get(e){let t;return t="cache"===(null===e||void 0===e?void 0:e.source)?(0,ti.kl)(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?(0,ti.Xk)(this._delegate):(0,ti.QT)(this._delegate),t.then((e=>new yi(this.firestore,new ti.xU(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new fi(this.firestore,e?this._delegate.withConverter(di.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function pi(e,t,n){return e.message=e.message.replace(t,n),e}function mi(e){for(const t of e)if("object"===typeof t&&!oi(t))return t;return{}}function gi(e,t){var n,r;let i;return i=oi(e[0])?e[0]:oi(e[1])?e[1]:"function"===typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class yi{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new fi(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return(0,ti.qK)(this._delegate,e._delegate)}}class vi extends yi{data(e){const t=this._delegate.data(e);return(0,ti.K9)(void 0!==t,"Document in a QueryDocumentSnapshot should exist"),t}}class wi{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ui(e)}where(e,t,n){try{return new wi(this.firestore,(0,ti.IO)(this._delegate,(0,ti.ar)(e,t,n)))}catch(r){throw pi(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new wi(this.firestore,(0,ti.IO)(this._delegate,(0,ti.Xo)(e,t)))}catch(n){throw pi(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new wi(this.firestore,(0,ti.IO)(this._delegate,(0,ti.b9)(e)))}catch(t){throw pi(t,"limit()","Query.limit()")}}limitToLast(e){try{return new wi(this.firestore,(0,ti.IO)(this._delegate,(0,ti.vh)(e)))}catch(t){throw pi(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new wi(this.firestore,(0,ti.IO)(this._delegate,(0,ti.e0)(...e)))}catch(t){throw pi(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new wi(this.firestore,(0,ti.IO)(this._delegate,(0,ti.TQ)(...e)))}catch(t){throw pi(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new wi(this.firestore,(0,ti.IO)(this._delegate,(0,ti.Lx)(...e)))}catch(t){throw pi(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new wi(this.firestore,(0,ti.IO)(this._delegate,(0,ti.Wu)(...e)))}catch(t){throw pi(t,"endAt()","Query.endAt()")}}isEqual(e){return(0,ti.iE)(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null===e||void 0===e?void 0:e.source)?(0,ti.UQ)(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?(0,ti.zN)(this._delegate):(0,ti.PL)(this._delegate),t.then((e=>new bi(this.firestore,new ti.W(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=mi(e),n=gi(e,(e=>new bi(this.firestore,new ti.W(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return(0,ti.cf)(this._delegate,t,n)}withConverter(e){return new wi(this.firestore,e?this._delegate.withConverter(di.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class _i{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new vi(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class bi{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new wi(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new vi(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new _i(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new vi(this._firestore,n))}))}isEqual(e){return(0,ti.qK)(this._delegate,e._delegate)}}class Ii extends wi{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new fi(this.firestore,e):null}doc(e){try{return new fi(this.firestore,void 0===e?(0,ti.JU)(this._delegate):(0,ti.JU)(this._delegate,e))}catch(t){throw pi(t,"doc()","CollectionReference.doc()")}}add(e){return(0,ti.ET)(this._delegate,e).then((e=>new fi(this.firestore,e)))}isEqual(e){return(0,ti.Eo)(this._delegate,e._delegate)}withConverter(e){return new Ii(this.firestore,e?this._delegate.withConverter(di.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Ti(e){return(0,ti.Cf)(e,ti.my)}class Ei{constructor(...e){this._delegate=new ti.Lz(...e)}static documentId(){return new Ei(ti.Xb.keyField().canonicalString())}isEqual(e){return(e=(0,r.m9)(e))instanceof ti.Lz&&this._delegate._internalPath.isEqual(e._internalPath)}}class ki{constructor(e){this._delegate=e}static serverTimestamp(){const e=(0,ti.Bt)();return e._methodName="FieldValue.serverTimestamp",new ki(e)}static delete(){const e=(0,ti.AK)();return e._methodName="FieldValue.delete",new ki(e)}static arrayUnion(...e){const t=(0,ti.vr)(...e);return t._methodName="FieldValue.arrayUnion",new ki(t)}static arrayRemove(...e){const t=(0,ti.Ab)(...e);return t._methodName="FieldValue.arrayRemove",new ki(t)}static increment(e){const t=(0,ti.nP)(e);return t._methodName="FieldValue.increment",new ki(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Si={Firestore:ci,GeoPoint:ti.F8,Timestamp:ti.EK,Blob:si,Transaction:hi,WriteBatch:li,DocumentReference:fi,DocumentSnapshot:yi,Query:wi,QueryDocumentSnapshot:vi,QuerySnapshot:bi,CollectionReference:Ii,FieldPath:Ei,FieldValue:ki,setLogLevel:function(e){(0,ti.Ub)(e)},CACHE_SIZE_UNLIMITED:ti.IX};!function(e){!function(e,t){e.INTERNAL.registerComponent(new i.wA("firestore-compat",(e=>{const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("firestore").getImmediate();return t(n,r)}),"PUBLIC").setServiceProps(Object.assign({},Si)))}(e,((e,t)=>new ci(e,t,new ai))),e.registerVersion("@firebase/firestore-compat","0.1.12")}(d);const Ai="firebasestorage.googleapis.com";class Ci extends r.ZR{constructor(e,t){super(Ri(e),`Firebase Storage: ${t} (${Ri(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Ci.prototype)}_codeEquals(e){return Ri(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}function Ri(e){return"storage/"+e}function Ni(){return new Ci("unknown","An unknown error occurred, please check the error payload for server response.")}function Di(){return new Ci("canceled","User canceled the upload/download.")}function Oi(){return new Ci("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function Pi(e){return new Ci("invalid-argument",e)}function xi(){return new Ci("app-deleted","The Firebase app was deleted.")}function Li(e){return new Ci("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function Mi(e,t){return new Ci("invalid-format","String does not match format '"+e+"': "+t)}function Ui(e){throw new Ci("internal-error","Internal error: "+e)}class Fi{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Fi.makeFromUrl(e,t)}catch(r){return new Fi(e,"")}if(""===n.path)return n;throw new Ci("invalid-default-bucket","Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)";const i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${t===Ai?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let c=0;c<a.length;c++){const t=a[c],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let i=r[t.indices.path];i||(i=""),n=new Fi(e,i),t.postModify(n);break}}if(null==n)throw function(e){return new Ci("invalid-url","Invalid URL '"+e+"'.")}(e);return n}}class Vi{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function qi(e){return"string"===typeof e||e instanceof String}function ji(e){return Bi()&&e instanceof Blob}function Bi(){return"undefined"!==typeof Blob}function zi(e,t,n,r){if(r<t)throw Pi(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw Pi(`Invalid value for '${e}'. Expected ${n} or less.`)}function $i(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function Ki(e){const t=encodeURIComponent;let n="?";for(const r in e)if(e.hasOwnProperty(r)){n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1),n}var Wi;!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Wi||(Wi={}));class Hi{constructor(e,t,n,r,i,s,o,a,c,u,h){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{if(t)return void e(!1,new Gi(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===Wi.NO_ERROR,i=n.getStatus();if(!t||this.isRetryStatusCode_(i)){const t=n.getErrorCode()===Wi.ABORT;return void e(!1,new Gi(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new Gi(s,n))}))},t=(e,t)=>{const n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());void 0!==e?n(e):n()}catch(s){r(s)}else if(null!==i){const e=Ni();e.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,e)):r(e)}else if(t.canceled){r(this.appDelete_?xi():Di())}else{r(new Ci("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}};this.canceled_?t(0,new Gi(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0;function c(){return 2===a}let u=!1;function h(...e){u||(u=!0,t.apply(null,e))}function l(t){i=setTimeout((()=>{i=null,e(f,c())}),t)}function d(){s&&clearTimeout(s)}function f(e,...t){if(u)return void d();if(e)return d(),void h.call(null,e,...t);if(c()||o)return d(),void h.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),l(n)}let p=!1;function m(e){p||(p=!0,d(),u||(null!==i?(e||(a=2),clearTimeout(i),l(0)):e||(a=1)))}return l(0),s=setTimeout((()=>{o=!0,m(!0)}),n),m}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}isRetryStatusCode_(e){const t=e>=500&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||r}}class Gi{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function Qi(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function Ji(...e){const t=Qi();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(Bi())return new Blob(e);throw new Ci("unsupported-environment","This browser doesn't seem to support creating Blobs")}const Yi={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Xi{constructor(e,t){this.data=e,this.contentType=t||null}}function Zi(e,t){switch(e){case Yi.RAW:return new Xi(es(t));case Yi.BASE64:case Yi.BASE64URL:return new Xi(ts(e,t));case Yi.DATA_URL:return new Xi(function(e){const t=new ns(e);return t.base64?ts(Yi.BASE64,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(n){throw Mi(Yi.DATA_URL,"Malformed data URL.")}return es(t)}(t.rest)}(t),new ns(t).contentType)}throw Ni()}function es(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);if(r<=127)t.push(r);else if(r<=2047)t.push(192|r>>6,128|63&r);else if(55296===(64512&r)){if(n<e.length-1&&56320===(64512&e.charCodeAt(n+1))){r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else t.push(239,191,189)}else 56320===(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function ts(e,t){switch(e){case Yi.BASE64:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r){throw Mi(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case Yi.BASE64URL:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r){throw Mi(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=atob(t)}catch(i){throw Mi(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class ns{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw Mi(Yi.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;null!=n&&(this.base64=function(e,t){if(!(e.length>=t.length))return!1;return e.substring(e.length-t.length)===t}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-";base64".length):n),this.rest=e.substring(e.indexOf(",")+1)}}class rs{constructor(e,t){let n=0,r="";ji(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(ji(this.data_)){const n=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,e,t);return null===n?null:new rs(n)}{const n=new Uint8Array(this.data_.buffer,e,t-e);return new rs(n,!0)}}static getBlob(...e){if(Bi()){const t=e.map((e=>e instanceof rs?e.data_:e));return new rs(Ji.apply(null,t))}{const t=e.map((e=>qi(e)?Zi(Yi.RAW,e).data:e.data_));let n=0;t.forEach((e=>{n+=e.byteLength}));const r=new Uint8Array(n);let i=0;return t.forEach((e=>{for(let t=0;t<e.length;t++)r[i++]=e[t]})),new rs(r,!0)}}uploadData(){return this.data_}}function is(e){let t;try{t=JSON.parse(e)}catch(r){return null}return"object"!==typeof(n=t)||Array.isArray(n)?null:t;var n}function ss(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function os(e,t){return t}class as{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||os}}let cs=null;function us(){if(cs)return cs;const e=[];e.push(new as("bucket")),e.push(new as("generation")),e.push(new as("metageneration")),e.push(new as("name","fullPath",!0));const t=new as("name");t.xform=function(e,t){return function(e){return!qi(e)||e.length<2?e:ss(e)}(t)},e.push(t);const n=new as("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new as("timeCreated")),e.push(new as("updated")),e.push(new as("md5Hash",null,!0)),e.push(new as("cacheControl",null,!0)),e.push(new as("contentDisposition",null,!0)),e.push(new as("contentEncoding",null,!0)),e.push(new as("contentLanguage",null,!0)),e.push(new as("contentType",null,!0)),e.push(new as("metadata","customMetadata",!0)),cs=e,cs}function hs(e,t,n){const r={type:"file"},i=n.length;for(let s=0;s<i;s++){const e=n[s];r[e.local]=e.xform(r,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,i=new Fi(n,r);return t._makeStorageReference(i)}})}(r,e),r}function ls(e,t,n){const r=is(t);if(null===r)return null;return hs(e,r,n)}function ds(e,t){const n={},r=t.length;for(let i=0;i<r;i++){const r=t[i];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}function fs(e,t,n){const r=is(n);if(null===r)return null;return function(e,t,n){const r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(const i of n.prefixes){const n=i.replace(/\/$/,""),s=e._makeStorageReference(new Fi(t,n));r.prefixes.push(s)}if(n.items)for(const i of n.items){const n=e._makeStorageReference(new Fi(t,i.name));r.items.push(n)}return r}(e,t,r)}class ps{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function ms(e){if(!e)throw Ni()}function gs(e,t){return function(n,r){const i=ls(e,r,t);return ms(null!==i),i}}function ys(e,t){return function(n,r){const i=ls(e,r,t);return ms(null!==i),function(e,t,n,r){const i=is(t);if(null===i)return null;if(!qi(i.downloadTokens))return null;const s=i.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map((t=>{const i=e.bucket,s=e.fullPath;return $i("/b/"+o(i)+"/o/"+o(s),n,r)+Ki({alt:"media",token:t})}))[0]}(i,r,e.host,e._protocol)}}function vs(e){return function(t,n){let r;var i,s;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new Ci("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new Ci("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,r=new Ci("quota-exceeded","Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,r=new Ci("unauthorized","User does not have permission to access '"+i+"'.")):r=n,r.serverResponse=n.serverResponse,r}}function ws(e){const t=vs(e);return function(n,r){let i=t(n,r);var s;return 404===n.getStatus()&&(s=e.path,i=new Ci("object-not-found","Object '"+s+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function _s(e,t,n){const r=$i(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new ps(r,"GET",gs(e,n),i);return s.errorHandler=ws(t),s}function bs(e,t,n,r,i){const s={};t.isRoot?s.prefix="":s.prefix=t.path+"/",n&&n.length>0&&(s.delimiter=n),r&&(s.pageToken=r),i&&(s.maxResults=i);const o=$i(t.bucketOnlyServerUrl(),e.host,e._protocol),a=e.maxOperationRetryTime,c=new ps(o,"GET",function(e,t){return function(n,r){const i=fs(e,t,r);return ms(null!==i),i}}(e,t.bucket),a);return c.urlParams=s,c.errorHandler=vs(t),c}function Is(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}function Ts(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};const a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const c=Is(t,r,i),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+ds(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",h="\r\n--"+a+"--",l=rs.getBlob(u,r,h);if(null===l)throw Oi();const d={name:c.fullPath},f=$i(s,e.host,e._protocol),p=e.maxUploadRetryTime,m=new ps(f,"POST",gs(e,n),p);return m.urlParams=d,m.headers=o,m.body=l.uploadData(),m.errorHandler=vs(t),m}class Es{constructor(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null}}function ks(e,t){let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(r){ms(!1)}return ms(!!n&&-1!==(t||["active"]).indexOf(n)),n}const Ss=262144;function As(e,t,n,r,i,s,o,a){const c=new Es(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw new Ci("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");const u=c.total-c.current;let h=u;i>0&&(h=Math.min(h,i));const l=c.current,d=l+h,f={"X-Goog-Upload-Command":h===u?"upload, finalize":"upload","X-Goog-Upload-Offset":`${c.current}`},p=r.slice(l,d);if(null===p)throw Oi();const m=t.maxUploadRetryTime,g=new ps(n,"POST",(function(e,n){const i=ks(e,["active","final"]),o=c.current+h,a=r.size();let u;return u="final"===i?gs(t,s)(e,n):null,new Es(o,a,"final"===i,u)}),m);return g.headers=f,g.body=p.uploadData(),g.progressCallback=a||null,g.errorHandler=vs(e),g}const Cs={STATE_CHANGED:"state_changed"},Rs={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Ns(e){switch(e){case"running":case"pausing":case"canceling":return Rs.RUNNING;case"paused":return Rs.PAUSED;case"success":return Rs.SUCCESS;case"canceled":return Rs.CANCELED;case"error":default:return Rs.ERROR}}class Ds{constructor(e,t,n){if("function"===typeof e||null!=t||null!=n)this.next=e,this.error=null!==t&&void 0!==t?t:void 0,this.complete=null!==n&&void 0!==n?n:void 0;else{const t=e;this.next=t.next,this.error=t.error,this.complete=t.complete}}}function Os(e){return(...t)=>{Promise.resolve().then((()=>e(...t)))}}class Ps{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Wi.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=Wi.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=Wi.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,r){if(this.sent_)throw Ui("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ui("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ui("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw Ui("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ui("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class xs extends Ps{initXhr(){this.xhr_.responseType="text"}}function Ls(){return new xs}class Ms{constructor(e,t,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=us(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=e=>{this._request=void 0,this._chunkMultiplier=1,e._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=e,this._transition("error"))},this._metadataErrorHandler=e=>{this._request=void 0,e._codeEquals("canceled")?this.completeTransitions_():(this._error=e,this._transition("error"))},this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t,this._start()})),this._promise.then(null,(()=>{}))}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then((([t,n])=>{switch(this._state){case"running":e(t,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}}))}_createResumable(){this._resolveToken(((e,t)=>{const n=function(e,t,n,r,i){const s=t.bucketOnlyServerUrl(),o=Is(t,r,i),a={name:o.fullPath},c=$i(s,e.host,e._protocol),u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=ds(o,n),l=e.maxUploadRetryTime,d=new ps(c,"POST",(function(e){let t;ks(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(n){ms(!1)}return ms(qi(t)),t}),l);return d.urlParams=a,d.headers=u,d.body=h,d.errorHandler=vs(t),d}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Ls,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._uploadUrl=e,this._needToFetchStatus=!1,this.completeTransitions_()}),this._errorHandler)}))}_fetchStatus(){const e=this._uploadUrl;this._resolveToken(((t,n)=>{const r=function(e,t,n,r){const i=e.maxUploadRetryTime,s=new ps(n,"POST",(function(e){const t=ks(e,["active","final"]);let n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(s){ms(!1)}n||ms(!1);const i=Number(n);return ms(!isNaN(i)),new Es(i,r.size(),"final"===t)}),i);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=vs(t),s}(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(r,Ls,t,n);this._request=i,i.getPromise().then((e=>{e=e,this._request=void 0,this._updateProgress(e.current),this._needToFetchStatus=!1,e.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()}),this._errorHandler)}))}_continueUpload(){const e=Ss*this._chunkMultiplier,t=new Es(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken(((r,i)=>{let s;try{s=As(this._ref._location,this._ref.storage,n,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(a){return this._error=a,void this._transition("error")}const o=this._ref.storage._makeRequest(s,Ls,r,i);this._request=o,o.getPromise().then((e=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(e.current),e.finalized?(this._metadata=e.metadata,this._transition("success")):this.completeTransitions_()}),this._errorHandler)}))}_increaseMultiplier(){Ss*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken(((e,t)=>{const n=_s(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(n,Ls,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._transition("success")}),this._metadataErrorHandler)}))}_oneShotUpload(){this._resolveToken(((e,t)=>{const n=Ts(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,Ls,e,t);this._request=r,r.getPromise().then((e=>{this._request=void 0,this._metadata=e,this._updateProgress(this._blob.size()),this._transition("success")}),this._errorHandler)}))}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request&&this._request.cancel();break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=Di(),this._state=e,this._notifyObservers();break;case"error":case"success":this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=Ns(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,n,r){const i=new Ds(t||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise();this._observers.slice().forEach((e=>{this._notifyObserver(e)}))}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(Ns(this._state)){case Rs.SUCCESS:Os(this._resolve.bind(null,this.snapshot))();break;case Rs.CANCELED:case Rs.ERROR:Os(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Ns(this._state)){case Rs.RUNNING:case Rs.PAUSED:e.next&&Os(e.next.bind(e,this.snapshot))();break;case Rs.SUCCESS:e.complete&&Os(e.complete.bind(e))();break;case Rs.CANCELED:case Rs.ERROR:e.error&&Os(e.error.bind(e,this._error))();break;default:e.error&&Os(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class Us{constructor(e,t){this._service=e,this._location=t instanceof Fi?t:Fi.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new Us(e,t)}get root(){const e=new Fi(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return ss(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Fi(this._location.bucket,e);return new Us(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw Li(e)}}function Fs(e){const t={prefixes:[],items:[]};return Vs(e,t).then((()=>t))}async function Vs(e,t,n){const r={pageToken:n},i=await qs(e,r);t.prefixes.push(...i.prefixes),t.items.push(...i.items),null!=i.nextPageToken&&await Vs(e,t,i.nextPageToken)}function qs(e,t){null!=t&&"number"===typeof t.maxResults&&zi("options.maxResults",1,1e3,t.maxResults);const n=t||{},r=bs(e.storage,e._location,"/",n.pageToken,n.maxResults);return e.storage.makeRequestWithTokens(r,Ls)}function js(e,t){e._throwIfRoot("updateMetadata");const n=function(e,t,n,r){const i=$i(t.fullServerUrl(),e.host,e._protocol),s=ds(n,r),o=e.maxOperationRetryTime,a=new ps(i,"PATCH",gs(e,r),o);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=s,a.errorHandler=ws(t),a}(e.storage,e._location,t,us());return e.storage.makeRequestWithTokens(n,Ls)}function Bs(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=$i(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new ps(r,"GET",ys(e,n),i);return s.errorHandler=ws(t),s}(e.storage,e._location,us());return e.storage.makeRequestWithTokens(t,Ls).then((e=>{if(null===e)throw new Ci("no-download-url","The given file does not have any download URLs.");return e}))}function zs(e){e._throwIfRoot("deleteObject");const t=function(e,t){const n=$i(t.fullServerUrl(),e.host,e._protocol),r=e.maxOperationRetryTime,i=new ps(n,"DELETE",(function(e,t){}),r);return i.successCodes=[200,204],i.errorHandler=ws(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,Ls)}function $s(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new Fi(e._location.bucket,n);return new Us(e.storage,r)}function Ks(e,t){if(e instanceof Gs){const n=e;if(null==n._bucket)throw new Ci("no-default-bucket","No default bucket found. Did you set the 'storageBucket' property when initializing the app?");const r=new Us(n,n._bucket);return null!=t?Ks(r,t):r}return void 0!==t?$s(e,t):e}function Ws(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof Gs)return new Us(e,t);throw Pi("To use ref(service, url), the first argument must be a Storage instance.")}return Ks(e,t)}function Hs(e,t){const n=null===t||void 0===t?void 0:t.storageBucket;return null==n?null:Fi.makeFromBucketSpec(n,e)}class Gs{constructor(e,t,n,r,i){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=Ai,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?Fi.makeFromBucketSpec(r,this._host):Hs(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Fi.makeFromBucketSpec(this._url,e):this._bucket=Hs(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){zi("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){zi("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Us(this,e)}_makeRequest(e,t,n,r){if(this._deleted)return new Vi(xi());{const i=function(e,t,n,r,i,s){const o=Ki(e.urlParams),a=e.url+o,c=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(c,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(c,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(c,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(c,r),new Hi(a,e.method,c,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i)}(e,this._appId,n,r,t,this._firebaseVersion);return this._requests.add(i),i.getPromise().then((()=>this._requests.delete(i)),(()=>this._requests.delete(i))),i}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const Qs="@firebase/storage",Js="0.9.1",Ys="storage";function Xs(e,t,n){return function(e,t,n){return e._throwIfRoot("uploadBytesResumable"),new Ms(e,new rs(t),n)}(e=(0,r.m9)(e),t,n)}function Zs(e){return function(e){e._throwIfRoot("getMetadata");const t=_s(e.storage,e._location,us());return e.storage.makeRequestWithTokens(t,Ls)}(e=(0,r.m9)(e))}function eo(e,t){return Ws(e=(0,r.m9)(e),t)}function to(e,t,n,i={}){!function(e,t,n,i={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:s}=i;s&&(e._overrideAuthToken="string"===typeof s?s:(0,r.Sg)(s,e.app.options.projectId))}(e,t,n,i)}function no(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),i=e.getProvider("app-check-internal");return new Gs(n,r,i,t,s.SDK_VERSION)}(0,s._registerComponent)(new i.wA(Ys,no,"PUBLIC").setMultipleInstances(!0)),(0,s.registerVersion)(Qs,Js,""),(0,s.registerVersion)(Qs,Js,"esm2017");class ro{constructor(e,t,n){this._delegate=e,this.task=t,this.ref=n}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class io{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new ro(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then((t=>{if(e)return e(new ro(t,this,this._ref))}),t)}on(e,t,n,r){let i;return t&&(i="function"===typeof t?e=>t(new ro(e,this,this._ref)):{next:t.next?e=>t.next(new ro(e,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,n||void 0,r||void 0)}}class so{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map((e=>new oo(e,this._service)))}get items(){return this._delegate.items.map((e=>new oo(e,this._service)))}get nextPageToken(){return this._delegate.nextPageToken||null}}class oo{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=function(e,t){return $s(e,t)}(this._delegate,e);return new oo(t,this.storage)}get root(){return new oo(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return null==e?null:new oo(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new io(Xs(this._delegate,e,t),this)}putString(e,t=Yi.RAW,n){this._throwIfRoot("putString");const r=Zi(t,e),i=Object.assign({},n);return null==i.contentType&&null!=r.contentType&&(i.contentType=r.contentType),new io(new Ms(this._delegate,new rs(r.data,!0),i),this)}listAll(){return function(e){return Fs(e=(0,r.m9)(e))}(this._delegate).then((e=>new so(e,this.storage)))}list(e){return function(e,t){return qs(e=(0,r.m9)(e),t)}(this._delegate,e||void 0).then((e=>new so(e,this.storage)))}getMetadata(){return Zs(this._delegate)}updateMetadata(e){return function(e,t){return js(e=(0,r.m9)(e),t)}(this._delegate,e)}getDownloadURL(){return function(e){return Bs(e=(0,r.m9)(e))}(this._delegate)}delete(){return this._throwIfRoot("delete"),function(e){return zs(e=(0,r.m9)(e))}(this._delegate)}_throwIfRoot(e){if(""===this._delegate._location.path)throw Li(e)}}class ao{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(co(e))throw Pi("ref() expected a child path but got a URL, use refFromURL instead.");return new oo(eo(this._delegate,e),this)}refFromURL(e){if(!co(e))throw Pi("refFromURL() expected a full URL but got a child path, use ref() instead.");try{Fi.makeFromUrl(e,this._delegate.host)}catch(t){throw Pi("refFromUrl() expected a valid full URL but got an invalid one.")}return new oo(eo(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,n={}){to(this._delegate,e,t,n)}}function co(e){return/^[A-Za-z]+:\/\//.test(e)}function uo(e,{instanceIdentifier:t}){const n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("storage").getImmediate({identifier:t});return new ao(n,r)}!function(e){const t={TaskState:Rs,TaskEvent:Cs,StringFormat:Yi,Storage:ao,Reference:oo};e.INTERNAL.registerComponent(new i.wA("storage-compat",uo,"PUBLIC").setServiceProps(t).setMultipleInstances(!0)),e.registerVersion("@firebase/storage-compat","0.1.9")}(d);var ho=n(8676);const lo="@firebase/installations",fo="0.5.5",po=1e4,mo="w:0.5.5",go="FIS_v2",yo=36e5,vo={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},wo=new r.LL("installations","Installations",vo);function _o(e){return e instanceof r.ZR&&e.code.includes("request-failed")}function bo({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function Io(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function To(e,t){const n=(await t.json()).error;return wo.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Eo({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function ko(e,{refreshToken:t}){const n=Eo(e);return n.append("Authorization",function(e){return`FIS_v2 ${e}`}(t)),n}async function So(e){const t=await e();return t.status>=500&&t.status<600?e():t}function Ao(e){return new Promise((t=>{setTimeout(t,e)}))}const Co=/^[cdef][\w-]{21}$/;function Ro(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22);var t}(e);return Co.test(t)?t:""}catch(e){return""}}function No(e){return`${e.appName}!${e.appId}`}const Do=new Map;function Oo(e,t){const n=No(e);Po(n,t),function(e,t){const n=Lo();n&&n.postMessage({key:e,fid:t});Mo()}(n,t)}function Po(e,t){const n=Do.get(e);if(n)for(const r of n)r(t)}let xo=null;function Lo(){return!xo&&"BroadcastChannel"in self&&(xo=new BroadcastChannel("[Firebase] FID Change"),xo.onmessage=e=>{Po(e.data.key,e.data.fid)}),xo}function Mo(){0===Do.size&&xo&&(xo.close(),xo=null)}const Uo="firebase-installations-store";let Fo=null;function Vo(){return Fo||(Fo=(0,ho.openDb)("firebase-installations-database",1,(e=>{switch(e.oldVersion){case 0:e.createObjectStore(Uo)}}))),Fo}async function qo(e,t){const n=No(e),r=(await Vo()).transaction(Uo,"readwrite"),i=r.objectStore(Uo),s=await i.get(n);return await i.put(t,n),await r.complete,s&&s.fid===t.fid||Oo(e,t.fid),t}async function jo(e){const t=No(e),n=(await Vo()).transaction(Uo,"readwrite");await n.objectStore(Uo).delete(t),await n.complete}async function Bo(e,t){const n=No(e),r=(await Vo()).transaction(Uo,"readwrite"),i=r.objectStore(Uo),s=await i.get(n),o=t(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.complete,!o||s&&s.fid===o.fid||Oo(e,o.fid),o}async function zo(e){let t;const n=await Bo(e,(n=>{const r=function(e){return Wo(e||{fid:Ro(),registrationStatus:0})}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine){return{installationEntry:t,registrationPromise:Promise.reject(wo.create("app-offline"))}}const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:n,registrationPromise:async function(e,t){try{return qo(e,await async function(e,{fid:t}){const n=bo(e),r=Eo(e),i={fid:t,authVersion:go,appId:e.appId,sdkVersion:mo},s={method:"POST",headers:r,body:JSON.stringify(i)},o=await So((()=>fetch(n,s)));if(o.ok){const e=await o.json();return{fid:e.fid||t,registrationStatus:2,refreshToken:e.refreshToken,authToken:Io(e.authToken)}}throw await To("Create Installation",o)}(e,t))}catch(n){throw _o(n)&&409===n.customData.serverCode?await jo(e):await qo(e,{fid:t.fid,registrationStatus:0}),n}}(e,n)}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:$o(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function $o(e){let t=await Ko(e);for(;1===t.registrationStatus;)await Ao(100),t=await Ko(e);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await zo(e);return n||t}return t}function Ko(e){return Bo(e,(e=>{if(!e)throw wo.create("installation-not-found");return Wo(e)}))}function Wo(e){return 1===(t=e).registrationStatus&&t.registrationTime+po<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function Ho({appConfig:e,platformLoggerProvider:t},n){const r=function(e,{fid:t}){return`${bo(e)}/${t}/authTokens:generate`}(e,n),i=ko(e,n),s=t.getImmediate({optional:!0});s&&i.append("x-firebase-client",s.getPlatformInfoString());const o={installation:{sdkVersion:mo}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await So((()=>fetch(r,a)));if(c.ok){return Io(await c.json())}throw await To("Generate Auth Token",c)}async function Go(e,t=!1){let n;const r=await Bo(e.appConfig,(r=>{if(!Jo(r))throw wo.create("not-registered");const i=r.authToken;if(!t&&function(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+yo}(e)}(i))return r;if(1===i.requestStatus)return n=async function(e,t){let n=await Qo(e.appConfig);for(;1===n.authToken.requestStatus;)await Ao(100),n=await Qo(e.appConfig);const r=n.authToken;return 0===r.requestStatus?Go(e,t):r}(e,t),r;{if(!navigator.onLine)throw wo.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return n=async function(e,t){try{const n=await Ho(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await qo(e.appConfig,r),n}catch(n){if(!_o(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await qo(e.appConfig,n)}else await jo(e.appConfig);throw n}}(e,t),t}}));return n?await n:r.authToken}function Qo(e){return Bo(e,(e=>{if(!Jo(e))throw wo.create("not-registered");const t=e.authToken;return 1===(n=t).requestStatus&&n.requestTime+po<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var n}))}function Jo(e){return void 0!==e&&2===e.registrationStatus}async function Yo(e,t=!1){const n=e;await async function(e){const{registrationPromise:t}=await zo(e);t&&await t}(n.appConfig);return(await Go(n,t)).token}function Xo(e){return wo.create("missing-app-config-values",{valueName:e})}const Zo="installations",ea=e=>{const t=e.getProvider("app").getImmediate();return{app:t,appConfig:function(e){if(!e||!e.options)throw Xo("App Configuration");if(!e.name)throw Xo("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Xo(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),platformLoggerProvider:(0,s._getProvider)(t,"platform-logger"),_delete:()=>Promise.resolve()}},ta=e=>{const t=e.getProvider("app").getImmediate(),n=(0,s._getProvider)(t,Zo).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await zo(t.appConfig);return r?r.catch(console.error):Go(t).catch(console.error),n.fid}(n),getToken:e=>Yo(n,e)}};(0,s._registerComponent)(new i.wA(Zo,ea,"PUBLIC")),(0,s._registerComponent)(new i.wA("installations-internal",ta,"PRIVATE")),(0,s.registerVersion)(lo,fo),(0,s.registerVersion)(lo,fo,"esm2017");const na="analytics",ra="https://www.googletagmanager.com/gtag/js",ia=new o.Yd("@firebase/analytics");function sa(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}function oa(e,t,n,r){return async function(i,s,o){try{"event"===i?await async function(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=await sa(n);for(const n of e){const e=r.find((e=>e.measurementId===n)),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",r,i||{})}catch(s){ia.error(s)}}(e,t,n,s,o):"config"===i?await async function(e,t,n,r,i,s){const o=r[i];try{if(o)await t[o];else{const e=(await sa(n)).find((e=>e.measurementId===i));e&&await t[e.appId]}}catch(a){ia.error(a)}e("config",i,s)}(e,t,n,r,s,o):e("set",s)}catch(a){ia.error(a)}}}const aa={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'},ca=new r.LL("analytics","Analytics",aa);const ua=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function ha(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function la(e,t=ua,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw ca.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw ca.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new fa;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),da({appId:r,apiKey:i,measurementId:s},o,a,t)}async function da(e,{throttleEndTimeMillis:t,backoffCount:n},i,s=ua){const{appId:o,measurementId:a}=e;try{await function(e,t){return new Promise(((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener((()=>{clearTimeout(s),r(ca.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(i,t)}catch(c){if(a)return ia.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c.message}]`),{appId:o,measurementId:a};throw c}try{const t=await async function(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:ha(r)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(a){}throw ca.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return s.deleteThrottleMetadata(o),t}catch(c){if(!function(e){if(!(e instanceof r.ZR)||!e.customData)return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(c)){if(s.deleteThrottleMetadata(o),a)return ia.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c.message}]`),{appId:o,measurementId:a};throw c}const t=503===Number(c.customData.httpStatus)?(0,r.$s)(n,s.intervalMillis,30):(0,r.$s)(n,s.intervalMillis),u={throttleEndTimeMillis:Date.now()+t,backoffCount:n+1};return s.setThrottleMetadata(o,u),ia.debug(`Calling attemptFetch again in ${t} millis`),da(e,u,i,s)}}class fa{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}async function pa(e,t,n,i,s,o,a){var c;const u=la(e);u.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&ia.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>ia.error(e))),t.push(u);const h=async function(){if(!(0,r.hl)())return ia.warn(ca.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await(0,r.eu)()}catch(e){return ia.warn(ca.create("indexeddb-unavailable",{errorInfo:e}).message),!1}return!0}().then((e=>e?i.getId():void 0)),[l,d]=await Promise.all([u,h]);(function(){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(ra))return t;return null})()||function(e,t){const n=document.createElement("script");n.src=`${ra}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(o,l.measurementId),s("js",new Date);const f=null!==(c=null===a||void 0===a?void 0:a.config)&&void 0!==c?c:{};return f.origin="firebase",f.update=!0,null!=d&&(f.firebase_id=d),s("config",l.measurementId,f),l.measurementId}class ma{constructor(e){this.app=e}_delete(){return delete ga[this.app.options.appId],Promise.resolve()}}let ga={},ya=[];const va={};let wa,_a,ba="dataLayer",Ia="gtag",Ta=!1;function Ea(e,t,n){!function(){const e=[];if((0,r.ru)()&&e.push("This is a browser extension environment."),(0,r.zI)()||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=ca.create("invalid-analytics-context",{errorInfo:t});ia.warn(n.message)}}();const i=e.options.appId;if(!i)throw ca.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw ca.create("no-api-key");ia.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=ga[i])throw ca.create("already-exists",{id:i});if(!Ta){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(ba);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"===typeof window[i]&&(s=window[i]),window[i]=oa(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(ga,ya,va,ba,Ia);_a=e,wa=t,Ta=!0}ga[i]=pa(e,ya,va,t,wa,ba,n);return new ma(e)}function ka(e,t,n,i){e=(0,r.m9)(e),async function(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=await t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}(_a,ga[e.app.options.appId],t,n,i).catch((e=>ia.error(e)))}const Sa="@firebase/analytics",Aa="0.7.5";(0,s._registerComponent)(new i.wA(na,((e,{options:t})=>Ea(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),(0,s._registerComponent)(new i.wA("analytics-internal",(function(e){try{const t=e.getProvider(na).getImmediate();return{logEvent:(e,n,r)=>ka(t,e,n,r)}}catch(t){throw ca.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),(0,s.registerVersion)(Sa,Aa),(0,s.registerVersion)(Sa,Aa,"esm2017");var Ca=d.initializeApp({apiKey:"AIzaSyCAKRrmxFh9iXniBOqKqBlrvk6ZGza5vC4",authDomain:"dev-kekw.firebaseapp.com",projectId:"dev-kekw",storageBucket:"dev-kekw.appspot.com",messagingSenderId:"676359168620",appId:"1:676359168620:web:c26cd50cb5cf0a8526ae49"}),Ra=Ca.auth(),Na=Ca.firestore()},8510:function(e,t,n){"use strict";n.r(t);var r=n(5893),i=(n(9008),n(906),n(7802));function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){s(e,t,n[t])}))}return e}t.default=function(e){var t=e.Component,n=e.pageProps;return(0,r.jsx)(i.Z,{children:(0,r.jsx)(t,o({},n))})}},906:function(){},7663:function(e){!function(){var t={162:function(e){var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"===typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"===typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var a,c=[],u=!1,h=-1;function l(){u&&a&&(u=!1,a.length?c=a.concat(c):h=-1,c.length&&d())}function d(){if(!u){var e=o(l);u=!0;for(var t=c.length;t;){for(a=c,c=[];++h<t;)a&&a[h].run();h=-1,t=c.length}a=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||u||o(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=p,r.addListener=p,r.once=p,r.off=p,r.removeListener=p,r.removeAllListeners=p,r.emit=p,r.prependListener=p,r.prependOnceListener=p,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var s=n[e]={exports:{}},o=!0;try{t[e](s,s.exports,r),o=!1}finally{o&&delete n[e]}return s.exports}r.ab="//";var i=r(162);e.exports=i}()},9008:function(e,t,n){n(5443)},2238:function(e,t,n){"use strict";n.r(t),n.d(t,{FirebaseError:function(){return s.ZR},SDK_VERSION:function(){return T},_DEFAULT_ENTRY_NAME:function(){return h},_addComponent:function(){return p},_addOrOverwriteComponent:function(){return m},_apps:function(){return d},_clearComponents:function(){return w},_components:function(){return f},_getProvider:function(){return y},_registerComponent:function(){return g},_removeServiceInstance:function(){return v},deleteApp:function(){return A},getApp:function(){return k},getApps:function(){return S},initializeApp:function(){return E},onLog:function(){return R},registerVersion:function(){return C},setLogLevel:function(){return N}});var r=n(8463),i=n(3333),s=n(4444);class o{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const a="@firebase/app",c="0.7.14",u=new i.Yd("@firebase/app"),h="[DEFAULT]",l={[a]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},d=new Map,f=new Map;function p(e,t){try{e.container.addComponent(t)}catch(n){u.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function m(e,t){e.container.addOrOverwriteComponent(t)}function g(e){const t=e.name;if(f.has(t))return u.debug(`There were multiple attempts to register component ${t}.`),!1;f.set(t,e);for(const n of d.values())p(n,e);return!0}function y(e,t){return e.container.getProvider(t)}function v(e,t,n=h){y(e,t).clearInstance(n)}function w(){f.clear()}const _={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."},b=new s.LL("app","Firebase",_);class I{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw b.create("app-deleted",{appName:this._name})}}const T="9.6.4";function E(e,t={}){if("object"!==typeof t){t={name:t}}const n=Object.assign({name:h,automaticDataCollectionEnabled:!1},t),i=n.name;if("string"!==typeof i||!i)throw b.create("bad-app-name",{appName:String(i)});const o=d.get(i);if(o){if((0,s.vZ)(e,o.options)&&(0,s.vZ)(n,o.config))return o;throw b.create("duplicate-app",{appName:i})}const a=new r.H0(i);for(const r of f.values())a.addComponent(r);const c=new I(e,n,a);return d.set(i,c),c}function k(e=h){const t=d.get(e);if(!t)throw b.create("no-app",{appName:e});return t}function S(){return Array.from(d.values())}async function A(e){const t=e.name;d.has(t)&&(d.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function C(e,t,n){var i;let s=null!==(i=l[e])&&void 0!==i?i:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${s}" with version "${t}":`];return o&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void u.warn(e.join(" "))}g(new r.wA(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}function R(e,t){if(null!==e&&"function"!==typeof e)throw b.create("invalid-log-argument");(0,i.Am)(e,t)}function N(e){(0,i.Ub)(e)}var D;D="",g(new r.wA("platform-logger",(e=>new o(e)),"PRIVATE")),C(a,c,D),C(a,c,"esm2017"),C("fire-js","")},8463:function(e,t,n){"use strict";n.d(t,{wA:function(){return i},H0:function(){return a}});var r=n(4444);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const s="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.BH;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,s]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&s.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===s?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(i){}var r;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},3333:function(e,t,n){"use strict";n.d(t,{in:function(){return i},Yd:function(){return u},Ub:function(){return h},Am:function(){return l}});const r=[];var i;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=a[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class u{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}function h(e){r.forEach((t=>{t.setLogLevel(e)}))}function l(e,t){for(const n of r){let r=null;t&&t.level&&(r=s[t.level]),n.userLogHandler=null===e?null:(t,n,...s)=>{const o=s.map((e=>{if(null==e)return null;if("string"===typeof e)return e;if("number"===typeof e||"boolean"===typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}})).filter((e=>e)).join(" ");n>=(null!==r&&void 0!==r?r:t.logLevel)&&e({level:i[n].toLowerCase(),message:o,args:s,type:t.name})}}}}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[774,179],(function(){return t(1780),t(387)}));var n=e.O();_N_E=n}]);